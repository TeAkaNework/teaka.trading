const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browser-CIga-qhc.js","assets/vendor-Dsvubs-V.js"])))=>i.map(i=>d[i]);
var C2=Object.defineProperty;var Ny=n=>{throw TypeError(n)};var N2=(n,e,t)=>e in n?C2(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var we=(n,e,t)=>N2(n,typeof e!="symbol"?e+"":e,t),bd=(n,e,t)=>e.has(n)||Ny("Cannot "+t);var yn=(n,e,t)=>(bd(n,e,"read from private field"),t?t.call(n):e.get(n)),Ed=(n,e,t)=>e.has(n)?Ny("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),gu=(n,e,t,r)=>(bd(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),Td=(n,e,t)=>(bd(n,e,"access private method"),t);import{j as m,L as _h,M as O2,A as k2,a as j2,S as Ng,C as D2,T as Ui,b as ri,B as fl,P as Oy,c as M2,d as ky,e as L2,f as Og,g as Fp,h as __,D as V2,Z as F2,i as U2,H as $2,I as B2,k as Lu,R as b_,l as E_,m as T_,n as q2,o as Sd,W as jy}from"./ui-DSZLNWtS.js";import{a as W2,r as se,c as $t,g as zi,b as z2,d as kg,W as Uo}from"./vendor-Dsvubs-V.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var S_,Dy=W2;S_=Dy.createRoot,Dy.hydrateRoot;function My(){return m.jsx("nav",{className:"border-b border-gray-800 px-6 py-4",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx(_h,{className:"w-8 h-8 text-blue-500"}),m.jsx("span",{className:"text-xl font-bold",children:"Teaka Trade"})]}),m.jsxs("div",{className:"hidden md:flex items-center space-x-6",children:[m.jsx("a",{href:"#",className:"hover:text-blue-500",children:"Dashboard"}),m.jsx("a",{href:"#",className:"hover:text-blue-500",children:"Algorithms"}),m.jsx("a",{href:"#",className:"hover:text-blue-500",children:"Portfolio"}),m.jsx("a",{href:"#",className:"hover:text-blue-500",children:"Analytics"})]}),m.jsx("button",{className:"md:hidden",children:m.jsx(O2,{className:"w-6 h-6"})})]})})}function G2({title:n,value:e,icon:t,change:r,positive:s}){return m.jsxs("div",{className:"bg-gray-900 rounded-lg p-6",children:[m.jsx("div",{className:"flex items-center justify-between mb-4",children:m.jsxs("div",{className:"flex items-center space-x-3",children:[t,m.jsx("h3",{className:"text-gray-400",children:n})]})}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-2xl font-bold",children:e}),m.jsxs("div",{className:`flex items-center ${s?"text-green-500":"text-red-500"}`,children:[s?m.jsx(k2,{className:"w-4 h-4"}):m.jsx(j2,{className:"w-4 h-4"}),m.jsx("span",{children:r})]})]})]})}function jg({symbol:n,theme:e="dark"}){const t=se.useRef(null),r=se.useRef(null);return se.useEffect(()=>{if(!t.current)return;const s=document.createElement("script");return s.src="https://s3.tradingview.com/tv.js",s.async=!0,s.onload=()=>{window.TradingView&&t.current&&new window.TradingView.widget({container_id:t.current.id,symbol:`BINANCE:${n}`,interval:"D",timezone:"Etc/UTC",theme:e,style:"1",locale:"en",toolbar_bg:"#f1f3f6",enable_publishing:!1,allow_symbol_change:!0,save_image:!1,studies:["MASimple@tv-basicstudies","RSI@tv-basicstudies","MACD@tv-basicstudies"],show_popup_button:!0,popup_width:"1000",popup_height:"650",hide_side_toolbar:!1,withdateranges:!0,hide_volume:!1,width:"100%",height:"100%"})},r.current=s,document.head.appendChild(s),()=>{r.current&&document.head.removeChild(r.current)}},[n,e]),m.jsx("div",{id:"tradingview_widget",ref:t,className:"h-full w-full"})}function H2({symbol:n,theme:e="dark"}){return m.jsx("iframe",{src:`https://charts.trendspider.com/embed/${n}?theme=${e}`,style:{width:"100%",height:"100%",border:"none"},title:"TrendSpider Chart"})}function K2({symbol:n,theme:e="dark"}){return m.jsx("iframe",{src:`https://trade-ideas.com/chart/${n}?theme=${e}`,style:{width:"100%",height:"100%",border:"none"},title:"Trade Ideas Chart"})}/*!
 *  decimal.js v10.5.0
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2025 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */var Up=9e15,ni=1e9,$p="0123456789abcdef",Xu="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Zu="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Bp={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-9e15,maxE:Up,crypto:!1},x_,us,xe=!0,bh="[DecimalError] ",Xs=bh+"Invalid argument: ",A_=bh+"Precision limit exceeded",R_=bh+"crypto unavailable",I_="[object Decimal]",wr=Math.floor,Ut=Math.pow,Q2=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,J2=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Y2=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,P_=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,_n=1e7,_e=7,X2=9007199254740991,Z2=Xu.length-1,qp=Zu.length-1,ee={toStringTag:I_};ee.absoluteValue=ee.abs=function(){var n=new this.constructor(this);return n.s<0&&(n.s=1),ge(n)};ee.ceil=function(){return ge(new this.constructor(this),this.e+1,2)};ee.clampedTo=ee.clamp=function(n,e){var t,r=this,s=r.constructor;if(n=new s(n),e=new s(e),!n.s||!e.s)return new s(NaN);if(n.gt(e))throw Error(Xs+e);return t=r.cmp(n),t<0?n:r.cmp(e)>0?e:new s(r)};ee.comparedTo=ee.cmp=function(n){var e,t,r,s,i=this,o=i.d,l=(n=new i.constructor(n)).d,u=i.s,h=n.s;if(!o||!l)return!u||!h?NaN:u!==h?u:o===l?0:!o^u<0?1:-1;if(!o[0]||!l[0])return o[0]?u:l[0]?-h:0;if(u!==h)return u;if(i.e!==n.e)return i.e>n.e^u<0?1:-1;for(r=o.length,s=l.length,e=0,t=r<s?r:s;e<t;++e)if(o[e]!==l[e])return o[e]>l[e]^u<0?1:-1;return r===s?0:r>s^u<0?1:-1};ee.cosine=ee.cos=function(){var n,e,t=this,r=t.constructor;return t.d?t.d[0]?(n=r.precision,e=r.rounding,r.precision=n+Math.max(t.e,t.sd())+_e,r.rounding=1,t=eP(r,j_(r,t)),r.precision=n,r.rounding=e,ge(us==2||us==3?t.neg():t,n,e,!0)):new r(1):new r(NaN)};ee.cubeRoot=ee.cbrt=function(){var n,e,t,r,s,i,o,l,u,h,d=this,g=d.constructor;if(!d.isFinite()||d.isZero())return new g(d);for(xe=!1,i=d.s*Ut(d.s*d,1/3),!i||Math.abs(i)==1/0?(t=tr(d.d),n=d.e,(i=(n-t.length+1)%3)&&(t+=i==1||i==-2?"0":"00"),i=Ut(t,1/3),n=wr((n+1)/3)-(n%3==(n<0?-1:2)),i==1/0?t="5e"+n:(t=i.toExponential(),t=t.slice(0,t.indexOf("e")+1)+n),r=new g(t),r.s=d.s):r=new g(i.toString()),o=(n=g.precision)+3;;)if(l=r,u=l.times(l).times(l),h=u.plus(d),r=ut(h.plus(d).times(l),h.plus(u),o+2,1),tr(l.d).slice(0,o)===(t=tr(r.d)).slice(0,o))if(t=t.slice(o-3,o+1),t=="9999"||!s&&t=="4999"){if(!s&&(ge(l,n+1,0),l.times(l).times(l).eq(d))){r=l;break}o+=4,s=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(ge(r,n+1,1),e=!r.times(r).times(r).eq(d));break}return xe=!0,ge(r,n,g.rounding,e)};ee.decimalPlaces=ee.dp=function(){var n,e=this.d,t=NaN;if(e){if(n=e.length-1,t=(n-wr(this.e/_e))*_e,n=e[n],n)for(;n%10==0;n/=10)t--;t<0&&(t=0)}return t};ee.dividedBy=ee.div=function(n){return ut(this,new this.constructor(n))};ee.dividedToIntegerBy=ee.divToInt=function(n){var e=this,t=e.constructor;return ge(ut(e,new t(n),0,1,1),t.precision,t.rounding)};ee.equals=ee.eq=function(n){return this.cmp(n)===0};ee.floor=function(){return ge(new this.constructor(this),this.e+1,3)};ee.greaterThan=ee.gt=function(n){return this.cmp(n)>0};ee.greaterThanOrEqualTo=ee.gte=function(n){var e=this.cmp(n);return e==1||e===0};ee.hyperbolicCosine=ee.cosh=function(){var n,e,t,r,s,i=this,o=i.constructor,l=new o(1);if(!i.isFinite())return new o(i.s?1/0:NaN);if(i.isZero())return l;t=o.precision,r=o.rounding,o.precision=t+Math.max(i.e,i.sd())+4,o.rounding=1,s=i.d.length,s<32?(n=Math.ceil(s/3),e=(1/Th(4,n)).toString()):(n=16,e="2.3283064365386962890625e-10"),i=Wo(o,1,i.times(e),new o(1),!0);for(var u,h=n,d=new o(8);h--;)u=i.times(i),i=l.minus(u.times(d.minus(u.times(d))));return ge(i,o.precision=t,o.rounding=r,!0)};ee.hyperbolicSine=ee.sinh=function(){var n,e,t,r,s=this,i=s.constructor;if(!s.isFinite()||s.isZero())return new i(s);if(e=i.precision,t=i.rounding,i.precision=e+Math.max(s.e,s.sd())+4,i.rounding=1,r=s.d.length,r<3)s=Wo(i,2,s,s,!0);else{n=1.4*Math.sqrt(r),n=n>16?16:n|0,s=s.times(1/Th(5,n)),s=Wo(i,2,s,s,!0);for(var o,l=new i(5),u=new i(16),h=new i(20);n--;)o=s.times(s),s=s.times(l.plus(o.times(u.times(o).plus(h))))}return i.precision=e,i.rounding=t,ge(s,e,t,!0)};ee.hyperbolicTangent=ee.tanh=function(){var n,e,t=this,r=t.constructor;return t.isFinite()?t.isZero()?new r(t):(n=r.precision,e=r.rounding,r.precision=n+7,r.rounding=1,ut(t.sinh(),t.cosh(),r.precision=n,r.rounding=e)):new r(t.s)};ee.inverseCosine=ee.acos=function(){var n=this,e=n.constructor,t=n.abs().cmp(1),r=e.precision,s=e.rounding;return t!==-1?t===0?n.isNeg()?kn(e,r,s):new e(0):new e(NaN):n.isZero()?kn(e,r+4,s).times(.5):(e.precision=r+6,e.rounding=1,n=new e(1).minus(n).div(n.plus(1)).sqrt().atan(),e.precision=r,e.rounding=s,n.times(2))};ee.inverseHyperbolicCosine=ee.acosh=function(){var n,e,t=this,r=t.constructor;return t.lte(1)?new r(t.eq(1)?0:NaN):t.isFinite()?(n=r.precision,e=r.rounding,r.precision=n+Math.max(Math.abs(t.e),t.sd())+4,r.rounding=1,xe=!1,t=t.times(t).minus(1).sqrt().plus(t),xe=!0,r.precision=n,r.rounding=e,t.ln()):new r(t)};ee.inverseHyperbolicSine=ee.asinh=function(){var n,e,t=this,r=t.constructor;return!t.isFinite()||t.isZero()?new r(t):(n=r.precision,e=r.rounding,r.precision=n+2*Math.max(Math.abs(t.e),t.sd())+6,r.rounding=1,xe=!1,t=t.times(t).plus(1).sqrt().plus(t),xe=!0,r.precision=n,r.rounding=e,t.ln())};ee.inverseHyperbolicTangent=ee.atanh=function(){var n,e,t,r,s=this,i=s.constructor;return s.isFinite()?s.e>=0?new i(s.abs().eq(1)?s.s/0:s.isZero()?s:NaN):(n=i.precision,e=i.rounding,r=s.sd(),Math.max(r,n)<2*-s.e-1?ge(new i(s),n,e,!0):(i.precision=t=r-s.e,s=ut(s.plus(1),new i(1).minus(s),t+n,1),i.precision=n+4,i.rounding=1,s=s.ln(),i.precision=n,i.rounding=e,s.times(.5))):new i(NaN)};ee.inverseSine=ee.asin=function(){var n,e,t,r,s=this,i=s.constructor;return s.isZero()?new i(s):(e=s.abs().cmp(1),t=i.precision,r=i.rounding,e!==-1?e===0?(n=kn(i,t+4,r).times(.5),n.s=s.s,n):new i(NaN):(i.precision=t+6,i.rounding=1,s=s.div(new i(1).minus(s.times(s)).sqrt().plus(1)).atan(),i.precision=t,i.rounding=r,s.times(2)))};ee.inverseTangent=ee.atan=function(){var n,e,t,r,s,i,o,l,u,h=this,d=h.constructor,g=d.precision,v=d.rounding;if(h.isFinite()){if(h.isZero())return new d(h);if(h.abs().eq(1)&&g+4<=qp)return o=kn(d,g+4,v).times(.25),o.s=h.s,o}else{if(!h.s)return new d(NaN);if(g+4<=qp)return o=kn(d,g+4,v).times(.5),o.s=h.s,o}for(d.precision=l=g+10,d.rounding=1,t=Math.min(28,l/_e+2|0),n=t;n;--n)h=h.div(h.times(h).plus(1).sqrt().plus(1));for(xe=!1,e=Math.ceil(l/_e),r=1,u=h.times(h),o=new d(h),s=h;n!==-1;)if(s=s.times(u),i=o.minus(s.div(r+=2)),s=s.times(u),o=i.plus(s.div(r+=2)),o.d[e]!==void 0)for(n=e;o.d[n]===i.d[n]&&n--;);return t&&(o=o.times(2<<t-1)),xe=!0,ge(o,d.precision=g,d.rounding=v,!0)};ee.isFinite=function(){return!!this.d};ee.isInteger=ee.isInt=function(){return!!this.d&&wr(this.e/_e)>this.d.length-2};ee.isNaN=function(){return!this.s};ee.isNegative=ee.isNeg=function(){return this.s<0};ee.isPositive=ee.isPos=function(){return this.s>0};ee.isZero=function(){return!!this.d&&this.d[0]===0};ee.lessThan=ee.lt=function(n){return this.cmp(n)<0};ee.lessThanOrEqualTo=ee.lte=function(n){return this.cmp(n)<1};ee.logarithm=ee.log=function(n){var e,t,r,s,i,o,l,u,h=this,d=h.constructor,g=d.precision,v=d.rounding,_=5;if(n==null)n=new d(10),e=!0;else{if(n=new d(n),t=n.d,n.s<0||!t||!t[0]||n.eq(1))return new d(NaN);e=n.eq(10)}if(t=h.d,h.s<0||!t||!t[0]||h.eq(1))return new d(t&&!t[0]?-1/0:h.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)i=!0;else{for(s=t[0];s%10===0;)s/=10;i=s!==1}if(xe=!1,l=g+_,o=Ws(h,l),r=e?eh(d,l+10):Ws(n,l),u=ut(o,r,l,1),Tl(u.d,s=g,v))do if(l+=10,o=Ws(h,l),r=e?eh(d,l+10):Ws(n,l),u=ut(o,r,l,1),!i){+tr(u.d).slice(s+1,s+15)+1==1e14&&(u=ge(u,g+1,0));break}while(Tl(u.d,s+=10,v));return xe=!0,ge(u,g,v)};ee.minus=ee.sub=function(n){var e,t,r,s,i,o,l,u,h,d,g,v,_=this,E=_.constructor;if(n=new E(n),!_.d||!n.d)return!_.s||!n.s?n=new E(NaN):_.d?n.s=-n.s:n=new E(n.d||_.s!==n.s?_:NaN),n;if(_.s!=n.s)return n.s=-n.s,_.plus(n);if(h=_.d,v=n.d,l=E.precision,u=E.rounding,!h[0]||!v[0]){if(v[0])n.s=-n.s;else if(h[0])n=new E(_);else return new E(u===3?-0:0);return xe?ge(n,l,u):n}if(t=wr(n.e/_e),d=wr(_.e/_e),h=h.slice(),i=d-t,i){for(g=i<0,g?(e=h,i=-i,o=v.length):(e=v,t=d,o=h.length),r=Math.max(Math.ceil(l/_e),o)+2,i>r&&(i=r,e.length=1),e.reverse(),r=i;r--;)e.push(0);e.reverse()}else{for(r=h.length,o=v.length,g=r<o,g&&(o=r),r=0;r<o;r++)if(h[r]!=v[r]){g=h[r]<v[r];break}i=0}for(g&&(e=h,h=v,v=e,n.s=-n.s),o=h.length,r=v.length-o;r>0;--r)h[o++]=0;for(r=v.length;r>i;){if(h[--r]<v[r]){for(s=r;s&&h[--s]===0;)h[s]=_n-1;--h[s],h[r]+=_n}h[r]-=v[r]}for(;h[--o]===0;)h.pop();for(;h[0]===0;h.shift())--t;return h[0]?(n.d=h,n.e=Eh(h,t),xe?ge(n,l,u):n):new E(u===3?-0:0)};ee.modulo=ee.mod=function(n){var e,t=this,r=t.constructor;return n=new r(n),!t.d||!n.s||n.d&&!n.d[0]?new r(NaN):!n.d||t.d&&!t.d[0]?ge(new r(t),r.precision,r.rounding):(xe=!1,r.modulo==9?(e=ut(t,n.abs(),0,3,1),e.s*=n.s):e=ut(t,n,0,r.modulo,1),e=e.times(n),xe=!0,t.minus(e))};ee.naturalExponential=ee.exp=function(){return Wp(this)};ee.naturalLogarithm=ee.ln=function(){return Ws(this)};ee.negated=ee.neg=function(){var n=new this.constructor(this);return n.s=-n.s,ge(n)};ee.plus=ee.add=function(n){var e,t,r,s,i,o,l,u,h,d,g=this,v=g.constructor;if(n=new v(n),!g.d||!n.d)return!g.s||!n.s?n=new v(NaN):g.d||(n=new v(n.d||g.s===n.s?g:NaN)),n;if(g.s!=n.s)return n.s=-n.s,g.minus(n);if(h=g.d,d=n.d,l=v.precision,u=v.rounding,!h[0]||!d[0])return d[0]||(n=new v(g)),xe?ge(n,l,u):n;if(i=wr(g.e/_e),r=wr(n.e/_e),h=h.slice(),s=i-r,s){for(s<0?(t=h,s=-s,o=d.length):(t=d,r=i,o=h.length),i=Math.ceil(l/_e),o=i>o?i+1:o+1,s>o&&(s=o,t.length=1),t.reverse();s--;)t.push(0);t.reverse()}for(o=h.length,s=d.length,o-s<0&&(s=o,t=d,d=h,h=t),e=0;s;)e=(h[--s]=h[s]+d[s]+e)/_n|0,h[s]%=_n;for(e&&(h.unshift(e),++r),o=h.length;h[--o]==0;)h.pop();return n.d=h,n.e=Eh(h,r),xe?ge(n,l,u):n};ee.precision=ee.sd=function(n){var e,t=this;if(n!==void 0&&n!==!!n&&n!==1&&n!==0)throw Error(Xs+n);return t.d?(e=C_(t.d),n&&t.e+1>e&&(e=t.e+1)):e=NaN,e};ee.round=function(){var n=this,e=n.constructor;return ge(new e(n),n.e+1,e.rounding)};ee.sine=ee.sin=function(){var n,e,t=this,r=t.constructor;return t.isFinite()?t.isZero()?new r(t):(n=r.precision,e=r.rounding,r.precision=n+Math.max(t.e,t.sd())+_e,r.rounding=1,t=rP(r,j_(r,t)),r.precision=n,r.rounding=e,ge(us>2?t.neg():t,n,e,!0)):new r(NaN)};ee.squareRoot=ee.sqrt=function(){var n,e,t,r,s,i,o=this,l=o.d,u=o.e,h=o.s,d=o.constructor;if(h!==1||!l||!l[0])return new d(!h||h<0&&(!l||l[0])?NaN:l?o:1/0);for(xe=!1,h=Math.sqrt(+o),h==0||h==1/0?(e=tr(l),(e.length+u)%2==0&&(e+="0"),h=Math.sqrt(e),u=wr((u+1)/2)-(u<0||u%2),h==1/0?e="5e"+u:(e=h.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),r=new d(e)):r=new d(h.toString()),t=(u=d.precision)+3;;)if(i=r,r=i.plus(ut(o,i,t+2,1)).times(.5),tr(i.d).slice(0,t)===(e=tr(r.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!s&&e=="4999"){if(!s&&(ge(i,u+1,0),i.times(i).eq(o))){r=i;break}t+=4,s=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(ge(r,u+1,1),n=!r.times(r).eq(o));break}return xe=!0,ge(r,u,d.rounding,n)};ee.tangent=ee.tan=function(){var n,e,t=this,r=t.constructor;return t.isFinite()?t.isZero()?new r(t):(n=r.precision,e=r.rounding,r.precision=n+10,r.rounding=1,t=t.sin(),t.s=1,t=ut(t,new r(1).minus(t.times(t)).sqrt(),n+10,0),r.precision=n,r.rounding=e,ge(us==2||us==4?t.neg():t,n,e,!0)):new r(NaN)};ee.times=ee.mul=function(n){var e,t,r,s,i,o,l,u,h,d=this,g=d.constructor,v=d.d,_=(n=new g(n)).d;if(n.s*=d.s,!v||!v[0]||!_||!_[0])return new g(!n.s||v&&!v[0]&&!_||_&&!_[0]&&!v?NaN:!v||!_?n.s/0:n.s*0);for(t=wr(d.e/_e)+wr(n.e/_e),u=v.length,h=_.length,u<h&&(i=v,v=_,_=i,o=u,u=h,h=o),i=[],o=u+h,r=o;r--;)i.push(0);for(r=h;--r>=0;){for(e=0,s=u+r;s>r;)l=i[s]+_[r]*v[s-r-1]+e,i[s--]=l%_n|0,e=l/_n|0;i[s]=(i[s]+e)%_n|0}for(;!i[--o];)i.pop();return e?++t:i.shift(),n.d=i,n.e=Eh(i,t),xe?ge(n,g.precision,g.rounding):n};ee.toBinary=function(n,e){return Dg(this,2,n,e)};ee.toDecimalPlaces=ee.toDP=function(n,e){var t=this,r=t.constructor;return t=new r(t),n===void 0?t:(jr(n,0,ni),e===void 0?e=r.rounding:jr(e,0,8),ge(t,n+t.e+1,e))};ee.toExponential=function(n,e){var t,r=this,s=r.constructor;return n===void 0?t=Vn(r,!0):(jr(n,0,ni),e===void 0?e=s.rounding:jr(e,0,8),r=ge(new s(r),n+1,e),t=Vn(r,!0,n+1)),r.isNeg()&&!r.isZero()?"-"+t:t};ee.toFixed=function(n,e){var t,r,s=this,i=s.constructor;return n===void 0?t=Vn(s):(jr(n,0,ni),e===void 0?e=i.rounding:jr(e,0,8),r=ge(new i(s),n+s.e+1,e),t=Vn(r,!1,n+r.e+1)),s.isNeg()&&!s.isZero()?"-"+t:t};ee.toFraction=function(n){var e,t,r,s,i,o,l,u,h,d,g,v,_=this,E=_.d,x=_.constructor;if(!E)return new x(_);if(h=t=new x(1),r=u=new x(0),e=new x(r),i=e.e=C_(E)-_.e-1,o=i%_e,e.d[0]=Ut(10,o<0?_e+o:o),n==null)n=i>0?e:h;else{if(l=new x(n),!l.isInt()||l.lt(h))throw Error(Xs+l);n=l.gt(e)?i>0?e:h:l}for(xe=!1,l=new x(tr(E)),d=x.precision,x.precision=i=E.length*_e*2;g=ut(l,e,0,1,1),s=t.plus(g.times(r)),s.cmp(n)!=1;)t=r,r=s,s=h,h=u.plus(g.times(s)),u=s,s=e,e=l.minus(g.times(s)),l=s;return s=ut(n.minus(t),r,0,1,1),u=u.plus(s.times(h)),t=t.plus(s.times(r)),u.s=h.s=_.s,v=ut(h,r,i,1).minus(_).abs().cmp(ut(u,t,i,1).minus(_).abs())<1?[h,r]:[u,t],x.precision=d,xe=!0,v};ee.toHexadecimal=ee.toHex=function(n,e){return Dg(this,16,n,e)};ee.toNearest=function(n,e){var t=this,r=t.constructor;if(t=new r(t),n==null){if(!t.d)return t;n=new r(1),e=r.rounding}else{if(n=new r(n),e===void 0?e=r.rounding:jr(e,0,8),!t.d)return n.s?t:n;if(!n.d)return n.s&&(n.s=t.s),n}return n.d[0]?(xe=!1,t=ut(t,n,0,e,1).times(n),xe=!0,ge(t)):(n.s=t.s,t=n),t};ee.toNumber=function(){return+this};ee.toOctal=function(n,e){return Dg(this,8,n,e)};ee.toPower=ee.pow=function(n){var e,t,r,s,i,o,l=this,u=l.constructor,h=+(n=new u(n));if(!l.d||!n.d||!l.d[0]||!n.d[0])return new u(Ut(+l,h));if(l=new u(l),l.eq(1))return l;if(r=u.precision,i=u.rounding,n.eq(1))return ge(l,r,i);if(e=wr(n.e/_e),e>=n.d.length-1&&(t=h<0?-h:h)<=X2)return s=N_(u,l,t,r),n.s<0?new u(1).div(s):ge(s,r,i);if(o=l.s,o<0){if(e<n.d.length-1)return new u(NaN);if(n.d[e]&1||(o=1),l.e==0&&l.d[0]==1&&l.d.length==1)return l.s=o,l}return t=Ut(+l,h),e=t==0||!isFinite(t)?wr(h*(Math.log("0."+tr(l.d))/Math.LN10+l.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?o/0:0):(xe=!1,u.rounding=l.s=1,t=Math.min(12,(e+"").length),s=Wp(n.times(Ws(l,r+t)),r),s.d&&(s=ge(s,r+5,1),Tl(s.d,r,i)&&(e=r+10,s=ge(Wp(n.times(Ws(l,e+t)),e),e+5,1),+tr(s.d).slice(r+1,r+15)+1==1e14&&(s=ge(s,r+1,0)))),s.s=o,xe=!0,u.rounding=i,ge(s,r,i))};ee.toPrecision=function(n,e){var t,r=this,s=r.constructor;return n===void 0?t=Vn(r,r.e<=s.toExpNeg||r.e>=s.toExpPos):(jr(n,1,ni),e===void 0?e=s.rounding:jr(e,0,8),r=ge(new s(r),n,e),t=Vn(r,n<=r.e||r.e<=s.toExpNeg,n)),r.isNeg()&&!r.isZero()?"-"+t:t};ee.toSignificantDigits=ee.toSD=function(n,e){var t=this,r=t.constructor;return n===void 0?(n=r.precision,e=r.rounding):(jr(n,1,ni),e===void 0?e=r.rounding:jr(e,0,8)),ge(new r(t),n,e)};ee.toString=function(){var n=this,e=n.constructor,t=Vn(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()&&!n.isZero()?"-"+t:t};ee.truncated=ee.trunc=function(){return ge(new this.constructor(this),this.e+1,1)};ee.valueOf=ee.toJSON=function(){var n=this,e=n.constructor,t=Vn(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()?"-"+t:t};function tr(n){var e,t,r,s=n.length-1,i="",o=n[0];if(s>0){for(i+=o,e=1;e<s;e++)r=n[e]+"",t=_e-r.length,t&&(i+=$s(t)),i+=r;o=n[e],r=o+"",t=_e-r.length,t&&(i+=$s(t))}else if(o===0)return"0";for(;o%10===0;)o/=10;return i+o}function jr(n,e,t){if(n!==~~n||n<e||n>t)throw Error(Xs+n)}function Tl(n,e,t,r){var s,i,o,l;for(i=n[0];i>=10;i/=10)--e;return--e<0?(e+=_e,s=0):(s=Math.ceil((e+1)/_e),e%=_e),i=Ut(10,_e-e),l=n[s]%i|0,r==null?e<3?(e==0?l=l/100|0:e==1&&(l=l/10|0),o=t<4&&l==99999||t>3&&l==49999||l==5e4||l==0):o=(t<4&&l+1==i||t>3&&l+1==i/2)&&(n[s+1]/i/100|0)==Ut(10,e-2)-1||(l==i/2||l==0)&&(n[s+1]/i/100|0)==0:e<4?(e==0?l=l/1e3|0:e==1?l=l/100|0:e==2&&(l=l/10|0),o=(r||t<4)&&l==9999||!r&&t>3&&l==4999):o=((r||t<4)&&l+1==i||!r&&t>3&&l+1==i/2)&&(n[s+1]/i/1e3|0)==Ut(10,e-3)-1,o}function Vu(n,e,t){for(var r,s=[0],i,o=0,l=n.length;o<l;){for(i=s.length;i--;)s[i]*=e;for(s[0]+=$p.indexOf(n.charAt(o++)),r=0;r<s.length;r++)s[r]>t-1&&(s[r+1]===void 0&&(s[r+1]=0),s[r+1]+=s[r]/t|0,s[r]%=t)}return s.reverse()}function eP(n,e){var t,r,s;if(e.isZero())return e;r=e.d.length,r<32?(t=Math.ceil(r/3),s=(1/Th(4,t)).toString()):(t=16,s="2.3283064365386962890625e-10"),n.precision+=t,e=Wo(n,1,e.times(s),new n(1));for(var i=t;i--;){var o=e.times(e);e=o.times(o).minus(o).times(8).plus(1)}return n.precision-=t,e}var ut=function(){function n(r,s,i){var o,l=0,u=r.length;for(r=r.slice();u--;)o=r[u]*s+l,r[u]=o%i|0,l=o/i|0;return l&&r.unshift(l),r}function e(r,s,i,o){var l,u;if(i!=o)u=i>o?1:-1;else for(l=u=0;l<i;l++)if(r[l]!=s[l]){u=r[l]>s[l]?1:-1;break}return u}function t(r,s,i,o){for(var l=0;i--;)r[i]-=l,l=r[i]<s[i]?1:0,r[i]=l*o+r[i]-s[i];for(;!r[0]&&r.length>1;)r.shift()}return function(r,s,i,o,l,u){var h,d,g,v,_,E,x,R,I,F,V,$,W,X,j,A,D,T,k,M,C=r.constructor,Te=r.s==s.s?1:-1,ne=r.d,oe=s.d;if(!ne||!ne[0]||!oe||!oe[0])return new C(!r.s||!s.s||(ne?oe&&ne[0]==oe[0]:!oe)?NaN:ne&&ne[0]==0||!oe?Te*0:Te/0);for(u?(_=1,d=r.e-s.e):(u=_n,_=_e,d=wr(r.e/_)-wr(s.e/_)),k=oe.length,D=ne.length,I=new C(Te),F=I.d=[],g=0;oe[g]==(ne[g]||0);g++);if(oe[g]>(ne[g]||0)&&d--,i==null?(X=i=C.precision,o=C.rounding):l?X=i+(r.e-s.e)+1:X=i,X<0)F.push(1),E=!0;else{if(X=X/_+2|0,g=0,k==1){for(v=0,oe=oe[0],X++;(g<D||v)&&X--;g++)j=v*u+(ne[g]||0),F[g]=j/oe|0,v=j%oe|0;E=v||g<D}else{for(v=u/(oe[0]+1)|0,v>1&&(oe=n(oe,v,u),ne=n(ne,v,u),k=oe.length,D=ne.length),A=k,V=ne.slice(0,k),$=V.length;$<k;)V[$++]=0;M=oe.slice(),M.unshift(0),T=oe[0],oe[1]>=u/2&&++T;do v=0,h=e(oe,V,k,$),h<0?(W=V[0],k!=$&&(W=W*u+(V[1]||0)),v=W/T|0,v>1?(v>=u&&(v=u-1),x=n(oe,v,u),R=x.length,$=V.length,h=e(x,V,R,$),h==1&&(v--,t(x,k<R?M:oe,R,u))):(v==0&&(h=v=1),x=oe.slice()),R=x.length,R<$&&x.unshift(0),t(V,x,$,u),h==-1&&($=V.length,h=e(oe,V,k,$),h<1&&(v++,t(V,k<$?M:oe,$,u))),$=V.length):h===0&&(v++,V=[0]),F[g++]=v,h&&V[0]?V[$++]=ne[A]||0:(V=[ne[A]],$=1);while((A++<D||V[0]!==void 0)&&X--);E=V[0]!==void 0}F[0]||F.shift()}if(_==1)I.e=d,x_=E;else{for(g=1,v=F[0];v>=10;v/=10)g++;I.e=g+d*_-1,ge(I,l?i+I.e+1:i,o,E)}return I}}();function ge(n,e,t,r){var s,i,o,l,u,h,d,g,v,_=n.constructor;e:if(e!=null){if(g=n.d,!g)return n;for(s=1,l=g[0];l>=10;l/=10)s++;if(i=e-s,i<0)i+=_e,o=e,d=g[v=0],u=d/Ut(10,s-o-1)%10|0;else if(v=Math.ceil((i+1)/_e),l=g.length,v>=l)if(r){for(;l++<=v;)g.push(0);d=u=0,s=1,i%=_e,o=i-_e+1}else break e;else{for(d=l=g[v],s=1;l>=10;l/=10)s++;i%=_e,o=i-_e+s,u=o<0?0:d/Ut(10,s-o-1)%10|0}if(r=r||e<0||g[v+1]!==void 0||(o<0?d:d%Ut(10,s-o-1)),h=t<4?(u||r)&&(t==0||t==(n.s<0?3:2)):u>5||u==5&&(t==4||r||t==6&&(i>0?o>0?d/Ut(10,s-o):0:g[v-1])%10&1||t==(n.s<0?8:7)),e<1||!g[0])return g.length=0,h?(e-=n.e+1,g[0]=Ut(10,(_e-e%_e)%_e),n.e=-e||0):g[0]=n.e=0,n;if(i==0?(g.length=v,l=1,v--):(g.length=v+1,l=Ut(10,_e-i),g[v]=o>0?(d/Ut(10,s-o)%Ut(10,o)|0)*l:0),h)for(;;)if(v==0){for(i=1,o=g[0];o>=10;o/=10)i++;for(o=g[0]+=l,l=1;o>=10;o/=10)l++;i!=l&&(n.e++,g[0]==_n&&(g[0]=1));break}else{if(g[v]+=l,g[v]!=_n)break;g[v--]=0,l=1}for(i=g.length;g[--i]===0;)g.pop()}return xe&&(n.e>_.maxE?(n.d=null,n.e=NaN):n.e<_.minE&&(n.e=0,n.d=[0])),n}function Vn(n,e,t){if(!n.isFinite())return k_(n);var r,s=n.e,i=tr(n.d),o=i.length;return e?(t&&(r=t-o)>0?i=i.charAt(0)+"."+i.slice(1)+$s(r):o>1&&(i=i.charAt(0)+"."+i.slice(1)),i=i+(n.e<0?"e":"e+")+n.e):s<0?(i="0."+$s(-s-1)+i,t&&(r=t-o)>0&&(i+=$s(r))):s>=o?(i+=$s(s+1-o),t&&(r=t-s-1)>0&&(i=i+"."+$s(r))):((r=s+1)<o&&(i=i.slice(0,r)+"."+i.slice(r)),t&&(r=t-o)>0&&(s+1===o&&(i+="."),i+=$s(r))),i}function Eh(n,e){var t=n[0];for(e*=_e;t>=10;t/=10)e++;return e}function eh(n,e,t){if(e>Z2)throw xe=!0,t&&(n.precision=t),Error(A_);return ge(new n(Xu),e,1,!0)}function kn(n,e,t){if(e>qp)throw Error(A_);return ge(new n(Zu),e,t,!0)}function C_(n){var e=n.length-1,t=e*_e+1;if(e=n[e],e){for(;e%10==0;e/=10)t--;for(e=n[0];e>=10;e/=10)t++}return t}function $s(n){for(var e="";n--;)e+="0";return e}function N_(n,e,t,r){var s,i=new n(1),o=Math.ceil(r/_e+4);for(xe=!1;;){if(t%2&&(i=i.times(e),Vy(i.d,o)&&(s=!0)),t=wr(t/2),t===0){t=i.d.length-1,s&&i.d[t]===0&&++i.d[t];break}e=e.times(e),Vy(e.d,o)}return xe=!0,i}function Ly(n){return n.d[n.d.length-1]&1}function O_(n,e,t){for(var r,s,i=new n(e[0]),o=0;++o<e.length;){if(s=new n(e[o]),!s.s){i=s;break}r=i.cmp(s),(r===t||r===0&&i.s===t)&&(i=s)}return i}function Wp(n,e){var t,r,s,i,o,l,u,h=0,d=0,g=0,v=n.constructor,_=v.rounding,E=v.precision;if(!n.d||!n.d[0]||n.e>17)return new v(n.d?n.d[0]?n.s<0?0:1/0:1:n.s?n.s<0?0:n:NaN);for(e==null?(xe=!1,u=E):u=e,l=new v(.03125);n.e>-2;)n=n.times(l),g+=5;for(r=Math.log(Ut(2,g))/Math.LN10*2+5|0,u+=r,t=i=o=new v(1),v.precision=u;;){if(i=ge(i.times(n),u,1),t=t.times(++d),l=o.plus(ut(i,t,u,1)),tr(l.d).slice(0,u)===tr(o.d).slice(0,u)){for(s=g;s--;)o=ge(o.times(o),u,1);if(e==null)if(h<3&&Tl(o.d,u-r,_,h))v.precision=u+=10,t=i=l=new v(1),d=0,h++;else return ge(o,v.precision=E,_,xe=!0);else return v.precision=E,o}o=l}}function Ws(n,e){var t,r,s,i,o,l,u,h,d,g,v,_=1,E=10,x=n,R=x.d,I=x.constructor,F=I.rounding,V=I.precision;if(x.s<0||!R||!R[0]||!x.e&&R[0]==1&&R.length==1)return new I(R&&!R[0]?-1/0:x.s!=1?NaN:R?0:x);if(e==null?(xe=!1,d=V):d=e,I.precision=d+=E,t=tr(R),r=t.charAt(0),Math.abs(i=x.e)<15e14){for(;r<7&&r!=1||r==1&&t.charAt(1)>3;)x=x.times(n),t=tr(x.d),r=t.charAt(0),_++;i=x.e,r>1?(x=new I("0."+t),i++):x=new I(r+"."+t.slice(1))}else return h=eh(I,d+2,V).times(i+""),x=Ws(new I(r+"."+t.slice(1)),d-E).plus(h),I.precision=V,e==null?ge(x,V,F,xe=!0):x;for(g=x,u=o=x=ut(x.minus(1),x.plus(1),d,1),v=ge(x.times(x),d,1),s=3;;){if(o=ge(o.times(v),d,1),h=u.plus(ut(o,new I(s),d,1)),tr(h.d).slice(0,d)===tr(u.d).slice(0,d))if(u=u.times(2),i!==0&&(u=u.plus(eh(I,d+2,V).times(i+""))),u=ut(u,new I(_),d,1),e==null)if(Tl(u.d,d-E,F,l))I.precision=d+=E,h=o=x=ut(g.minus(1),g.plus(1),d,1),v=ge(x.times(x),d,1),s=l=1;else return ge(u,I.precision=V,F,xe=!0);else return I.precision=V,u;u=h,s+=2}}function k_(n){return String(n.s*n.s/0)}function Fu(n,e){var t,r,s;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(r=e.search(/e/i))>0?(t<0&&(t=r),t+=+e.slice(r+1),e=e.substring(0,r)):t<0&&(t=e.length),r=0;e.charCodeAt(r)===48;r++);for(s=e.length;e.charCodeAt(s-1)===48;--s);if(e=e.slice(r,s),e){if(s-=r,n.e=t=t-r-1,n.d=[],r=(t+1)%_e,t<0&&(r+=_e),r<s){for(r&&n.d.push(+e.slice(0,r)),s-=_e;r<s;)n.d.push(+e.slice(r,r+=_e));e=e.slice(r),r=_e-e.length}else r-=s;for(;r--;)e+="0";n.d.push(+e),xe&&(n.e>n.constructor.maxE?(n.d=null,n.e=NaN):n.e<n.constructor.minE&&(n.e=0,n.d=[0]))}else n.e=0,n.d=[0];return n}function tP(n,e){var t,r,s,i,o,l,u,h,d;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),P_.test(e))return Fu(n,e)}else if(e==="Infinity"||e==="NaN")return+e||(n.s=NaN),n.e=NaN,n.d=null,n;if(J2.test(e))t=16,e=e.toLowerCase();else if(Q2.test(e))t=2;else if(Y2.test(e))t=8;else throw Error(Xs+e);for(i=e.search(/p/i),i>0?(u=+e.slice(i+1),e=e.substring(2,i)):e=e.slice(2),i=e.indexOf("."),o=i>=0,r=n.constructor,o&&(e=e.replace(".",""),l=e.length,i=l-i,s=N_(r,new r(t),i,i*2)),h=Vu(e,t,_n),d=h.length-1,i=d;h[i]===0;--i)h.pop();return i<0?new r(n.s*0):(n.e=Eh(h,d),n.d=h,xe=!1,o&&(n=ut(n,s,l*4)),u&&(n=n.times(Math.abs(u)<54?Ut(2,u):ce.pow(2,u))),xe=!0,n)}function rP(n,e){var t,r=e.d.length;if(r<3)return e.isZero()?e:Wo(n,2,e,e);t=1.4*Math.sqrt(r),t=t>16?16:t|0,e=e.times(1/Th(5,t)),e=Wo(n,2,e,e);for(var s,i=new n(5),o=new n(16),l=new n(20);t--;)s=e.times(e),e=e.times(i.plus(s.times(o.times(s).minus(l))));return e}function Wo(n,e,t,r,s){var i,o,l,u,h=n.precision,d=Math.ceil(h/_e);for(xe=!1,u=t.times(t),l=new n(r);;){if(o=ut(l.times(u),new n(e++*e++),h,1),l=s?r.plus(o):r.minus(o),r=ut(o.times(u),new n(e++*e++),h,1),o=l.plus(r),o.d[d]!==void 0){for(i=d;o.d[i]===l.d[i]&&i--;);if(i==-1)break}i=l,l=r,r=o,o=i}return xe=!0,o.d.length=d+1,o}function Th(n,e){for(var t=n;--e;)t*=n;return t}function j_(n,e){var t,r=e.s<0,s=kn(n,n.precision,1),i=s.times(.5);if(e=e.abs(),e.lte(i))return us=r?4:1,e;if(t=e.divToInt(s),t.isZero())us=r?3:2;else{if(e=e.minus(t.times(s)),e.lte(i))return us=Ly(t)?r?2:3:r?4:1,e;us=Ly(t)?r?1:4:r?3:2}return e.minus(s).abs()}function Dg(n,e,t,r){var s,i,o,l,u,h,d,g,v,_=n.constructor,E=t!==void 0;if(E?(jr(t,1,ni),r===void 0?r=_.rounding:jr(r,0,8)):(t=_.precision,r=_.rounding),!n.isFinite())d=k_(n);else{for(d=Vn(n),o=d.indexOf("."),E?(s=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):s=e,o>=0&&(d=d.replace(".",""),v=new _(1),v.e=d.length-o,v.d=Vu(Vn(v),10,s),v.e=v.d.length),g=Vu(d,10,s),i=u=g.length;g[--u]==0;)g.pop();if(!g[0])d=E?"0p+0":"0";else{if(o<0?i--:(n=new _(n),n.d=g,n.e=i,n=ut(n,v,t,r,0,s),g=n.d,i=n.e,h=x_),o=g[t],l=s/2,h=h||g[t+1]!==void 0,h=r<4?(o!==void 0||h)&&(r===0||r===(n.s<0?3:2)):o>l||o===l&&(r===4||h||r===6&&g[t-1]&1||r===(n.s<0?8:7)),g.length=t,h)for(;++g[--t]>s-1;)g[t]=0,t||(++i,g.unshift(1));for(u=g.length;!g[u-1];--u);for(o=0,d="";o<u;o++)d+=$p.charAt(g[o]);if(E){if(u>1)if(e==16||e==8){for(o=e==16?4:3,--u;u%o;u++)d+="0";for(g=Vu(d,s,e),u=g.length;!g[u-1];--u);for(o=1,d="1.";o<u;o++)d+=$p.charAt(g[o])}else d=d.charAt(0)+"."+d.slice(1);d=d+(i<0?"p":"p+")+i}else if(i<0){for(;++i;)d="0"+d;d="0."+d}else if(++i>u)for(i-=u;i--;)d+="0";else i<u&&(d=d.slice(0,i)+"."+d.slice(i))}d=(e==16?"0x":e==2?"0b":e==8?"0o":"")+d}return n.s<0?"-"+d:d}function Vy(n,e){if(n.length>e)return n.length=e,!0}function nP(n){return new this(n).abs()}function sP(n){return new this(n).acos()}function iP(n){return new this(n).acosh()}function oP(n,e){return new this(n).plus(e)}function aP(n){return new this(n).asin()}function lP(n){return new this(n).asinh()}function cP(n){return new this(n).atan()}function uP(n){return new this(n).atanh()}function hP(n,e){n=new this(n),e=new this(e);var t,r=this.precision,s=this.rounding,i=r+4;return!n.s||!e.s?t=new this(NaN):!n.d&&!e.d?(t=kn(this,i,1).times(e.s>0?.25:.75),t.s=n.s):!e.d||n.isZero()?(t=e.s<0?kn(this,r,s):new this(0),t.s=n.s):!n.d||e.isZero()?(t=kn(this,i,1).times(.5),t.s=n.s):e.s<0?(this.precision=i,this.rounding=1,t=this.atan(ut(n,e,i,1)),e=kn(this,i,1),this.precision=r,this.rounding=s,t=n.s<0?t.minus(e):t.plus(e)):t=this.atan(ut(n,e,i,1)),t}function fP(n){return new this(n).cbrt()}function dP(n){return ge(n=new this(n),n.e+1,2)}function pP(n,e,t){return new this(n).clamp(e,t)}function gP(n){if(!n||typeof n!="object")throw Error(bh+"Object expected");var e,t,r,s=n.defaults===!0,i=["precision",1,ni,"rounding",0,8,"toExpNeg",-9e15,0,"toExpPos",0,Up,"maxE",0,Up,"minE",-9e15,0,"modulo",0,9];for(e=0;e<i.length;e+=3)if(t=i[e],s&&(this[t]=Bp[t]),(r=n[t])!==void 0)if(wr(r)===r&&r>=i[e+1]&&r<=i[e+2])this[t]=r;else throw Error(Xs+t+": "+r);if(t="crypto",s&&(this[t]=Bp[t]),(r=n[t])!==void 0)if(r===!0||r===!1||r===0||r===1)if(r)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(R_);else this[t]=!1;else throw Error(Xs+t+": "+r);return this}function mP(n){return new this(n).cos()}function yP(n){return new this(n).cosh()}function D_(n){var e,t,r;function s(i){var o,l,u,h=this;if(!(h instanceof s))return new s(i);if(h.constructor=s,Fy(i)){h.s=i.s,xe?!i.d||i.e>s.maxE?(h.e=NaN,h.d=null):i.e<s.minE?(h.e=0,h.d=[0]):(h.e=i.e,h.d=i.d.slice()):(h.e=i.e,h.d=i.d?i.d.slice():i.d);return}if(u=typeof i,u==="number"){if(i===0){h.s=1/i<0?-1:1,h.e=0,h.d=[0];return}if(i<0?(i=-i,h.s=-1):h.s=1,i===~~i&&i<1e7){for(o=0,l=i;l>=10;l/=10)o++;xe?o>s.maxE?(h.e=NaN,h.d=null):o<s.minE?(h.e=0,h.d=[0]):(h.e=o,h.d=[i]):(h.e=o,h.d=[i]);return}if(i*0!==0){i||(h.s=NaN),h.e=NaN,h.d=null;return}return Fu(h,i.toString())}if(u==="string")return(l=i.charCodeAt(0))===45?(i=i.slice(1),h.s=-1):(l===43&&(i=i.slice(1)),h.s=1),P_.test(i)?Fu(h,i):tP(h,i);if(u==="bigint")return i<0?(i=-i,h.s=-1):h.s=1,Fu(h,i.toString());throw Error(Xs+i)}if(s.prototype=ee,s.ROUND_UP=0,s.ROUND_DOWN=1,s.ROUND_CEIL=2,s.ROUND_FLOOR=3,s.ROUND_HALF_UP=4,s.ROUND_HALF_DOWN=5,s.ROUND_HALF_EVEN=6,s.ROUND_HALF_CEIL=7,s.ROUND_HALF_FLOOR=8,s.EUCLID=9,s.config=s.set=gP,s.clone=D_,s.isDecimal=Fy,s.abs=nP,s.acos=sP,s.acosh=iP,s.add=oP,s.asin=aP,s.asinh=lP,s.atan=cP,s.atanh=uP,s.atan2=hP,s.cbrt=fP,s.ceil=dP,s.clamp=pP,s.cos=mP,s.cosh=yP,s.div=wP,s.exp=vP,s.floor=_P,s.hypot=bP,s.ln=EP,s.log=TP,s.log10=xP,s.log2=SP,s.max=AP,s.min=RP,s.mod=IP,s.mul=PP,s.pow=CP,s.random=NP,s.round=OP,s.sign=kP,s.sin=jP,s.sinh=DP,s.sqrt=MP,s.sub=LP,s.sum=VP,s.tan=FP,s.tanh=UP,s.trunc=$P,n===void 0&&(n={}),n&&n.defaults!==!0)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<r.length;)n.hasOwnProperty(t=r[e++])||(n[t]=this[t]);return s.config(n),s}function wP(n,e){return new this(n).div(e)}function vP(n){return new this(n).exp()}function _P(n){return ge(n=new this(n),n.e+1,3)}function bP(){var n,e,t=new this(0);for(xe=!1,n=0;n<arguments.length;)if(e=new this(arguments[n++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return xe=!0,new this(1/0);t=e}return xe=!0,t.sqrt()}function Fy(n){return n instanceof ce||n&&n.toStringTag===I_||!1}function EP(n){return new this(n).ln()}function TP(n,e){return new this(n).log(e)}function SP(n){return new this(n).log(2)}function xP(n){return new this(n).log(10)}function AP(){return O_(this,arguments,-1)}function RP(){return O_(this,arguments,1)}function IP(n,e){return new this(n).mod(e)}function PP(n,e){return new this(n).mul(e)}function CP(n,e){return new this(n).pow(e)}function NP(n){var e,t,r,s,i=0,o=new this(1),l=[];if(n===void 0?n=this.precision:jr(n,1,ni),r=Math.ceil(n/_e),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(r));i<r;)s=e[i],s>=429e7?e[i]=crypto.getRandomValues(new Uint32Array(1))[0]:l[i++]=s%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(r*=4);i<r;)s=e[i]+(e[i+1]<<8)+(e[i+2]<<16)+((e[i+3]&127)<<24),s>=214e7?crypto.randomBytes(4).copy(e,i):(l.push(s%1e7),i+=4);i=r/4}else throw Error(R_);else for(;i<r;)l[i++]=Math.random()*1e7|0;for(r=l[--i],n%=_e,r&&n&&(s=Ut(10,_e-n),l[i]=(r/s|0)*s);l[i]===0;i--)l.pop();if(i<0)t=0,l=[0];else{for(t=-1;l[0]===0;t-=_e)l.shift();for(r=1,s=l[0];s>=10;s/=10)r++;r<_e&&(t-=_e-r)}return o.e=t,o.d=l,o}function OP(n){return ge(n=new this(n),n.e+1,this.rounding)}function kP(n){return n=new this(n),n.d?n.d[0]?n.s:0*n.s:n.s||NaN}function jP(n){return new this(n).sin()}function DP(n){return new this(n).sinh()}function MP(n){return new this(n).sqrt()}function LP(n,e){return new this(n).sub(e)}function VP(){var n=0,e=arguments,t=new this(e[n]);for(xe=!1;t.s&&++n<e.length;)t=t.plus(e[n]);return xe=!0,ge(t,this.precision,this.rounding)}function FP(n){return new this(n).tan()}function UP(n){return new this(n).tanh()}function $P(n){return ge(n=new this(n),n.e+1,1)}ee[Symbol.for("nodejs.util.inspect.custom")]=ee.toString;ee[Symbol.toStringTag]="Decimal";var ce=ee.constructor=D_(Bp);Xu=new ce(Xu);Zu=new ce(Zu);var Sh={},Ll={};let M_={};Ll.setConfig=n=>{M_=n};Ll.getConfig=()=>M_;var Mg={},zp={exports:{}};(function(n,e){var t=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof $t<"u")return $t;throw new Error("unable to locate global object")},r=t();n.exports=e=r.fetch,r.fetch&&(e.default=r.fetch.bind(r)),e.Headers=r.Headers,e.Request=r.Request,e.Response=r.Response})(zp,zp.exports);var BP=zp.exports,th={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */th.exports;(function(n,e){(function(){var t,r="4.17.21",s=200,i="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",o="Expected a function",l="Invalid `variable` option passed into `_.template`",u="__lodash_hash_undefined__",h=500,d="__lodash_placeholder__",g=1,v=2,_=4,E=1,x=2,R=1,I=2,F=4,V=8,$=16,W=32,X=64,j=128,A=256,D=512,T=30,k="...",M=800,C=16,Te=1,ne=2,oe=3,Ae=1/0,Le=9007199254740991,wt=17976931348623157e292,nt=NaN,me=4294967295,Re=me-1,ue=me>>>1,at=[["ary",j],["bind",R],["bindKey",I],["curry",V],["curryRight",$],["flip",D],["partial",W],["partialRight",X],["rearg",A]],Ge="[object Arguments]",Nt="[object Array]",ht="[object AsyncFunction]",Bn="[object Boolean]",qn="[object Date]",vs="[object DOMException]",an="[object Error]",Sn="[object Function]",_s="[object GeneratorFunction]",Ht="[object Map]",ln="[object Number]",Yi="[object Null]",cn="[object Object]",ec="[object Promise]",tc="[object Proxy]",Wn="[object RegExp]",Sr="[object Set]",ai="[object String]",bs="[object Symbol]",ya="[object Undefined]",Es="[object WeakMap]",Bt="[object WeakSet]",At="[object ArrayBuffer]",un="[object DataView]",Xi="[object Float32Array]",Zi="[object Float64Array]",wa="[object Int8Array]",zn="[object Int16Array]",eo="[object Int32Array]",to="[object Uint8Array]",li="[object Uint8ClampedArray]",va="[object Uint16Array]",_a="[object Uint32Array]",ba=/\b__p \+= '';/g,rc=/\b(__p \+=) '' \+/g,nc=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ts=/&(?:amp|lt|gt|quot|#39);/g,ro=/[&<>"']/g,Ea=RegExp(Ts.source),Gn=RegExp(ro.source),sc=/<%-([\s\S]+?)%>/g,no=/<%([\s\S]+?)%>/g,Ta=/<%=([\s\S]+?)%>/g,ci=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ic=/^\w*$/,Kt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,so=/[\\^$.*+?()[\]{}|]/g,ui=RegExp(so.source),Hn=/^\s+/,ff=/\s/,df=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Ss=/\{\n\/\* \[wrapped with (.+)\] \*/,pf=/,? & /,gf=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,io=/[()=,{}\[\]\/\s]/,oc=/\\(\\)?/g,Sa=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,hi=/\w*$/,xn=/^[-+]0x[0-9a-f]+$/i,ac=/^0b[01]+$/i,lc=/^\[object .+?Constructor\]$/,xa=/^0o[0-7]+$/i,Aa=/^(?:0|[1-9]\d*)$/,cc=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,fi=/($^)/,mf=/['\n\r\u2028\u2029\\]/g,Kn="\\ud800-\\udfff",uc="\\u0300-\\u036f",Ra="\\ufe20-\\ufe2f",di="\\u20d0-\\u20ff",An=uc+Ra+di,oo="\\u2700-\\u27bf",hc="a-z\\xdf-\\xf6\\xf8-\\xff",fc="\\xac\\xb1\\xd7\\xf7",dc="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",pc="\\u2000-\\u206f",Ia=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ao="A-Z\\xc0-\\xd6\\xd8-\\xde",Pa="\\ufe0e\\ufe0f",Ca=fc+dc+pc+Ia,Na="['’]",yf="["+Kn+"]",Oa="["+Ca+"]",pi="["+An+"]",gc="\\d+",Qn="["+oo+"]",zr="["+hc+"]",gi="[^"+Kn+Ca+gc+oo+hc+ao+"]",xs="\\ud83c[\\udffb-\\udfff]",mc="(?:"+pi+"|"+xs+")",ot="[^"+Kn+"]",As="(?:\\ud83c[\\udde6-\\uddff]){2}",Jn="[\\ud800-\\udbff][\\udc00-\\udfff]",Gr="["+ao+"]",yc="\\u200d",ka="(?:"+zr+"|"+gi+")",wf="(?:"+Gr+"|"+gi+")",wc="(?:"+Na+"(?:d|ll|m|re|s|t|ve))?",vc="(?:"+Na+"(?:D|LL|M|RE|S|T|VE))?",_c=mc+"?",Rs="["+Pa+"]?",Rn="(?:"+yc+"(?:"+[ot,As,Jn].join("|")+")"+Rs+_c+")*",bc="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ec="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ja=Rs+_c+Rn,Is="(?:"+[Qn,As,Jn].join("|")+")"+ja,vf="(?:"+[ot+pi+"?",pi,As,Jn,yf].join("|")+")",_f=RegExp(Na,"g"),bf=RegExp(pi,"g"),Hr=RegExp(xs+"(?="+xs+")|"+vf+ja,"g"),Ef=RegExp([Gr+"?"+zr+"+"+wc+"(?="+[Oa,Gr,"$"].join("|")+")",wf+"+"+vc+"(?="+[Oa,Gr+ka,"$"].join("|")+")",Gr+"?"+ka+"+"+wc,Gr+"+"+vc,Ec,bc,gc,Is].join("|"),"g"),Tf=RegExp("["+yc+Kn+An+Pa+"]"),lo=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,co=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Tc=-1,Ye={};Ye[Xi]=Ye[Zi]=Ye[wa]=Ye[zn]=Ye[eo]=Ye[to]=Ye[li]=Ye[va]=Ye[_a]=!0,Ye[Ge]=Ye[Nt]=Ye[At]=Ye[Bn]=Ye[un]=Ye[qn]=Ye[an]=Ye[Sn]=Ye[Ht]=Ye[ln]=Ye[cn]=Ye[Wn]=Ye[Sr]=Ye[ai]=Ye[Es]=!1;var Ke={};Ke[Ge]=Ke[Nt]=Ke[At]=Ke[un]=Ke[Bn]=Ke[qn]=Ke[Xi]=Ke[Zi]=Ke[wa]=Ke[zn]=Ke[eo]=Ke[Ht]=Ke[ln]=Ke[cn]=Ke[Wn]=Ke[Sr]=Ke[ai]=Ke[bs]=Ke[to]=Ke[li]=Ke[va]=Ke[_a]=!0,Ke[an]=Ke[Sn]=Ke[Es]=!1;var Sc={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},Da={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},yt={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Sf={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},xf=parseFloat,xc=parseInt,Ma=typeof $t=="object"&&$t&&$t.Object===Object&&$t,Ac=typeof self=="object"&&self&&self.Object===Object&&self,Tt=Ma||Ac||Function("return this")(),uo=e&&!e.nodeType&&e,Qt=uo&&!0&&n&&!n.nodeType&&n,La=Qt&&Qt.exports===uo,Va=La&&Ma.process,qt=function(){try{var B=Qt&&Qt.require&&Qt.require("util").types;return B||Va&&Va.binding&&Va.binding("util")}catch{}}(),Fa=qt&&qt.isArrayBuffer,ho=qt&&qt.isDate,mi=qt&&qt.isMap,Ua=qt&&qt.isRegExp,yi=qt&&qt.isSet,Rc=qt&&qt.isTypedArray;function ir(B,Q,G){switch(G.length){case 0:return B.call(Q);case 1:return B.call(Q,G[0]);case 2:return B.call(Q,G[0],G[1]);case 3:return B.call(Q,G[0],G[1],G[2])}return B.apply(Q,G)}function wi(B,Q,G,he){for(var Ie=-1,Ze=B==null?0:B.length;++Ie<Ze;){var Lt=B[Ie];Q(he,Lt,G(Lt),B)}return he}function _r(B,Q){for(var G=-1,he=B==null?0:B.length;++G<he&&Q(B[G],G,B)!==!1;);return B}function Ic(B,Q){for(var G=B==null?0:B.length;G--&&Q(B[G],G,B)!==!1;);return B}function fo(B,Q){for(var G=-1,he=B==null?0:B.length;++G<he;)if(!Q(B[G],G,B))return!1;return!0}function Kr(B,Q){for(var G=-1,he=B==null?0:B.length,Ie=0,Ze=[];++G<he;){var Lt=B[G];Q(Lt,G,B)&&(Ze[Ie++]=Lt)}return Ze}function vi(B,Q){var G=B==null?0:B.length;return!!G&&Yn(B,Q,0)>-1}function Ps(B,Q,G){for(var he=-1,Ie=B==null?0:B.length;++he<Ie;)if(G(Q,B[he]))return!0;return!1}function lt(B,Q){for(var G=-1,he=B==null?0:B.length,Ie=Array(he);++G<he;)Ie[G]=Q(B[G],G,B);return Ie}function hn(B,Q){for(var G=-1,he=Q.length,Ie=B.length;++G<he;)B[Ie+G]=Q[G];return B}function fn(B,Q,G,he){var Ie=-1,Ze=B==null?0:B.length;for(he&&Ze&&(G=B[++Ie]);++Ie<Ze;)G=Q(G,B[Ie],Ie,B);return G}function Pc(B,Q,G,he){var Ie=B==null?0:B.length;for(he&&Ie&&(G=B[--Ie]);Ie--;)G=Q(G,B[Ie],Ie,B);return G}function po(B,Q){for(var G=-1,he=B==null?0:B.length;++G<he;)if(Q(B[G],G,B))return!0;return!1}var Cc=b("length");function Nc(B){return B.split("")}function go(B){return B.match(gf)||[]}function or(B,Q,G){var he;return G(B,function(Ie,Ze,Lt){if(Q(Ie,Ze,Lt))return he=Ze,!1}),he}function _i(B,Q,G,he){for(var Ie=B.length,Ze=G+(he?1:-1);he?Ze--:++Ze<Ie;)if(Q(B[Ze],Ze,B))return Ze;return-1}function Yn(B,Q,G){return Q===Q?mT(B,Q,G):_i(B,f,G)}function Cs(B,Q,G,he){for(var Ie=G-1,Ze=B.length;++Ie<Ze;)if(he(B[Ie],Q))return Ie;return-1}function f(B){return B!==B}function y(B,Q){var G=B==null?0:B.length;return G?ie(B,Q)/G:nt}function b(B){return function(Q){return Q==null?t:Q[B]}}function N(B){return function(Q){return B==null?t:B[Q]}}function z(B,Q,G,he,Ie){return Ie(B,function(Ze,Lt,ct){G=he?(he=!1,Ze):Q(G,Ze,Lt,ct)}),G}function H(B,Q){var G=B.length;for(B.sort(Q);G--;)B[G]=B[G].value;return B}function ie(B,Q){for(var G,he=-1,Ie=B.length;++he<Ie;){var Ze=Q(B[he]);Ze!==t&&(G=G===t?Ze:G+Ze)}return G}function Xe(B,Q){for(var G=-1,he=Array(B);++G<B;)he[G]=Q(G);return he}function Mt(B,Q){return lt(Q,function(G){return[G,B[G]]})}function qe(B){return B&&B.slice(0,$m(B)+1).replace(Hn,"")}function tt(B){return function(Q){return B(Q)}}function Ot(B,Q){return lt(Q,function(G){return B[G]})}function Qr(B,Q){return B.has(Q)}function xr(B,Q){for(var G=-1,he=B.length;++G<he&&Yn(Q,B[G],0)>-1;);return G}function bi(B,Q){for(var G=B.length;G--&&Yn(Q,B[G],0)>-1;);return G}function $a(B,Q){for(var G=B.length,he=0;G--;)B[G]===Q&&++he;return he}var cT=N(Sc),uT=N(Da);function hT(B){return"\\"+Sf[B]}function fT(B,Q){return B==null?t:B[Q]}function mo(B){return Tf.test(B)}function dT(B){return lo.test(B)}function pT(B){for(var Q,G=[];!(Q=B.next()).done;)G.push(Q.value);return G}function Af(B){var Q=-1,G=Array(B.size);return B.forEach(function(he,Ie){G[++Q]=[Ie,he]}),G}function Um(B,Q){return function(G){return B(Q(G))}}function Ns(B,Q){for(var G=-1,he=B.length,Ie=0,Ze=[];++G<he;){var Lt=B[G];(Lt===Q||Lt===d)&&(B[G]=d,Ze[Ie++]=G)}return Ze}function Oc(B){var Q=-1,G=Array(B.size);return B.forEach(function(he){G[++Q]=he}),G}function gT(B){var Q=-1,G=Array(B.size);return B.forEach(function(he){G[++Q]=[he,he]}),G}function mT(B,Q,G){for(var he=G-1,Ie=B.length;++he<Ie;)if(B[he]===Q)return he;return-1}function yT(B,Q,G){for(var he=G+1;he--;)if(B[he]===Q)return he;return he}function yo(B){return mo(B)?vT(B):Cc(B)}function dn(B){return mo(B)?_T(B):Nc(B)}function $m(B){for(var Q=B.length;Q--&&ff.test(B.charAt(Q)););return Q}var wT=N(yt);function vT(B){for(var Q=Hr.lastIndex=0;Hr.test(B);)++Q;return Q}function _T(B){return B.match(Hr)||[]}function bT(B){return B.match(Ef)||[]}var ET=function B(Q){Q=Q==null?Tt:wo.defaults(Tt.Object(),Q,wo.pick(Tt,co));var G=Q.Array,he=Q.Date,Ie=Q.Error,Ze=Q.Function,Lt=Q.Math,ct=Q.Object,Rf=Q.RegExp,TT=Q.String,Jr=Q.TypeError,kc=G.prototype,ST=Ze.prototype,vo=ct.prototype,jc=Q["__core-js_shared__"],Dc=ST.toString,st=vo.hasOwnProperty,xT=0,Bm=function(){var a=/[^.]+$/.exec(jc&&jc.keys&&jc.keys.IE_PROTO||"");return a?"Symbol(src)_1."+a:""}(),Mc=vo.toString,AT=Dc.call(ct),RT=Tt._,IT=Rf("^"+Dc.call(st).replace(so,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Lc=La?Q.Buffer:t,Os=Q.Symbol,Vc=Q.Uint8Array,qm=Lc?Lc.allocUnsafe:t,Fc=Um(ct.getPrototypeOf,ct),Wm=ct.create,zm=vo.propertyIsEnumerable,Uc=kc.splice,Gm=Os?Os.isConcatSpreadable:t,Ba=Os?Os.iterator:t,Ei=Os?Os.toStringTag:t,$c=function(){try{var a=Ri(ct,"defineProperty");return a({},"",{}),a}catch{}}(),PT=Q.clearTimeout!==Tt.clearTimeout&&Q.clearTimeout,CT=he&&he.now!==Tt.Date.now&&he.now,NT=Q.setTimeout!==Tt.setTimeout&&Q.setTimeout,Bc=Lt.ceil,qc=Lt.floor,If=ct.getOwnPropertySymbols,OT=Lc?Lc.isBuffer:t,Hm=Q.isFinite,kT=kc.join,jT=Um(ct.keys,ct),Vt=Lt.max,ar=Lt.min,DT=he.now,MT=Q.parseInt,Km=Lt.random,LT=kc.reverse,Pf=Ri(Q,"DataView"),qa=Ri(Q,"Map"),Cf=Ri(Q,"Promise"),_o=Ri(Q,"Set"),Wa=Ri(Q,"WeakMap"),za=Ri(ct,"create"),Wc=Wa&&new Wa,bo={},VT=Ii(Pf),FT=Ii(qa),UT=Ii(Cf),$T=Ii(_o),BT=Ii(Wa),zc=Os?Os.prototype:t,Ga=zc?zc.valueOf:t,Qm=zc?zc.toString:t;function P(a){if(St(a)&&!Ne(a)&&!(a instanceof Ue)){if(a instanceof Yr)return a;if(st.call(a,"__wrapped__"))return J0(a)}return new Yr(a)}var Eo=function(){function a(){}return function(c){if(!vt(c))return{};if(Wm)return Wm(c);a.prototype=c;var p=new a;return a.prototype=t,p}}();function Gc(){}function Yr(a,c){this.__wrapped__=a,this.__actions__=[],this.__chain__=!!c,this.__index__=0,this.__values__=t}P.templateSettings={escape:sc,evaluate:no,interpolate:Ta,variable:"",imports:{_:P}},P.prototype=Gc.prototype,P.prototype.constructor=P,Yr.prototype=Eo(Gc.prototype),Yr.prototype.constructor=Yr;function Ue(a){this.__wrapped__=a,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=me,this.__views__=[]}function qT(){var a=new Ue(this.__wrapped__);return a.__actions__=Ar(this.__actions__),a.__dir__=this.__dir__,a.__filtered__=this.__filtered__,a.__iteratees__=Ar(this.__iteratees__),a.__takeCount__=this.__takeCount__,a.__views__=Ar(this.__views__),a}function WT(){if(this.__filtered__){var a=new Ue(this);a.__dir__=-1,a.__filtered__=!0}else a=this.clone(),a.__dir__*=-1;return a}function zT(){var a=this.__wrapped__.value(),c=this.__dir__,p=Ne(a),w=c<0,S=p?a.length:0,O=nx(0,S,this.__views__),L=O.start,U=O.end,q=U-L,J=w?U:L-1,Y=this.__iteratees__,te=Y.length,le=0,pe=ar(q,this.__takeCount__);if(!p||!w&&S==q&&pe==q)return v0(a,this.__actions__);var be=[];e:for(;q--&&le<pe;){J+=c;for(var De=-1,Ee=a[J];++De<te;){var Ve=Y[De],We=Ve.iteratee,Lr=Ve.type,Tr=We(Ee);if(Lr==ne)Ee=Tr;else if(!Tr){if(Lr==Te)continue e;break e}}be[le++]=Ee}return be}Ue.prototype=Eo(Gc.prototype),Ue.prototype.constructor=Ue;function Ti(a){var c=-1,p=a==null?0:a.length;for(this.clear();++c<p;){var w=a[c];this.set(w[0],w[1])}}function GT(){this.__data__=za?za(null):{},this.size=0}function HT(a){var c=this.has(a)&&delete this.__data__[a];return this.size-=c?1:0,c}function KT(a){var c=this.__data__;if(za){var p=c[a];return p===u?t:p}return st.call(c,a)?c[a]:t}function QT(a){var c=this.__data__;return za?c[a]!==t:st.call(c,a)}function JT(a,c){var p=this.__data__;return this.size+=this.has(a)?0:1,p[a]=za&&c===t?u:c,this}Ti.prototype.clear=GT,Ti.prototype.delete=HT,Ti.prototype.get=KT,Ti.prototype.has=QT,Ti.prototype.set=JT;function Xn(a){var c=-1,p=a==null?0:a.length;for(this.clear();++c<p;){var w=a[c];this.set(w[0],w[1])}}function YT(){this.__data__=[],this.size=0}function XT(a){var c=this.__data__,p=Hc(c,a);if(p<0)return!1;var w=c.length-1;return p==w?c.pop():Uc.call(c,p,1),--this.size,!0}function ZT(a){var c=this.__data__,p=Hc(c,a);return p<0?t:c[p][1]}function eS(a){return Hc(this.__data__,a)>-1}function tS(a,c){var p=this.__data__,w=Hc(p,a);return w<0?(++this.size,p.push([a,c])):p[w][1]=c,this}Xn.prototype.clear=YT,Xn.prototype.delete=XT,Xn.prototype.get=ZT,Xn.prototype.has=eS,Xn.prototype.set=tS;function Zn(a){var c=-1,p=a==null?0:a.length;for(this.clear();++c<p;){var w=a[c];this.set(w[0],w[1])}}function rS(){this.size=0,this.__data__={hash:new Ti,map:new(qa||Xn),string:new Ti}}function nS(a){var c=iu(this,a).delete(a);return this.size-=c?1:0,c}function sS(a){return iu(this,a).get(a)}function iS(a){return iu(this,a).has(a)}function oS(a,c){var p=iu(this,a),w=p.size;return p.set(a,c),this.size+=p.size==w?0:1,this}Zn.prototype.clear=rS,Zn.prototype.delete=nS,Zn.prototype.get=sS,Zn.prototype.has=iS,Zn.prototype.set=oS;function Si(a){var c=-1,p=a==null?0:a.length;for(this.__data__=new Zn;++c<p;)this.add(a[c])}function aS(a){return this.__data__.set(a,u),this}function lS(a){return this.__data__.has(a)}Si.prototype.add=Si.prototype.push=aS,Si.prototype.has=lS;function pn(a){var c=this.__data__=new Xn(a);this.size=c.size}function cS(){this.__data__=new Xn,this.size=0}function uS(a){var c=this.__data__,p=c.delete(a);return this.size=c.size,p}function hS(a){return this.__data__.get(a)}function fS(a){return this.__data__.has(a)}function dS(a,c){var p=this.__data__;if(p instanceof Xn){var w=p.__data__;if(!qa||w.length<s-1)return w.push([a,c]),this.size=++p.size,this;p=this.__data__=new Zn(w)}return p.set(a,c),this.size=p.size,this}pn.prototype.clear=cS,pn.prototype.delete=uS,pn.prototype.get=hS,pn.prototype.has=fS,pn.prototype.set=dS;function Jm(a,c){var p=Ne(a),w=!p&&Pi(a),S=!p&&!w&&Ls(a),O=!p&&!w&&!S&&Ao(a),L=p||w||S||O,U=L?Xe(a.length,TT):[],q=U.length;for(var J in a)(c||st.call(a,J))&&!(L&&(J=="length"||S&&(J=="offset"||J=="parent")||O&&(J=="buffer"||J=="byteLength"||J=="byteOffset")||ns(J,q)))&&U.push(J);return U}function Ym(a){var c=a.length;return c?a[$f(0,c-1)]:t}function pS(a,c){return ou(Ar(a),xi(c,0,a.length))}function gS(a){return ou(Ar(a))}function Nf(a,c,p){(p!==t&&!gn(a[c],p)||p===t&&!(c in a))&&es(a,c,p)}function Ha(a,c,p){var w=a[c];(!(st.call(a,c)&&gn(w,p))||p===t&&!(c in a))&&es(a,c,p)}function Hc(a,c){for(var p=a.length;p--;)if(gn(a[p][0],c))return p;return-1}function mS(a,c,p,w){return ks(a,function(S,O,L){c(w,S,p(S),L)}),w}function Xm(a,c){return a&&Pn(c,Wt(c),a)}function yS(a,c){return a&&Pn(c,Ir(c),a)}function es(a,c,p){c=="__proto__"&&$c?$c(a,c,{configurable:!0,enumerable:!0,value:p,writable:!0}):a[c]=p}function Of(a,c){for(var p=-1,w=c.length,S=G(w),O=a==null;++p<w;)S[p]=O?t:fd(a,c[p]);return S}function xi(a,c,p){return a===a&&(p!==t&&(a=a<=p?a:p),c!==t&&(a=a>=c?a:c)),a}function Xr(a,c,p,w,S,O){var L,U=c&g,q=c&v,J=c&_;if(p&&(L=S?p(a,w,S,O):p(a)),L!==t)return L;if(!vt(a))return a;var Y=Ne(a);if(Y){if(L=ix(a),!U)return Ar(a,L)}else{var te=lr(a),le=te==Sn||te==_s;if(Ls(a))return E0(a,U);if(te==cn||te==Ge||le&&!S){if(L=q||le?{}:$0(a),!U)return q?KS(a,yS(L,a)):HS(a,Xm(L,a))}else{if(!Ke[te])return S?a:{};L=ox(a,te,U)}}O||(O=new pn);var pe=O.get(a);if(pe)return pe;O.set(a,L),my(a)?a.forEach(function(Ee){L.add(Xr(Ee,c,p,Ee,a,O))}):py(a)&&a.forEach(function(Ee,Ve){L.set(Ve,Xr(Ee,c,p,Ve,a,O))});var be=J?q?Xf:Yf:q?Ir:Wt,De=Y?t:be(a);return _r(De||a,function(Ee,Ve){De&&(Ve=Ee,Ee=a[Ve]),Ha(L,Ve,Xr(Ee,c,p,Ve,a,O))}),L}function wS(a){var c=Wt(a);return function(p){return Zm(p,a,c)}}function Zm(a,c,p){var w=p.length;if(a==null)return!w;for(a=ct(a);w--;){var S=p[w],O=c[S],L=a[S];if(L===t&&!(S in a)||!O(L))return!1}return!0}function e0(a,c,p){if(typeof a!="function")throw new Jr(o);return el(function(){a.apply(t,p)},c)}function Ka(a,c,p,w){var S=-1,O=vi,L=!0,U=a.length,q=[],J=c.length;if(!U)return q;p&&(c=lt(c,tt(p))),w?(O=Ps,L=!1):c.length>=s&&(O=Qr,L=!1,c=new Si(c));e:for(;++S<U;){var Y=a[S],te=p==null?Y:p(Y);if(Y=w||Y!==0?Y:0,L&&te===te){for(var le=J;le--;)if(c[le]===te)continue e;q.push(Y)}else O(c,te,w)||q.push(Y)}return q}var ks=R0(In),t0=R0(jf,!0);function vS(a,c){var p=!0;return ks(a,function(w,S,O){return p=!!c(w,S,O),p}),p}function Kc(a,c,p){for(var w=-1,S=a.length;++w<S;){var O=a[w],L=c(O);if(L!=null&&(U===t?L===L&&!Mr(L):p(L,U)))var U=L,q=O}return q}function _S(a,c,p,w){var S=a.length;for(p=ke(p),p<0&&(p=-p>S?0:S+p),w=w===t||w>S?S:ke(w),w<0&&(w+=S),w=p>w?0:wy(w);p<w;)a[p++]=c;return a}function r0(a,c){var p=[];return ks(a,function(w,S,O){c(w,S,O)&&p.push(w)}),p}function Jt(a,c,p,w,S){var O=-1,L=a.length;for(p||(p=lx),S||(S=[]);++O<L;){var U=a[O];c>0&&p(U)?c>1?Jt(U,c-1,p,w,S):hn(S,U):w||(S[S.length]=U)}return S}var kf=I0(),n0=I0(!0);function In(a,c){return a&&kf(a,c,Wt)}function jf(a,c){return a&&n0(a,c,Wt)}function Qc(a,c){return Kr(c,function(p){return ss(a[p])})}function Ai(a,c){c=Ds(c,a);for(var p=0,w=c.length;a!=null&&p<w;)a=a[Cn(c[p++])];return p&&p==w?a:t}function s0(a,c,p){var w=c(a);return Ne(a)?w:hn(w,p(a))}function br(a){return a==null?a===t?ya:Yi:Ei&&Ei in ct(a)?rx(a):gx(a)}function Df(a,c){return a>c}function bS(a,c){return a!=null&&st.call(a,c)}function ES(a,c){return a!=null&&c in ct(a)}function TS(a,c,p){return a>=ar(c,p)&&a<Vt(c,p)}function Mf(a,c,p){for(var w=p?Ps:vi,S=a[0].length,O=a.length,L=O,U=G(O),q=1/0,J=[];L--;){var Y=a[L];L&&c&&(Y=lt(Y,tt(c))),q=ar(Y.length,q),U[L]=!p&&(c||S>=120&&Y.length>=120)?new Si(L&&Y):t}Y=a[0];var te=-1,le=U[0];e:for(;++te<S&&J.length<q;){var pe=Y[te],be=c?c(pe):pe;if(pe=p||pe!==0?pe:0,!(le?Qr(le,be):w(J,be,p))){for(L=O;--L;){var De=U[L];if(!(De?Qr(De,be):w(a[L],be,p)))continue e}le&&le.push(be),J.push(pe)}}return J}function SS(a,c,p,w){return In(a,function(S,O,L){c(w,p(S),O,L)}),w}function Qa(a,c,p){c=Ds(c,a),a=z0(a,c);var w=a==null?a:a[Cn(en(c))];return w==null?t:ir(w,a,p)}function i0(a){return St(a)&&br(a)==Ge}function xS(a){return St(a)&&br(a)==At}function AS(a){return St(a)&&br(a)==qn}function Ja(a,c,p,w,S){return a===c?!0:a==null||c==null||!St(a)&&!St(c)?a!==a&&c!==c:RS(a,c,p,w,Ja,S)}function RS(a,c,p,w,S,O){var L=Ne(a),U=Ne(c),q=L?Nt:lr(a),J=U?Nt:lr(c);q=q==Ge?cn:q,J=J==Ge?cn:J;var Y=q==cn,te=J==cn,le=q==J;if(le&&Ls(a)){if(!Ls(c))return!1;L=!0,Y=!1}if(le&&!Y)return O||(O=new pn),L||Ao(a)?V0(a,c,p,w,S,O):ex(a,c,q,p,w,S,O);if(!(p&E)){var pe=Y&&st.call(a,"__wrapped__"),be=te&&st.call(c,"__wrapped__");if(pe||be){var De=pe?a.value():a,Ee=be?c.value():c;return O||(O=new pn),S(De,Ee,p,w,O)}}return le?(O||(O=new pn),tx(a,c,p,w,S,O)):!1}function IS(a){return St(a)&&lr(a)==Ht}function Lf(a,c,p,w){var S=p.length,O=S,L=!w;if(a==null)return!O;for(a=ct(a);S--;){var U=p[S];if(L&&U[2]?U[1]!==a[U[0]]:!(U[0]in a))return!1}for(;++S<O;){U=p[S];var q=U[0],J=a[q],Y=U[1];if(L&&U[2]){if(J===t&&!(q in a))return!1}else{var te=new pn;if(w)var le=w(J,Y,q,a,c,te);if(!(le===t?Ja(Y,J,E|x,w,te):le))return!1}}return!0}function o0(a){if(!vt(a)||ux(a))return!1;var c=ss(a)?IT:lc;return c.test(Ii(a))}function PS(a){return St(a)&&br(a)==Wn}function CS(a){return St(a)&&lr(a)==Sr}function NS(a){return St(a)&&fu(a.length)&&!!Ye[br(a)]}function a0(a){return typeof a=="function"?a:a==null?Pr:typeof a=="object"?Ne(a)?u0(a[0],a[1]):c0(a):Py(a)}function Vf(a){if(!Za(a))return jT(a);var c=[];for(var p in ct(a))st.call(a,p)&&p!="constructor"&&c.push(p);return c}function OS(a){if(!vt(a))return px(a);var c=Za(a),p=[];for(var w in a)w=="constructor"&&(c||!st.call(a,w))||p.push(w);return p}function Ff(a,c){return a<c}function l0(a,c){var p=-1,w=Rr(a)?G(a.length):[];return ks(a,function(S,O,L){w[++p]=c(S,O,L)}),w}function c0(a){var c=ed(a);return c.length==1&&c[0][2]?q0(c[0][0],c[0][1]):function(p){return p===a||Lf(p,a,c)}}function u0(a,c){return rd(a)&&B0(c)?q0(Cn(a),c):function(p){var w=fd(p,a);return w===t&&w===c?dd(p,a):Ja(c,w,E|x)}}function Jc(a,c,p,w,S){a!==c&&kf(c,function(O,L){if(S||(S=new pn),vt(O))kS(a,c,L,p,Jc,w,S);else{var U=w?w(sd(a,L),O,L+"",a,c,S):t;U===t&&(U=O),Nf(a,L,U)}},Ir)}function kS(a,c,p,w,S,O,L){var U=sd(a,p),q=sd(c,p),J=L.get(q);if(J){Nf(a,p,J);return}var Y=O?O(U,q,p+"",a,c,L):t,te=Y===t;if(te){var le=Ne(q),pe=!le&&Ls(q),be=!le&&!pe&&Ao(q);Y=q,le||pe||be?Ne(U)?Y=U:Rt(U)?Y=Ar(U):pe?(te=!1,Y=E0(q,!0)):be?(te=!1,Y=T0(q,!0)):Y=[]:tl(q)||Pi(q)?(Y=U,Pi(U)?Y=vy(U):(!vt(U)||ss(U))&&(Y=$0(q))):te=!1}te&&(L.set(q,Y),S(Y,q,w,O,L),L.delete(q)),Nf(a,p,Y)}function h0(a,c){var p=a.length;if(p)return c+=c<0?p:0,ns(c,p)?a[c]:t}function f0(a,c,p){c.length?c=lt(c,function(O){return Ne(O)?function(L){return Ai(L,O.length===1?O[0]:O)}:O}):c=[Pr];var w=-1;c=lt(c,tt(ve()));var S=l0(a,function(O,L,U){var q=lt(c,function(J){return J(O)});return{criteria:q,index:++w,value:O}});return H(S,function(O,L){return GS(O,L,p)})}function jS(a,c){return d0(a,c,function(p,w){return dd(a,w)})}function d0(a,c,p){for(var w=-1,S=c.length,O={};++w<S;){var L=c[w],U=Ai(a,L);p(U,L)&&Ya(O,Ds(L,a),U)}return O}function DS(a){return function(c){return Ai(c,a)}}function Uf(a,c,p,w){var S=w?Cs:Yn,O=-1,L=c.length,U=a;for(a===c&&(c=Ar(c)),p&&(U=lt(a,tt(p)));++O<L;)for(var q=0,J=c[O],Y=p?p(J):J;(q=S(U,Y,q,w))>-1;)U!==a&&Uc.call(U,q,1),Uc.call(a,q,1);return a}function p0(a,c){for(var p=a?c.length:0,w=p-1;p--;){var S=c[p];if(p==w||S!==O){var O=S;ns(S)?Uc.call(a,S,1):Wf(a,S)}}return a}function $f(a,c){return a+qc(Km()*(c-a+1))}function MS(a,c,p,w){for(var S=-1,O=Vt(Bc((c-a)/(p||1)),0),L=G(O);O--;)L[w?O:++S]=a,a+=p;return L}function Bf(a,c){var p="";if(!a||c<1||c>Le)return p;do c%2&&(p+=a),c=qc(c/2),c&&(a+=a);while(c);return p}function Me(a,c){return id(W0(a,c,Pr),a+"")}function LS(a){return Ym(Ro(a))}function VS(a,c){var p=Ro(a);return ou(p,xi(c,0,p.length))}function Ya(a,c,p,w){if(!vt(a))return a;c=Ds(c,a);for(var S=-1,O=c.length,L=O-1,U=a;U!=null&&++S<O;){var q=Cn(c[S]),J=p;if(q==="__proto__"||q==="constructor"||q==="prototype")return a;if(S!=L){var Y=U[q];J=w?w(Y,q,U):t,J===t&&(J=vt(Y)?Y:ns(c[S+1])?[]:{})}Ha(U,q,J),U=U[q]}return a}var g0=Wc?function(a,c){return Wc.set(a,c),a}:Pr,FS=$c?function(a,c){return $c(a,"toString",{configurable:!0,enumerable:!1,value:gd(c),writable:!0})}:Pr;function US(a){return ou(Ro(a))}function Zr(a,c,p){var w=-1,S=a.length;c<0&&(c=-c>S?0:S+c),p=p>S?S:p,p<0&&(p+=S),S=c>p?0:p-c>>>0,c>>>=0;for(var O=G(S);++w<S;)O[w]=a[w+c];return O}function $S(a,c){var p;return ks(a,function(w,S,O){return p=c(w,S,O),!p}),!!p}function Yc(a,c,p){var w=0,S=a==null?w:a.length;if(typeof c=="number"&&c===c&&S<=ue){for(;w<S;){var O=w+S>>>1,L=a[O];L!==null&&!Mr(L)&&(p?L<=c:L<c)?w=O+1:S=O}return S}return qf(a,c,Pr,p)}function qf(a,c,p,w){var S=0,O=a==null?0:a.length;if(O===0)return 0;c=p(c);for(var L=c!==c,U=c===null,q=Mr(c),J=c===t;S<O;){var Y=qc((S+O)/2),te=p(a[Y]),le=te!==t,pe=te===null,be=te===te,De=Mr(te);if(L)var Ee=w||be;else J?Ee=be&&(w||le):U?Ee=be&&le&&(w||!pe):q?Ee=be&&le&&!pe&&(w||!De):pe||De?Ee=!1:Ee=w?te<=c:te<c;Ee?S=Y+1:O=Y}return ar(O,Re)}function m0(a,c){for(var p=-1,w=a.length,S=0,O=[];++p<w;){var L=a[p],U=c?c(L):L;if(!p||!gn(U,q)){var q=U;O[S++]=L===0?0:L}}return O}function y0(a){return typeof a=="number"?a:Mr(a)?nt:+a}function Dr(a){if(typeof a=="string")return a;if(Ne(a))return lt(a,Dr)+"";if(Mr(a))return Qm?Qm.call(a):"";var c=a+"";return c=="0"&&1/a==-1/0?"-0":c}function js(a,c,p){var w=-1,S=vi,O=a.length,L=!0,U=[],q=U;if(p)L=!1,S=Ps;else if(O>=s){var J=c?null:XS(a);if(J)return Oc(J);L=!1,S=Qr,q=new Si}else q=c?[]:U;e:for(;++w<O;){var Y=a[w],te=c?c(Y):Y;if(Y=p||Y!==0?Y:0,L&&te===te){for(var le=q.length;le--;)if(q[le]===te)continue e;c&&q.push(te),U.push(Y)}else S(q,te,p)||(q!==U&&q.push(te),U.push(Y))}return U}function Wf(a,c){return c=Ds(c,a),a=z0(a,c),a==null||delete a[Cn(en(c))]}function w0(a,c,p,w){return Ya(a,c,p(Ai(a,c)),w)}function Xc(a,c,p,w){for(var S=a.length,O=w?S:-1;(w?O--:++O<S)&&c(a[O],O,a););return p?Zr(a,w?0:O,w?O+1:S):Zr(a,w?O+1:0,w?S:O)}function v0(a,c){var p=a;return p instanceof Ue&&(p=p.value()),fn(c,function(w,S){return S.func.apply(S.thisArg,hn([w],S.args))},p)}function zf(a,c,p){var w=a.length;if(w<2)return w?js(a[0]):[];for(var S=-1,O=G(w);++S<w;)for(var L=a[S],U=-1;++U<w;)U!=S&&(O[S]=Ka(O[S]||L,a[U],c,p));return js(Jt(O,1),c,p)}function _0(a,c,p){for(var w=-1,S=a.length,O=c.length,L={};++w<S;){var U=w<O?c[w]:t;p(L,a[w],U)}return L}function Gf(a){return Rt(a)?a:[]}function Hf(a){return typeof a=="function"?a:Pr}function Ds(a,c){return Ne(a)?a:rd(a,c)?[a]:Q0(rt(a))}var BS=Me;function Ms(a,c,p){var w=a.length;return p=p===t?w:p,!c&&p>=w?a:Zr(a,c,p)}var b0=PT||function(a){return Tt.clearTimeout(a)};function E0(a,c){if(c)return a.slice();var p=a.length,w=qm?qm(p):new a.constructor(p);return a.copy(w),w}function Kf(a){var c=new a.constructor(a.byteLength);return new Vc(c).set(new Vc(a)),c}function qS(a,c){var p=c?Kf(a.buffer):a.buffer;return new a.constructor(p,a.byteOffset,a.byteLength)}function WS(a){var c=new a.constructor(a.source,hi.exec(a));return c.lastIndex=a.lastIndex,c}function zS(a){return Ga?ct(Ga.call(a)):{}}function T0(a,c){var p=c?Kf(a.buffer):a.buffer;return new a.constructor(p,a.byteOffset,a.length)}function S0(a,c){if(a!==c){var p=a!==t,w=a===null,S=a===a,O=Mr(a),L=c!==t,U=c===null,q=c===c,J=Mr(c);if(!U&&!J&&!O&&a>c||O&&L&&q&&!U&&!J||w&&L&&q||!p&&q||!S)return 1;if(!w&&!O&&!J&&a<c||J&&p&&S&&!w&&!O||U&&p&&S||!L&&S||!q)return-1}return 0}function GS(a,c,p){for(var w=-1,S=a.criteria,O=c.criteria,L=S.length,U=p.length;++w<L;){var q=S0(S[w],O[w]);if(q){if(w>=U)return q;var J=p[w];return q*(J=="desc"?-1:1)}}return a.index-c.index}function x0(a,c,p,w){for(var S=-1,O=a.length,L=p.length,U=-1,q=c.length,J=Vt(O-L,0),Y=G(q+J),te=!w;++U<q;)Y[U]=c[U];for(;++S<L;)(te||S<O)&&(Y[p[S]]=a[S]);for(;J--;)Y[U++]=a[S++];return Y}function A0(a,c,p,w){for(var S=-1,O=a.length,L=-1,U=p.length,q=-1,J=c.length,Y=Vt(O-U,0),te=G(Y+J),le=!w;++S<Y;)te[S]=a[S];for(var pe=S;++q<J;)te[pe+q]=c[q];for(;++L<U;)(le||S<O)&&(te[pe+p[L]]=a[S++]);return te}function Ar(a,c){var p=-1,w=a.length;for(c||(c=G(w));++p<w;)c[p]=a[p];return c}function Pn(a,c,p,w){var S=!p;p||(p={});for(var O=-1,L=c.length;++O<L;){var U=c[O],q=w?w(p[U],a[U],U,p,a):t;q===t&&(q=a[U]),S?es(p,U,q):Ha(p,U,q)}return p}function HS(a,c){return Pn(a,td(a),c)}function KS(a,c){return Pn(a,F0(a),c)}function Zc(a,c){return function(p,w){var S=Ne(p)?wi:mS,O=c?c():{};return S(p,a,ve(w,2),O)}}function To(a){return Me(function(c,p){var w=-1,S=p.length,O=S>1?p[S-1]:t,L=S>2?p[2]:t;for(O=a.length>3&&typeof O=="function"?(S--,O):t,L&&Er(p[0],p[1],L)&&(O=S<3?t:O,S=1),c=ct(c);++w<S;){var U=p[w];U&&a(c,U,w,O)}return c})}function R0(a,c){return function(p,w){if(p==null)return p;if(!Rr(p))return a(p,w);for(var S=p.length,O=c?S:-1,L=ct(p);(c?O--:++O<S)&&w(L[O],O,L)!==!1;);return p}}function I0(a){return function(c,p,w){for(var S=-1,O=ct(c),L=w(c),U=L.length;U--;){var q=L[a?U:++S];if(p(O[q],q,O)===!1)break}return c}}function QS(a,c,p){var w=c&R,S=Xa(a);function O(){var L=this&&this!==Tt&&this instanceof O?S:a;return L.apply(w?p:this,arguments)}return O}function P0(a){return function(c){c=rt(c);var p=mo(c)?dn(c):t,w=p?p[0]:c.charAt(0),S=p?Ms(p,1).join(""):c.slice(1);return w[a]()+S}}function So(a){return function(c){return fn(Ry(Ay(c).replace(_f,"")),a,"")}}function Xa(a){return function(){var c=arguments;switch(c.length){case 0:return new a;case 1:return new a(c[0]);case 2:return new a(c[0],c[1]);case 3:return new a(c[0],c[1],c[2]);case 4:return new a(c[0],c[1],c[2],c[3]);case 5:return new a(c[0],c[1],c[2],c[3],c[4]);case 6:return new a(c[0],c[1],c[2],c[3],c[4],c[5]);case 7:return new a(c[0],c[1],c[2],c[3],c[4],c[5],c[6])}var p=Eo(a.prototype),w=a.apply(p,c);return vt(w)?w:p}}function JS(a,c,p){var w=Xa(a);function S(){for(var O=arguments.length,L=G(O),U=O,q=xo(S);U--;)L[U]=arguments[U];var J=O<3&&L[0]!==q&&L[O-1]!==q?[]:Ns(L,q);if(O-=J.length,O<p)return j0(a,c,eu,S.placeholder,t,L,J,t,t,p-O);var Y=this&&this!==Tt&&this instanceof S?w:a;return ir(Y,this,L)}return S}function C0(a){return function(c,p,w){var S=ct(c);if(!Rr(c)){var O=ve(p,3);c=Wt(c),p=function(U){return O(S[U],U,S)}}var L=a(c,p,w);return L>-1?S[O?c[L]:L]:t}}function N0(a){return rs(function(c){var p=c.length,w=p,S=Yr.prototype.thru;for(a&&c.reverse();w--;){var O=c[w];if(typeof O!="function")throw new Jr(o);if(S&&!L&&su(O)=="wrapper")var L=new Yr([],!0)}for(w=L?w:p;++w<p;){O=c[w];var U=su(O),q=U=="wrapper"?Zf(O):t;q&&nd(q[0])&&q[1]==(j|V|W|A)&&!q[4].length&&q[9]==1?L=L[su(q[0])].apply(L,q[3]):L=O.length==1&&nd(O)?L[U]():L.thru(O)}return function(){var J=arguments,Y=J[0];if(L&&J.length==1&&Ne(Y))return L.plant(Y).value();for(var te=0,le=p?c[te].apply(this,J):Y;++te<p;)le=c[te].call(this,le);return le}})}function eu(a,c,p,w,S,O,L,U,q,J){var Y=c&j,te=c&R,le=c&I,pe=c&(V|$),be=c&D,De=le?t:Xa(a);function Ee(){for(var Ve=arguments.length,We=G(Ve),Lr=Ve;Lr--;)We[Lr]=arguments[Lr];if(pe)var Tr=xo(Ee),Vr=$a(We,Tr);if(w&&(We=x0(We,w,S,pe)),O&&(We=A0(We,O,L,pe)),Ve-=Vr,pe&&Ve<J){var It=Ns(We,Tr);return j0(a,c,eu,Ee.placeholder,p,We,It,U,q,J-Ve)}var mn=te?p:this,os=le?mn[a]:a;return Ve=We.length,U?We=mx(We,U):be&&Ve>1&&We.reverse(),Y&&q<Ve&&(We.length=q),this&&this!==Tt&&this instanceof Ee&&(os=De||Xa(os)),os.apply(mn,We)}return Ee}function O0(a,c){return function(p,w){return SS(p,a,c(w),{})}}function tu(a,c){return function(p,w){var S;if(p===t&&w===t)return c;if(p!==t&&(S=p),w!==t){if(S===t)return w;typeof p=="string"||typeof w=="string"?(p=Dr(p),w=Dr(w)):(p=y0(p),w=y0(w)),S=a(p,w)}return S}}function Qf(a){return rs(function(c){return c=lt(c,tt(ve())),Me(function(p){var w=this;return a(c,function(S){return ir(S,w,p)})})})}function ru(a,c){c=c===t?" ":Dr(c);var p=c.length;if(p<2)return p?Bf(c,a):c;var w=Bf(c,Bc(a/yo(c)));return mo(c)?Ms(dn(w),0,a).join(""):w.slice(0,a)}function YS(a,c,p,w){var S=c&R,O=Xa(a);function L(){for(var U=-1,q=arguments.length,J=-1,Y=w.length,te=G(Y+q),le=this&&this!==Tt&&this instanceof L?O:a;++J<Y;)te[J]=w[J];for(;q--;)te[J++]=arguments[++U];return ir(le,S?p:this,te)}return L}function k0(a){return function(c,p,w){return w&&typeof w!="number"&&Er(c,p,w)&&(p=w=t),c=is(c),p===t?(p=c,c=0):p=is(p),w=w===t?c<p?1:-1:is(w),MS(c,p,w,a)}}function nu(a){return function(c,p){return typeof c=="string"&&typeof p=="string"||(c=tn(c),p=tn(p)),a(c,p)}}function j0(a,c,p,w,S,O,L,U,q,J){var Y=c&V,te=Y?L:t,le=Y?t:L,pe=Y?O:t,be=Y?t:O;c|=Y?W:X,c&=~(Y?X:W),c&F||(c&=-4);var De=[a,c,S,pe,te,be,le,U,q,J],Ee=p.apply(t,De);return nd(a)&&G0(Ee,De),Ee.placeholder=w,H0(Ee,a,c)}function Jf(a){var c=Lt[a];return function(p,w){if(p=tn(p),w=w==null?0:ar(ke(w),292),w&&Hm(p)){var S=(rt(p)+"e").split("e"),O=c(S[0]+"e"+(+S[1]+w));return S=(rt(O)+"e").split("e"),+(S[0]+"e"+(+S[1]-w))}return c(p)}}var XS=_o&&1/Oc(new _o([,-0]))[1]==Ae?function(a){return new _o(a)}:wd;function D0(a){return function(c){var p=lr(c);return p==Ht?Af(c):p==Sr?gT(c):Mt(c,a(c))}}function ts(a,c,p,w,S,O,L,U){var q=c&I;if(!q&&typeof a!="function")throw new Jr(o);var J=w?w.length:0;if(J||(c&=-97,w=S=t),L=L===t?L:Vt(ke(L),0),U=U===t?U:ke(U),J-=S?S.length:0,c&X){var Y=w,te=S;w=S=t}var le=q?t:Zf(a),pe=[a,c,p,w,S,Y,te,O,L,U];if(le&&dx(pe,le),a=pe[0],c=pe[1],p=pe[2],w=pe[3],S=pe[4],U=pe[9]=pe[9]===t?q?0:a.length:Vt(pe[9]-J,0),!U&&c&(V|$)&&(c&=-25),!c||c==R)var be=QS(a,c,p);else c==V||c==$?be=JS(a,c,U):(c==W||c==(R|W))&&!S.length?be=YS(a,c,p,w):be=eu.apply(t,pe);var De=le?g0:G0;return H0(De(be,pe),a,c)}function M0(a,c,p,w){return a===t||gn(a,vo[p])&&!st.call(w,p)?c:a}function L0(a,c,p,w,S,O){return vt(a)&&vt(c)&&(O.set(c,a),Jc(a,c,t,L0,O),O.delete(c)),a}function ZS(a){return tl(a)?t:a}function V0(a,c,p,w,S,O){var L=p&E,U=a.length,q=c.length;if(U!=q&&!(L&&q>U))return!1;var J=O.get(a),Y=O.get(c);if(J&&Y)return J==c&&Y==a;var te=-1,le=!0,pe=p&x?new Si:t;for(O.set(a,c),O.set(c,a);++te<U;){var be=a[te],De=c[te];if(w)var Ee=L?w(De,be,te,c,a,O):w(be,De,te,a,c,O);if(Ee!==t){if(Ee)continue;le=!1;break}if(pe){if(!po(c,function(Ve,We){if(!Qr(pe,We)&&(be===Ve||S(be,Ve,p,w,O)))return pe.push(We)})){le=!1;break}}else if(!(be===De||S(be,De,p,w,O))){le=!1;break}}return O.delete(a),O.delete(c),le}function ex(a,c,p,w,S,O,L){switch(p){case un:if(a.byteLength!=c.byteLength||a.byteOffset!=c.byteOffset)return!1;a=a.buffer,c=c.buffer;case At:return!(a.byteLength!=c.byteLength||!O(new Vc(a),new Vc(c)));case Bn:case qn:case ln:return gn(+a,+c);case an:return a.name==c.name&&a.message==c.message;case Wn:case ai:return a==c+"";case Ht:var U=Af;case Sr:var q=w&E;if(U||(U=Oc),a.size!=c.size&&!q)return!1;var J=L.get(a);if(J)return J==c;w|=x,L.set(a,c);var Y=V0(U(a),U(c),w,S,O,L);return L.delete(a),Y;case bs:if(Ga)return Ga.call(a)==Ga.call(c)}return!1}function tx(a,c,p,w,S,O){var L=p&E,U=Yf(a),q=U.length,J=Yf(c),Y=J.length;if(q!=Y&&!L)return!1;for(var te=q;te--;){var le=U[te];if(!(L?le in c:st.call(c,le)))return!1}var pe=O.get(a),be=O.get(c);if(pe&&be)return pe==c&&be==a;var De=!0;O.set(a,c),O.set(c,a);for(var Ee=L;++te<q;){le=U[te];var Ve=a[le],We=c[le];if(w)var Lr=L?w(We,Ve,le,c,a,O):w(Ve,We,le,a,c,O);if(!(Lr===t?Ve===We||S(Ve,We,p,w,O):Lr)){De=!1;break}Ee||(Ee=le=="constructor")}if(De&&!Ee){var Tr=a.constructor,Vr=c.constructor;Tr!=Vr&&"constructor"in a&&"constructor"in c&&!(typeof Tr=="function"&&Tr instanceof Tr&&typeof Vr=="function"&&Vr instanceof Vr)&&(De=!1)}return O.delete(a),O.delete(c),De}function rs(a){return id(W0(a,t,Z0),a+"")}function Yf(a){return s0(a,Wt,td)}function Xf(a){return s0(a,Ir,F0)}var Zf=Wc?function(a){return Wc.get(a)}:wd;function su(a){for(var c=a.name+"",p=bo[c],w=st.call(bo,c)?p.length:0;w--;){var S=p[w],O=S.func;if(O==null||O==a)return S.name}return c}function xo(a){var c=st.call(P,"placeholder")?P:a;return c.placeholder}function ve(){var a=P.iteratee||md;return a=a===md?a0:a,arguments.length?a(arguments[0],arguments[1]):a}function iu(a,c){var p=a.__data__;return cx(c)?p[typeof c=="string"?"string":"hash"]:p.map}function ed(a){for(var c=Wt(a),p=c.length;p--;){var w=c[p],S=a[w];c[p]=[w,S,B0(S)]}return c}function Ri(a,c){var p=fT(a,c);return o0(p)?p:t}function rx(a){var c=st.call(a,Ei),p=a[Ei];try{a[Ei]=t;var w=!0}catch{}var S=Mc.call(a);return w&&(c?a[Ei]=p:delete a[Ei]),S}var td=If?function(a){return a==null?[]:(a=ct(a),Kr(If(a),function(c){return zm.call(a,c)}))}:vd,F0=If?function(a){for(var c=[];a;)hn(c,td(a)),a=Fc(a);return c}:vd,lr=br;(Pf&&lr(new Pf(new ArrayBuffer(1)))!=un||qa&&lr(new qa)!=Ht||Cf&&lr(Cf.resolve())!=ec||_o&&lr(new _o)!=Sr||Wa&&lr(new Wa)!=Es)&&(lr=function(a){var c=br(a),p=c==cn?a.constructor:t,w=p?Ii(p):"";if(w)switch(w){case VT:return un;case FT:return Ht;case UT:return ec;case $T:return Sr;case BT:return Es}return c});function nx(a,c,p){for(var w=-1,S=p.length;++w<S;){var O=p[w],L=O.size;switch(O.type){case"drop":a+=L;break;case"dropRight":c-=L;break;case"take":c=ar(c,a+L);break;case"takeRight":a=Vt(a,c-L);break}}return{start:a,end:c}}function sx(a){var c=a.match(Ss);return c?c[1].split(pf):[]}function U0(a,c,p){c=Ds(c,a);for(var w=-1,S=c.length,O=!1;++w<S;){var L=Cn(c[w]);if(!(O=a!=null&&p(a,L)))break;a=a[L]}return O||++w!=S?O:(S=a==null?0:a.length,!!S&&fu(S)&&ns(L,S)&&(Ne(a)||Pi(a)))}function ix(a){var c=a.length,p=new a.constructor(c);return c&&typeof a[0]=="string"&&st.call(a,"index")&&(p.index=a.index,p.input=a.input),p}function $0(a){return typeof a.constructor=="function"&&!Za(a)?Eo(Fc(a)):{}}function ox(a,c,p){var w=a.constructor;switch(c){case At:return Kf(a);case Bn:case qn:return new w(+a);case un:return qS(a,p);case Xi:case Zi:case wa:case zn:case eo:case to:case li:case va:case _a:return T0(a,p);case Ht:return new w;case ln:case ai:return new w(a);case Wn:return WS(a);case Sr:return new w;case bs:return zS(a)}}function ax(a,c){var p=c.length;if(!p)return a;var w=p-1;return c[w]=(p>1?"& ":"")+c[w],c=c.join(p>2?", ":" "),a.replace(df,`{
/* [wrapped with `+c+`] */
`)}function lx(a){return Ne(a)||Pi(a)||!!(Gm&&a&&a[Gm])}function ns(a,c){var p=typeof a;return c=c??Le,!!c&&(p=="number"||p!="symbol"&&Aa.test(a))&&a>-1&&a%1==0&&a<c}function Er(a,c,p){if(!vt(p))return!1;var w=typeof c;return(w=="number"?Rr(p)&&ns(c,p.length):w=="string"&&c in p)?gn(p[c],a):!1}function rd(a,c){if(Ne(a))return!1;var p=typeof a;return p=="number"||p=="symbol"||p=="boolean"||a==null||Mr(a)?!0:ic.test(a)||!ci.test(a)||c!=null&&a in ct(c)}function cx(a){var c=typeof a;return c=="string"||c=="number"||c=="symbol"||c=="boolean"?a!=="__proto__":a===null}function nd(a){var c=su(a),p=P[c];if(typeof p!="function"||!(c in Ue.prototype))return!1;if(a===p)return!0;var w=Zf(p);return!!w&&a===w[0]}function ux(a){return!!Bm&&Bm in a}var hx=jc?ss:_d;function Za(a){var c=a&&a.constructor,p=typeof c=="function"&&c.prototype||vo;return a===p}function B0(a){return a===a&&!vt(a)}function q0(a,c){return function(p){return p==null?!1:p[a]===c&&(c!==t||a in ct(p))}}function fx(a){var c=uu(a,function(w){return p.size===h&&p.clear(),w}),p=c.cache;return c}function dx(a,c){var p=a[1],w=c[1],S=p|w,O=S<(R|I|j),L=w==j&&p==V||w==j&&p==A&&a[7].length<=c[8]||w==(j|A)&&c[7].length<=c[8]&&p==V;if(!(O||L))return a;w&R&&(a[2]=c[2],S|=p&R?0:F);var U=c[3];if(U){var q=a[3];a[3]=q?x0(q,U,c[4]):U,a[4]=q?Ns(a[3],d):c[4]}return U=c[5],U&&(q=a[5],a[5]=q?A0(q,U,c[6]):U,a[6]=q?Ns(a[5],d):c[6]),U=c[7],U&&(a[7]=U),w&j&&(a[8]=a[8]==null?c[8]:ar(a[8],c[8])),a[9]==null&&(a[9]=c[9]),a[0]=c[0],a[1]=S,a}function px(a){var c=[];if(a!=null)for(var p in ct(a))c.push(p);return c}function gx(a){return Mc.call(a)}function W0(a,c,p){return c=Vt(c===t?a.length-1:c,0),function(){for(var w=arguments,S=-1,O=Vt(w.length-c,0),L=G(O);++S<O;)L[S]=w[c+S];S=-1;for(var U=G(c+1);++S<c;)U[S]=w[S];return U[c]=p(L),ir(a,this,U)}}function z0(a,c){return c.length<2?a:Ai(a,Zr(c,0,-1))}function mx(a,c){for(var p=a.length,w=ar(c.length,p),S=Ar(a);w--;){var O=c[w];a[w]=ns(O,p)?S[O]:t}return a}function sd(a,c){if(!(c==="constructor"&&typeof a[c]=="function")&&c!="__proto__")return a[c]}var G0=K0(g0),el=NT||function(a,c){return Tt.setTimeout(a,c)},id=K0(FS);function H0(a,c,p){var w=c+"";return id(a,ax(w,yx(sx(w),p)))}function K0(a){var c=0,p=0;return function(){var w=DT(),S=C-(w-p);if(p=w,S>0){if(++c>=M)return arguments[0]}else c=0;return a.apply(t,arguments)}}function ou(a,c){var p=-1,w=a.length,S=w-1;for(c=c===t?w:c;++p<c;){var O=$f(p,S),L=a[O];a[O]=a[p],a[p]=L}return a.length=c,a}var Q0=fx(function(a){var c=[];return a.charCodeAt(0)===46&&c.push(""),a.replace(Kt,function(p,w,S,O){c.push(S?O.replace(oc,"$1"):w||p)}),c});function Cn(a){if(typeof a=="string"||Mr(a))return a;var c=a+"";return c=="0"&&1/a==-1/0?"-0":c}function Ii(a){if(a!=null){try{return Dc.call(a)}catch{}try{return a+""}catch{}}return""}function yx(a,c){return _r(at,function(p){var w="_."+p[0];c&p[1]&&!vi(a,w)&&a.push(w)}),a.sort()}function J0(a){if(a instanceof Ue)return a.clone();var c=new Yr(a.__wrapped__,a.__chain__);return c.__actions__=Ar(a.__actions__),c.__index__=a.__index__,c.__values__=a.__values__,c}function wx(a,c,p){(p?Er(a,c,p):c===t)?c=1:c=Vt(ke(c),0);var w=a==null?0:a.length;if(!w||c<1)return[];for(var S=0,O=0,L=G(Bc(w/c));S<w;)L[O++]=Zr(a,S,S+=c);return L}function vx(a){for(var c=-1,p=a==null?0:a.length,w=0,S=[];++c<p;){var O=a[c];O&&(S[w++]=O)}return S}function _x(){var a=arguments.length;if(!a)return[];for(var c=G(a-1),p=arguments[0],w=a;w--;)c[w-1]=arguments[w];return hn(Ne(p)?Ar(p):[p],Jt(c,1))}var bx=Me(function(a,c){return Rt(a)?Ka(a,Jt(c,1,Rt,!0)):[]}),Ex=Me(function(a,c){var p=en(c);return Rt(p)&&(p=t),Rt(a)?Ka(a,Jt(c,1,Rt,!0),ve(p,2)):[]}),Tx=Me(function(a,c){var p=en(c);return Rt(p)&&(p=t),Rt(a)?Ka(a,Jt(c,1,Rt,!0),t,p):[]});function Sx(a,c,p){var w=a==null?0:a.length;return w?(c=p||c===t?1:ke(c),Zr(a,c<0?0:c,w)):[]}function xx(a,c,p){var w=a==null?0:a.length;return w?(c=p||c===t?1:ke(c),c=w-c,Zr(a,0,c<0?0:c)):[]}function Ax(a,c){return a&&a.length?Xc(a,ve(c,3),!0,!0):[]}function Rx(a,c){return a&&a.length?Xc(a,ve(c,3),!0):[]}function Ix(a,c,p,w){var S=a==null?0:a.length;return S?(p&&typeof p!="number"&&Er(a,c,p)&&(p=0,w=S),_S(a,c,p,w)):[]}function Y0(a,c,p){var w=a==null?0:a.length;if(!w)return-1;var S=p==null?0:ke(p);return S<0&&(S=Vt(w+S,0)),_i(a,ve(c,3),S)}function X0(a,c,p){var w=a==null?0:a.length;if(!w)return-1;var S=w-1;return p!==t&&(S=ke(p),S=p<0?Vt(w+S,0):ar(S,w-1)),_i(a,ve(c,3),S,!0)}function Z0(a){var c=a==null?0:a.length;return c?Jt(a,1):[]}function Px(a){var c=a==null?0:a.length;return c?Jt(a,Ae):[]}function Cx(a,c){var p=a==null?0:a.length;return p?(c=c===t?1:ke(c),Jt(a,c)):[]}function Nx(a){for(var c=-1,p=a==null?0:a.length,w={};++c<p;){var S=a[c];w[S[0]]=S[1]}return w}function ey(a){return a&&a.length?a[0]:t}function Ox(a,c,p){var w=a==null?0:a.length;if(!w)return-1;var S=p==null?0:ke(p);return S<0&&(S=Vt(w+S,0)),Yn(a,c,S)}function kx(a){var c=a==null?0:a.length;return c?Zr(a,0,-1):[]}var jx=Me(function(a){var c=lt(a,Gf);return c.length&&c[0]===a[0]?Mf(c):[]}),Dx=Me(function(a){var c=en(a),p=lt(a,Gf);return c===en(p)?c=t:p.pop(),p.length&&p[0]===a[0]?Mf(p,ve(c,2)):[]}),Mx=Me(function(a){var c=en(a),p=lt(a,Gf);return c=typeof c=="function"?c:t,c&&p.pop(),p.length&&p[0]===a[0]?Mf(p,t,c):[]});function Lx(a,c){return a==null?"":kT.call(a,c)}function en(a){var c=a==null?0:a.length;return c?a[c-1]:t}function Vx(a,c,p){var w=a==null?0:a.length;if(!w)return-1;var S=w;return p!==t&&(S=ke(p),S=S<0?Vt(w+S,0):ar(S,w-1)),c===c?yT(a,c,S):_i(a,f,S,!0)}function Fx(a,c){return a&&a.length?h0(a,ke(c)):t}var Ux=Me(ty);function ty(a,c){return a&&a.length&&c&&c.length?Uf(a,c):a}function $x(a,c,p){return a&&a.length&&c&&c.length?Uf(a,c,ve(p,2)):a}function Bx(a,c,p){return a&&a.length&&c&&c.length?Uf(a,c,t,p):a}var qx=rs(function(a,c){var p=a==null?0:a.length,w=Of(a,c);return p0(a,lt(c,function(S){return ns(S,p)?+S:S}).sort(S0)),w});function Wx(a,c){var p=[];if(!(a&&a.length))return p;var w=-1,S=[],O=a.length;for(c=ve(c,3);++w<O;){var L=a[w];c(L,w,a)&&(p.push(L),S.push(w))}return p0(a,S),p}function od(a){return a==null?a:LT.call(a)}function zx(a,c,p){var w=a==null?0:a.length;return w?(p&&typeof p!="number"&&Er(a,c,p)?(c=0,p=w):(c=c==null?0:ke(c),p=p===t?w:ke(p)),Zr(a,c,p)):[]}function Gx(a,c){return Yc(a,c)}function Hx(a,c,p){return qf(a,c,ve(p,2))}function Kx(a,c){var p=a==null?0:a.length;if(p){var w=Yc(a,c);if(w<p&&gn(a[w],c))return w}return-1}function Qx(a,c){return Yc(a,c,!0)}function Jx(a,c,p){return qf(a,c,ve(p,2),!0)}function Yx(a,c){var p=a==null?0:a.length;if(p){var w=Yc(a,c,!0)-1;if(gn(a[w],c))return w}return-1}function Xx(a){return a&&a.length?m0(a):[]}function Zx(a,c){return a&&a.length?m0(a,ve(c,2)):[]}function eA(a){var c=a==null?0:a.length;return c?Zr(a,1,c):[]}function tA(a,c,p){return a&&a.length?(c=p||c===t?1:ke(c),Zr(a,0,c<0?0:c)):[]}function rA(a,c,p){var w=a==null?0:a.length;return w?(c=p||c===t?1:ke(c),c=w-c,Zr(a,c<0?0:c,w)):[]}function nA(a,c){return a&&a.length?Xc(a,ve(c,3),!1,!0):[]}function sA(a,c){return a&&a.length?Xc(a,ve(c,3)):[]}var iA=Me(function(a){return js(Jt(a,1,Rt,!0))}),oA=Me(function(a){var c=en(a);return Rt(c)&&(c=t),js(Jt(a,1,Rt,!0),ve(c,2))}),aA=Me(function(a){var c=en(a);return c=typeof c=="function"?c:t,js(Jt(a,1,Rt,!0),t,c)});function lA(a){return a&&a.length?js(a):[]}function cA(a,c){return a&&a.length?js(a,ve(c,2)):[]}function uA(a,c){return c=typeof c=="function"?c:t,a&&a.length?js(a,t,c):[]}function ad(a){if(!(a&&a.length))return[];var c=0;return a=Kr(a,function(p){if(Rt(p))return c=Vt(p.length,c),!0}),Xe(c,function(p){return lt(a,b(p))})}function ry(a,c){if(!(a&&a.length))return[];var p=ad(a);return c==null?p:lt(p,function(w){return ir(c,t,w)})}var hA=Me(function(a,c){return Rt(a)?Ka(a,c):[]}),fA=Me(function(a){return zf(Kr(a,Rt))}),dA=Me(function(a){var c=en(a);return Rt(c)&&(c=t),zf(Kr(a,Rt),ve(c,2))}),pA=Me(function(a){var c=en(a);return c=typeof c=="function"?c:t,zf(Kr(a,Rt),t,c)}),gA=Me(ad);function mA(a,c){return _0(a||[],c||[],Ha)}function yA(a,c){return _0(a||[],c||[],Ya)}var wA=Me(function(a){var c=a.length,p=c>1?a[c-1]:t;return p=typeof p=="function"?(a.pop(),p):t,ry(a,p)});function ny(a){var c=P(a);return c.__chain__=!0,c}function vA(a,c){return c(a),a}function au(a,c){return c(a)}var _A=rs(function(a){var c=a.length,p=c?a[0]:0,w=this.__wrapped__,S=function(O){return Of(O,a)};return c>1||this.__actions__.length||!(w instanceof Ue)||!ns(p)?this.thru(S):(w=w.slice(p,+p+(c?1:0)),w.__actions__.push({func:au,args:[S],thisArg:t}),new Yr(w,this.__chain__).thru(function(O){return c&&!O.length&&O.push(t),O}))});function bA(){return ny(this)}function EA(){return new Yr(this.value(),this.__chain__)}function TA(){this.__values__===t&&(this.__values__=yy(this.value()));var a=this.__index__>=this.__values__.length,c=a?t:this.__values__[this.__index__++];return{done:a,value:c}}function SA(){return this}function xA(a){for(var c,p=this;p instanceof Gc;){var w=J0(p);w.__index__=0,w.__values__=t,c?S.__wrapped__=w:c=w;var S=w;p=p.__wrapped__}return S.__wrapped__=a,c}function AA(){var a=this.__wrapped__;if(a instanceof Ue){var c=a;return this.__actions__.length&&(c=new Ue(this)),c=c.reverse(),c.__actions__.push({func:au,args:[od],thisArg:t}),new Yr(c,this.__chain__)}return this.thru(od)}function RA(){return v0(this.__wrapped__,this.__actions__)}var IA=Zc(function(a,c,p){st.call(a,p)?++a[p]:es(a,p,1)});function PA(a,c,p){var w=Ne(a)?fo:vS;return p&&Er(a,c,p)&&(c=t),w(a,ve(c,3))}function CA(a,c){var p=Ne(a)?Kr:r0;return p(a,ve(c,3))}var NA=C0(Y0),OA=C0(X0);function kA(a,c){return Jt(lu(a,c),1)}function jA(a,c){return Jt(lu(a,c),Ae)}function DA(a,c,p){return p=p===t?1:ke(p),Jt(lu(a,c),p)}function sy(a,c){var p=Ne(a)?_r:ks;return p(a,ve(c,3))}function iy(a,c){var p=Ne(a)?Ic:t0;return p(a,ve(c,3))}var MA=Zc(function(a,c,p){st.call(a,p)?a[p].push(c):es(a,p,[c])});function LA(a,c,p,w){a=Rr(a)?a:Ro(a),p=p&&!w?ke(p):0;var S=a.length;return p<0&&(p=Vt(S+p,0)),du(a)?p<=S&&a.indexOf(c,p)>-1:!!S&&Yn(a,c,p)>-1}var VA=Me(function(a,c,p){var w=-1,S=typeof c=="function",O=Rr(a)?G(a.length):[];return ks(a,function(L){O[++w]=S?ir(c,L,p):Qa(L,c,p)}),O}),FA=Zc(function(a,c,p){es(a,p,c)});function lu(a,c){var p=Ne(a)?lt:l0;return p(a,ve(c,3))}function UA(a,c,p,w){return a==null?[]:(Ne(c)||(c=c==null?[]:[c]),p=w?t:p,Ne(p)||(p=p==null?[]:[p]),f0(a,c,p))}var $A=Zc(function(a,c,p){a[p?0:1].push(c)},function(){return[[],[]]});function BA(a,c,p){var w=Ne(a)?fn:z,S=arguments.length<3;return w(a,ve(c,4),p,S,ks)}function qA(a,c,p){var w=Ne(a)?Pc:z,S=arguments.length<3;return w(a,ve(c,4),p,S,t0)}function WA(a,c){var p=Ne(a)?Kr:r0;return p(a,hu(ve(c,3)))}function zA(a){var c=Ne(a)?Ym:LS;return c(a)}function GA(a,c,p){(p?Er(a,c,p):c===t)?c=1:c=ke(c);var w=Ne(a)?pS:VS;return w(a,c)}function HA(a){var c=Ne(a)?gS:US;return c(a)}function KA(a){if(a==null)return 0;if(Rr(a))return du(a)?yo(a):a.length;var c=lr(a);return c==Ht||c==Sr?a.size:Vf(a).length}function QA(a,c,p){var w=Ne(a)?po:$S;return p&&Er(a,c,p)&&(c=t),w(a,ve(c,3))}var JA=Me(function(a,c){if(a==null)return[];var p=c.length;return p>1&&Er(a,c[0],c[1])?c=[]:p>2&&Er(c[0],c[1],c[2])&&(c=[c[0]]),f0(a,Jt(c,1),[])}),cu=CT||function(){return Tt.Date.now()};function YA(a,c){if(typeof c!="function")throw new Jr(o);return a=ke(a),function(){if(--a<1)return c.apply(this,arguments)}}function oy(a,c,p){return c=p?t:c,c=a&&c==null?a.length:c,ts(a,j,t,t,t,t,c)}function ay(a,c){var p;if(typeof c!="function")throw new Jr(o);return a=ke(a),function(){return--a>0&&(p=c.apply(this,arguments)),a<=1&&(c=t),p}}var ld=Me(function(a,c,p){var w=R;if(p.length){var S=Ns(p,xo(ld));w|=W}return ts(a,w,c,p,S)}),ly=Me(function(a,c,p){var w=R|I;if(p.length){var S=Ns(p,xo(ly));w|=W}return ts(c,w,a,p,S)});function cy(a,c,p){c=p?t:c;var w=ts(a,V,t,t,t,t,t,c);return w.placeholder=cy.placeholder,w}function uy(a,c,p){c=p?t:c;var w=ts(a,$,t,t,t,t,t,c);return w.placeholder=uy.placeholder,w}function hy(a,c,p){var w,S,O,L,U,q,J=0,Y=!1,te=!1,le=!0;if(typeof a!="function")throw new Jr(o);c=tn(c)||0,vt(p)&&(Y=!!p.leading,te="maxWait"in p,O=te?Vt(tn(p.maxWait)||0,c):O,le="trailing"in p?!!p.trailing:le);function pe(It){var mn=w,os=S;return w=S=t,J=It,L=a.apply(os,mn),L}function be(It){return J=It,U=el(Ve,c),Y?pe(It):L}function De(It){var mn=It-q,os=It-J,Cy=c-mn;return te?ar(Cy,O-os):Cy}function Ee(It){var mn=It-q,os=It-J;return q===t||mn>=c||mn<0||te&&os>=O}function Ve(){var It=cu();if(Ee(It))return We(It);U=el(Ve,De(It))}function We(It){return U=t,le&&w?pe(It):(w=S=t,L)}function Lr(){U!==t&&b0(U),J=0,w=q=S=U=t}function Tr(){return U===t?L:We(cu())}function Vr(){var It=cu(),mn=Ee(It);if(w=arguments,S=this,q=It,mn){if(U===t)return be(q);if(te)return b0(U),U=el(Ve,c),pe(q)}return U===t&&(U=el(Ve,c)),L}return Vr.cancel=Lr,Vr.flush=Tr,Vr}var XA=Me(function(a,c){return e0(a,1,c)}),ZA=Me(function(a,c,p){return e0(a,tn(c)||0,p)});function eR(a){return ts(a,D)}function uu(a,c){if(typeof a!="function"||c!=null&&typeof c!="function")throw new Jr(o);var p=function(){var w=arguments,S=c?c.apply(this,w):w[0],O=p.cache;if(O.has(S))return O.get(S);var L=a.apply(this,w);return p.cache=O.set(S,L)||O,L};return p.cache=new(uu.Cache||Zn),p}uu.Cache=Zn;function hu(a){if(typeof a!="function")throw new Jr(o);return function(){var c=arguments;switch(c.length){case 0:return!a.call(this);case 1:return!a.call(this,c[0]);case 2:return!a.call(this,c[0],c[1]);case 3:return!a.call(this,c[0],c[1],c[2])}return!a.apply(this,c)}}function tR(a){return ay(2,a)}var rR=BS(function(a,c){c=c.length==1&&Ne(c[0])?lt(c[0],tt(ve())):lt(Jt(c,1),tt(ve()));var p=c.length;return Me(function(w){for(var S=-1,O=ar(w.length,p);++S<O;)w[S]=c[S].call(this,w[S]);return ir(a,this,w)})}),cd=Me(function(a,c){var p=Ns(c,xo(cd));return ts(a,W,t,c,p)}),fy=Me(function(a,c){var p=Ns(c,xo(fy));return ts(a,X,t,c,p)}),nR=rs(function(a,c){return ts(a,A,t,t,t,c)});function sR(a,c){if(typeof a!="function")throw new Jr(o);return c=c===t?c:ke(c),Me(a,c)}function iR(a,c){if(typeof a!="function")throw new Jr(o);return c=c==null?0:Vt(ke(c),0),Me(function(p){var w=p[c],S=Ms(p,0,c);return w&&hn(S,w),ir(a,this,S)})}function oR(a,c,p){var w=!0,S=!0;if(typeof a!="function")throw new Jr(o);return vt(p)&&(w="leading"in p?!!p.leading:w,S="trailing"in p?!!p.trailing:S),hy(a,c,{leading:w,maxWait:c,trailing:S})}function aR(a){return oy(a,1)}function lR(a,c){return cd(Hf(c),a)}function cR(){if(!arguments.length)return[];var a=arguments[0];return Ne(a)?a:[a]}function uR(a){return Xr(a,_)}function hR(a,c){return c=typeof c=="function"?c:t,Xr(a,_,c)}function fR(a){return Xr(a,g|_)}function dR(a,c){return c=typeof c=="function"?c:t,Xr(a,g|_,c)}function pR(a,c){return c==null||Zm(a,c,Wt(c))}function gn(a,c){return a===c||a!==a&&c!==c}var gR=nu(Df),mR=nu(function(a,c){return a>=c}),Pi=i0(function(){return arguments}())?i0:function(a){return St(a)&&st.call(a,"callee")&&!zm.call(a,"callee")},Ne=G.isArray,yR=Fa?tt(Fa):xS;function Rr(a){return a!=null&&fu(a.length)&&!ss(a)}function Rt(a){return St(a)&&Rr(a)}function wR(a){return a===!0||a===!1||St(a)&&br(a)==Bn}var Ls=OT||_d,vR=ho?tt(ho):AS;function _R(a){return St(a)&&a.nodeType===1&&!tl(a)}function bR(a){if(a==null)return!0;if(Rr(a)&&(Ne(a)||typeof a=="string"||typeof a.splice=="function"||Ls(a)||Ao(a)||Pi(a)))return!a.length;var c=lr(a);if(c==Ht||c==Sr)return!a.size;if(Za(a))return!Vf(a).length;for(var p in a)if(st.call(a,p))return!1;return!0}function ER(a,c){return Ja(a,c)}function TR(a,c,p){p=typeof p=="function"?p:t;var w=p?p(a,c):t;return w===t?Ja(a,c,t,p):!!w}function ud(a){if(!St(a))return!1;var c=br(a);return c==an||c==vs||typeof a.message=="string"&&typeof a.name=="string"&&!tl(a)}function SR(a){return typeof a=="number"&&Hm(a)}function ss(a){if(!vt(a))return!1;var c=br(a);return c==Sn||c==_s||c==ht||c==tc}function dy(a){return typeof a=="number"&&a==ke(a)}function fu(a){return typeof a=="number"&&a>-1&&a%1==0&&a<=Le}function vt(a){var c=typeof a;return a!=null&&(c=="object"||c=="function")}function St(a){return a!=null&&typeof a=="object"}var py=mi?tt(mi):IS;function xR(a,c){return a===c||Lf(a,c,ed(c))}function AR(a,c,p){return p=typeof p=="function"?p:t,Lf(a,c,ed(c),p)}function RR(a){return gy(a)&&a!=+a}function IR(a){if(hx(a))throw new Ie(i);return o0(a)}function PR(a){return a===null}function CR(a){return a==null}function gy(a){return typeof a=="number"||St(a)&&br(a)==ln}function tl(a){if(!St(a)||br(a)!=cn)return!1;var c=Fc(a);if(c===null)return!0;var p=st.call(c,"constructor")&&c.constructor;return typeof p=="function"&&p instanceof p&&Dc.call(p)==AT}var hd=Ua?tt(Ua):PS;function NR(a){return dy(a)&&a>=-9007199254740991&&a<=Le}var my=yi?tt(yi):CS;function du(a){return typeof a=="string"||!Ne(a)&&St(a)&&br(a)==ai}function Mr(a){return typeof a=="symbol"||St(a)&&br(a)==bs}var Ao=Rc?tt(Rc):NS;function OR(a){return a===t}function kR(a){return St(a)&&lr(a)==Es}function jR(a){return St(a)&&br(a)==Bt}var DR=nu(Ff),MR=nu(function(a,c){return a<=c});function yy(a){if(!a)return[];if(Rr(a))return du(a)?dn(a):Ar(a);if(Ba&&a[Ba])return pT(a[Ba]());var c=lr(a),p=c==Ht?Af:c==Sr?Oc:Ro;return p(a)}function is(a){if(!a)return a===0?a:0;if(a=tn(a),a===Ae||a===-1/0){var c=a<0?-1:1;return c*wt}return a===a?a:0}function ke(a){var c=is(a),p=c%1;return c===c?p?c-p:c:0}function wy(a){return a?xi(ke(a),0,me):0}function tn(a){if(typeof a=="number")return a;if(Mr(a))return nt;if(vt(a)){var c=typeof a.valueOf=="function"?a.valueOf():a;a=vt(c)?c+"":c}if(typeof a!="string")return a===0?a:+a;a=qe(a);var p=ac.test(a);return p||xa.test(a)?xc(a.slice(2),p?2:8):xn.test(a)?nt:+a}function vy(a){return Pn(a,Ir(a))}function LR(a){return a?xi(ke(a),-9007199254740991,Le):a===0?a:0}function rt(a){return a==null?"":Dr(a)}var VR=To(function(a,c){if(Za(c)||Rr(c)){Pn(c,Wt(c),a);return}for(var p in c)st.call(c,p)&&Ha(a,p,c[p])}),_y=To(function(a,c){Pn(c,Ir(c),a)}),pu=To(function(a,c,p,w){Pn(c,Ir(c),a,w)}),FR=To(function(a,c,p,w){Pn(c,Wt(c),a,w)}),UR=rs(Of);function $R(a,c){var p=Eo(a);return c==null?p:Xm(p,c)}var BR=Me(function(a,c){a=ct(a);var p=-1,w=c.length,S=w>2?c[2]:t;for(S&&Er(c[0],c[1],S)&&(w=1);++p<w;)for(var O=c[p],L=Ir(O),U=-1,q=L.length;++U<q;){var J=L[U],Y=a[J];(Y===t||gn(Y,vo[J])&&!st.call(a,J))&&(a[J]=O[J])}return a}),qR=Me(function(a){return a.push(t,L0),ir(by,t,a)});function WR(a,c){return or(a,ve(c,3),In)}function zR(a,c){return or(a,ve(c,3),jf)}function GR(a,c){return a==null?a:kf(a,ve(c,3),Ir)}function HR(a,c){return a==null?a:n0(a,ve(c,3),Ir)}function KR(a,c){return a&&In(a,ve(c,3))}function QR(a,c){return a&&jf(a,ve(c,3))}function JR(a){return a==null?[]:Qc(a,Wt(a))}function YR(a){return a==null?[]:Qc(a,Ir(a))}function fd(a,c,p){var w=a==null?t:Ai(a,c);return w===t?p:w}function XR(a,c){return a!=null&&U0(a,c,bS)}function dd(a,c){return a!=null&&U0(a,c,ES)}var ZR=O0(function(a,c,p){c!=null&&typeof c.toString!="function"&&(c=Mc.call(c)),a[c]=p},gd(Pr)),eI=O0(function(a,c,p){c!=null&&typeof c.toString!="function"&&(c=Mc.call(c)),st.call(a,c)?a[c].push(p):a[c]=[p]},ve),tI=Me(Qa);function Wt(a){return Rr(a)?Jm(a):Vf(a)}function Ir(a){return Rr(a)?Jm(a,!0):OS(a)}function rI(a,c){var p={};return c=ve(c,3),In(a,function(w,S,O){es(p,c(w,S,O),w)}),p}function nI(a,c){var p={};return c=ve(c,3),In(a,function(w,S,O){es(p,S,c(w,S,O))}),p}var sI=To(function(a,c,p){Jc(a,c,p)}),by=To(function(a,c,p,w){Jc(a,c,p,w)}),iI=rs(function(a,c){var p={};if(a==null)return p;var w=!1;c=lt(c,function(O){return O=Ds(O,a),w||(w=O.length>1),O}),Pn(a,Xf(a),p),w&&(p=Xr(p,g|v|_,ZS));for(var S=c.length;S--;)Wf(p,c[S]);return p});function oI(a,c){return Ey(a,hu(ve(c)))}var aI=rs(function(a,c){return a==null?{}:jS(a,c)});function Ey(a,c){if(a==null)return{};var p=lt(Xf(a),function(w){return[w]});return c=ve(c),d0(a,p,function(w,S){return c(w,S[0])})}function lI(a,c,p){c=Ds(c,a);var w=-1,S=c.length;for(S||(S=1,a=t);++w<S;){var O=a==null?t:a[Cn(c[w])];O===t&&(w=S,O=p),a=ss(O)?O.call(a):O}return a}function cI(a,c,p){return a==null?a:Ya(a,c,p)}function uI(a,c,p,w){return w=typeof w=="function"?w:t,a==null?a:Ya(a,c,p,w)}var Ty=D0(Wt),Sy=D0(Ir);function hI(a,c,p){var w=Ne(a),S=w||Ls(a)||Ao(a);if(c=ve(c,4),p==null){var O=a&&a.constructor;S?p=w?new O:[]:vt(a)?p=ss(O)?Eo(Fc(a)):{}:p={}}return(S?_r:In)(a,function(L,U,q){return c(p,L,U,q)}),p}function fI(a,c){return a==null?!0:Wf(a,c)}function dI(a,c,p){return a==null?a:w0(a,c,Hf(p))}function pI(a,c,p,w){return w=typeof w=="function"?w:t,a==null?a:w0(a,c,Hf(p),w)}function Ro(a){return a==null?[]:Ot(a,Wt(a))}function gI(a){return a==null?[]:Ot(a,Ir(a))}function mI(a,c,p){return p===t&&(p=c,c=t),p!==t&&(p=tn(p),p=p===p?p:0),c!==t&&(c=tn(c),c=c===c?c:0),xi(tn(a),c,p)}function yI(a,c,p){return c=is(c),p===t?(p=c,c=0):p=is(p),a=tn(a),TS(a,c,p)}function wI(a,c,p){if(p&&typeof p!="boolean"&&Er(a,c,p)&&(c=p=t),p===t&&(typeof c=="boolean"?(p=c,c=t):typeof a=="boolean"&&(p=a,a=t)),a===t&&c===t?(a=0,c=1):(a=is(a),c===t?(c=a,a=0):c=is(c)),a>c){var w=a;a=c,c=w}if(p||a%1||c%1){var S=Km();return ar(a+S*(c-a+xf("1e-"+((S+"").length-1))),c)}return $f(a,c)}var vI=So(function(a,c,p){return c=c.toLowerCase(),a+(p?xy(c):c)});function xy(a){return pd(rt(a).toLowerCase())}function Ay(a){return a=rt(a),a&&a.replace(cc,cT).replace(bf,"")}function _I(a,c,p){a=rt(a),c=Dr(c);var w=a.length;p=p===t?w:xi(ke(p),0,w);var S=p;return p-=c.length,p>=0&&a.slice(p,S)==c}function bI(a){return a=rt(a),a&&Gn.test(a)?a.replace(ro,uT):a}function EI(a){return a=rt(a),a&&ui.test(a)?a.replace(so,"\\$&"):a}var TI=So(function(a,c,p){return a+(p?"-":"")+c.toLowerCase()}),SI=So(function(a,c,p){return a+(p?" ":"")+c.toLowerCase()}),xI=P0("toLowerCase");function AI(a,c,p){a=rt(a),c=ke(c);var w=c?yo(a):0;if(!c||w>=c)return a;var S=(c-w)/2;return ru(qc(S),p)+a+ru(Bc(S),p)}function RI(a,c,p){a=rt(a),c=ke(c);var w=c?yo(a):0;return c&&w<c?a+ru(c-w,p):a}function II(a,c,p){a=rt(a),c=ke(c);var w=c?yo(a):0;return c&&w<c?ru(c-w,p)+a:a}function PI(a,c,p){return p||c==null?c=0:c&&(c=+c),MT(rt(a).replace(Hn,""),c||0)}function CI(a,c,p){return(p?Er(a,c,p):c===t)?c=1:c=ke(c),Bf(rt(a),c)}function NI(){var a=arguments,c=rt(a[0]);return a.length<3?c:c.replace(a[1],a[2])}var OI=So(function(a,c,p){return a+(p?"_":"")+c.toLowerCase()});function kI(a,c,p){return p&&typeof p!="number"&&Er(a,c,p)&&(c=p=t),p=p===t?me:p>>>0,p?(a=rt(a),a&&(typeof c=="string"||c!=null&&!hd(c))&&(c=Dr(c),!c&&mo(a))?Ms(dn(a),0,p):a.split(c,p)):[]}var jI=So(function(a,c,p){return a+(p?" ":"")+pd(c)});function DI(a,c,p){return a=rt(a),p=p==null?0:xi(ke(p),0,a.length),c=Dr(c),a.slice(p,p+c.length)==c}function MI(a,c,p){var w=P.templateSettings;p&&Er(a,c,p)&&(c=t),a=rt(a),c=pu({},c,w,M0);var S=pu({},c.imports,w.imports,M0),O=Wt(S),L=Ot(S,O),U,q,J=0,Y=c.interpolate||fi,te="__p += '",le=Rf((c.escape||fi).source+"|"+Y.source+"|"+(Y===Ta?Sa:fi).source+"|"+(c.evaluate||fi).source+"|$","g"),pe="//# sourceURL="+(st.call(c,"sourceURL")?(c.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Tc+"]")+`
`;a.replace(le,function(Ee,Ve,We,Lr,Tr,Vr){return We||(We=Lr),te+=a.slice(J,Vr).replace(mf,hT),Ve&&(U=!0,te+=`' +
__e(`+Ve+`) +
'`),Tr&&(q=!0,te+=`';
`+Tr+`;
__p += '`),We&&(te+=`' +
((__t = (`+We+`)) == null ? '' : __t) +
'`),J=Vr+Ee.length,Ee}),te+=`';
`;var be=st.call(c,"variable")&&c.variable;if(!be)te=`with (obj) {
`+te+`
}
`;else if(io.test(be))throw new Ie(l);te=(q?te.replace(ba,""):te).replace(rc,"$1").replace(nc,"$1;"),te="function("+(be||"obj")+`) {
`+(be?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(U?", __e = _.escape":"")+(q?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+te+`return __p
}`;var De=Iy(function(){return Ze(O,pe+"return "+te).apply(t,L)});if(De.source=te,ud(De))throw De;return De}function LI(a){return rt(a).toLowerCase()}function VI(a){return rt(a).toUpperCase()}function FI(a,c,p){if(a=rt(a),a&&(p||c===t))return qe(a);if(!a||!(c=Dr(c)))return a;var w=dn(a),S=dn(c),O=xr(w,S),L=bi(w,S)+1;return Ms(w,O,L).join("")}function UI(a,c,p){if(a=rt(a),a&&(p||c===t))return a.slice(0,$m(a)+1);if(!a||!(c=Dr(c)))return a;var w=dn(a),S=bi(w,dn(c))+1;return Ms(w,0,S).join("")}function $I(a,c,p){if(a=rt(a),a&&(p||c===t))return a.replace(Hn,"");if(!a||!(c=Dr(c)))return a;var w=dn(a),S=xr(w,dn(c));return Ms(w,S).join("")}function BI(a,c){var p=T,w=k;if(vt(c)){var S="separator"in c?c.separator:S;p="length"in c?ke(c.length):p,w="omission"in c?Dr(c.omission):w}a=rt(a);var O=a.length;if(mo(a)){var L=dn(a);O=L.length}if(p>=O)return a;var U=p-yo(w);if(U<1)return w;var q=L?Ms(L,0,U).join(""):a.slice(0,U);if(S===t)return q+w;if(L&&(U+=q.length-U),hd(S)){if(a.slice(U).search(S)){var J,Y=q;for(S.global||(S=Rf(S.source,rt(hi.exec(S))+"g")),S.lastIndex=0;J=S.exec(Y);)var te=J.index;q=q.slice(0,te===t?U:te)}}else if(a.indexOf(Dr(S),U)!=U){var le=q.lastIndexOf(S);le>-1&&(q=q.slice(0,le))}return q+w}function qI(a){return a=rt(a),a&&Ea.test(a)?a.replace(Ts,wT):a}var WI=So(function(a,c,p){return a+(p?" ":"")+c.toUpperCase()}),pd=P0("toUpperCase");function Ry(a,c,p){return a=rt(a),c=p?t:c,c===t?dT(a)?bT(a):go(a):a.match(c)||[]}var Iy=Me(function(a,c){try{return ir(a,t,c)}catch(p){return ud(p)?p:new Ie(p)}}),zI=rs(function(a,c){return _r(c,function(p){p=Cn(p),es(a,p,ld(a[p],a))}),a});function GI(a){var c=a==null?0:a.length,p=ve();return a=c?lt(a,function(w){if(typeof w[1]!="function")throw new Jr(o);return[p(w[0]),w[1]]}):[],Me(function(w){for(var S=-1;++S<c;){var O=a[S];if(ir(O[0],this,w))return ir(O[1],this,w)}})}function HI(a){return wS(Xr(a,g))}function gd(a){return function(){return a}}function KI(a,c){return a==null||a!==a?c:a}var QI=N0(),JI=N0(!0);function Pr(a){return a}function md(a){return a0(typeof a=="function"?a:Xr(a,g))}function YI(a){return c0(Xr(a,g))}function XI(a,c){return u0(a,Xr(c,g))}var ZI=Me(function(a,c){return function(p){return Qa(p,a,c)}}),e2=Me(function(a,c){return function(p){return Qa(a,p,c)}});function yd(a,c,p){var w=Wt(c),S=Qc(c,w);p==null&&!(vt(c)&&(S.length||!w.length))&&(p=c,c=a,a=this,S=Qc(c,Wt(c)));var O=!(vt(p)&&"chain"in p)||!!p.chain,L=ss(a);return _r(S,function(U){var q=c[U];a[U]=q,L&&(a.prototype[U]=function(){var J=this.__chain__;if(O||J){var Y=a(this.__wrapped__),te=Y.__actions__=Ar(this.__actions__);return te.push({func:q,args:arguments,thisArg:a}),Y.__chain__=J,Y}return q.apply(a,hn([this.value()],arguments))})}),a}function t2(){return Tt._===this&&(Tt._=RT),this}function wd(){}function r2(a){return a=ke(a),Me(function(c){return h0(c,a)})}var n2=Qf(lt),s2=Qf(fo),i2=Qf(po);function Py(a){return rd(a)?b(Cn(a)):DS(a)}function o2(a){return function(c){return a==null?t:Ai(a,c)}}var a2=k0(),l2=k0(!0);function vd(){return[]}function _d(){return!1}function c2(){return{}}function u2(){return""}function h2(){return!0}function f2(a,c){if(a=ke(a),a<1||a>Le)return[];var p=me,w=ar(a,me);c=ve(c),a-=me;for(var S=Xe(w,c);++p<a;)c(p);return S}function d2(a){return Ne(a)?lt(a,Cn):Mr(a)?[a]:Ar(Q0(rt(a)))}function p2(a){var c=++xT;return rt(a)+c}var g2=tu(function(a,c){return a+c},0),m2=Jf("ceil"),y2=tu(function(a,c){return a/c},1),w2=Jf("floor");function v2(a){return a&&a.length?Kc(a,Pr,Df):t}function _2(a,c){return a&&a.length?Kc(a,ve(c,2),Df):t}function b2(a){return y(a,Pr)}function E2(a,c){return y(a,ve(c,2))}function T2(a){return a&&a.length?Kc(a,Pr,Ff):t}function S2(a,c){return a&&a.length?Kc(a,ve(c,2),Ff):t}var x2=tu(function(a,c){return a*c},1),A2=Jf("round"),R2=tu(function(a,c){return a-c},0);function I2(a){return a&&a.length?ie(a,Pr):0}function P2(a,c){return a&&a.length?ie(a,ve(c,2)):0}return P.after=YA,P.ary=oy,P.assign=VR,P.assignIn=_y,P.assignInWith=pu,P.assignWith=FR,P.at=UR,P.before=ay,P.bind=ld,P.bindAll=zI,P.bindKey=ly,P.castArray=cR,P.chain=ny,P.chunk=wx,P.compact=vx,P.concat=_x,P.cond=GI,P.conforms=HI,P.constant=gd,P.countBy=IA,P.create=$R,P.curry=cy,P.curryRight=uy,P.debounce=hy,P.defaults=BR,P.defaultsDeep=qR,P.defer=XA,P.delay=ZA,P.difference=bx,P.differenceBy=Ex,P.differenceWith=Tx,P.drop=Sx,P.dropRight=xx,P.dropRightWhile=Ax,P.dropWhile=Rx,P.fill=Ix,P.filter=CA,P.flatMap=kA,P.flatMapDeep=jA,P.flatMapDepth=DA,P.flatten=Z0,P.flattenDeep=Px,P.flattenDepth=Cx,P.flip=eR,P.flow=QI,P.flowRight=JI,P.fromPairs=Nx,P.functions=JR,P.functionsIn=YR,P.groupBy=MA,P.initial=kx,P.intersection=jx,P.intersectionBy=Dx,P.intersectionWith=Mx,P.invert=ZR,P.invertBy=eI,P.invokeMap=VA,P.iteratee=md,P.keyBy=FA,P.keys=Wt,P.keysIn=Ir,P.map=lu,P.mapKeys=rI,P.mapValues=nI,P.matches=YI,P.matchesProperty=XI,P.memoize=uu,P.merge=sI,P.mergeWith=by,P.method=ZI,P.methodOf=e2,P.mixin=yd,P.negate=hu,P.nthArg=r2,P.omit=iI,P.omitBy=oI,P.once=tR,P.orderBy=UA,P.over=n2,P.overArgs=rR,P.overEvery=s2,P.overSome=i2,P.partial=cd,P.partialRight=fy,P.partition=$A,P.pick=aI,P.pickBy=Ey,P.property=Py,P.propertyOf=o2,P.pull=Ux,P.pullAll=ty,P.pullAllBy=$x,P.pullAllWith=Bx,P.pullAt=qx,P.range=a2,P.rangeRight=l2,P.rearg=nR,P.reject=WA,P.remove=Wx,P.rest=sR,P.reverse=od,P.sampleSize=GA,P.set=cI,P.setWith=uI,P.shuffle=HA,P.slice=zx,P.sortBy=JA,P.sortedUniq=Xx,P.sortedUniqBy=Zx,P.split=kI,P.spread=iR,P.tail=eA,P.take=tA,P.takeRight=rA,P.takeRightWhile=nA,P.takeWhile=sA,P.tap=vA,P.throttle=oR,P.thru=au,P.toArray=yy,P.toPairs=Ty,P.toPairsIn=Sy,P.toPath=d2,P.toPlainObject=vy,P.transform=hI,P.unary=aR,P.union=iA,P.unionBy=oA,P.unionWith=aA,P.uniq=lA,P.uniqBy=cA,P.uniqWith=uA,P.unset=fI,P.unzip=ad,P.unzipWith=ry,P.update=dI,P.updateWith=pI,P.values=Ro,P.valuesIn=gI,P.without=hA,P.words=Ry,P.wrap=lR,P.xor=fA,P.xorBy=dA,P.xorWith=pA,P.zip=gA,P.zipObject=mA,P.zipObjectDeep=yA,P.zipWith=wA,P.entries=Ty,P.entriesIn=Sy,P.extend=_y,P.extendWith=pu,yd(P,P),P.add=g2,P.attempt=Iy,P.camelCase=vI,P.capitalize=xy,P.ceil=m2,P.clamp=mI,P.clone=uR,P.cloneDeep=fR,P.cloneDeepWith=dR,P.cloneWith=hR,P.conformsTo=pR,P.deburr=Ay,P.defaultTo=KI,P.divide=y2,P.endsWith=_I,P.eq=gn,P.escape=bI,P.escapeRegExp=EI,P.every=PA,P.find=NA,P.findIndex=Y0,P.findKey=WR,P.findLast=OA,P.findLastIndex=X0,P.findLastKey=zR,P.floor=w2,P.forEach=sy,P.forEachRight=iy,P.forIn=GR,P.forInRight=HR,P.forOwn=KR,P.forOwnRight=QR,P.get=fd,P.gt=gR,P.gte=mR,P.has=XR,P.hasIn=dd,P.head=ey,P.identity=Pr,P.includes=LA,P.indexOf=Ox,P.inRange=yI,P.invoke=tI,P.isArguments=Pi,P.isArray=Ne,P.isArrayBuffer=yR,P.isArrayLike=Rr,P.isArrayLikeObject=Rt,P.isBoolean=wR,P.isBuffer=Ls,P.isDate=vR,P.isElement=_R,P.isEmpty=bR,P.isEqual=ER,P.isEqualWith=TR,P.isError=ud,P.isFinite=SR,P.isFunction=ss,P.isInteger=dy,P.isLength=fu,P.isMap=py,P.isMatch=xR,P.isMatchWith=AR,P.isNaN=RR,P.isNative=IR,P.isNil=CR,P.isNull=PR,P.isNumber=gy,P.isObject=vt,P.isObjectLike=St,P.isPlainObject=tl,P.isRegExp=hd,P.isSafeInteger=NR,P.isSet=my,P.isString=du,P.isSymbol=Mr,P.isTypedArray=Ao,P.isUndefined=OR,P.isWeakMap=kR,P.isWeakSet=jR,P.join=Lx,P.kebabCase=TI,P.last=en,P.lastIndexOf=Vx,P.lowerCase=SI,P.lowerFirst=xI,P.lt=DR,P.lte=MR,P.max=v2,P.maxBy=_2,P.mean=b2,P.meanBy=E2,P.min=T2,P.minBy=S2,P.stubArray=vd,P.stubFalse=_d,P.stubObject=c2,P.stubString=u2,P.stubTrue=h2,P.multiply=x2,P.nth=Fx,P.noConflict=t2,P.noop=wd,P.now=cu,P.pad=AI,P.padEnd=RI,P.padStart=II,P.parseInt=PI,P.random=wI,P.reduce=BA,P.reduceRight=qA,P.repeat=CI,P.replace=NI,P.result=lI,P.round=A2,P.runInContext=B,P.sample=zA,P.size=KA,P.snakeCase=OI,P.some=QA,P.sortedIndex=Gx,P.sortedIndexBy=Hx,P.sortedIndexOf=Kx,P.sortedLastIndex=Qx,P.sortedLastIndexBy=Jx,P.sortedLastIndexOf=Yx,P.startCase=jI,P.startsWith=DI,P.subtract=R2,P.sum=I2,P.sumBy=P2,P.template=MI,P.times=f2,P.toFinite=is,P.toInteger=ke,P.toLength=wy,P.toLower=LI,P.toNumber=tn,P.toSafeInteger=LR,P.toString=rt,P.toUpper=VI,P.trim=FI,P.trimEnd=UI,P.trimStart=$I,P.truncate=BI,P.unescape=qI,P.uniqueId=p2,P.upperCase=WI,P.upperFirst=pd,P.each=sy,P.eachRight=iy,P.first=ey,yd(P,function(){var a={};return In(P,function(c,p){st.call(P.prototype,p)||(a[p]=c)}),a}(),{chain:!1}),P.VERSION=r,_r(["bind","bindKey","curry","curryRight","partial","partialRight"],function(a){P[a].placeholder=P}),_r(["drop","take"],function(a,c){Ue.prototype[a]=function(p){p=p===t?1:Vt(ke(p),0);var w=this.__filtered__&&!c?new Ue(this):this.clone();return w.__filtered__?w.__takeCount__=ar(p,w.__takeCount__):w.__views__.push({size:ar(p,me),type:a+(w.__dir__<0?"Right":"")}),w},Ue.prototype[a+"Right"]=function(p){return this.reverse()[a](p).reverse()}}),_r(["filter","map","takeWhile"],function(a,c){var p=c+1,w=p==Te||p==oe;Ue.prototype[a]=function(S){var O=this.clone();return O.__iteratees__.push({iteratee:ve(S,3),type:p}),O.__filtered__=O.__filtered__||w,O}}),_r(["head","last"],function(a,c){var p="take"+(c?"Right":"");Ue.prototype[a]=function(){return this[p](1).value()[0]}}),_r(["initial","tail"],function(a,c){var p="drop"+(c?"":"Right");Ue.prototype[a]=function(){return this.__filtered__?new Ue(this):this[p](1)}}),Ue.prototype.compact=function(){return this.filter(Pr)},Ue.prototype.find=function(a){return this.filter(a).head()},Ue.prototype.findLast=function(a){return this.reverse().find(a)},Ue.prototype.invokeMap=Me(function(a,c){return typeof a=="function"?new Ue(this):this.map(function(p){return Qa(p,a,c)})}),Ue.prototype.reject=function(a){return this.filter(hu(ve(a)))},Ue.prototype.slice=function(a,c){a=ke(a);var p=this;return p.__filtered__&&(a>0||c<0)?new Ue(p):(a<0?p=p.takeRight(-a):a&&(p=p.drop(a)),c!==t&&(c=ke(c),p=c<0?p.dropRight(-c):p.take(c-a)),p)},Ue.prototype.takeRightWhile=function(a){return this.reverse().takeWhile(a).reverse()},Ue.prototype.toArray=function(){return this.take(me)},In(Ue.prototype,function(a,c){var p=/^(?:filter|find|map|reject)|While$/.test(c),w=/^(?:head|last)$/.test(c),S=P[w?"take"+(c=="last"?"Right":""):c],O=w||/^find/.test(c);S&&(P.prototype[c]=function(){var L=this.__wrapped__,U=w?[1]:arguments,q=L instanceof Ue,J=U[0],Y=q||Ne(L),te=function(Ve){var We=S.apply(P,hn([Ve],U));return w&&le?We[0]:We};Y&&p&&typeof J=="function"&&J.length!=1&&(q=Y=!1);var le=this.__chain__,pe=!!this.__actions__.length,be=O&&!le,De=q&&!pe;if(!O&&Y){L=De?L:new Ue(this);var Ee=a.apply(L,U);return Ee.__actions__.push({func:au,args:[te],thisArg:t}),new Yr(Ee,le)}return be&&De?a.apply(this,U):(Ee=this.thru(te),be?w?Ee.value()[0]:Ee.value():Ee)})}),_r(["pop","push","shift","sort","splice","unshift"],function(a){var c=kc[a],p=/^(?:push|sort|unshift)$/.test(a)?"tap":"thru",w=/^(?:pop|shift)$/.test(a);P.prototype[a]=function(){var S=arguments;if(w&&!this.__chain__){var O=this.value();return c.apply(Ne(O)?O:[],S)}return this[p](function(L){return c.apply(Ne(L)?L:[],S)})}}),In(Ue.prototype,function(a,c){var p=P[c];if(p){var w=p.name+"";st.call(bo,w)||(bo[w]=[]),bo[w].push({name:c,func:p})}}),bo[eu(t,I).name]=[{name:"wrapper",func:t}],Ue.prototype.clone=qT,Ue.prototype.reverse=WT,Ue.prototype.value=zT,P.prototype.at=_A,P.prototype.chain=bA,P.prototype.commit=EA,P.prototype.next=TA,P.prototype.plant=xA,P.prototype.reverse=AA,P.prototype.toJSON=P.prototype.valueOf=P.prototype.value=RA,P.prototype.first=P.prototype.head,Ba&&(P.prototype[Ba]=SA),P},wo=ET();Qt?((Qt.exports=wo)._=wo,uo._=wo):Tt._=wo}).call($t)})(th,th.exports);var Vl=th.exports,qP=class{constructor(){this.middlewares=[]}use(e){this.middlewares.push(e)}async run(e){return await[...this.middlewares].reduceRight((i,o)=>async()=>{await o(e,i)},async()=>{Promise.resolve()})(e)}};const WP=BP,zP=Vl,Uy=qP,Uu={GET:"GET",POST:"POST",DEL:"DELETE"};class GP{constructor(e){this.baseConfig=e,this.middleware=new Uy,this.afterMiddleware=new Uy}useBefore(e){this.middleware.use(e)}useAfter(e){this.afterMiddleware.use(e)}resolveData(e,t={}){const r={};return zP.each(t||{},(s,i)=>{typeof s<"u"&&(r[i]=s)}),e===Uu.POST?{query:"",body:JSON.stringify(r)}:{query:Object.keys(r).map(s=>`${s}=${r[s]}`).join("&"),body:void 0}}async makeRequest(e,t,r,s){const{body:i,query:o}=this.resolveData(e,r||{}),{baseUrl:l}=this.baseConfig,[u,h=""]=t.split("?"),d={url:t,query:h+(h?"&":"")+o,baseUrl:l,body:i,method:e,headers:s||""};return await this.middleware.run(d),await WP(d.baseUrl+u+"?"+d.query,{body:d.body,method:e,headers:d.headers}).then(v=>v.json&&typeof v.json=="function"?v.json():v).then(async v=>(await this.afterMiddleware.run(v),v))}}var HP=function(e){const t=[],r=[];class s{static useBefore(o){t.push(o)}static useAfter(o){r.push(o)}static registerMiddle(o){t.forEach(l=>{o.useBefore(l)}),r.forEach(l=>{o.useAfter(l)})}static createRequest(o,l,u,h){const d=new GP(e);return s.registerMiddle(d),d.makeRequest(o,l,u,h)}static POST(o,l,u){return s.createRequest(Uu.POST,o,l,u)}static GET(o,l,u){return s.createRequest(Uu.GET,o,l,u)}static DEL(o,l){return s.createRequest(Uu.DEL,o,l)}}return s};const KP={},QP=Object.freeze(Object.defineProperty({__proto__:null,default:KP},Symbol.toStringTag,{value:"Module"})),Fl=zi(QP);var mu,JP=new Uint8Array(16);function L_(){if(!mu&&(mu=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!mu))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return mu(JP)}const YP=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function xh(n){return typeof n=="string"&&YP.test(n)}var Yt=[];for(var xd=0;xd<256;++xd)Yt.push((xd+256).toString(16).substr(1));function Ah(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(Yt[n[e+0]]+Yt[n[e+1]]+Yt[n[e+2]]+Yt[n[e+3]]+"-"+Yt[n[e+4]]+Yt[n[e+5]]+"-"+Yt[n[e+6]]+Yt[n[e+7]]+"-"+Yt[n[e+8]]+Yt[n[e+9]]+"-"+Yt[n[e+10]]+Yt[n[e+11]]+Yt[n[e+12]]+Yt[n[e+13]]+Yt[n[e+14]]+Yt[n[e+15]]).toLowerCase();if(!xh(t))throw TypeError("Stringified UUID is invalid");return t}var $y,Ad,Rd=0,Id=0;function XP(n,e,t){var r=e&&t||0,s=e||new Array(16);n=n||{};var i=n.node||$y,o=n.clockseq!==void 0?n.clockseq:Ad;if(i==null||o==null){var l=n.random||(n.rng||L_)();i==null&&(i=$y=[l[0]|1,l[1],l[2],l[3],l[4],l[5]]),o==null&&(o=Ad=(l[6]<<8|l[7])&16383)}var u=n.msecs!==void 0?n.msecs:Date.now(),h=n.nsecs!==void 0?n.nsecs:Id+1,d=u-Rd+(h-Id)/1e4;if(d<0&&n.clockseq===void 0&&(o=o+1&16383),(d<0||u>Rd)&&n.nsecs===void 0&&(h=0),h>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Rd=u,Id=h,Ad=o,u+=122192928e5;var g=((u&268435455)*1e4+h)%4294967296;s[r++]=g>>>24&255,s[r++]=g>>>16&255,s[r++]=g>>>8&255,s[r++]=g&255;var v=u/4294967296*1e4&268435455;s[r++]=v>>>8&255,s[r++]=v&255,s[r++]=v>>>24&15|16,s[r++]=v>>>16&255,s[r++]=o>>>8|128,s[r++]=o&255;for(var _=0;_<6;++_)s[r+_]=i[_];return e||Ah(s)}function V_(n){if(!xh(n))throw TypeError("Invalid UUID");var e,t=new Uint8Array(16);return t[0]=(e=parseInt(n.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(n.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(n.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(n.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(n.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}function ZP(n){n=unescape(encodeURIComponent(n));for(var e=[],t=0;t<n.length;++t)e.push(n.charCodeAt(t));return e}var eC="6ba7b810-9dad-11d1-80b4-00c04fd430c8",tC="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function F_(n,e,t){function r(s,i,o,l){if(typeof s=="string"&&(s=ZP(s)),typeof i=="string"&&(i=V_(i)),i.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var u=new Uint8Array(16+s.length);if(u.set(i),u.set(s,i.length),u=t(u),u[6]=u[6]&15|e,u[8]=u[8]&63|128,o){l=l||0;for(var h=0;h<16;++h)o[l+h]=u[h];return o}return Ah(u)}try{r.name=n}catch{}return r.DNS=eC,r.URL=tC,r}function rC(n){if(typeof n=="string"){var e=unescape(encodeURIComponent(n));n=new Uint8Array(e.length);for(var t=0;t<e.length;++t)n[t]=e.charCodeAt(t)}return nC(sC(iC(n),n.length*8))}function nC(n){for(var e=[],t=n.length*32,r="0123456789abcdef",s=0;s<t;s+=8){var i=n[s>>5]>>>s%32&255,o=parseInt(r.charAt(i>>>4&15)+r.charAt(i&15),16);e.push(o)}return e}function U_(n){return(n+64>>>9<<4)+14+1}function sC(n,e){n[e>>5]|=128<<e%32,n[U_(e)-1]=e;for(var t=1732584193,r=-271733879,s=-1732584194,i=271733878,o=0;o<n.length;o+=16){var l=t,u=r,h=s,d=i;t=cr(t,r,s,i,n[o],7,-680876936),i=cr(i,t,r,s,n[o+1],12,-389564586),s=cr(s,i,t,r,n[o+2],17,606105819),r=cr(r,s,i,t,n[o+3],22,-1044525330),t=cr(t,r,s,i,n[o+4],7,-176418897),i=cr(i,t,r,s,n[o+5],12,1200080426),s=cr(s,i,t,r,n[o+6],17,-1473231341),r=cr(r,s,i,t,n[o+7],22,-45705983),t=cr(t,r,s,i,n[o+8],7,1770035416),i=cr(i,t,r,s,n[o+9],12,-1958414417),s=cr(s,i,t,r,n[o+10],17,-42063),r=cr(r,s,i,t,n[o+11],22,-1990404162),t=cr(t,r,s,i,n[o+12],7,1804603682),i=cr(i,t,r,s,n[o+13],12,-40341101),s=cr(s,i,t,r,n[o+14],17,-1502002290),r=cr(r,s,i,t,n[o+15],22,1236535329),t=ur(t,r,s,i,n[o+1],5,-165796510),i=ur(i,t,r,s,n[o+6],9,-1069501632),s=ur(s,i,t,r,n[o+11],14,643717713),r=ur(r,s,i,t,n[o],20,-373897302),t=ur(t,r,s,i,n[o+5],5,-701558691),i=ur(i,t,r,s,n[o+10],9,38016083),s=ur(s,i,t,r,n[o+15],14,-660478335),r=ur(r,s,i,t,n[o+4],20,-405537848),t=ur(t,r,s,i,n[o+9],5,568446438),i=ur(i,t,r,s,n[o+14],9,-1019803690),s=ur(s,i,t,r,n[o+3],14,-187363961),r=ur(r,s,i,t,n[o+8],20,1163531501),t=ur(t,r,s,i,n[o+13],5,-1444681467),i=ur(i,t,r,s,n[o+2],9,-51403784),s=ur(s,i,t,r,n[o+7],14,1735328473),r=ur(r,s,i,t,n[o+12],20,-1926607734),t=hr(t,r,s,i,n[o+5],4,-378558),i=hr(i,t,r,s,n[o+8],11,-2022574463),s=hr(s,i,t,r,n[o+11],16,1839030562),r=hr(r,s,i,t,n[o+14],23,-35309556),t=hr(t,r,s,i,n[o+1],4,-1530992060),i=hr(i,t,r,s,n[o+4],11,1272893353),s=hr(s,i,t,r,n[o+7],16,-155497632),r=hr(r,s,i,t,n[o+10],23,-1094730640),t=hr(t,r,s,i,n[o+13],4,681279174),i=hr(i,t,r,s,n[o],11,-358537222),s=hr(s,i,t,r,n[o+3],16,-722521979),r=hr(r,s,i,t,n[o+6],23,76029189),t=hr(t,r,s,i,n[o+9],4,-640364487),i=hr(i,t,r,s,n[o+12],11,-421815835),s=hr(s,i,t,r,n[o+15],16,530742520),r=hr(r,s,i,t,n[o+2],23,-995338651),t=fr(t,r,s,i,n[o],6,-198630844),i=fr(i,t,r,s,n[o+7],10,1126891415),s=fr(s,i,t,r,n[o+14],15,-1416354905),r=fr(r,s,i,t,n[o+5],21,-57434055),t=fr(t,r,s,i,n[o+12],6,1700485571),i=fr(i,t,r,s,n[o+3],10,-1894986606),s=fr(s,i,t,r,n[o+10],15,-1051523),r=fr(r,s,i,t,n[o+1],21,-2054922799),t=fr(t,r,s,i,n[o+8],6,1873313359),i=fr(i,t,r,s,n[o+15],10,-30611744),s=fr(s,i,t,r,n[o+6],15,-1560198380),r=fr(r,s,i,t,n[o+13],21,1309151649),t=fr(t,r,s,i,n[o+4],6,-145523070),i=fr(i,t,r,s,n[o+11],10,-1120210379),s=fr(s,i,t,r,n[o+2],15,718787259),r=fr(r,s,i,t,n[o+9],21,-343485551),t=zs(t,l),r=zs(r,u),s=zs(s,h),i=zs(i,d)}return[t,r,s,i]}function iC(n){if(n.length===0)return[];for(var e=n.length*8,t=new Uint32Array(U_(e)),r=0;r<e;r+=8)t[r>>5]|=(n[r/8]&255)<<r%32;return t}function zs(n,e){var t=(n&65535)+(e&65535),r=(n>>16)+(e>>16)+(t>>16);return r<<16|t&65535}function oC(n,e){return n<<e|n>>>32-e}function Rh(n,e,t,r,s,i){return zs(oC(zs(zs(e,n),zs(r,i)),s),t)}function cr(n,e,t,r,s,i,o){return Rh(e&t|~e&r,n,e,s,i,o)}function ur(n,e,t,r,s,i,o){return Rh(e&r|t&~r,n,e,s,i,o)}function hr(n,e,t,r,s,i,o){return Rh(e^t^r,n,e,s,i,o)}function fr(n,e,t,r,s,i,o){return Rh(t^(e|~r),n,e,s,i,o)}var aC=F_("v3",48,rC);function lC(n,e,t){n=n||{};var r=n.random||(n.rng||L_)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var s=0;s<16;++s)e[t+s]=r[s];return e}return Ah(r)}function cC(n,e,t,r){switch(n){case 0:return e&t^~e&r;case 1:return e^t^r;case 2:return e&t^e&r^t&r;case 3:return e^t^r}}function Pd(n,e){return n<<e|n>>>32-e}function uC(n){var e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){var r=unescape(encodeURIComponent(n));n=[];for(var s=0;s<r.length;++s)n.push(r.charCodeAt(s))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);for(var i=n.length/4+2,o=Math.ceil(i/16),l=new Array(o),u=0;u<o;++u){for(var h=new Uint32Array(16),d=0;d<16;++d)h[d]=n[u*64+d*4]<<24|n[u*64+d*4+1]<<16|n[u*64+d*4+2]<<8|n[u*64+d*4+3];l[u]=h}l[o-1][14]=(n.length-1)*8/Math.pow(2,32),l[o-1][14]=Math.floor(l[o-1][14]),l[o-1][15]=(n.length-1)*8&4294967295;for(var g=0;g<o;++g){for(var v=new Uint32Array(80),_=0;_<16;++_)v[_]=l[g][_];for(var E=16;E<80;++E)v[E]=Pd(v[E-3]^v[E-8]^v[E-14]^v[E-16],1);for(var x=t[0],R=t[1],I=t[2],F=t[3],V=t[4],$=0;$<80;++$){var W=Math.floor($/20),X=Pd(x,5)+cC(W,R,I,F)+V+e[W]+v[$]>>>0;V=F,F=I,I=Pd(R,30)>>>0,R=x,x=X}t[0]=t[0]+x>>>0,t[1]=t[1]+R>>>0,t[2]=t[2]+I>>>0,t[3]=t[3]+F>>>0,t[4]=t[4]+V>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var hC=F_("v5",80,uC);const fC="00000000-0000-0000-0000-000000000000";function dC(n){if(!xh(n))throw TypeError("Invalid UUID");return parseInt(n.substr(14,1),16)}const pC=Object.freeze(Object.defineProperty({__proto__:null,NIL:fC,parse:V_,stringify:Ah,v1:XP,v3:aC,v4:lC,v5:hC,validate:xh,version:dC},Symbol.toStringTag,{value:"Module"})),gC=zi(pC),mC="1.1.1",yC={version:mC},$_=Vl,wC=Fl,B_=Fl,q_=Fl,vC=gC,{getConfig:_C}=Ll,{version:bC}=yC;function Gp(n,e,t="base64"){return wC.createHmac("sha256",e).update(n).digest(t)}function EC(n,e,t,r){const{authVersion:s}=_C(),i=Date.now(),o=Gp(i+e.toUpperCase()+t+r,n.secret),l={"KC-API-KEY":n.key,"KC-API-SIGN":o,"KC-API-TIMESTAMP":i.toString(),"KC-API-PASSPHRASE":n.passphrase||"","Content-Type":"application/json","User-Agent":`KuCoin-Node-SDK/${bC}`};return s&&(s===2||s==="2")&&(l["KC-API-KEY-VERSION"]=2,l["KC-API-PASSPHRASE"]=Gp(n.passphrase||"",n.secret)),l}async function TC(n){const e=B_.join(__dirname,n),t=q_.createReadStream(e);let r="";return new Promise(s=>{t.on("data",i=>{r+=i}),t.on("end",()=>{s(r)}),t.on("error",i=>{s(i.message)})})}async function SC(n,e){const t=B_.join(__dirname,n),r=q_.createWriteStream(t);return new Promise(s=>{r.write(e),r.on("end",()=>{s("")}),r.on("error",i=>{s(i.message)})})}function xC(){return vC.v4()}function AC(n){for(var e=[],t=n.split(""),r=0;r<t.length;r++){var s=t[r],i=s.charCodeAt(0).toString(8);e.push(i)}return e.join("")}function RC(n=[],e){if(n.length){if(n[0].sequenceStart!==e+1)return!1;for(let t=0;t<n.length;t++)if(n[t+1]&&n[t+1].sequenceStart!==n[t].sequenceEnd+1)return!1}return!0}function IC(n=[],e=t=>t){const t={};for(let r=0;r<n.length;r++){const s=n[r];t[e(s[0])]=s[1]}return t}function PC(n={},e="asc"){const t=[];return $_.each(n,(r,s)=>{t.push([s,r])}),t.sort((r,s)=>e==="desc"?+s[0]-+r[0]:r[0]-s[0]),t}function CC(n=[]){const e={};for(let t=0;t<n.length;t++){const r=n[t];e[r[1]]=r}return e}function NC(n={},e,t="asc",r=1){const s=[];return $_.each(n,i=>{const[o,l,u,h,d]=i;s.push([u,h,d,l])}),s.sort((i,o)=>i[0]===o[0]?i[2]-o[2]:t==="desc"?o[0]-i[0]:i[0]-o[0]),s}var W_={sign:Gp,auth:EC,readFile:TC,writeFile:SC,genClientOid:xC,strTo2String:AC,checkL2BufferContinue:RC,mapArr:IC,arrMap:PC,mapl3Arr:CC,arrl3Map:NC},OC={};const kC=HP,{getConfig:By}=Ll,jC=W_;let Cd=null;const DC=()=>{if(!Cd){const{baseUrl:n}=By();let e=n;e||(e=OC.PRODUCTION==="prod"?"https://openapi-v2.kucoin.com":"https://openapi-sandbox.kucoin.io");const t=kC({baseUrl:e});t.useBefore(async(r,s)=>{const{apiAuth:i}=By(),o=jC.auth(i,r.method,r.url+(r.query?(/\?/g.test(r.url)?"&":"?")+(r.query||""):""),r.body||"");r.headers={...r.headers,...o},s(r)}),Cd=t}return Cd};var Et=DC;const z_=Et;Mg.getSubUsers=async function(){return await z_().GET("/api/v1/sub/user")};Mg.getPaginatedSubUsers=async function({currentPage:e,pageSize:t}){return await z_().GET("/api/v2/sub/user",{currentPage:e,pageSize:t})};var xt={};const Dt=Et;xt.createAccount=async function(e,t){return await Dt().POST("/api/v1/accounts",{type:e,currency:t})};xt.getAccountsList=async function({type:e,currency:t}={}){return await Dt().GET("/api/v1/accounts",{type:e,currency:t})};xt.getAccountInformation=async function(e){return await Dt().GET(`/api/v1/accounts/${e}`)};xt.getAccountLedgers=async function({currency:e,direction:t,bizType:r,startAt:s,endAt:i}={}){return await Dt().GET("/api/v1/accounts/ledgers",{currency:e,direction:t,bizType:r,startAt:s,endAt:i})};xt.getHolds=async function(e){return await Dt().GET(`/api/v1/accounts/${e}/holds`)};xt.getBalanceOfSubAccount=async function(e){return await Dt().GET(`/api/v1/sub-accounts/${e}`)};xt.getAggregatedBalanceOfAllSubAccounts=async function(){return await Dt().GET("/api/v1/sub-accounts")};xt.getTransferable=async function(e,t){return await Dt().GET("/api/v1/accounts/transferable",{currency:t,type:e})};xt.transferBetweenMasterUserAndSubUser=async function(e,t,r,s,i,{accountType:o,subAccountType:l}={}){return await Dt().POST("/api/v2/accounts/sub-transfer",{clientOid:e,currency:t,amount:r,direction:s,accountType:o,subAccountType:l,subUserId:i})};xt.innerTransfer=async function(e,t,r,s,i){return await Dt().POST("/api/v2/accounts/inner-transfer",{clientOid:e,currency:t,from:r,to:s,amount:i})};xt.getAccountSummaryInfo=async function(){return await Dt().GET("/api/v2/user-info")};xt.createSubAccount=async function({password:e,remarks:t,subName:r,access:s}){return await Dt().POST("/api/v2/sub/user/created",{password:e,remarks:t,subName:r,access:s})};xt.getSubAccountSpotApiList=async function({apiKey:e,subName:t}){return await Dt().GET("/api/v1/sub/api-key",{apiKey:e,subName:t})};xt.createSpotAPIsForSubAccount=async function({subName:e,passphrase:t,remark:r,permission:s,ipWhitelist:i,expire:o}){return await Dt().POST("/api/v1/sub/api-key",{subName:e,passphrase:t,remark:r,permission:s,ipWhitelist:i,expire:o})};xt.updateSubAccountSpotApis=async function({subName:e,apiKey:t,passphrase:r,permission:s,ipWhitelist:i,expire:o}){return await Dt().POST("/api/v1/sub/api-key/update",{subName:e,apiKey:t,passphrase:r,permission:s,ipWhitelist:i,expire:o})};xt.deleteSubAccountSpotApis=async function({apiKey:e,passphrase:t,subName:r}){return await Dt().DEL("/api/v1/sub/api-key",{apiKey:e,passphrase:t,subName:r})};xt.getPaginatedSubAccountInformation=async function({currentPage:e,pageSize:t}){return await Dt().GET("/api/v2/sub-accounts",{currentPage:e,pageSize:t})};xt.transferToHFAccount=async function({clientOid:e,currency:t,from:r,to:s,amount:i,type:o}){try{const l=await this.innerTransfer(e,t,r,s,i),u=await this.getTransferable(o,t);return(l==null?void 0:l.code)==="200000"?u:{msg:(l==null?void 0:l.msg)||"transferToHFAccount-error",code:(l==null?void 0:l.code)||"400000",data:{currency:"USDT",balance:"0",available:"0",holds:"0",transferable:"0"}}}catch(l){console.error(l,"transferToHFAccount-error")}};xt.getHighFrequencyAccountLedger=async function({currency:e,direction:t,bizType:r,lastId:s,limit:i,startAt:o,endAt:l}){return await Dt().GET("/api/v1/hf/accounts/ledgers",{currency:e,direction:t,bizType:r,lastId:s,limit:i,startAt:o,endAt:l})};xt.getUserType=async function(){return await Dt().GET("/api/v1/hf/accounts/opened")};xt.universalTransfer=async function({clientOid:e,currency:t,amount:r,fromUserId:s,fromAccountType:i,fromAccountTag:o,type:l,toUserId:u,toAccountType:h,toAccountTag:d}){const g={clientOid:e,currency:t,amount:r,fromUserId:s,fromAccountType:i,fromAccountTag:o,type:l,toUserId:u,toAccountType:h,toAccountTag:d};return await Dt().POST("/api/v3/accounts/universal-transfer",g)};var ta={};const Ul=Et;ta.createDepositAddress=async function(e,{chain:t}={}){return await Ul().POST("/api/v1/deposit-addresses",{currency:e,chain:t})};ta.getDepositAddress=async function(e,{chain:t}={}){return await Ul().GET("/api/v1/deposit-addresses",{currency:e,chain:t})};ta.getDepositAddressV2=async function(e){return await Ul().GET("/api/v2/deposit-addresses",{currency:e})};ta.getDepositList=async function({currency:e,startAt:t,endAt:r,status:s}={}){return await Ul().GET("/api/v1/deposits",{currency:e,startAt:t,endAt:r,status:s})};ta.getV1HistoricalDepositsList=async function({currency:e,startAt:t,endAt:r,status:s}={}){return await Ul().GET("/api/v1/hist-deposits",{currency:e,startAt:t,endAt:r,status:s})};var ra={};const $l=Et;ra.getWithdrawalsList=async function({currency:e,status:t,startAt:r,endAt:s}={}){return await $l().GET("/api/v1/withdrawals",{currency:e,status:t,startAt:r,endAt:s})};ra.getV1HistoricalWithdrawalsList=async function({currentPage:e,pageSize:t,currency:r,status:s,startAt:i,endAt:o}={}){return await $l().GET("/api/v1/hist-withdrawals",{currentPage:e,pageSize:t,currency:r,status:s,startAt:i,endAt:o})};ra.getWithdrawalQuotas=async function(e,{chain:t}={}){return await $l().GET("/api/v1/withdrawals/quotas",{currency:e,chain:t})};ra.applyWithdraw=async function(e,t,r,{memo:s,isInner:i,remark:o,chain:l,feeDeductType:u}={}){return await $l().POST("/api/v1/withdrawals",{currency:e,address:t,amount:r,memo:s,isInner:i,remark:o,chain:l,feeDeductType:u})};ra.cancelWithdrawal=async function(e){return await $l().DEL(`/api/v1/withdrawals/${e}`)};var Lg={};const G_=Et;Lg.getBasicUserFee=async function(){return await G_().GET("/api/v1/base-fee")};Lg.getActualFeeRateBySymbols=async function(e){return await G_().GET("/api/v1/trade-fees",{symbols:e})};var Je={};const et=Et;Je.postOrder=async function(e={},t={}){return await et().POST("/api/v1/orders",{...e,...t})};Je.postMultiOrders=async function(e={}){return await et().POST("/api/v1/orders/multi",{...e})};Je.cancelOrder=async function(e){return await et().DEL(`/api/v1/orders/${e}`)};Je.cancelAllOrders=async function({symbol:e,tradeType:t}={}){return await et().DEL("/api/v1/orders",{symbol:e,tradeType:t})};Je.cancelOrderByClientOid=async function({symbol:e,tradeType:t}={}){return await et().DEL(`/api/v1/order/client-order/${clientOid}`)};Je.getOrdersList=async function(e,t={}){return await et().GET("/api/v1/orders",{tradeType:e,...t})};Je.getV1HistoricalOrdersList=async function(e={}){return await et().GET("/api/v1/hist-orders",{...e})};Je.getRecentOrders=async function(){return await et().GET("/api/v1/limit/orders")};Je.getOrderByID=async function(e){return await et().GET(`/api/v1/orders/${e}`)};Je.getSingleActiveOrderByClientOid=async function(e){return await et().GET(`/api/v1/order/client-order/${e}`)};Je.placeHfOrder=async function({clientOid:e,symbol:t,type:r,side:s,stp:i,tags:o,remark:l}){return await et().POST("/api/v1/hf/orders",{clientOid:e,symbol:t,type:r,side:s,stp:i,tags:o,remark:l})};Je.syncPlaceHfOrder=async function({clientOid:e,symbol:t,type:r,side:s,stp:i,tags:o,remark:l}){return await et().POST("/api/v1/hf/orders/sync",{clientOid:e,symbol:t,type:r,side:s,stp:i,tags:o,remark:l})};Je.placeMultipleHfOrders=async function({clientOid:e,symbol:t,type:r,timeInForce:s,stp:i,side:o,price:l,size:u,cancelAfter:h,postOnly:d,hidden:g,iceberg:v,visibleSize:_,tags:E,remark:x}){return await et().POST("/api/v1/hf/orders/multi",{clientOid:e,symbol:t,type:r,timeInForce:s,stp:i,side:o,price:l,size:u,cancelAfter:h,postOnly:d,hidden:g,iceberg:v,visibleSize:_,tags:E,remark:x})};Je.syncPlaceMultipleHfOrders=async function({clientOid:e,symbol:t,type:r,timeInForce:s,stp:i,side:o,price:l,size:u,cancelAfter:h,postOnly:d,hidden:g,iceberg:v,visibleSize:_,tags:E,remark:x}){return await et().POST("/api/v1/hf/orders/multi/sync",{clientOid:e,symbol:t,type:r,timeInForce:s,stp:i,side:o,price:l,size:u,cancelAfter:h,postOnly:d,hidden:g,iceberg:v,visibleSize:_,tags:E,remark:x})};Je.modifyOrder=async function({symbol:e,clientOid:t,orderId:r,newPrice:s,newSize:i}){return await et().POST("/api/v1/hf/orders/alter",{symbol:e,clientOid:t,orderId:r,newPrice:s,newSize:i})};Je.cancelOrdersByOrderId=async function({orderId:e,symbol:t}){return await et().DEL(`/api/v1/hf/orders/${e}`,{orderId:e,symbol:t})};Je.syncCancelOrdersByOrderId=async function({orderId:e,symbol:t}){return await et().DEL(`/api/v1/hf/orders/sync/${e}`,{orderId:e,symbol:t})};Je.cancelOrderByClientOid=async function({clientOid:e,symbol:t}){return await et().DEL(`/api/v1/hf/orders/client-order/${e}`,{clientOid:e,symbol:t})};Je.syncCancelOrdersByClientOid=async function({clientOid:e,symbol:t}){return await et().DEL(`/api/v1/hf/orders/sync/client-order/${e}`,{clientOid:e,symbol:t})};Je.cancelSpecifiedNumberOfOrdersByOrderId=async function({orderId:e,symbol:t,cancelSize:r}){return await et().DEL(`/api/v1/hf/orders/cancel/${e}`,{orderId:e,symbol:t,cancelSize:r})};Je.cancelAllHfOrdersBySymbol=async function({symbol:e}){return await et().DEL("/api/v1/hf/orders",{symbol:e})};Je.obtainListOfActiveHfOrders=async function({symbol:e}){return await et().GET("/api/v1/hf/orders/active",{symbol:e})};Je.obtainListOfSymbolWithActiveHfOrders=async function(){return await et().GET("/api/v1/hf/orders/active/symbols")};Je.obtainListOfFilledHfOrders=async function({symbol:e,side:t,type:r,startAt:s,endAt:i,lastId:o,limit:l}){return await et().GET("/api/v1/hf/orders/done",{symbol:e,side:t,type:r,startAt:s,endAt:i,lastId:o,limit:l})};Je.detailsOfAsingleHfOrder=async function({orderId:e,symbol:t}){return await et().GET(`/api/v1/hf/orders/${e}`,{orderId:e,symbol:t})};Je.obtainDetailsOfASingleHfOrder=async function({clientOid:e,symbol:t}){return await et().GET(`/api/v1/hf/orders/client-order/${e}`,{clientOid:e,symbol:t})};Je.hfAutoCancelSetting=async function({timeout:e,symbols:t}){return await et().POST("/api/v1/hf/orders/dead-cancel-all",{timeout:e,symbols:t})};Je.queryHfAutoCancelOrderSetting=async function(){return await et().GET("/api/v1/hf/orders/dead-cancel-all/query")};Je.cancelAllHfOrders=async function(){return await et().DEL("/api/v1/hf/orders/cancelAll")};Je.placeOrderTest=async function(e={}){return await et().POST("/api/v1/orders/test",{...e})};Je.placeHfOrderTest=async function({clientOid:e,symbol:t,type:r,side:s,stp:i,tags:o,remark:l}){return await et().POST("/api/v1/hf/orders/test",{clientOid:e,symbol:t,type:r,side:s,stp:i,tags:o,remark:l})};var Un={};const gs=Et;Un.postStopOrder=async function(e={},t={}){return await gs().POST("/api/v1/stop-order",{...e,...t})};Un.cancelOrder=async function(e,t){return await gs().DEL(`/api/v1/stop-order/${e}/${t}`)};Un.cancelMultiOrders=async function(e,t,r){return await gs().DEL("/api/v1/stop-order/cancel",{symbol:e,tradeType:t,orderIds:r})};Un.getOrder=async function(e,t){return await gs().GET(`/api/v1/stop-order/${e}/${t}`)};Un.getStopOrderList=async function(e={}){return await gs().GET("/api/v1/stop-order",{...e})};Un.getOrderByClientOid=async function(e,t){return await gs().GET("/api/v1/stop-order/queryOrderByClientOid",{clientOid:e,symbol:t})};Un.cancelSingleOrderByClientOid=async function(e,t){return await gs().DEL("/api/v1/stop-order/cancelOrderByClientOid",{clientOid:e,symbol:t})};Un.getSingleStopOrderInfo=async function({orderId:e}){return await gs().GET(`/api/v1/stop-order/${e}`,{orderId:e})};Un.cancelStopOrder=async function({orderId:e}){return await gs().DEL(`/api/v1/stop-order/${e}`,{orderId:e})};var ms={};const si=Et;ms.placeOrder=async function({symbol:e,side:t,price:r,size:s,stopPrice:i,limitPrice:o,tradeType:l,clientOid:u,remark:h}){return await si().POST("/api/v3/oco/order",{symbol:e,side:t,price:r,size:s,stopPrice:i,limitPrice:o,tradeType:l,clientOid:u,remark:h})};ms.cancelOrder=async function(e){return await si().DEL(`/api/v3/oco/order/${e}`)};ms.cancelOrderByClientOid=async function(e){return await si().DEL(`/api/v3/oco/client-order/${e}`)};ms.cancelAllOrders=async function({orderIds:e,symbol:t}){return await si().DEL("/api/v3/oco/orders",{orderIds:e,symbol:t})};ms.getOrder=async function(e){return await si().GET(`/api/v3/oco/order/${e}`)};ms.getOrderByClientOid=async function(e){return await si().GET(`/api/v3/oco/client-order/${e}`)};ms.getOrders=async function({pageSize:e,currentPage:t,symbol:r,startAt:s,endAt:i,orderIds:o}){return await si().GET("/api/v3/oco/orders",{pageSize:e,currentPage:t,symbol:r,startAt:s,endAt:i,orderIds:o})};ms.getOrderDetails=async function(e){return await si().GET(`/api/v3/oco/order/details/${e}`)};var Ih={};const Vg=Et;Ih.getFillsList=async function(e,t={}){return await Vg().GET("/api/v1/fills",{tradeType:e,...t})};Ih.getRecentFills=async function(){return await Vg().GET("/api/v1/limit/fills")};Ih.getHfTransactionRecords=async function({orderId:e,symbol:t,side:r,type:s,startAt:i,endAt:o,lastId:l,limit:u}){return await Vg().GET("/api/v1/hf/fills",{orderId:e,symbol:t,side:r,type:s,startAt:i,endAt:o,lastId:l,limit:u})};var Gi={};const na=Et;Gi.getTicker=async function(e){return await na().GET("/api/v1/market/orderbook/level1",{symbol:e})};Gi.getAllTickers=async function(){return await na().GET("/api/v1/market/allTickers")};Gi.get24hrStats=async function(e){return await na().GET("/api/v1/market/stats",{symbol:e})};Gi.getMarketList=async function(){return await na().GET("/api/v1/markets")};Gi.getSymbolsList=async function({market:e=void 0}={}){return await na().GET("/api/v2/symbols",{market:e})};Gi.getSymbolDetail=async function(e){return await na().GET(`/api/v2/symbols/${e}`)};var sa={};const Ph=Et;sa.getLevel2_20=async function(e){return await Ph().GET("/api/v1/market/orderbook/level2_20",{symbol:e})};sa.getLevel2_100=async function(e){return await Ph().GET("/api/v1/market/orderbook/level2_100",{symbol:e})};sa.getLevel2_full=async function(e){return await Ph().GET("/api/v3/market/orderbook/level2",{symbol:e})};sa.getLevel3_full=async function(e){return await Ph().GET("/api/v2/market/orderbook/level3",{symbol:e})};var Fg={};const H_=Et;Fg.getMarketHistories=async function(e){return await H_().GET("/api/v1/market/histories",{symbol:e})};Fg.getMarketCandles=async function(e,t,{startAt:r,endAt:s}={}){return await H_().GET("/api/v1/market/candles",{symbol:e,type:t,startAt:r,endAt:s})};var Bl={};const Ch=Et;Bl.getCurrencies=async function(){return await Ch().GET("/api/v1/currencies")};Bl.getFiatPrice=async function(e={}){return await Ch().GET("/api/v1/prices",{...e})};Bl.getCurrencyDetail=async function({currency:e,chain:t}){return await Ch().GET(`/api/v2/currencies/${e}`,{currency:e,chain:t})};Bl.getCurrencyDetail_V3=async function({currency:e,chain:t}){return await Ch().GET(`/api/v3/currencies/${e}`,{currency:e,chain:t})};var En={};const $n=Et;En.getMarkPrice=async function(e){return await $n().GET(`/api/v1/mark-price/${e}/current`)};En.getMarginConfigurationInfo=async function(){return await $n().GET("/api/v1/margin/config")};En.getMarginAccount=async function(){return await $n().GET("/api/v1/margin/account")};En.postMarginOrder=async function(e={}){return await $n().POST("/api/v1/margin/order",{...e})};En.getMarginPriceStrategy=async function({marginModel:e}={}){return await $n().GET("/api/v1/risk/limit/strategy",{marginModel:e})};En.getMarginCurrencies=async function({isIsolated:e,symbol:t,currency:r}){return await $n().GET("/api/v3/margin/currencies",{isIsolated:e,symbol:t,currency:r})};En.getEtfInfo=async function({currency:e}){return await $n().GET("/api/v3/etf/info",{currency:e})};En.getMarginAccounts=async function({quoteCurrency:e="USDT",queryType:t="MARGIN"}){return await $n().GET("/api/v3/margin/accounts",{quoteCurrency:e,queryType:t})};En.getIsolatedAccounts=async function({symbol:e,quoteCurrency:t="USDT",queryType:r="MARGIN"}){return await $n().GET("/api/v3/isolated/accounts",{symbol:e,quoteCurrency:t,queryType:r})};En.postMarginOrderTest=async function({clientOid:e,side:t,symbol:r,type:s,remark:i,stp:o,marginModel:l,autoBorrow:u,autoRepay:h,price:d,size:g,timeInForce:v,cancelAfter:_,postOnly:E,hidden:x,iceberg:R,visibleSize:I,funds:F}){return await $n().POST("/api/v1/margin/order/test",{clientOid:e,side:t,symbol:r,type:s,remark:i,stp:o,marginModel:l,autoBorrow:u,autoRepay:h,price:d,size:g,timeInForce:v,cancelAfter:_,postOnly:E,hidden:x,iceberg:R,visibleSize:I,funds:F})};var sr={};const vr=Et;sr.postBorrowOrder=async function(e={}){return await vr().POST("/api/v1/margin/borrow",{...e})};sr.getBorrowOrder=async function(e){return await vr().GET("/api/v1/margin/borrow",{orderId:e})};sr.getRepayRecord=async function(e){return await vr().GET("/api/v1/margin/borrow/outstanding",{currency:e})};sr.getRepaymentRecord=async function(e){return await vr().GET("/api/v1/margin/borrow/repaid",{currency:e})};sr.repayAll=async function(e,t,r){return await vr().POST("/api/v1/margin/repay/all",{currency:e,sequence:t,size:r})};sr.repaySingle=async function(e,t,r){return await vr().POST("/api/v1/margin/repay/single",{currency:e,tradeId:t,size:r})};sr.postLendOrder=async function(e,t,r,s){return await vr().POST("/api/v1/margin/lend",{currency:e,size:t,dailyIntRate:r,term:s})};sr.cancelLendOrder=async function(e){return await vr().DEL(`/api/v1/margin/lend/${e}`)};sr.setAutoLend=async function(e,t,r,s,i){return await vr().POST("/api/v1/margin/toggle-auto-lend",{currency:e,isEnable:t,retainSize:r,dailyIntRate:s,term:i})};sr.getActiveOrder=async function(e,{currentPage:t,pageSize:r}={}){return await vr().GET("/api/v1/margin/lend/active",{currency:e,currentPage:t,pageSize:r})};sr.getLentHistory=async function(e,{currentPage:t,pageSize:r}={}){return await vr().GET("/api/v1/margin/lend/done",{currency:e,currentPage:t,pageSize:r})};sr.getActiveLendOrdersList=async function(e,{currentPage:t,pageSize:r}={}){return await vr().GET("/api/v1/margin/lend/trade/unsettled",{currency:e,currentPage:t,pageSize:r})};sr.getSettledLendOrderHistory=async function(e,{currentPage:t,pageSize:r}={}){return await vr().GET("/api/v1/margin/lend/trade/settled",{currency:e,currentPage:t,pageSize:r})};sr.getAccountLendRecord=async function(e){return await vr().GET("/api/v1/margin/lend/assets",{currency:e})};sr.getLendingMarketData=async function(e,t){return await vr().GET("/api/v1/margin/market",{currency:e,term:t})};sr.getMarginFillsTradeData=async function(e){return await vr().GET("/api/v1/margin/trade/last",{currency:e})};var ys={};const ii=Et;ys.queryIsolatedMarginTradingPairConfiguration=async function(){return await ii().GET("/api/v1/isolated/symbols")};ys.queryIsolatedMarginAccountInfo=async function({balanceCurrency:e}){return await ii().GET("/api/v1/isolated/accounts",{balanceCurrency:e})};ys.querySingleIsolatedMarginAccountInfo=async function({symbol:e}){return await ii().GET(`/api/v1/isolated/account/${e}`,{symbol:e})};ys.isolatedMarginBorrowing=async function({symbol:e,currency:t,size:r,borrowStrategy:s,maxRate:i,period:o}){return await ii().POST("/api/v1/isolated/borrow",{symbol:e,currency:t,size:r,borrowStrategy:s,maxRate:i,period:o})};ys.queryOutstandingRepaymentRecords=async function({symbol:e,currency:t,pageSize:r,currentPage:s}){return await ii().GET("/api/v1/isolated/borrow/outstanding",{symbol:e,currency:t,pageSize:r,currentPage:s})};ys.queryRepaymentRecords=async function({symbol:e,currency:t,pageSize:r,currentPage:s}){return await ii().GET("/api/v1/isolated/borrow/repaid",{symbol:e,currency:t,pageSize:r,currentPage:s})};ys.quickRepayment=async function({symbol:e,currency:t,size:r,seqStrategy:s}){return await ii().POST("/api/v1/isolated/repay/all",{symbol:e,currency:t,size:r,seqStrategy:s})};ys.singleRepayment=async function({symbol:e,currency:t,size:r,loanId:s}){return await ii().POST("/api/v1/isolated/repay/single",{symbol:e,currency:t,size:r,loanId:s})};var dt={};const mt=Et;dt.marginBorrowV3=async function({isIsolated:e=!1,symbol:t,currency:r,size:s,timeInForce:i,isHf:o=!1}){const l={isIsolated:e,currency:r,size:s,timeInForce:i,isHf:o};if(e&&!t)throw new Error("Symbol is required for isolated margin accounts.");e&&(l.symbol=t);try{return await mt().POST("/api/v3/margin/borrow",l)}catch(u){throw console.error("Error borrowing margin:",u),u}};dt.getBorrowHistoryV3=async function({currency:e,isIsolated:t,symbol:r,orderNo:s,startTime:i,endTime:o,currentPage:l,pageSize:u}){return await mt().GET("/api/v3/margin/borrow",{currency:e,isIsolated:t,symbol:r,orderNo:s,startTime:i,endTime:o,currentPage:l,pageSize:u})};dt.repayMarginLoanV3=async function({isIsolated:e,isHf:t,symbol:r,currency:s,size:i}){return await mt().POST("/api/v3/margin/repay",{isIsolated:e,isHf:t,symbol:r,currency:s,size:i})};dt.getRepayHistoryV3=async function({currency:e,isIsolated:t,symbol:r,orderNo:s,startTime:i,endTime:o,currentPage:l,pageSize:u}){return await mt().GET("/api/v3/margin/repay",{currency:e,isIsolated:t,symbol:r,orderNo:s,startTime:i,endTime:o,currentPage:l,pageSize:u})};dt.getMarginInterestRecordsV3=async function({isIsolated:e,symbol:t,currency:r,startTime:s,endTime:i,currentPage:o,pageSize:l}){return await mt().GET("/api/v3/margin/interest",{isIsolated:e,symbol:t,currency:r,startTime:s,endTime:i,currentPage:o,pageSize:l})};dt.getLendingCurrencyInfoV3=async function({currency:e}){return await mt().GET("/api/v3/project/list",{currency:e})};dt.getMarketInterestRateV3=async function({currency:e}){return await mt().GET("/api/v3/project/marketInterestRate",{currency:e})};dt.initiatePurchaseV3=async function({currency:e,size:t,interestRate:r}){return await mt().POST("/api/v3/purchase",{currency:e,size:t,interestRate:r})};dt.getPurchaseOrdersV3=async function({currency:e,status:t,currentPage:r,pageSize:s}){return await mt().GET("/api/v3/purchase/orders",{currency:e,status:t,currentPage:r,pageSize:s})};dt.redeemMarketV3=async function({currency:e,size:t,purchaseOrderNo:r}){return await mt().POST("/api/v3/redeem",{currency:e,size:t,purchaseOrderNo:r})};dt.getRedemptionOrdersV3=async function({currency:e,redeemOrderNo:t,status:r,currentPage:s,pageSize:i}){return await mt().GET("/api/v3/redeem/orders",{currency:e,redeemOrderNo:t,status:r,currentPage:s,pageSize:i})};dt.updatePurchaseOrderInterestRateV3=async function({currency:e,purchaseOrderNo:t,interestRate:r}){await mt().POST("/api/v3/lend/purchase/update",{currency:e,purchaseOrderNo:t,interestRate:r})};dt.getCrossMarginTradingPairs=async function(e){const t=e?{symbol:e}:{};return(await mt().GET("/api/v3/margin/symbols",{params:t})).data};dt.updateLeverageMultiplier=async function({leverage:e,symbol:t,isIsolated:r=!1}){const s={leverage:e,symbol:t,isIsolated:r};await mt().POST("/api/v3/position/update-user-leverage",s)};dt.placeHfMarginOrder=async function(e){return(await mt().POST("/api/v3/hf/margin/order",e)).data};dt.testHfMarginOrder=async function(e){return(await mt().POST("/api/v3/hf/margin/order/test",e)).data};dt.cancelHfMarginOrder=async function(e,t){return(await mt().DEL(`/api/v3/hf/margin/orders/${e}`,{params:{symbol:t}})).data};dt.cancelHfMarginOrderByClientOid=async function(e,t){return(await mt().DEL(`/api/v3/hf/margin/orders/client-order/${e}`,{params:{symbol:t}})).data};dt.cancelAllHfMarginOrdersBySymbol=async function(e,t){return(await mt().DEL("/api/v3/hf/margin/orders",{params:{symbol:e,tradeType:t}})).data};dt.getActiveHfMarginOrders=async function(e,t){return(await mt().GET("/api/v3/hf/margin/orders/active",{params:{tradeType:e,symbol:t}})).data};dt.getFilledHfMarginOrders=async function({tradeType:e,symbol:t,side:r,type:s,startAt:i,endAt:o,lastId:l,limit:u=100}){const h={tradeType:e,symbol:t,side:r,type:s,startAt:i,endAt:o,lastId:l,limit:u};return(await mt().GET("/api/v3/hf/margin/orders/done",{params:h})).data};dt.getHfOrderDetails=async function({orderId:e,symbol:t}){if(!e||!t)throw new Error("Both orderId and symbol are required parameters.");return(await mt().GET(`/api/v3/hf/margin/orders/${e}`,{params:{symbol:t}})).data};dt.getHfOrderDetailsByClientOid=async function({clientOid:e,symbol:t}){if(!e||!t)throw new Error("Both clientOid and symbol are required parameters.");return(await mt().GET(`/api/v3/hf/margin/orders/client-order/${e}`,{params:{symbol:t}})).data};dt.getHfTransactionRecords=async function(e){if(!e.symbol||!e.tradeType)throw new Error("Both symbol and tradeType are required parameters.");return(await mt().GET("/api/v3/hf/margin/fills",{params:e})).data};dt.getActiveHfOrderSymbols=async function({tradeType:e}){if(!e)throw new Error("tradeType is a required parameter.");return(await mt().GET("/api/v3/hf/margin/order/active/symbols",{params:{tradeType:e}})).data};var Nh={};const Ug=Et;Nh.subscribeToEarnFixedIncomeProducts=async function({productId:e,amount:t,accountType:r}){return(await Ug().POST("/api/v1/earn/orders",{productId:e,amount:t,accountType:r})).data};Nh.redeemByEarnHoldingId=async function({orderId:e,amount:t,fromAccountType:r,confirmPunishRedeem:s}){const i={orderId:e,amount:t,...r&&{fromAccountType:r},...s&&{confirmPunishRedeem:s}};return(await Ug().DEL("/api/v1/earn/orders",{params:i})).data};Nh.getEarnRedeemPreviewByHoldingId=async function({orderId:e,fromAccountType:t}){const r={orderId:e,...t&&{fromAccountType:t}};return(await Ug().GET("/api/v1/earn/redeem-preview",{params:r})).data};var Oh={};const $g=Et;Oh.getEarnSavingsProducts=async function({currency:e}){const t=e?{currency:e}:{};return(await $g().GET("/api/v1/earn/saving/products",{params:t})).data};Oh.getEarnFixedIncomeCurrentHoldings=async function({currentPage:e=1,pageSize:t=20,productId:r,productCategory:s,currency:i}){const o={currentPage:e,pageSize:t,...r&&{productId:r},...s&&{productCategory:s},...i&&{currency:i}};return(await $g().GET("/api/v1/earn/hold-assets",{params:o})).data};Oh.getEarnPromotionProducts=async function({currency:e}){const t=e?{currency:e}:{};return(await $g().GET("/api/v1/earn/promotion/products",{params:t})).data};var kh={};const Bg=Et;kh.getKcsStakingProducts=async function({currency:e}){const t=e?{currency:e}:{};return(await Bg().GET("/api/v1/earn/kcs-staking/products",{params:t})).data};kh.getEarnStakingProducts=async function({currency:e}){const t=e?{currency:e}:{};return(await Bg().GET("/api/v1/earn/staking/products",{params:t})).data};kh.getEthStakingProducts=async function(){return(await Bg().GET("/api/v1/earn/eth-staking/products")).data};var qg={};const K_=Et;qg.getOtcLoanInformation=async function(){return(await K_().GET("/api/v1/otc-loan/loan")).data};qg.getOtcLoanAccounts=async function(){const e="/api/v1/otc-loan/accounts";try{return(await K_().GET(e)).data}catch(t){throw console.error("Error fetching OTC loan accounts:",t.message),t}};var jh={};const Wg=Et;jh.getTimestamp=async function(){return await Wg().GET("/api/v1/timestamp")};jh.getStatus=async function(){return await Wg().GET("/api/v1/status")};jh.getAnnouncements=async function(e={}){return await Wg().GET("/api/v3/announcements",e)};var Nd,qy;function Q_(){return qy||(qy=1,Nd=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}),Nd}var Hp={exports:{}},J_={exports:{}},MC=void 0,Y_=function(n){return n!==MC&&n!==null},LC=Y_,VC={object:!0,function:!0,undefined:!0},FC=function(n){return LC(n)?hasOwnProperty.call(VC,typeof n):!1},UC=FC,$C=function(n){if(!UC(n))return!1;try{return n.constructor?n.constructor.prototype===n:!1}catch{return!1}},BC=$C,qC=function(n){if(typeof n!="function"||!hasOwnProperty.call(n,"length"))return!1;try{if(typeof n.length!="number"||typeof n.call!="function"||typeof n.apply!="function")return!1}catch{return!1}return!BC(n)},WC=qC,zC=/^\s*class[\s{/}]/,GC=Function.prototype.toString,HC=function(n){return!(!WC(n)||zC.test(GC.call(n)))},KC=function(){var n=Object.assign,e;return typeof n!="function"?!1:(e={foo:"raz"},n(e,{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")},Od,Wy;function QC(){return Wy||(Wy=1,Od=function(){try{return Object.keys("primitive"),!0}catch{return!1}}),Od}var JC=function(){},YC=JC(),Dh=function(n){return n!==YC&&n!==null},kd,zy;function XC(){if(zy)return kd;zy=1;var n=Dh,e=Object.keys;return kd=function(t){return e(n(t)?Object(t):t)},kd}var jd,Gy;function ZC(){return Gy||(Gy=1,jd=QC()()?Object.keys:XC()),jd}var Dd,Hy;function eN(){if(Hy)return Dd;Hy=1;var n=Dh;return Dd=function(e){if(!n(e))throw new TypeError("Cannot use null or undefined");return e},Dd}var Md,Ky;function tN(){if(Ky)return Md;Ky=1;var n=ZC(),e=eN(),t=Math.max;return Md=function(r,s){var i,o,l=t(arguments.length,2),u;for(r=Object(e(r)),u=function(h){try{r[h]=s[h]}catch(d){i||(i=d)}},o=1;o<l;++o)s=arguments[o],n(s).forEach(u);if(i!==void 0)throw i;return r},Md}var rN=KC()?Object.assign:tN(),nN=Dh,sN=Array.prototype.forEach,iN=Object.create,oN=function(n,e){var t;for(t in n)e[t]=n[t]},aN=function(n){var e=iN(null);return sN.call(arguments,function(t){nN(t)&&oN(Object(t),e)}),e},lN={},$u=Y_,Qy=HC,X_=rN,Z_=aN,dl=lN,cN=J_.exports=function(n,e){var t,r,s,i,o;return arguments.length<2||typeof n!="string"?(i=e,e=n,n=null):i=arguments[2],$u(n)?(t=dl.call(n,"c"),r=dl.call(n,"e"),s=dl.call(n,"w")):(t=s=!0,r=!1),o={value:e,configurable:t,enumerable:r,writable:s},i?X_(Z_(i),o):o};cN.gs=function(n,e,t){var r,s,i,o;return typeof n!="string"?(i=t,t=e,e=n,n=null):i=arguments[3],$u(e)?Qy(e)?$u(t)?Qy(t)||(i=t,t=void 0):t=void 0:(i=e,e=t=void 0):e=void 0,$u(n)?(r=dl.call(n,"c"),s=dl.call(n,"e")):(r=!0,s=!1),o={get:e,set:t,configurable:r,enumerable:s},i?X_(Z_(i),o):o};var uN=J_.exports,hN=function(n){if(typeof n!="function")throw new TypeError(n+" is not a function");return n};(function(n,e){var t=uN,r=hN,s=Function.prototype.apply,i=Function.prototype.call,o=Object.create,l=Object.defineProperty,u=Object.defineProperties,h=Object.prototype.hasOwnProperty,d={configurable:!0,enumerable:!1,writable:!0},g,v,_,E,x,R,I;g=function(F,V){var $;return r(V),h.call(this,"__ee__")?$=this.__ee__:($=d.value=o(null),l(this,"__ee__",d),d.value=null),$[F]?typeof $[F]=="object"?$[F].push(V):$[F]=[$[F],V]:$[F]=V,this},v=function(F,V){var $,W;return r(V),W=this,g.call(this,F,$=function(){_.call(W,F,$),s.call(V,this,arguments)}),$.__eeOnceListener__=V,this},_=function(F,V){var $,W,X,j;if(r(V),!h.call(this,"__ee__"))return this;if($=this.__ee__,!$[F])return this;if(W=$[F],typeof W=="object")for(j=0;X=W[j];++j)(X===V||X.__eeOnceListener__===V)&&(W.length===2?$[F]=W[j?0:1]:W.splice(j,1));else(W===V||W.__eeOnceListener__===V)&&delete $[F];return this},E=function(F){var V,$,W,X,j;if(h.call(this,"__ee__")&&(X=this.__ee__[F],!!X))if(typeof X=="object"){for($=arguments.length,j=new Array($-1),V=1;V<$;++V)j[V-1]=arguments[V];for(X=X.slice(),V=0;W=X[V];++V)s.call(W,this,j)}else switch(arguments.length){case 1:i.call(X,this);break;case 2:i.call(X,this,arguments[1]);break;case 3:i.call(X,this,arguments[1],arguments[2]);break;default:for($=arguments.length,j=new Array($-1),V=1;V<$;++V)j[V-1]=arguments[V];s.call(X,this,j)}},x={on:g,once:v,off:_,emit:E},R={on:t(g),once:t(v),off:t(_),emit:t(E)},I=u({},R),n.exports=e=function(F){return F==null?o(I):u(Object(F),R)},e.methods=x})(Hp,Hp.exports);var fN=Hp.exports,dN=Dh,pN={function:!0,object:!0},gN=function(n){return dN(n)&&pN[typeof n]||!1},mN=gN,yN=function(n){if(!mN(n))throw new TypeError(n+" is not an Object");return n},wN=yN,Jy=Object.prototype.hasOwnProperty,vN=function(n){var e=arguments[1],t;if(wN(n),e!==void 0){if(t=Jy.call(n,"__ee__")&&n.__ee__,!t)return;t[e]&&delete t[e];return}Jy.call(n,"__ee__")&&delete n.__ee__};const rl=Vl,_N=Et,bN=Q_(),EN=fN,TN=vN,e1=()=>{},yu=()=>"_e_"+Date.now()+(Math.random()*365).toString(16).slice(4,14)+"kc",Ld=n=>n.split(":")[0],Io=e1;let SN=class{constructor(e=!1){this.privateBullet=!!e,this.trustConnected=!1,this.client=null,this.emitter=new EN,this.topicState=[],this.topicListener={},this.incrementSubscribeId=0,this.ping=0,this._connecting=!1,this._onClose=[],this._maxId=0,this._pingTs=null,this.connectSocket=this.connectSocket.bind(this),this.subscribe=this.subscribe.bind(this),this.unsubscribe=this.unsubscribe.bind(this),this.onClose=this.onClose.bind(this),this._handleClose=this._handleClose.bind(this),this._distribute=this._distribute.bind(this),this._handleAfterConnect=this._handleAfterConnect.bind(this),this._connect=this._connect.bind(this),this._getBulletToken=this._getBulletToken.bind(this),this._sub=this._sub.bind(this),this._unsub=this._unsub.bind(this),this._clearPing=this._clearPing.bind(this),this._ping=this._ping.bind(this)}async connectSocket(){if(this.trustConnected){Io("ws conn status: ",this.trustConnected);return}if(this._connecting)return;this._connecting=!0,this._clearPing(),TN(this.emitter);const e=await this._getBulletToken();if(!e){rl.delay(()=>{this._connecting=!1,this.connectSocket()},3e3);return}const t=yu();this.emitter.on(`welcome_${t}`,this._handleAfterConnect);const r=await this._connect({server:e.data,connectId:t});r.onopen=()=>{Io("socket connect opend",this._maxId,r._maxId),this.client=r},r.onmessage=s=>{if(!s.data)return;let i=null;try{Io("parse: ",s.data,this._maxId,r._maxId),i=JSON.parse(s.data)}catch(u){console.error(u)}if(!i)return;const{id:o,type:l}=i;switch(l){case"welcome":case"ack":case"pong":this.emitter.emit(`${l}_${o}`);break;case"message":this._distribute(i);break;case"ping":default:Io("unhandle message",s.data);break}},r.onerror=s=>{Io("socket connect onerror",this._maxId,r._maxId,s.message)},r.onclose=()=>{Io("socket connect closed",this._maxId,r._maxId),this._handleClose(),rl.delay(()=>{this._connecting=!1,this.connectSocket()},3e3)}}_handleClose(){this.trustConnected=!1,this.ping=0,rl.each(this._onClose,e=>{typeof e=="function"&&e()})}onClose(e){return typeof e=="function"&&this._onClose.push(e),this}subscribe(e,t=e1,r=!1){this.incrementSubscribeId+=1,this.incrementSubscribeId>1e8&&(this.incrementSubscribeId=0);const s=this.incrementSubscribeId,i={hook:t,id:s},o=Ld(e);return this.topicListener[o]?this.topicListener[o].push(i):this.topicListener[o]=[i],this.topicState.filter(u=>u[0]===e).length===0&&(this.topicState.push([e,r]),this._sub(e,r)),s}unsubscribe(e,t,r=!1){const s=Ld(e);if(this.topicListener[s]){const i=this.topicListener[s].filter(o=>o.id!==t);i.length===0?delete this.topicListener[s]:this.topicListener[s]=i}this.topicState=this.topicState.filter(i=>i[0]!==e),this._unsub(e,r)}_distribute(e){const{topic:t}=e;if(t){const r=Ld(t),s=this.topicListener[r];s&&rl.each(s,({hook:i})=>{typeof i=="function"&&i(e)})}}_handleAfterConnect(){this.trustConnected=!0,this._connecting=!1,rl.each(this.topicState,([e,t])=>{this._sub(e,t)}),this._ping()}async _connect(e){const t=e.server,r=e.connectId,{instanceServers:s,token:i}=t,o=`${s[0].endpoint}?token=${i}&acceptUserMessage=false&connectId=${r}`;this._maxId+=1,this._maxId>1e8&&(this._maxId=0);const l=new bN(o,{handshakeTimeout:3e4});return l._maxId=this._maxId,l}async _getBulletToken(){let e=!1;try{e=await _N().POST(this.privateBullet?"/api/v1/bullet-private":"/api/v1/bullet-public")}catch{}return e}_sub(e,t=!1){if(!this.trustConnected)return;const r=yu();this.emitter.once(`ack_${r}`,()=>{}),this.client.send(JSON.stringify({id:r,type:"subscribe",topic:e,private:t,privateChannel:t,response:!0}))}_unsub(e,t=!1){if(!this.trustConnected)return;const r=yu();this.emitter.once(`ack_${r}`,()=>{}),this.client.send(JSON.stringify({id:r,type:"unsubscribe",topic:e,private:t,privateChannel:t}))}_clearPing(){this._pingTs&&(clearInterval(this._pingTs),this._pingTs=null)}_ping(){this._clearPing(),this._pingTs=setInterval(()=>{if(!this.trustConnected)return;const e=yu(),t=setTimeout(()=>{this._clearPing(),this.client&&(this.client.terminate(),this.client=null)},5e3),r=Date.now();this.emitter.once(`pong_${e}`,()=>{this.ping=Date.now()-r,clearTimeout(t)}),this.client.send(JSON.stringify({id:e,type:"ping"}))},1e4)}};var t1=SN;const xN=Vl,AN=(n=1e3)=>new Promise(e=>{xN.delay(()=>{e()},n)});var RN=AN;const wu=Vl,Yy=t1,IN=RN,{checkL2BufferContinue:PN,mapArr:Xy,arrMap:Zy}=W_,CN=sa;let Vs=(...n)=>{console.log(...n)};const NN=["asks","bids"];class ON{constructor(e,t){this.buffer=[],this.fullSnapshot={dirty:!0,sequence:0,asks:{},bids:{}},this.messageEventCallback=null,this.symbol=e,t instanceof Yy?this.datafeed=t:this.datafeed=new Yy,this._rebuilding=!1,this.bufferMessage=this.bufferMessage.bind(this),this.getFilteredBuffer=this.getFilteredBuffer.bind(this),this.rebuild=this.rebuild.bind(this),this.fetch=this.fetch.bind(this),this.updateFullByMessage=this.updateFullByMessage.bind(this),this.listen=this.listen.bind(this),this.handleMessageEvent=this.handleMessageEvent.bind(this),this.getOrderBook=this.getOrderBook.bind(this)}static setLogger(e){typeof e=="function"&&(Vs=e)}bufferMessage(e){const{sequenceStart:t,sequenceEnd:r,changes:s}=e||{};if(t&&r&&s){const i=this.fullSnapshot.sequence;this.fullSnapshot.dirty===!1&&t===i+1?this.updateFullByMessage(e):(this.buffer.push(e),this.rebuild())}}getFilteredBuffer(e){const t=e+1,r=this.buffer.filter(s=>{const{sequenceStart:i,sequenceEnd:o,changes:l}=s||{};return i<=t&&o>=t||i>=t});if(r[0]){const{sequenceStart:s,sequenceEnd:i,symbol:o,changes:l}=r[0],{asks:u,bids:h}=l,d=u.filter(v=>+v[2]==t),g=h.filter(v=>+v[2]==t);if(!d[0]&&!g[0])return[];r[0]={sequenceStart:t,sequenceEnd:i,symbol:o,changes:{asks:u.filter(v=>+v[2]>=t),bids:h.filter(v=>+v[2]>=t)}}}return r}async rebuild(){if(this._rebuilding){Vs("rebuilding dirty level2, return",this.fullSnapshot.sequence,this.buffer.length&&this.buffer[this.buffer.length-1].sequenceEnd);return}Vs("build dirty level2"),this._rebuilding=!0,this.fullSnapshot.dirty=!0,await IN(5e3);const e=await this.fetch(),t=this.fullSnapshot.sequence;if(e&&this.datafeed.trustConnected){const r=this.getFilteredBuffer(t);(r.length>0||r.length===0&&this.buffer.length===0||r.length===0&&t===this.buffer[this.buffer.length-1].sequenceEnd)&&(PN(r,t)?(Vs("lastSeq & len",this.fullSnapshot.sequence,r.length,this.buffer.length),wu.each(r,i=>{this.updateFullByMessage(i)}),this.fullSnapshot.dirty=!1,this.buffer=[],Vs("level2 checked")):Vs("level2 buffer is not continue with snapshot"))}this._rebuilding=!1}async fetch(){let e=!1;try{const t=await CN.getLevel2_full(this.symbol);if(t.code==="200000"&&t.data){const{sequence:r,asks:s,bids:i}=t.data;this.fullSnapshot.dirty=!0,this.fullSnapshot.sequence=+r,this.fullSnapshot.asks=Xy(s),this.fullSnapshot.bids=Xy(i),e=!0}}catch(t){Vs("fetch level2 error",t)}return e}updateFullByMessage(e){const{sequenceStart:t,sequenceEnd:r,changes:s}=e||{};wu.each(s,(i,o)=>{wu.indexOf(NN,o)>-1&&wu.each(i,l=>{const[u,h,d]=l;h==0?delete this.fullSnapshot[o][u]:this.fullSnapshot[o][u]=h,this.fullSnapshot.sequence=+d})}),this.fullSnapshot.sequence=+r,typeof this.messageEventCallback=="function"&&this.messageEventCallback(e)}listen(){this.datafeed.connectSocket(),this.datafeed.onClose(()=>{Vs("ws closed, status ",this.datafeed.trustConnected),this.rebuild()});const e=`/market/level2:${this.symbol}`;this.datafeed.subscribe(e,t=>{t.topic===e&&this.bufferMessage(t.data)}),this.rebuild()}handleMessageEvent(e){typeof e=="function"&&(this.messageEventCallback=e)}getOrderBook(e=10){const t=this.fullSnapshot.dirty,r=this.fullSnapshot.sequence,s=Zy(this.fullSnapshot.asks,"asc").slice(0,e),i=Zy(this.fullSnapshot.bids,"desc").slice(0,e),o=this.datafeed.ping;return{dirty:t,sequence:r,asks:s,bids:i,ping:o}}}var kN=ON;const{setConfig:jN}=Ll;var DN=Sh.init=n=>{if(typeof n!="object")throw new Error("Invalid cfg type");if(typeof n.apiAuth!="object")throw new Error("Invalid cfg content");jN(n)};Sh.rest={User:{UserInfo:Mg,Account:xt,Deposit:ta,Withdrawals:ra,TradeFee:Lg},Trade:{Orders:Je,StopOrder:Un,OCOOrder:ms,Fills:Ih},Market:{Symbols:Gi,OrderBook:sa,Histories:Fg,Currencies:Bl},Margin:{MarginInfo:En,BorrowAndLend:sr,Isolated:ys,MarginV3:dt},Earn:{General:Nh,KucoinEarn:Oh,Staking:kh},VIPLending:{OtcLoan:qg},Others:jh};Sh.websocket={Datafeed:t1,Level2:kN};var vu={exports:{}},Vd,ew;function r1(){return ew||(ew=1,Vd=function(e,t){return function(){for(var s=new Array(arguments.length),i=0;i<s.length;i++)s[i]=arguments[i];return e.apply(t,s)}}),Vd}var Fd,tw;function Wr(){if(tw)return Fd;tw=1;var n=r1(),e=Object.prototype.toString;function t(A){return e.call(A)==="[object Array]"}function r(A){return typeof A>"u"}function s(A){return A!==null&&!r(A)&&A.constructor!==null&&!r(A.constructor)&&typeof A.constructor.isBuffer=="function"&&A.constructor.isBuffer(A)}function i(A){return e.call(A)==="[object ArrayBuffer]"}function o(A){return typeof FormData<"u"&&A instanceof FormData}function l(A){var D;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?D=ArrayBuffer.isView(A):D=A&&A.buffer&&A.buffer instanceof ArrayBuffer,D}function u(A){return typeof A=="string"}function h(A){return typeof A=="number"}function d(A){return A!==null&&typeof A=="object"}function g(A){if(e.call(A)!=="[object Object]")return!1;var D=Object.getPrototypeOf(A);return D===null||D===Object.prototype}function v(A){return e.call(A)==="[object Date]"}function _(A){return e.call(A)==="[object File]"}function E(A){return e.call(A)==="[object Blob]"}function x(A){return e.call(A)==="[object Function]"}function R(A){return d(A)&&x(A.pipe)}function I(A){return typeof URLSearchParams<"u"&&A instanceof URLSearchParams}function F(A){return A.trim?A.trim():A.replace(/^\s+|\s+$/g,"")}function V(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function $(A,D){if(!(A===null||typeof A>"u"))if(typeof A!="object"&&(A=[A]),t(A))for(var T=0,k=A.length;T<k;T++)D.call(null,A[T],T,A);else for(var M in A)Object.prototype.hasOwnProperty.call(A,M)&&D.call(null,A[M],M,A)}function W(){var A={};function D(M,C){g(A[C])&&g(M)?A[C]=W(A[C],M):g(M)?A[C]=W({},M):t(M)?A[C]=M.slice():A[C]=M}for(var T=0,k=arguments.length;T<k;T++)$(arguments[T],D);return A}function X(A,D,T){return $(D,function(M,C){T&&typeof M=="function"?A[C]=n(M,T):A[C]=M}),A}function j(A){return A.charCodeAt(0)===65279&&(A=A.slice(1)),A}return Fd={isArray:t,isArrayBuffer:i,isBuffer:s,isFormData:o,isArrayBufferView:l,isString:u,isNumber:h,isObject:d,isPlainObject:g,isUndefined:r,isDate:v,isFile:_,isBlob:E,isFunction:x,isStream:R,isURLSearchParams:I,isStandardBrowserEnv:V,forEach:$,merge:W,extend:X,trim:F,stripBOM:j},Fd}var Ud,rw;function n1(){if(rw)return Ud;rw=1;var n=Wr();function e(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}return Ud=function(r,s,i){if(!s)return r;var o;if(i)o=i(s);else if(n.isURLSearchParams(s))o=s.toString();else{var l=[];n.forEach(s,function(d,g){d===null||typeof d>"u"||(n.isArray(d)?g=g+"[]":d=[d],n.forEach(d,function(_){n.isDate(_)?_=_.toISOString():n.isObject(_)&&(_=JSON.stringify(_)),l.push(e(g)+"="+e(_))}))}),o=l.join("&")}if(o){var u=r.indexOf("#");u!==-1&&(r=r.slice(0,u)),r+=(r.indexOf("?")===-1?"?":"&")+o}return r},Ud}var $d,nw;function MN(){if(nw)return $d;nw=1;var n=Wr();function e(){this.handlers=[]}return e.prototype.use=function(r,s,i){return this.handlers.push({fulfilled:r,rejected:s,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1},e.prototype.eject=function(r){this.handlers[r]&&(this.handlers[r]=null)},e.prototype.forEach=function(r){n.forEach(this.handlers,function(i){i!==null&&r(i)})},$d=e,$d}var Bd,sw;function LN(){if(sw)return Bd;sw=1;var n=Wr();return Bd=function(t,r){n.forEach(t,function(i,o){o!==r&&o.toUpperCase()===r.toUpperCase()&&(t[r]=i,delete t[o])})},Bd}var qd,iw;function s1(){return iw||(iw=1,qd=function(e,t,r,s,i){return e.config=t,r&&(e.code=r),e.request=s,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}),qd}var Wd,ow;function i1(){if(ow)return Wd;ow=1;var n=s1();return Wd=function(t,r,s,i,o){var l=new Error(t);return n(l,r,s,i,o)},Wd}var zd,aw;function VN(){if(aw)return zd;aw=1;var n=i1();return zd=function(t,r,s){var i=s.config.validateStatus;!s.status||!i||i(s.status)?t(s):r(n("Request failed with status code "+s.status,s.config,null,s.request,s))},zd}var Gd,lw;function FN(){if(lw)return Gd;lw=1;var n=Wr();return Gd=n.isStandardBrowserEnv()?function(){return{write:function(r,s,i,o,l,u){var h=[];h.push(r+"="+encodeURIComponent(s)),n.isNumber(i)&&h.push("expires="+new Date(i).toGMTString()),n.isString(o)&&h.push("path="+o),n.isString(l)&&h.push("domain="+l),u===!0&&h.push("secure"),document.cookie=h.join("; ")},read:function(r){var s=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return s?decodeURIComponent(s[3]):null},remove:function(r){this.write(r,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),Gd}var Hd,cw;function UN(){return cw||(cw=1,Hd=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}),Hd}var Kd,uw;function $N(){return uw||(uw=1,Kd=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}),Kd}var Qd,hw;function BN(){if(hw)return Qd;hw=1;var n=UN(),e=$N();return Qd=function(r,s){return r&&!n(s)?e(r,s):s},Qd}var Jd,fw;function qN(){if(fw)return Jd;fw=1;var n=Wr(),e=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return Jd=function(r){var s={},i,o,l;return r&&n.forEach(r.split(`
`),function(h){if(l=h.indexOf(":"),i=n.trim(h.substr(0,l)).toLowerCase(),o=n.trim(h.substr(l+1)),i){if(s[i]&&e.indexOf(i)>=0)return;i==="set-cookie"?s[i]=(s[i]?s[i]:[]).concat([o]):s[i]=s[i]?s[i]+", "+o:o}}),s},Jd}var Yd,dw;function WN(){if(dw)return Yd;dw=1;var n=Wr();return Yd=n.isStandardBrowserEnv()?function(){var t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a"),s;function i(o){var l=o;return t&&(r.setAttribute("href",l),l=r.href),r.setAttribute("href",l),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return s=i(window.location.href),function(l){var u=n.isString(l)?i(l):l;return u.protocol===s.protocol&&u.host===s.host}}():function(){return function(){return!0}}(),Yd}var Xd,pw;function gw(){if(pw)return Xd;pw=1;var n=Wr(),e=VN(),t=FN(),r=n1(),s=BN(),i=qN(),o=WN(),l=i1();return Xd=function(h){return new Promise(function(g,v){var _=h.data,E=h.headers,x=h.responseType;n.isFormData(_)&&delete E["Content-Type"];var R=new XMLHttpRequest;if(h.auth){var I=h.auth.username||"",F=h.auth.password?unescape(encodeURIComponent(h.auth.password)):"";E.Authorization="Basic "+btoa(I+":"+F)}var V=s(h.baseURL,h.url);R.open(h.method.toUpperCase(),r(V,h.params,h.paramsSerializer),!0),R.timeout=h.timeout;function $(){if(R){var X="getAllResponseHeaders"in R?i(R.getAllResponseHeaders()):null,j=!x||x==="text"||x==="json"?R.responseText:R.response,A={data:j,status:R.status,statusText:R.statusText,headers:X,config:h,request:R};e(g,v,A),R=null}}if("onloadend"in R?R.onloadend=$:R.onreadystatechange=function(){!R||R.readyState!==4||R.status===0&&!(R.responseURL&&R.responseURL.indexOf("file:")===0)||setTimeout($)},R.onabort=function(){R&&(v(l("Request aborted",h,"ECONNABORTED",R)),R=null)},R.onerror=function(){v(l("Network Error",h,null,R)),R=null},R.ontimeout=function(){var j="timeout of "+h.timeout+"ms exceeded";h.timeoutErrorMessage&&(j=h.timeoutErrorMessage),v(l(j,h,h.transitional&&h.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",R)),R=null},n.isStandardBrowserEnv()){var W=(h.withCredentials||o(V))&&h.xsrfCookieName?t.read(h.xsrfCookieName):void 0;W&&(E[h.xsrfHeaderName]=W)}"setRequestHeader"in R&&n.forEach(E,function(j,A){typeof _>"u"&&A.toLowerCase()==="content-type"?delete E[A]:R.setRequestHeader(A,j)}),n.isUndefined(h.withCredentials)||(R.withCredentials=!!h.withCredentials),x&&x!=="json"&&(R.responseType=h.responseType),typeof h.onDownloadProgress=="function"&&R.addEventListener("progress",h.onDownloadProgress),typeof h.onUploadProgress=="function"&&R.upload&&R.upload.addEventListener("progress",h.onUploadProgress),h.cancelToken&&h.cancelToken.promise.then(function(j){R&&(R.abort(),v(j),R=null)}),_||(_=null),R.send(_)})},Xd}var Zd,mw;function zg(){if(mw)return Zd;mw=1;var n=Wr(),e=LN(),t=s1(),r={"Content-Type":"application/x-www-form-urlencoded"};function s(u,h){!n.isUndefined(u)&&n.isUndefined(u["Content-Type"])&&(u["Content-Type"]=h)}function i(){var u;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(u=gw()),u}function o(u,h,d){if(n.isString(u))try{return(h||JSON.parse)(u),n.trim(u)}catch(g){if(g.name!=="SyntaxError")throw g}return(d||JSON.stringify)(u)}var l={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:i(),transformRequest:[function(h,d){return e(d,"Accept"),e(d,"Content-Type"),n.isFormData(h)||n.isArrayBuffer(h)||n.isBuffer(h)||n.isStream(h)||n.isFile(h)||n.isBlob(h)?h:n.isArrayBufferView(h)?h.buffer:n.isURLSearchParams(h)?(s(d,"application/x-www-form-urlencoded;charset=utf-8"),h.toString()):n.isObject(h)||d&&d["Content-Type"]==="application/json"?(s(d,"application/json"),o(h)):h}],transformResponse:[function(h){var d=this.transitional,g=d&&d.silentJSONParsing,v=d&&d.forcedJSONParsing,_=!g&&this.responseType==="json";if(_||v&&n.isString(h)&&h.length)try{return JSON.parse(h)}catch(E){if(_)throw E.name==="SyntaxError"?t(E,this,"E_JSON_PARSE"):E}return h}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(h){return h>=200&&h<300}};return l.headers={common:{Accept:"application/json, text/plain, */*"}},n.forEach(["delete","get","head"],function(h){l.headers[h]={}}),n.forEach(["post","put","patch"],function(h){l.headers[h]=n.merge(r)}),Zd=l,Zd}var ep,yw;function zN(){if(yw)return ep;yw=1;var n=Wr(),e=zg();return ep=function(r,s,i){var o=this||e;return n.forEach(i,function(u){r=u.call(o,r,s)}),r},ep}var tp,ww;function o1(){return ww||(ww=1,tp=function(e){return!!(e&&e.__CANCEL__)}),tp}var rp,vw;function GN(){if(vw)return rp;vw=1;var n=Wr(),e=zN(),t=o1(),r=zg();function s(i){i.cancelToken&&i.cancelToken.throwIfRequested()}return rp=function(o){s(o),o.headers=o.headers||{},o.data=e.call(o,o.data,o.headers,o.transformRequest),o.headers=n.merge(o.headers.common||{},o.headers[o.method]||{},o.headers),n.forEach(["delete","get","head","post","put","patch","common"],function(h){delete o.headers[h]});var l=o.adapter||r.adapter;return l(o).then(function(h){return s(o),h.data=e.call(o,h.data,h.headers,o.transformResponse),h},function(h){return t(h)||(s(o),h&&h.response&&(h.response.data=e.call(o,h.response.data,h.response.headers,o.transformResponse))),Promise.reject(h)})},rp}var np,_w;function a1(){if(_w)return np;_w=1;var n=Wr();return np=function(t,r){r=r||{};var s={},i=["url","method","data"],o=["headers","auth","proxy","params"],l=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],u=["validateStatus"];function h(_,E){return n.isPlainObject(_)&&n.isPlainObject(E)?n.merge(_,E):n.isPlainObject(E)?n.merge({},E):n.isArray(E)?E.slice():E}function d(_){n.isUndefined(r[_])?n.isUndefined(t[_])||(s[_]=h(void 0,t[_])):s[_]=h(t[_],r[_])}n.forEach(i,function(E){n.isUndefined(r[E])||(s[E]=h(void 0,r[E]))}),n.forEach(o,d),n.forEach(l,function(E){n.isUndefined(r[E])?n.isUndefined(t[E])||(s[E]=h(void 0,t[E])):s[E]=h(void 0,r[E])}),n.forEach(u,function(E){E in r?s[E]=h(t[E],r[E]):E in t&&(s[E]=h(void 0,t[E]))});var g=i.concat(o).concat(l).concat(u),v=Object.keys(t).concat(Object.keys(r)).filter(function(E){return g.indexOf(E)===-1});return n.forEach(v,d),s},np}const HN="0.21.4",KN={version:HN};var sp,bw;function QN(){if(bw)return sp;bw=1;var n=KN,e={};["object","boolean","number","function","string","symbol"].forEach(function(o,l){e[o]=function(h){return typeof h===o||"a"+(l<1?"n ":" ")+o}});var t={},r=n.version.split(".");function s(o,l){for(var u=l?l.split("."):r,h=o.split("."),d=0;d<3;d++){if(u[d]>h[d])return!0;if(u[d]<h[d])return!1}return!1}e.transitional=function(l,u,h){var d=u&&s(u);function g(v,_){return"[Axios v"+n.version+"] Transitional option '"+v+"'"+_+(h?". "+h:"")}return function(v,_,E){if(l===!1)throw new Error(g(_," has been removed in "+u));return d&&!t[_]&&(t[_]=!0,console.warn(g(_," has been deprecated since v"+u+" and will be removed in the near future"))),l?l(v,_,E):!0}};function i(o,l,u){if(typeof o!="object")throw new TypeError("options must be an object");for(var h=Object.keys(o),d=h.length;d-- >0;){var g=h[d],v=l[g];if(v){var _=o[g],E=_===void 0||v(_,g,o);if(E!==!0)throw new TypeError("option "+g+" must be "+E);continue}if(u!==!0)throw Error("Unknown option "+g)}}return sp={isOlderVersion:s,assertOptions:i,validators:e},sp}var ip,Ew;function JN(){if(Ew)return ip;Ew=1;var n=Wr(),e=n1(),t=MN(),r=GN(),s=a1(),i=QN(),o=i.validators;function l(u){this.defaults=u,this.interceptors={request:new t,response:new t}}return l.prototype.request=function(h){typeof h=="string"?(h=arguments[1]||{},h.url=arguments[0]):h=h||{},h=s(this.defaults,h),h.method?h.method=h.method.toLowerCase():this.defaults.method?h.method=this.defaults.method.toLowerCase():h.method="get";var d=h.transitional;d!==void 0&&i.assertOptions(d,{silentJSONParsing:o.transitional(o.boolean,"1.0.0"),forcedJSONParsing:o.transitional(o.boolean,"1.0.0"),clarifyTimeoutError:o.transitional(o.boolean,"1.0.0")},!1);var g=[],v=!0;this.interceptors.request.forEach(function($){typeof $.runWhen=="function"&&$.runWhen(h)===!1||(v=v&&$.synchronous,g.unshift($.fulfilled,$.rejected))});var _=[];this.interceptors.response.forEach(function($){_.push($.fulfilled,$.rejected)});var E;if(!v){var x=[r,void 0];for(Array.prototype.unshift.apply(x,g),x=x.concat(_),E=Promise.resolve(h);x.length;)E=E.then(x.shift(),x.shift());return E}for(var R=h;g.length;){var I=g.shift(),F=g.shift();try{R=I(R)}catch(V){F(V);break}}try{E=r(R)}catch(V){return Promise.reject(V)}for(;_.length;)E=E.then(_.shift(),_.shift());return E},l.prototype.getUri=function(h){return h=s(this.defaults,h),e(h.url,h.params,h.paramsSerializer).replace(/^\?/,"")},n.forEach(["delete","get","head","options"],function(h){l.prototype[h]=function(d,g){return this.request(s(g||{},{method:h,url:d,data:(g||{}).data}))}}),n.forEach(["post","put","patch"],function(h){l.prototype[h]=function(d,g,v){return this.request(s(v||{},{method:h,url:d,data:g}))}}),ip=l,ip}var op,Tw;function l1(){if(Tw)return op;Tw=1;function n(e){this.message=e}return n.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},n.prototype.__CANCEL__=!0,op=n,op}var ap,Sw;function YN(){if(Sw)return ap;Sw=1;var n=l1();function e(t){if(typeof t!="function")throw new TypeError("executor must be a function.");var r;this.promise=new Promise(function(o){r=o});var s=this;t(function(o){s.reason||(s.reason=new n(o),r(s.reason))})}return e.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},e.source=function(){var r,s=new e(function(o){r=o});return{token:s,cancel:r}},ap=e,ap}var lp,xw;function XN(){return xw||(xw=1,lp=function(e){return function(r){return e.apply(null,r)}}),lp}var cp,Aw;function ZN(){return Aw||(Aw=1,cp=function(e){return typeof e=="object"&&e.isAxiosError===!0}),cp}var Rw;function eO(){if(Rw)return vu.exports;Rw=1;var n=Wr(),e=r1(),t=JN(),r=a1(),s=zg();function i(l){var u=new t(l),h=e(t.prototype.request,u);return n.extend(h,t.prototype,u),n.extend(h,u),h}var o=i(s);return o.Axios=t,o.create=function(u){return i(r(o.defaults,u))},o.Cancel=l1(),o.CancelToken=YN(),o.isCancel=o1(),o.all=function(u){return Promise.all(u)},o.spread=XN(),o.isAxiosError=ZN(),vu.exports=o,vu.exports.default=o,vu.exports}var up,Iw;function Mh(){return Iw||(Iw=1,up=eO()),up}var hp,Pw;function tO(){if(Pw)return hp;Pw=1;const n=Mh(),e={};return e.getAccountOverview=async function(t={}){let r="/api/v1/account-overview",s=this.baseURL+r+this.formatQuery(t);return(await n.get(s,this.sign(r,"GET",t))).data},e.getTransactionHist=async function(t={}){let r="/api/v1/transaction-history",s=this.baseURL+r+this.formatQuery(t);return(await n.get(s,this.sign(r,"GET",t))).data},e.getDepositAddress=async function(t){let r="/api/v1/deposit-address",s=this.baseURL+r+this.formatQuery(t);return(await n.get(s,this.sign(r,"GET",t))).data},e.getDepositList=async function(t={}){let r="/api/v1/deposit-list",s=this.baseURL+r+this.formatQuery(t);return(await n.get(s,this.sign(r,"GET",t))).data},e.getWithdrawalQuotas=async function(t){let r="/api/v1/withdrawals/quotas",s=this.baseURL+r+this.formatQuery(t);return(await n.get(s,this.sign(r,"GET",t))).data},e.applyForWithdrawal=async function(t){let r="/api/v1/withdrawals",s=this.baseURL+r;return(await n.post(s,t,this.sign(r,"POST",t))).data},e.getWithdrawalsList=async function(t={}){let r="/api/v1/withdrawal-list",s=this.baseURL+r+this.formatQuery(t);return(await n.get(s,this.sign(r,"GET",t))).data},e.cancelWithdrawal=async function(t){let r="/api/v1/withdrawals/"+t.withdrawalId,s=this.baseURL+r;return(await n.delete(s,this.sign(r,"DELETE"))).data},e.transferFunds=async function(t){let r="/api/v2/transfer-out",s=this.baseURL+r;return(await n.post(s,t,this.sign(r,"POST",t))).data},e.getTransferList=async function(t={}){let r="/api/v1/transfer-list",s=this.baseURL+r+this.formatQuery(t);return(await n.get(s,this.sign(r,"GET",t))).data},e.cancelWithdrawal=async function(t){let r="/api/v1/cancel/transfer-out",s=this.baseURL+r+this.formatQuery(t);return(await n.delete(s,this.sign(r,"DELETE",t))).data},hp=e,hp}var fp,Cw;function rO(){if(Cw)return fp;Cw=1;const n=Mh(),e={};return e.getContract=async function(t=""){let r=`/api/v1/contracts/${t}`,s=this.baseURL+r;return(await n.get(s)).data},e.getAllContracts=async function(){let r=this.baseURL+"/api/v1/contracts/active";return(await n.get(r)).data},e.getTicker=async function(t){let r=`/api/v1/ticker?symbol=${t}`,s=this.baseURL+r;return(await n.get(s)).data},e.getFullOrderBook=async function(t){let r=`/api/v1/market/orderbook/level2?symbol=${t}`,s=this.baseURL+r;return(await n.get(s)).data},e.getPartOrderBook=async function(t){let r=`/api/v1/level2/depth${t.amount}?symbol=${t.symbol}`,s=this.baseURL+r;return(await n.get(s)).data},e.pullMessagesLvl2=async function(t){let s=this.baseURL+"/api/v1/level2/message/query"+this.formatQuery(t);return(await n.get(s)).data},e.getFullOrderBookAtomic=async function(t){let r=`/api/v2/level3/snapshot?symbol=${t}`,s=this.baseURL+r;return(await n.get(s)).data},e.pullMessagesLvl3=async function(t){let s=this.baseURL+"/api/v1/level3/snapshot"+this.formatQuery(t);return(await n.get(s)).data},e.getTradeHistories=async function(t){let r=`/api/v1/trade/history?symbol=${t}`,s=this.baseURL+r;return(await n.get(s)).data},e.getInterestRate=async function(t){let s=this.baseURL+"/api/v1/interest/query"+this.formatQuery(t);return(await n.get(s)).data},e.getIndexList=async function(t){let s=this.baseURL+"/api/v1/index/query"+this.formatQuery(t);return(await n.get(s)).data},e.getMarkPrice=async function(t){let r=`/api/v1/mark-price/${t}/current`,s=this.baseURL+r;return(await n.get(s)).data},e.getPremiumIndex=async function(t){let s=this.baseURL+"/api/v1/index/query"+this.formatQuery(t);return(await n.get(s)).data},e.getFundingRate=async function(t){let r=`/api/v1/funding-rate/${t}/current`,s=this.baseURL+r;return(await n.get(s)).data},e.getServerTime=async function(){let r=this.baseURL+"/api/v1/timestamp";return(await n.get(r)).data},e.getKlines=async function(t){let s=this.baseURL+"/api/v1/kline/query"+this.formatQuery(t);return(await n.get(s)).data},fp=e,fp}var dp,Nw;function nO(){if(Nw)return dp;Nw=1;const n=Mh(),e={};return e.placeOrder=async function(t){let r="/api/v1/orders",s=this.baseURL+r;return(await n.post(s,t,this.sign(r,"POST",t))).data},e.cancelOrder=async function(t){let r="/api/v1/orders/"+t.id,s=this.baseURL+r;return(await n.delete(s,this.sign(r,"DELETE"))).data},e.cancelAllOrders=async function(t){let r="/api/v1/orders",s=this.baseURL+r+this.formatQuery(t);return(await n.delete(s,this.sign(r,"DELETE",t))).data},e.cancelAllStopOrders=async function(t){let r="/api/v1/stopOrders",s=this.baseURL+r+this.formatQuery(t);return(await n.delete(s,this.sign(r,"DELETE",t))).data},e.getOrders=async function(t={}){let r="/api/v1/orders",s=this.baseURL+r+this.formatQuery(t);return(await n.get(s,this.sign(r,"GET",t))).data},e.getStopOrders=async function(t={}){let r="/api/v1/stopOrders",s=this.baseURL+r+this.formatQuery(t);return(await n.get(s,this.sign(r,"GET",t))).data},e.getRecentOrders=async function(){let t="/api/v1/recentDoneOrders",r=this.baseURL+t;return(await n.get(r,this.sign(t,"GET"))).data},e.getOrderById=async function(t){let r;t.oid!=null?r="/api/v1/orders/"+t.oid:r="/api/v1/orders/byClientOid?clientOid="+t.cid;let s=this.baseURL+r;return(await n.get(s,this.sign(r,"GET"))).data},e.listFills=async function(t={}){let r="/api/v1/fills",s=this.baseURL+r+this.formatQuery(t);return(await n.get(s,this.sign(r,"GET",t))).data},e.recentFills=async function(){let t="/api/v1/recentFills",r=this.baseURL+t;return(await n.get(r,this.sign(t,"GET"))).data},e.getOpenOrderStatistics=async function(t={}){let r="/api/v1/openOrderStatistics",s=this.baseURL+r+this.formatQuery(t);return(await n.get(s,this.sign(r,"GET",t))).data},e.getPosition=async function(t){let r="/api/v1/position",s=this.baseURL+r+this.formatQuery(t);return(await n.get(s,this.sign(r,"GET",t))).data},e.getAllPositions=async function(){let t="/api/v1/positions",r=this.baseURL+t+this.formatQuery();return(await n.get(r,this.sign(t,"GET"))).data},e.changeAutoDeposit=async function(t){let r="/api/v1/position/margin/auto-deposit-status",s=this.baseURL+r;return(await n.post(s,t,this.sign(r,"POST",t))).data},e.addMargin=async function(t){let r="/api/v1/position/margin/deposit-margin",s=this.baseURL+r;return(await n.post(s,t,this.sign(r,"POST",t))).data},e.getFundingHistory=async function(t={}){let r="/api/v1/funding-history",s=this.baseURL+r+this.formatQuery(t);return(await n.get(s,this.sign(r,"GET",t))).data},dp=e,dp}var pp,Ow;function sO(){if(Ow)return pp;Ow=1;const n=Q_(),e=Mh(),t={};return t.ws={},t.heartbeat={},getPublicWsToken=async function(r){let i=r+"/api/v1/bullet-public";return(await e.post(i,{})).data},getPrivateWsToken=async function(r,s){let o=r+"/api/v1/bullet-private";return(await e.post(o,{},s)).data},getSocketEndpoint=async function(r,s,i,o){let l;r=="private"?l=await getPrivateWsToken(s,o):l=await getPublicWsToken(s);let u=l.data.token,h=l.data.instanceServers[0];if(h){if(i==="sandbox")return`${h.endpoint}?token=${u}&[connectId=${Date.now()}]`;if(i==="live")return`${h.endpoint}?token=${u}&[connectId=${Date.now()}]`}else throw Error("No Kucoin WS servers running")},t.initSocket=async function(r,s){try{r.sign||(r.sign=!1),r.endpoint||(r.endpoint=!1);let[i,o,l]=t.topics(r.topic,r.symbols,r.endpoint,r.sign),u=this.sign("/api/v1/bullet-private","POST",{}),h=await getSocketEndpoint(l,this.baseURL,this.environment,u),d=new n(h);d.on("open",()=>{t.ws[i]=d,console.log(i+" opening websocket connection... "),t.subscribe(i,o,l,s),t.ws[i].heartbeat=setInterval(t.socketHeartBeat,2e4,i)}),d.on("error",g=>{t.handleSocketError(g),console.log(g)}),d.on("ping",()=>{}),d.on("close",()=>{clearInterval(t.ws[i].heartbeat),console.log(i+" websocket closed...")})}catch(i){console.log(i)}},t.handleSocketError=function(r){console.log("WebSocket error: "+(r.code?" ("+r.code+")":"")+(r.message?" "+r.message:""))},t.socketHeartBeat=function(r){t.ws[r].ping()},t.subscribe=async function(r,s,i,o){let l=t.ws[r];i==="private"?l.send(JSON.stringify({id:Date.now(),type:"subscribe",topic:s,privateChannel:!0,response:!0})):l.send(JSON.stringify({id:Date.now(),type:"subscribe",topic:s,response:!0})),l.on("message",o)},t.unsubscribe=async function(r,s,i,o){let l=t.ws[r];l.send(JSON.stringify({id:Date.now(),type:"unsubscribe",topic:s,response:!0})),l.on("message",o)},t.topics=function(r,s=[],i=!1,o=!1){if(i)return[r,i+(s.length>0?":":"")+s.join(","),o?"private":"public"];if(r==="ticker")return[r,"/contractMarket/ticker:"+s[0],"public"];if(r==="tickerv2")return[r,"/contractMarket/tickerV2:"+s[0],"public"];if(r==="orderbook")return[r,"/contractMarket/level2:",+s[0],"public"];if(r==="execution")return[r,"/contractMarket/execution:"+s[0],"public"];if(r==="fullMatch")return[r,"/contractMarket/level3v2:"+s[0],"public"];if(r==="depth5")return[r,"/contractMarket/level2Depth5:"+s[0],"public"];if(r==="depth50")return[r,"/contractMarket/level2Depth50"+s[0],"public"];if(r==="market")return[r,"/contract/instrument:"+s[0],"public"];if(r==="announcement")return[r,"/contract/announcement","public"];if(r==="snapshot")return[r,"/contractMarket/snapshot:"+s[0],"public"];if(r==="ordersMarket")return[r,"/contractMarket/tradeOrders:"+s[0],"private"];if(r==="orders")return[r,"/contractMarket/tradeOrders","private"];if(r==="advancedOrders")return[r,"/contractMarket/advancedOrders","private"];if(r==="balances")return[r,"/contractAccount/wallet","private"];if(r==="position")return[r,"/contract/position:"+s[0],"private"]},pp=t,pp}const iO=Fl,kw=Fl;class oO{constructor(){}init(e){let t="";e.environment==="live"?t="https://api-futures.kucoin.com":t="https://api-sandbox-futures.kucoin.com",this.environment=e.environment,this.baseURL=t,this.secretKey=e.secretKey,this.apiKey=e.apiKey,this.passphrase=e.passphrase;const r=tO(),s=rO(),i=nO(),o=sO();Object.assign(this,r,s,i,o)}sign(e,t,r={}){let s={headers:{"Content-Type":"application/json"}},i=Date.now()+"",o="";t==="GET"||t==="DELETE"?o=i+t+e+this.formatQuery(r):o=i+t+e+JSON.stringify(r);let l=kw.createHmac("sha256",this.secretKey).update(o).digest("base64"),u=kw.createHmac("sha256",this.secretKey).update(this.passphrase).digest("base64");return s.headers["KC-API-SIGN"]=l,s.headers["KC-API-TIMESTAMP"]=i,s.headers["KC-API-KEY"]=this.apiKey,s.headers["KC-API-PASSPHRASE"]=u,s.headers["KC-API-KEY-VERSION"]=2,s}formatQuery(e){return e!==void 0&&JSON.stringify(e).length!==2?"?"+iO.stringify(e):""}}var aO=oO;const jw=z2(aO),lO="modulepreload",cO=function(n){return"/"+n},Dw={},zo=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));s=Promise.allSettled(t.map(u=>{if(u=cO(u),u in Dw)return;Dw[u]=!0;const h=u.endsWith(".css"),d=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${d}`))return;const g=document.createElement("link");if(g.rel=h?"stylesheet":lO,h||(g.as="script"),g.crossOrigin="",g.href=u,l&&g.setAttribute("nonce",l),document.head.appendChild(g),h)return new Promise((v,_)=>{g.addEventListener("load",v),g.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return s.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})},uO=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>zo(async()=>{const{default:r}=await Promise.resolve().then(()=>ia);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class Gg extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class hO extends Gg{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class fO extends Gg{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class dO extends Gg{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Kp;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(Kp||(Kp={}));var pO=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(d){try{h(r.next(d))}catch(g){o(g)}}function u(d){try{h(r.throw(d))}catch(g){o(g)}}function h(d){d.done?i(d.value):s(d.value).then(l,u)}h((r=r.apply(n,e||[])).next())})};class gO{constructor(e,{headers:t={},customFetch:r,region:s=Kp.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=uO(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return pO(this,void 0,void 0,function*(){try{const{headers:s,method:i,body:o}=t;let l={},{region:u}=t;u||(u=this.region),u&&u!=="any"&&(l["x-region"]=u);let h;o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",h=o):typeof o=="string"?(l["Content-Type"]="text/plain",h=o):typeof FormData<"u"&&o instanceof FormData?h=o:(l["Content-Type"]="application/json",h=JSON.stringify(o)));const d=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),s),body:h}).catch(E=>{throw new hO(E)}),g=d.headers.get("x-relay-error");if(g&&g==="true")throw new fO(d);if(!d.ok)throw new dO(d);let v=((r=d.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),_;return v==="application/json"?_=yield d.json():v==="application/octet-stream"?_=yield d.blob():v==="text/event-stream"?_=d:v==="multipart/form-data"?_=yield d.formData():_=yield d.text(),{data:_,error:null}}catch(s){return{data:null,error:s}}})}}var Nr={},Hg={},Lh={},ql={},Vh={},Fh={},mO=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Go=mO();const yO=Go.fetch,c1=Go.fetch.bind(Go),u1=Go.Headers,wO=Go.Request,vO=Go.Response,ia=Object.freeze(Object.defineProperty({__proto__:null,Headers:u1,Request:wO,Response:vO,default:c1,fetch:yO},Symbol.toStringTag,{value:"Module"})),_O=zi(ia);var Uh={};Object.defineProperty(Uh,"__esModule",{value:!0});let bO=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Uh.default=bO;var h1=$t&&$t.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Fh,"__esModule",{value:!0});const EO=h1(_O),TO=h1(Uh);let SO=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=EO.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var o,l,u;let h=null,d=null,g=null,v=i.status,_=i.statusText;if(i.ok){if(this.method!=="HEAD"){const I=await i.text();I===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?d=I:d=JSON.parse(I))}const x=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),R=(l=i.headers.get("content-range"))===null||l===void 0?void 0:l.split("/");x&&R&&R.length>1&&(g=parseInt(R[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(d)&&(d.length>1?(h={code:"PGRST116",details:`Results contain ${d.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},d=null,g=null,v=406,_="Not Acceptable"):d.length===1?d=d[0]:d=null)}else{const x=await i.text();try{h=JSON.parse(x),Array.isArray(h)&&i.status===404&&(d=[],h=null,v=200,_="OK")}catch{i.status===404&&x===""?(v=204,_="No Content"):h={message:x}}if(h&&this.isMaybeSingle&&(!((u=h==null?void 0:h.details)===null||u===void 0)&&u.includes("0 rows"))&&(h=null,v=200,_="OK"),h&&this.shouldThrowOnError)throw new TO.default(h)}return{error:h,data:d,count:g,status:v,statusText:_}});return this.shouldThrowOnError||(s=s.catch(i=>{var o,l,u;return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(l=i==null?void 0:i.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(u=i==null?void 0:i.code)!==null&&u!==void 0?u:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}returns(){return this}overrideTypes(){return this}};Fh.default=SO;var xO=$t&&$t.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Vh,"__esModule",{value:!0});const AO=xO(Fh);let RO=class extends AO.default{select(e){let t=!1;const r=(e??"*").split("").map(s=>/\s/.test(s)&&!t?"":(s==='"'&&(t=!t),s)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s,referencedTable:i=s}={}){const o=i?`${i}.order`:"order",l=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${l?`${l},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const s=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:s=r}={}){const i=typeof s>"u"?"offset":`${s}.offset`,o=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(o,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:i=!1,format:o="text"}={}){var l;const u=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,i?"wal":null].filter(Boolean).join("|"),h=(l=this.headers.Accept)!==null&&l!==void 0?l:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${h}"; options=${u};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Vh.default=RO;var IO=$t&&$t.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ql,"__esModule",{value:!0});const PO=IO(Vh);let CO=class extends PO.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let i="";s==="plain"?i="pl":s==="phrase"?i="ph":s==="websearch"&&(i="w");const o=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${i}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}};ql.default=CO;var NO=$t&&$t.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Lh,"__esModule",{value:!0});const nl=NO(ql);let OO=class{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=t,this.schema=r,this.fetch=s}select(e,{head:t=!1,count:r}={}){const s=t?"HEAD":"GET";let i=!1;const o=(e??"*").split("").map(l=>/\s/.test(l)&&!i?"":(l==='"'&&(i=!i),l)).join("");return this.url.searchParams.set("select",o),r&&(this.headers.Prefer=`count=${r}`),new nl.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const s="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const o=e.reduce((l,u)=>l.concat(Object.keys(u)),[]);if(o.length>0){const l=[...new Set(o)].map(u=>`"${u}"`);this.url.searchParams.set("columns",l.join(","))}}return new nl.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:s,defaultToNull:i=!0}={}){const o="POST",l=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&l.push(this.headers.Prefer),s&&l.push(`count=${s}`),i||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(e)){const u=e.reduce((h,d)=>h.concat(Object.keys(d)),[]);if(u.length>0){const h=[...new Set(u)].map(d=>`"${d}"`);this.url.searchParams.set("columns",h.join(","))}}return new nl.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new nl.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new nl.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Lh.default=OO;var $h={},Bh={};Object.defineProperty(Bh,"__esModule",{value:!0});Bh.version=void 0;Bh.version="0.0.0-automated";Object.defineProperty($h,"__esModule",{value:!0});$h.DEFAULT_HEADERS=void 0;const kO=Bh;$h.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${kO.version}`};var f1=$t&&$t.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Hg,"__esModule",{value:!0});const jO=f1(Lh),DO=f1(ql),MO=$h;let LO=class d1{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},MO.DEFAULT_HEADERS),t),this.schemaName=r,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new jO.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new d1(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:s=!1,count:i}={}){let o;const l=new URL(`${this.url}/rpc/${e}`);let u;r||s?(o=r?"HEAD":"GET",Object.entries(t).filter(([d,g])=>g!==void 0).map(([d,g])=>[d,Array.isArray(g)?`{${g.join(",")}}`:`${g}`]).forEach(([d,g])=>{l.searchParams.append(d,g)})):(o="POST",u=t);const h=Object.assign({},this.headers);return i&&(h.Prefer=`count=${i}`),new DO.default({method:o,url:l,headers:h,schema:this.schemaName,body:u,fetch:this.fetch,allowEmpty:!1})}};Hg.default=LO;var oa=$t&&$t.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Nr,"__esModule",{value:!0});Nr.PostgrestError=Nr.PostgrestBuilder=Nr.PostgrestTransformBuilder=Nr.PostgrestFilterBuilder=Nr.PostgrestQueryBuilder=Nr.PostgrestClient=void 0;const p1=oa(Hg);Nr.PostgrestClient=p1.default;const g1=oa(Lh);Nr.PostgrestQueryBuilder=g1.default;const m1=oa(ql);Nr.PostgrestFilterBuilder=m1.default;const y1=oa(Vh);Nr.PostgrestTransformBuilder=y1.default;const w1=oa(Fh);Nr.PostgrestBuilder=w1.default;const v1=oa(Uh);Nr.PostgrestError=v1.default;var VO=Nr.default={PostgrestClient:p1.default,PostgrestQueryBuilder:g1.default,PostgrestFilterBuilder:m1.default,PostgrestTransformBuilder:y1.default,PostgrestBuilder:w1.default,PostgrestError:v1.default};const{PostgrestClient:FO,PostgrestQueryBuilder:Z3,PostgrestFilterBuilder:e6,PostgrestTransformBuilder:t6,PostgrestBuilder:r6,PostgrestError:n6}=VO,UO="2.11.2",$O={"X-Client-Info":`realtime-js/${UO}`},BO="1.0.0",_1=1e4,qO=1e3;var $o;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})($o||($o={}));var Fr;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(Fr||(Fr={}));var wn;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(wn||(wn={}));var Qp;(function(n){n.websocket="websocket"})(Qp||(Qp={}));var ki;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(ki||(ki={}));class WO{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const l=r.decode(e.slice(o,o+s));o=o+s;const u=r.decode(e.slice(o,o+i));o=o+i;const h=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:l,event:u,payload:h}}}class b1{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ft;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(ft||(ft={}));const Mw=(n,e,t={})=>{var r;const s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((i,o)=>(i[o]=zO(o,n,e,s),i),{})},zO=(n,e,t,r)=>{const s=e.find(l=>l.name===n),i=s==null?void 0:s.type,o=t[n];return i&&!r.includes(i)?E1(i,o):Jp(o)},E1=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return QO(e,t)}switch(n){case ft.bool:return GO(e);case ft.float4:case ft.float8:case ft.int2:case ft.int4:case ft.int8:case ft.numeric:case ft.oid:return HO(e);case ft.json:case ft.jsonb:return KO(e);case ft.timestamp:return JO(e);case ft.abstime:case ft.date:case ft.daterange:case ft.int4range:case ft.int8range:case ft.money:case ft.reltime:case ft.text:case ft.time:case ft.timestamptz:case ft.timetz:case ft.tsrange:case ft.tstzrange:return Jp(e);default:return Jp(e)}},Jp=n=>n,GO=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},HO=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},KO=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},QO=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let i;const o=n.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(l=>E1(e,l))}return n},JO=n=>typeof n=="string"?n.replace(" ","T"):n,T1=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class gp{constructor(e,t,r={},s=_1){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Lw;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Lw||(Lw={}));class pl{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=pl.syncState(this.state,s,i,o),this.pendingDiffs.forEach(u=>{this.state=pl.syncDiff(this.state,u,i,o)}),this.pendingDiffs=[],l()}),this.channel._on(r.diff,{},s=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=pl.syncDiff(this.state,s,i,o),l())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const i=this.cloneDeep(e),o=this.transformState(t),l={},u={};return this.map(i,(h,d)=>{o[h]||(u[h]=d)}),this.map(o,(h,d)=>{const g=i[h];if(g){const v=d.map(R=>R.presence_ref),_=g.map(R=>R.presence_ref),E=d.filter(R=>_.indexOf(R.presence_ref)<0),x=g.filter(R=>v.indexOf(R.presence_ref)<0);E.length>0&&(l[h]=E),x.length>0&&(u[h]=x)}else l[h]=d}),this.syncDiff(i,{joins:l,leaves:u},r,s)}static syncDiff(e,t,r,s){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(l,u)=>{var h;const d=(h=e[l])!==null&&h!==void 0?h:[];if(e[l]=this.cloneDeep(u),d.length>0){const g=e[l].map(_=>_.presence_ref),v=d.filter(_=>g.indexOf(_.presence_ref)<0);e[l].unshift(...v)}r(l,d,u)}),this.map(o,(l,u)=>{let h=e[l];if(!h)return;const d=u.map(g=>g.presence_ref);h=h.filter(g=>d.indexOf(g.presence_ref)<0),e[l]=h,s(l,h,u),h.length===0&&delete e[l]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return"metas"in s?t[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Vw;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(Vw||(Vw={}));var Fw;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(Fw||(Fw={}));var as;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(as||(as={}));class Kg{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=Fr.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new gp(this,wn.join,this.params,this.timeout),this.rejoinTimer=new b1(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Fr.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Fr.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=Fr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Fr.errored,this.rejoinTimer.scheduleTimeout())}),this._on(wn.reply,{},(s,i)=>{this._trigger(this._replyEventName(i),s)}),this.presence=new pl(this),this.broadcastEndpointURL=T1(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:o,private:l}}=this.params;this._onError(d=>e==null?void 0:e(as.CHANNEL_ERROR,d)),this._onClose(()=>e==null?void 0:e(as.CLOSED));const u={},h={broadcast:i,presence:o,postgres_changes:(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(d=>d.filter))!==null&&s!==void 0?s:[],private:l};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:h},u)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:d})=>{var g;if(this.socket.setAuth(),d===void 0){e==null||e(as.SUBSCRIBED);return}else{const v=this.bindings.postgres_changes,_=(g=v==null?void 0:v.length)!==null&&g!==void 0?g:0,E=[];for(let x=0;x<_;x++){const R=v[x],{filter:{event:I,schema:F,table:V,filter:$}}=R,W=d&&d[x];if(W&&W.event===I&&W.schema===F&&W.table===V&&W.filter===$)E.push(Object.assign(Object.assign({},R),{id:W.id}));else{this.unsubscribe(),e==null||e(as.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=E,e&&e(as.SUBSCRIBED);return}}).receive("error",d=>{e==null||e(as.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(d).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(as.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:o}=e,u={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const h=await this._fetchWithTimeout(this.broadcastEndpointURL,u,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((s=h.body)===null||s===void 0?void 0:s.cancel()),h.ok?"ok":"error"}catch(h){return h.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,l,u;const h=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((u=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||u===void 0)&&u.ack)&&i("ok"),h.receive("ok",()=>i("ok")),h.receive("error",()=>i("error")),h.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Fr.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(wn.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const s=new gp(this,wn.leave,{},e);s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}async _fetchWithTimeout(e,t,r){const s=new AbortController,i=setTimeout(()=>s.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(i),o}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new gp(this,e,t,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,i;const o=e.toLocaleLowerCase(),{close:l,error:u,leave:h,join:d}=wn;if(r&&[l,u,h,d].indexOf(o)>=0&&r!==this._joinRef())return;let v=this._onMessage(o,t,r);if(t&&!v)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(_=>{var E,x,R;return((E=_.filter)===null||E===void 0?void 0:E.event)==="*"||((R=(x=_.filter)===null||x===void 0?void 0:x.event)===null||R===void 0?void 0:R.toLocaleLowerCase())===o}).map(_=>_.callback(v,r)):(i=this.bindings[o])===null||i===void 0||i.filter(_=>{var E,x,R,I,F,V;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in _){const $=_.id,W=(E=_.filter)===null||E===void 0?void 0:E.event;return $&&((x=t.ids)===null||x===void 0?void 0:x.includes($))&&(W==="*"||(W==null?void 0:W.toLocaleLowerCase())===((R=t.data)===null||R===void 0?void 0:R.type.toLocaleLowerCase()))}else{const $=(F=(I=_==null?void 0:_.filter)===null||I===void 0?void 0:I.event)===null||F===void 0?void 0:F.toLocaleLowerCase();return $==="*"||$===((V=t==null?void 0:t.event)===null||V===void 0?void 0:V.toLocaleLowerCase())}else return _.type.toLocaleLowerCase()===o}).map(_=>{if(typeof v=="object"&&"ids"in v){const E=v.data,{schema:x,table:R,commit_timestamp:I,type:F,errors:V}=E;v=Object.assign(Object.assign({},{schema:x,table:R,commit_timestamp:I,eventType:F,new:{},old:{},errors:V}),this._getPayloadRecords(E))}_.callback(v,r)})}_isClosed(){return this.state===Fr.closed}_isJoined(){return this.state===Fr.joined}_isJoining(){return this.state===Fr.joining}_isLeaving(){return this.state===Fr.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&Kg.isEqual(s.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(wn.close,{},e)}_onError(e){this._on(wn.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Fr.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Mw(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Mw(e.columns,e.old_record)),t}}const YO=()=>{},XO=typeof WebSocket<"u",ZO=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class ek{constructor(e,t){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=$O,this.params={},this.timeout=_1,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=YO,this.conn=null,this.sendBuffer=[],this.serializer=new WO,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let o;return i?o=i:typeof fetch>"u"?o=(...l)=>zo(async()=>{const{default:u}=await Promise.resolve().then(()=>ia);return{default:u}},void 0).then(({default:u})=>u(...l)):o=fetch,(...l)=>o(...l)},this.endPoint=`${e}/${Qp.websocket}`,this.httpEndpoint=T1(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.apikey;if(s&&(this.accessTokenValue=s,this.apiKey=s),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,o)=>o(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new b1(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(XO){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new tk(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),zo(async()=>{const{default:e}=await import("./browser-CIga-qhc.js").then(t=>t.b);return{default:e}},__vite__mapDeps([0,1])).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:BO}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case $o.connecting:return ki.Connecting;case $o.open:return ki.Open;case $o.closing:return ki.Closing;default:return ki.Closed}}isConnected(){return this.connectionState()===ki.Open}channel(e,t={config:{}}){const r=new Kg(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:s,ref:i}=e,o=()=>{this.encode(e,l=>{var u;(u=this.conn)===null||u===void 0||u.send(l)})};this.log("push",`${t} ${r} (${i})`,s),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let r=null;try{r=JSON.parse(atob(t.split(".")[1]))}catch{}if(r&&r.exp&&!(Math.floor(Date.now()/1e3)-r.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`);this.accessTokenValue=t,this.channels.forEach(s=>{t&&s.updateJoinPayload({access_token:t}),s.joinedOnce&&s._isJoined()&&s._push(wn.access_token,{access_token:t})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(qO,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:s,payload:i,ref:o}=t;o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${s} ${o&&"("+o+")"||""}`,i),this.channels.filter(l=>l._isMember(r)).forEach(l=>l._trigger(s,i,o)),this.stateChangeCallbacks.message.forEach(l=>l(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(wn.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([ZO],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}}class tk{constructor(e,t,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=$o.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=r.close}}class Qg extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function zt(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class rk extends Qg{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Yp extends Qg{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var nk=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(d){try{h(r.next(d))}catch(g){o(g)}}function u(d){try{h(r.throw(d))}catch(g){o(g)}}function h(d){d.done?i(d.value):s(d.value).then(l,u)}h((r=r.apply(n,e||[])).next())})};const S1=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>zo(async()=>{const{default:r}=await Promise.resolve().then(()=>ia);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},sk=()=>nk(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield zo(()=>Promise.resolve().then(()=>ia),void 0)).Response:Response}),Xp=n=>{if(Array.isArray(n))return n.map(t=>Xp(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,r])=>{const s=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=Xp(r)}),e};var Hi=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(d){try{h(r.next(d))}catch(g){o(g)}}function u(d){try{h(r.throw(d))}catch(g){o(g)}}function h(d){d.done?i(d.value):s(d.value).then(l,u)}h((r=r.apply(n,e||[])).next())})};const mp=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),ik=(n,e,t)=>Hi(void 0,void 0,void 0,function*(){const r=yield sk();n instanceof r&&!(t!=null&&t.noResolveJson)?n.json().then(s=>{e(new rk(mp(s),n.status||500))}).catch(s=>{e(new Yp(mp(s),s))}):e(new Yp(mp(n),n))}),ok=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),r&&(s.body=JSON.stringify(r)),Object.assign(Object.assign({},s),t))};function Wl(n,e,t,r,s,i){return Hi(this,void 0,void 0,function*(){return new Promise((o,l)=>{n(t,ok(e,r,s,i)).then(u=>{if(!u.ok)throw u;return r!=null&&r.noResolveJson?u:u.json()}).then(u=>o(u)).catch(u=>ik(u,l,r))})})}function rh(n,e,t,r){return Hi(this,void 0,void 0,function*(){return Wl(n,"GET",e,t,r)})}function Bs(n,e,t,r,s){return Hi(this,void 0,void 0,function*(){return Wl(n,"POST",e,r,s,t)})}function ak(n,e,t,r,s){return Hi(this,void 0,void 0,function*(){return Wl(n,"PUT",e,r,s,t)})}function lk(n,e,t,r){return Hi(this,void 0,void 0,function*(){return Wl(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function x1(n,e,t,r,s){return Hi(this,void 0,void 0,function*(){return Wl(n,"DELETE",e,r,s,t)})}var Cr=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(d){try{h(r.next(d))}catch(g){o(g)}}function u(d){try{h(r.throw(d))}catch(g){o(g)}}function h(d){d.done?i(d.value):s(d.value).then(l,u)}h((r=r.apply(n,e||[])).next())})};const ck={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Uw={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class uk{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=S1(s)}uploadOrUpdate(e,t,r,s){return Cr(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},Uw),s);let l=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const u=o.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),u&&i.append("metadata",this.encodeMetadata(u)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",o.cacheControl),u&&i.append("metadata",this.encodeMetadata(u))):(i=r,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,u&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(u)))),s!=null&&s.headers&&(l=Object.assign(Object.assign({},l),s.headers));const h=this._removeEmptyFolders(t),d=this._getFinalPath(h),g=yield this.fetch(`${this.url}/object/${d}`,Object.assign({method:e,body:i,headers:l},o!=null&&o.duplex?{duplex:o.duplex}:{})),v=yield g.json();return g.ok?{data:{path:h,id:v.Id,fullPath:v.Key},error:null}:{data:null,error:v}}catch(i){if(zt(i))return{data:null,error:i};throw i}})}upload(e,t,r){return Cr(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return Cr(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),l=new URL(this.url+`/object/upload/sign/${o}`);l.searchParams.set("token",t);try{let u;const h=Object.assign({upsert:Uw.upsert},s),d=Object.assign(Object.assign({},this.headers),{"x-upsert":String(h.upsert)});typeof Blob<"u"&&r instanceof Blob?(u=new FormData,u.append("cacheControl",h.cacheControl),u.append("",r)):typeof FormData<"u"&&r instanceof FormData?(u=r,u.append("cacheControl",h.cacheControl)):(u=r,d["cache-control"]=`max-age=${h.cacheControl}`,d["content-type"]=h.contentType);const g=yield this.fetch(l.toString(),{method:"PUT",body:u,headers:d}),v=yield g.json();return g.ok?{data:{path:i,fullPath:v.Key},error:null}:{data:null,error:v}}catch(u){if(zt(u))return{data:null,error:u};throw u}})}createSignedUploadUrl(e,t){return Cr(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);t!=null&&t.upsert&&(s["x-upsert"]="true");const i=yield Bs(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),o=new URL(this.url+i.url),l=o.searchParams.get("token");if(!l)throw new Qg("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:l},error:null}}catch(r){if(zt(r))return{data:null,error:r};throw r}})}update(e,t,r){return Cr(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return Cr(this,void 0,void 0,function*(){try{return{data:yield Bs(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(zt(s))return{data:null,error:s};throw s}})}copy(e,t,r){return Cr(this,void 0,void 0,function*(){try{return{data:{path:(yield Bs(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(zt(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,r){return Cr(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield Bs(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(zt(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return Cr(this,void 0,void 0,function*(){try{const s=yield Bs(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(zt(s))return{data:null,error:s};throw s}})}download(e,t){return Cr(this,void 0,void 0,function*(){const s=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=i?`?${i}`:"";try{const l=this._getFinalPath(e);return{data:yield(yield rh(this.fetch,`${this.url}/${s}/${l}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if(zt(l))return{data:null,error:l};throw l}})}info(e){return Cr(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield rh(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Xp(r),error:null}}catch(r){if(zt(r))return{data:null,error:r};throw r}})}exists(e){return Cr(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield lk(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(zt(r)&&r instanceof Yp){const s=r.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&s.push(i);const l=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",u=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});u!==""&&s.push(u);let h=s.join("&");return h!==""&&(h=`?${h}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${r}${h}`)}}}remove(e){return Cr(this,void 0,void 0,function*(){try{return{data:yield x1(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(zt(t))return{data:null,error:t};throw t}})}list(e,t,r){return Cr(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},ck),t),{prefix:e||""});return{data:yield Bs(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(zt(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const hk="2.7.1",fk={"X-Client-Info":`storage-js/${hk}`};var Po=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(d){try{h(r.next(d))}catch(g){o(g)}}function u(d){try{h(r.throw(d))}catch(g){o(g)}}function h(d){d.done?i(d.value):s(d.value).then(l,u)}h((r=r.apply(n,e||[])).next())})};class dk{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},fk),t),this.fetch=S1(r)}listBuckets(){return Po(this,void 0,void 0,function*(){try{return{data:yield rh(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(zt(e))return{data:null,error:e};throw e}})}getBucket(e){return Po(this,void 0,void 0,function*(){try{return{data:yield rh(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(zt(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Po(this,void 0,void 0,function*(){try{return{data:yield Bs(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(zt(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return Po(this,void 0,void 0,function*(){try{return{data:yield ak(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(zt(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Po(this,void 0,void 0,function*(){try{return{data:yield Bs(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(zt(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Po(this,void 0,void 0,function*(){try{return{data:yield x1(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(zt(t))return{data:null,error:t};throw t}})}}class pk extends dk{constructor(e,t={},r){super(e,t,r)}from(e){return new uk(this.url,this.headers,e,this.fetch)}}const gk="2.49.4";let al="";typeof Deno<"u"?al="deno":typeof document<"u"?al="web":typeof navigator<"u"&&navigator.product==="ReactNative"?al="react-native":al="node";const mk={"X-Client-Info":`supabase-js-${al}/${gk}`},yk={headers:mk},wk={schema:"public"},vk={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},_k={};var bk=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(d){try{h(r.next(d))}catch(g){o(g)}}function u(d){try{h(r.throw(d))}catch(g){o(g)}}function h(d){d.done?i(d.value):s(d.value).then(l,u)}h((r=r.apply(n,e||[])).next())})};const Ek=n=>{let e;return n?e=n:typeof fetch>"u"?e=c1:e=fetch,(...t)=>e(...t)},Tk=()=>typeof Headers>"u"?u1:Headers,Sk=(n,e,t)=>{const r=Ek(t),s=Tk();return(i,o)=>bk(void 0,void 0,void 0,function*(){var l;const u=(l=yield e())!==null&&l!==void 0?l:n;let h=new s(o==null?void 0:o.headers);return h.has("apikey")||h.set("apikey",n),h.has("Authorization")||h.set("Authorization",`Bearer ${u}`),r(i,Object.assign(Object.assign({},o),{headers:h}))})};var xk=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(d){try{h(r.next(d))}catch(g){o(g)}}function u(d){try{h(r.throw(d))}catch(g){o(g)}}function h(d){d.done?i(d.value):s(d.value).then(l,u)}h((r=r.apply(n,e||[])).next())})};function Ak(n){return n.replace(/\/$/,"")}function Rk(n,e){const{db:t,auth:r,realtime:s,global:i}=n,{db:o,auth:l,realtime:u,global:h}=e,d={db:Object.assign(Object.assign({},o),t),auth:Object.assign(Object.assign({},l),r),realtime:Object.assign(Object.assign({},u),s),global:Object.assign(Object.assign({},h),i),accessToken:()=>xk(this,void 0,void 0,function*(){return""})};return n.accessToken?d.accessToken=n.accessToken:delete d.accessToken,d}const A1="2.69.1",ko=30*1e3,Zp=3,yp=Zp*ko,Ik="http://localhost:9999",Pk="supabase.auth.token",Ck={"X-Client-Info":`gotrue-js/${A1}`},eg="X-Supabase-Api-Version",R1={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Nk=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Ok=6e5;class Jg extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function je(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class kk extends Jg{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function jk(n){return je(n)&&n.name==="AuthApiError"}class I1 extends Jg{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class oi extends Jg{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class Fs extends oi{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Dk(n){return je(n)&&n.name==="AuthSessionMissingError"}class wp extends oi{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class _u extends oi{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class bu extends oi{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Mk(n){return je(n)&&n.name==="AuthImplicitGrantRedirectError"}class $w extends oi{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class tg extends oi{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function vp(n){return je(n)&&n.name==="AuthRetryableFetchError"}class Bw extends oi{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class gl extends oi{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const qw="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Ww=` 	
\r=`.split(""),Lk=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<Ww.length;e+=1)n[Ww[e].charCodeAt(0)]=-2;for(let e=0;e<qw.length;e+=1)n[qw[e].charCodeAt(0)]=e;return n})();function P1(n,e,t){const r=Lk[n];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function zw(n){const e=[],t=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=o=>{Uk(o,r,t)};for(let o=0;o<n.length;o+=1)P1(n.charCodeAt(o),s,i);return e.join("")}function Vk(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function Fk(n,e){for(let t=0;t<n.length;t+=1){let r=n.charCodeAt(t);if(r>55295&&r<=56319){const s=(r-55296)*1024&65535;r=(n.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}Vk(r,e)}}function Uk(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let r=1;r<6;r+=1)if(!(n>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function $k(n){const e=[],t={queue:0,queuedBits:0},r=s=>{e.push(s)};for(let s=0;s<n.length;s+=1)P1(n.charCodeAt(s),t,r);return new Uint8Array(e)}function Bk(n){const e=[];return Fk(n,t=>e.push(t)),new Uint8Array(e)}function qk(n){return Math.round(Date.now()/1e3)+n}function Wk(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const On=()=>typeof window<"u"&&typeof document<"u",Ci={tested:!1,writable:!1},ml=()=>{if(!On())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ci.tested)return Ci.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),Ci.tested=!0,Ci.writable=!0}catch{Ci.tested=!0,Ci.writable=!1}return Ci.writable};function zk(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return t.searchParams.forEach((r,s)=>{e[s]=r}),e}const C1=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>zo(async()=>{const{default:r}=await Promise.resolve().then(()=>ia);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Gk=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",N1=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Eu=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Tu=async(n,e)=>{await n.removeItem(e)};let O1=class k1{constructor(){this.promise=new k1.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}};O1.promiseConstructor=Promise;function _p(n){const e=n.split(".");if(e.length!==3)throw new gl("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!Nk.test(e[r]))throw new gl("JWT not in base64url format");return{header:JSON.parse(zw(e[0])),payload:JSON.parse(zw(e[1])),signature:$k(e[2]),raw:{header:e[0],payload:e[1]}}}async function Hk(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function Kk(n,e){return new Promise((r,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await n(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){s(o);return}}})()})}function Qk(n){return("0"+n.toString(16)).substr(-2)}function Jk(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let i=0;i<56;i++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,Qk).join("")}async function Yk(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function Xk(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await Yk(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Co(n,e,t=!1){const r=Jk();let s=r;t&&(s+="/PASSWORD_RECOVERY"),await N1(n,`${e}-code-verifier`,s);const i=await Xk(r);return[i,r===i?"plain":"s256"]}const Zk=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function ej(n){const e=n.headers.get(eg);if(!e||!e.match(Zk))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function tj(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function rj(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var nj=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};const Ni=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),sj=[502,503,504];async function Gw(n){var e;if(!Gk(n))throw new tg(Ni(n),0);if(sj.includes(n.status))throw new tg(Ni(n),n.status);let t;try{t=await n.json()}catch(i){throw new I1(Ni(i),i)}let r;const s=ej(n);if(s&&s.getTime()>=R1["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new Bw(Ni(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Fs}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new Bw(Ni(t),n.status,t.weak_password.reasons);throw new kk(Ni(t),n.status||500,r)}const ij=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};async function $e(n,e,t,r){var s;const i=Object.assign({},r==null?void 0:r.headers);i[eg]||(i[eg]=R1["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",u=await oj(n,e,t+l,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(u):{data:Object.assign({},u),error:null}}async function oj(n,e,t,r,s,i){const o=ij(e,r,s,i);let l;try{l=await n(t,Object.assign({},o))}catch(u){throw console.error(u),new tg(Ni(u),0)}if(l.ok||await Gw(l),r!=null&&r.noResolveJson)return l;try{return await l.json()}catch(u){await Gw(u)}}function Us(n){var e;let t=null;uj(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=qk(n.expires_in)));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function Hw(n){const e=Us(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function qs(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function aj(n){return{data:n,error:null}}function lj(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i}=n,o=nj(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i},u=Object.assign({},o);return{data:{properties:l,user:u},error:null}}function cj(n){return n}function uj(n){return n.access_token&&n.refresh_token&&n.expires_in}var hj=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class fj{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=C1(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await $e(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(je(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await $e(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:qs})}catch(r){if(je(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=hj(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),await $e(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:lj,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(je(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await $e(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:qs})}catch(t){if(je(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,i,o,l,u;try{const h={nextPage:null,lastPage:0,total:0},d=await $e(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:cj});if(d.error)throw d.error;const g=await d.json(),v=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,_=(u=(l=d.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&u!==void 0?u:[];return _.length>0&&(_.forEach(E=>{const x=parseInt(E.split(";")[0].split("=")[1].substring(0,1)),R=JSON.parse(E.split(";")[1].split("=")[1]);h[`${R}Page`]=x}),h.total=parseInt(v)),{data:Object.assign(Object.assign({},g),h),error:null}}catch(h){if(je(h))return{data:{users:[]},error:h};throw h}}async getUserById(e){try{return await $e(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:qs})}catch(t){if(je(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await $e(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:qs})}catch(r){if(je(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){try{return await $e(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:qs})}catch(r){if(je(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{const{data:t,error:r}=await $e(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if(je(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await $e(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(je(t))return{data:null,error:t};throw t}}}const dj={getItem:n=>ml()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{ml()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{ml()&&globalThis.localStorage.removeItem(n)}};function Kw(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function pj(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const No={debug:!!(globalThis&&ml()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class j1 extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class gj extends j1{}async function mj(n,e,t){No.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),No.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){No.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,s.name);try{return await t()}finally{No.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,s.name)}}else{if(e===0)throw No.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new gj(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(No.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}pj();const yj={url:Ik,storageKey:Pk,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ck,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Qw(n,e,t){return await t()}class Sl{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Sl.nextInstanceID,Sl.nextInstanceID+=1,this.instanceID>0&&On()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},yj),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new fj({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=C1(s.fetch),this.lock=s.lock||Qw,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:On()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=mj:this.lock=Qw,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:ml()?this.storage=dj:(this.memoryStorage={},this.storage=Kw(this.memoryStorage)):(this.memoryStorage={},this.storage=Kw(this.memoryStorage)),On()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${A1}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=zk(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),On()&&this.detectSessionInUrl&&r!=="none"){const{data:s,error:i}=await this._getSessionFromURL(t,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),Mk(i)){const u=(e=i.details)===null||e===void 0?void 0:e.code;if(u==="identity_already_exists"||u==="identity_not_found"||u==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:l}=s;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return je(t)?{error:t}:{error:new I1("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{const i=await $e(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:Us}),{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const u=o.session,h=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",u)),{data:{user:h,session:u},error:null}}catch(i){if(je(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,r,s;try{let i;if("email"in e){const{email:d,password:g,options:v}=e;let _=null,E=null;this.flowType==="pkce"&&([_,E]=await Co(this.storage,this.storageKey)),i=await $e(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:v==null?void 0:v.emailRedirectTo,body:{email:d,password:g,data:(t=v==null?void 0:v.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:v==null?void 0:v.captchaToken},code_challenge:_,code_challenge_method:E},xform:Us})}else if("phone"in e){const{phone:d,password:g,options:v}=e;i=await $e(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:g,data:(r=v==null?void 0:v.data)!==null&&r!==void 0?r:{},channel:(s=v==null?void 0:v.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:v==null?void 0:v.captchaToken}},xform:Us})}else throw new _u("You must provide either an email or phone number and a password");const{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const u=o.session,h=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",u)),{data:{user:h,session:u},error:null}}catch(i){if(je(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:l}=e;t=await $e(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Hw})}else if("phone"in e){const{phone:i,password:o,options:l}=e;t=await $e(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Hw})}else throw new _u("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new wp}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(t){if(je(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Eu(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(t??"").split("/");try{const{data:i,error:o}=await $e(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Us});if(await Tu(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new wp}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:o})}catch(i){if(je(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:r,token:s,access_token:i,nonce:o}=e,l=await $e(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:Us}),{data:u,error:h}=l;return h?{data:{user:null,session:null},error:h}:!u||!u.session||!u.user?{data:{user:null,session:null},error:new wp}:(u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",u.session)),{data:u,error:h})}catch(t){if(je(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,i,o;try{if("email"in e){const{email:l,options:u}=e;let h=null,d=null;this.flowType==="pkce"&&([h,d]=await Co(this.storage,this.storageKey));const{error:g}=await $e(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(t=u==null?void 0:u.data)!==null&&t!==void 0?t:{},create_user:(r=u==null?void 0:u.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken},code_challenge:h,code_challenge_method:d},redirectTo:u==null?void 0:u.emailRedirectTo});return{data:{user:null,session:null},error:g}}if("phone"in e){const{phone:l,options:u}=e,{data:h,error:d}=await $e(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(s=u==null?void 0:u.data)!==null&&s!==void 0?s:{},create_user:(i=u==null?void 0:u.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken},channel:(o=u==null?void 0:u.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:h==null?void 0:h.message_id},error:d}}throw new _u("You must provide either an email or phone number.")}catch(l){if(je(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(e){var t,r;try{let s,i;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:l}=await $e(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:Us});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const u=o.session,h=o.user;return u!=null&&u.access_token&&(await this._saveSession(u),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",u)),{data:{user:h,session:u},error:null}}catch(s){if(je(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await Co(this.storage,this.storageKey)),await $e(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:aj})}catch(i){if(je(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new Fs;const{error:s}=await $e(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(je(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:i}=e,{error:o}=await $e(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:s,options:i}=e,{data:o,error:l}=await $e(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:l}}throw new _u("You must provide either an email or phone number and a type")}catch(t){if(je(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Eu(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<yp:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(u,h,d)=>(!o&&h==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(u,h,d))})}return{data:{session:e},error:null}}const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await $e(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:qs}):await this._useSession(async t=>{var r,s,i;const{data:o,error:l}=t;if(l)throw l;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Fs}:await $e(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:qs})})}catch(t){if(je(t))return Dk(t)&&(await this._removeSession(),await Tu(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:i}=r;if(i)throw i;if(!s.session)throw new Fs;const o=s.session;let l=null,u=null;this.flowType==="pkce"&&e.email!=null&&([l,u]=await Co(this.storage,this.storageKey));const{data:h,error:d}=await $e(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:u}),jwt:o.access_token,xform:qs});if(d)throw d;return o.user=h.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(r){if(je(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Fs;const t=Date.now()/1e3;let r=t,s=!0,i=null;const{payload:o}=_p(e.access_token);if(o.exp&&(r=o.exp,s=r<=t),s){const{session:l,error:u}=await this._callRefreshToken(e.refresh_token);if(u)return{data:{user:null,session:null},error:u};if(!l)return{data:{user:null,session:null},error:null};i=l}else{const{data:l,error:u}=await this._getUser(e.access_token);if(u)throw u;i={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(je(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:o,error:l}=t;if(l)throw l;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new Fs;const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(je(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!On())throw new bu("No browser detected.");if(e.error||e.error_description||e.error_code)throw new bu(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new $w("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new bu("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new $w("No code detected.");const{data:F,error:V}=await this._exchangeCodeForSession(e.code);if(V)throw V;const $=new URL(window.location.href);return $.searchParams.delete("code"),window.history.replaceState(window.history.state,"",$.toString()),{data:{session:F.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:i,refresh_token:o,expires_in:l,expires_at:u,token_type:h}=e;if(!i||!l||!o||!h)throw new bu("No session defined in URL");const d=Math.round(Date.now()/1e3),g=parseInt(l);let v=d+g;u&&(v=parseInt(u));const _=v-d;_*1e3<=ko&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${_}s, should have been closer to ${g}s`);const E=v-g;d-E>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",E,v,d):d-E<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",E,v,d);const{data:x,error:R}=await this._getUser(i);if(R)throw R;const I={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:g,expires_at:v,refresh_token:o,token_type:h,user:x.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:I,redirectType:e.type},error:null}}catch(r){if(je(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Eu(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:i}=t;if(i)return{error:i};const o=(r=s.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:l}=await this.admin.signOut(o,e);if(l&&!(jk(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(await this._removeSession(),await Tu(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Wk(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:i},error:o}=t;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await Co(this.storage,this.storageKey,!0));try{return await $e(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(je(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(je(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:s}=await this._useSession(async i=>{var o,l,u,h,d;const{data:g,error:v}=i;if(v)throw v;const _=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(u=e.options)===null||u===void 0?void 0:u.queryParams,skipBrowserRedirect:!0});return await $e(this.fetch,"GET",_,{headers:this.headers,jwt:(d=(h=g.session)===null||h===void 0?void 0:h.access_token)!==null&&d!==void 0?d:void 0})});if(s)throw s;return On()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(je(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;const{data:i,error:o}=t;if(o)throw o;return await $e(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(je(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await Kk(async s=>(s>0&&await Hk(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await $e(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Us})),(s,i)=>{const o=200*Math.pow(2,s);return i&&vp(i)&&Date.now()+o-r<ko})}catch(r){if(this._debug(t,"error",r),je(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),On()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await Eu(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const s=((e=r.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<yp;if(this._debug(t,`session has${s?"":" not"} expired with margin of ${yp}s`),s){if(this.autoRefreshToken&&r.refresh_token){const{error:i}=await this._callRefreshToken(r.refresh_token);i&&(console.error(i),vp(i)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new Fs;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new O1;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new Fs;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const l={session:i.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(i){if(this._debug(s,"error",i),je(i)){const o={session:null,error:i};return vp(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,t)}catch(u){i.push(u)}});if(await Promise.all(o),i.length>0){for(let l=0;l<i.length;l+=1)console.error(i[l]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await N1(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Tu(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&On()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),ko);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/ko);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${ko}ms, refresh threshold is ${Zp} ticks`),s<=Zp&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof j1)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!On()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=await Co(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(l.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);s.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;return i?{data:null,error:i}:await $e(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(je(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:i,error:o}=t;if(o)return{data:null,error:o};const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:u,error:h}=await $e(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return h?{data:null,error:h}:(e.factorType==="totp"&&(!((s=u==null?void 0:u.totp)===null||s===void 0)&&s.qr_code)&&(u.totp.qr_code=`data:image/svg+xml;utf-8,${u.totp.qr_code}`),{data:u,error:null})})}catch(t){if(je(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;if(i)return{data:null,error:i};const{data:o,error:l}=await $e(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:l})})}catch(t){if(je(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;return i?{data:null,error:i}:await $e(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(je(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],s=r.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=r.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:r,totp:s,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:s},error:i}=e;if(i)return{data:null,error:i};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=_p(s.access_token);let l=null;o.aal&&(l=o.aal);let u=l;((r=(t=s.user.factors)===null||t===void 0?void 0:t.filter(g=>g.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(u="aal2");const d=o.amr||[];return{data:{currentLevel:l,nextLevel:u,currentAuthenticationMethods:d},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(o=>o.kid===e);if(r||(r=this.jwks.keys.find(o=>o.kid===e),r&&this.jwks_cached_at+Ok>Date.now()))return r;const{data:s,error:i}=await $e(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;if(!s.keys||s.keys.length===0)throw new gl("JWKS is empty");if(this.jwks=s,this.jwks_cached_at=Date.now(),r=s.keys.find(o=>o.kid===e),!r)throw new gl("No matching signing key found in JWKS");return r}async getClaims(e,t={keys:[]}){try{let r=e;if(!r){const{data:_,error:E}=await this.getSession();if(E||!_.session)return{data:null,error:E};r=_.session.access_token}const{header:s,payload:i,signature:o,raw:{header:l,payload:u}}=_p(r);if(tj(i.exp),!s.kid||s.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:_}=await this.getUser(r);if(_)throw _;return{data:{claims:i,header:s,signature:o},error:null}}const h=rj(s.alg),d=await this.fetchJwk(s.kid,t),g=await crypto.subtle.importKey("jwk",d,h,!0,["verify"]);if(!await crypto.subtle.verify(h,g,o,Bk(`${l}.${u}`)))throw new gl("Invalid JWT signature");return{data:{claims:i,header:s,signature:o},error:null}}catch(r){if(je(r))return{data:null,error:r};throw r}}}Sl.nextInstanceID=0;const wj=Sl;class vj extends wj{constructor(e){super(e)}}var _j=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(d){try{h(r.next(d))}catch(g){o(g)}}function u(d){try{h(r.throw(d))}catch(g){o(g)}}function h(d){d.done?i(d.value):s(d.value).then(l,u)}h((r=r.apply(n,e||[])).next())})};class bj{constructor(e,t,r){var s,i,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const l=Ak(e);this.realtimeUrl=`${l}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${l}/auth/v1`,this.storageUrl=`${l}/storage/v1`,this.functionsUrl=`${l}/functions/v1`;const u=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,h={db:wk,realtime:_k,auth:Object.assign(Object.assign({},vk),{storageKey:u}),global:yk},d=Rk(r??{},h);this.storageKey=(s=d.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(i=d.global.headers)!==null&&i!==void 0?i:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(g,v)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(v)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=d.auth)!==null&&o!==void 0?o:{},this.headers,d.global.fetch),this.fetch=Sk(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new FO(`${l}/rest/v1`,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new gO(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new pk(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return _j(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:i,flowType:o,lock:l,debug:u},h,d){const g={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new vj({url:this.authUrl,headers:Object.assign(Object.assign({},g),h),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:o,lock:l,debug:u,fetch:d,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new ek(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Ej=(n,e,t)=>new bj(n,e,t),Tj="https://fuwojzgyyckccwrwwifh.supabase.co",Sj="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ1d29qemd5eWNrY2N3cnd3aWZoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQyNzk0MTEsImV4cCI6MjA1OTg1NTQxMX0.yjVIj4fyL7MNg_JDA4rumUQLbGArvFlnjSE5xrsoAv4",Xt=Ej(Tj,Sj),xj=kg((n,e)=>({configs:[],isLoading:!1,error:null,loadConfigs:async()=>{try{n({isLoading:!0,error:null});const{data:t,error:r}=await Xt.from("exchange_configs").select("*");if(r)throw r;n({configs:t.map(s=>({...s,enabled:s.enabled||!1}))})}catch(t){n({error:t.message})}finally{n({isLoading:!1})}},addExchange:async t=>{try{n({isLoading:!0,error:null});const{error:r}=await Xt.from("exchange_configs").insert({name:t.name,type:t.type,enabled:t.enabled,api_key:t.apiKey,secret_key:t.secretKey,passphrase:t.passphrase});if(r)throw r;await e().loadConfigs()}catch(r){n({error:r.message})}finally{n({isLoading:!1})}},updateExchange:async(t,r,s)=>{try{n({isLoading:!0,error:null});const{error:i}=await Xt.from("exchange_configs").update({enabled:s.enabled,api_key:s.apiKey,secret_key:s.secretKey,passphrase:s.passphrase}).match({name:t,type:r});if(i)throw i;await e().loadConfigs()}catch(i){n({error:i.message})}finally{n({isLoading:!1})}},removeExchange:async(t,r)=>{try{n({isLoading:!0,error:null});const{error:s}=await Xt.from("exchange_configs").delete().match({name:t,type:r});if(s)throw s;await e().loadConfigs()}catch(s){n({error:s.message})}finally{n({isLoading:!1})}}}));class D1{constructor(){we(this,"kucoinSpotWs",null);we(this,"kucoinFuturesWs",null);we(this,"bitgetSpotWs",null);we(this,"bitgetFuturesWs",null);we(this,"subscribers",[]);we(this,"reconnectAttempts",0);we(this,"maxReconnectAttempts",50);we(this,"reconnectDelay",2e3);we(this,"heartbeatInterval",null);we(this,"lastMessageTime",0);we(this,"HEARTBEAT_INTERVAL",3e4);we(this,"CONNECTION_TIMEOUT",6e4);we(this,"isConnecting",!1);we(this,"SPOT_PAIRS",["BTC-USDT","ETH-USDT","SOL-USDT","BNB-USDT","ADA-USDT"]);we(this,"FUTURES_PAIRS",["XBTUSDTM","ETHUSDTM","SOLUSDTM","BNBUSDTM","ADAUSDTM"]);this.initializeExchanges(),this.startHeartbeat()}startHeartbeat(){this.heartbeatInterval=setInterval(()=>{Date.now()-this.lastMessageTime>this.CONNECTION_TIMEOUT&&(console.warn("⚠️ WebSocket timeout, reconnecting..."),this.disconnect(),this.initializeExchanges())},this.HEARTBEAT_INTERVAL)}async initializeExchanges(){const{configs:e}=xj.getState();for(const t of e)t.enabled&&(t.name==="kucoin"?t.type==="spot"?(DN({apiKey:t.apiKey,secretKey:t.secretKey,passphrase:t.passphrase,environment:"live"}),await this.connectKucoinSpot()):t.type==="futures"&&(jw.init({apiKey:t.apiKey,secretKey:t.secretKey,passphrase:t.passphrase,environment:"live"}),await this.connectKucoinFutures()):t.name==="bitget"&&(t.type==="spot"?await this.connectBitgetSpot():t.type==="futures"&&await this.connectBitgetFutures()))}async connectKucoinSpot(){try{const e=await Sh.getPublicWsToken(),{token:t,instanceServers:r}=e.data,s=`${r[0].endpoint}?token=${t}&acceptUserMessage=true`;this.kucoinSpotWs=new WebSocket(s),this.kucoinSpotWs.onopen=()=>{console.log("Kucoin Spot WebSocket connected"),this.subscribeKucoinSpot()},this.kucoinSpotWs.onmessage=i=>{this.lastMessageTime=Date.now();const o=JSON.parse(i.data);o.type==="message"&&this.processKucoinSpotUpdate(o)},this.kucoinSpotWs.onerror=i=>{console.error("Kucoin Spot WebSocket error:",i),this.handleReconnect("kucoin-spot")},this.kucoinSpotWs.onclose=()=>{console.log("Kucoin Spot WebSocket closed"),this.handleReconnect("kucoin-spot")}}catch(e){console.error("Failed to connect to Kucoin Spot:",e),this.notifySubscribersOfState("error","kucoin-spot",e.message)}}async connectKucoinFutures(){try{const e=await jw.getPublicWsToken(),{token:t,instanceServers:r}=e.data,s=`${r[0].endpoint}?token=${t}&acceptUserMessage=true`;this.kucoinFuturesWs=new WebSocket(s),this.kucoinFuturesWs.onopen=()=>{console.log("Kucoin Futures WebSocket connected"),this.subscribeKucoinFutures()},this.kucoinFuturesWs.onmessage=i=>{this.lastMessageTime=Date.now();const o=JSON.parse(i.data);o.type==="message"&&this.processKucoinFuturesUpdate(o)},this.kucoinFuturesWs.onerror=i=>{console.error("Kucoin Futures WebSocket error:",i),this.handleReconnect("kucoin-futures")},this.kucoinFuturesWs.onclose=()=>{console.log("Kucoin Futures WebSocket closed"),this.handleReconnect("kucoin-futures")}}catch(e){console.error("Failed to connect to Kucoin Futures:",e),this.notifySubscribersOfState("error","kucoin-futures",e.message)}}async connectBitgetSpot(){}async connectBitgetFutures(){}subscribeKucoinSpot(){var e;if(((e=this.kucoinSpotWs)==null?void 0:e.readyState)===WebSocket.OPEN){const t={type:"subscribe",topic:`/market/ticker:${this.SPOT_PAIRS.join(",")}`,privateChannel:!1,response:!0};this.kucoinSpotWs.send(JSON.stringify(t))}}subscribeKucoinFutures(){var e;if(((e=this.kucoinFuturesWs)==null?void 0:e.readyState)===WebSocket.OPEN){const t={type:"subscribe",topic:`/contractMarket/ticker:${this.FUTURES_PAIRS.join(",")}`,privateChannel:!1,response:!0};this.kucoinFuturesWs.send(JSON.stringify(t))}}processKucoinSpotUpdate(e){const t=new ce(e.data.price),r=new ce(e.data.openPrice24h),s=t.minus(r).dividedBy(r),i={symbol:e.data.symbol,price:t,change24h:s,volume:new ce(e.data.size),high24h:new ce(e.data.bestAsk),low24h:new ce(e.data.bestBid),timestamp:e.data.timestamp,assetType:"spot",exchange:"kucoin"};this.notifySubscribers(i)}processKucoinFuturesUpdate(e){const t=new ce(e.data.price),r=new ce(e.data.openPrice24h),s=t.minus(r).dividedBy(r),i={symbol:e.data.symbol,price:t,change24h:s,volume:new ce(e.data.size),high24h:new ce(e.data.bestAsk),low24h:new ce(e.data.bestBid),timestamp:e.data.timestamp,assetType:"futures",exchange:"kucoin"};this.notifySubscribers(i)}handleReconnect(e){if(this.reconnectAttempts<this.maxReconnectAttempts){this.reconnectAttempts++;const t=this.calculateBackoff(this.reconnectAttempts);console.log(`Attempting ${e} reconnection ${this.reconnectAttempts}/${this.maxReconnectAttempts} in ${t}ms`),setTimeout(()=>{switch(e){case"kucoin-spot":this.connectKucoinSpot();break;case"kucoin-futures":this.connectKucoinFutures();break;case"bitget-spot":this.connectBitgetSpot();break;case"bitget-futures":this.connectBitgetFutures();break}},t)}else console.error(`Max ${e} reconnection attempts reached`),this.notifySubscribersOfState("failed",e),setTimeout(()=>{this.reconnectAttempts=0,this.handleReconnect(e)},6e4)}calculateBackoff(e){const t=this.reconnectDelay,s=Math.min(t*Math.pow(2,e),3e4),i=s*.2*(Math.random()*2-1);return Math.floor(s+i)}notifySubscribersOfState(e,t,r){const s={symbol:`SYSTEM_${t.toUpperCase()}`,price:new ce(0),change24h:new ce(0),volume:new ce(0),high24h:new ce(0),low24h:new ce(0),timestamp:Date.now(),assetType:"spot",exchange:"kucoin",error:`${e}${r?": "+r:""}`};this.notifySubscribers(s)}notifySubscribers(e){this.subscribers.forEach(t=>{try{t(e)}catch(r){console.error("Error in price update subscriber:",r)}})}onPriceUpdate(e){return this.subscribers.push(e),()=>{this.subscribers=this.subscribers.filter(t=>t!==e)}}disconnect(){this.kucoinSpotWs&&(this.kucoinSpotWs.close(),this.kucoinSpotWs=null),this.kucoinFuturesWs&&(this.kucoinFuturesWs.close(),this.kucoinFuturesWs=null),this.bitgetSpotWs&&(this.bitgetSpotWs.close(),this.bitgetSpotWs=null),this.bitgetFuturesWs&&(this.bitgetFuturesWs.close(),this.bitgetFuturesWs=null),this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null),this.subscribers=[]}getAvailableSymbols(){return{spot:this.SPOT_PAIRS,futures:this.FUTURES_PAIRS}}}const Aj=new D1;function M1(){const[n,e]=se.useState({});return se.useEffect(()=>{const t=Aj.onPriceUpdate(r=>{e(s=>({...s,[r.symbol]:{price:r.price,change24h:r.change24h}}))});return()=>t()},[]),n}function Rj({selectedAsset:n,onAssetChange:e}){const[t,r]=se.useState("tradingview"),[s,i]=se.useState(!1),[o,l]=se.useState("crypto"),u=M1(),d=(x=>{const R=x.replace("/","").toUpperCase();return u[R]})(n),g=[{id:"tradingview",name:"TradingView",icon:m.jsx(_h,{className:"w-4 h-4"})},{id:"trendspider",name:"TrendSpider",icon:m.jsx(Ui,{className:"w-4 h-4"})},{id:"tradeideas",name:"Trade Ideas",icon:m.jsx(ri,{className:"w-4 h-4"})}],v=[{id:"crypto",name:"Crypto"},{id:"forex",name:"Forex"},{id:"commodity",name:"Commodities"}],_=()=>{switch(o){case"crypto":return["BTC/USDT","ETH/USDT","SOL/USDT","BNB/USDT","ADA/USDT"];case"forex":return["EUR/USD","GBP/USD","USD/JPY","USD/CHF","AUD/USD","USD/CAD","NZD/USD","EUR/GBP"];case"commodity":return["XAU/USD","XAG/USD","WTI/USD","BCO/USD","NATGAS","COPPER","PLATINUM","PALLADIUM"];default:return[]}},E=()=>{const x={symbol:n.replace("/",""),theme:"dark"};switch(t){case"trendspider":return m.jsx(H2,{...x});case"tradeideas":return m.jsx(K2,{...x});default:return m.jsx(jg,{...x})}};return m.jsxs("div",{className:"lg:col-span-2 bg-gray-900 rounded-lg p-6",children:[m.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between mb-6 space-y-4 md:space-y-0",children:[m.jsxs("div",{className:"flex items-center space-x-4",children:[m.jsx("select",{value:o,onChange:x=>l(x.target.value),className:"bg-gray-800 border border-gray-700 rounded-lg px-4 py-2",children:v.map(x=>m.jsx("option",{value:x.id,children:x.name},x.id))}),m.jsx("select",{value:n,onChange:x=>e(x.target.value),className:"bg-gray-800 border border-gray-700 rounded-lg px-4 py-2",children:_().map(x=>m.jsx("option",{value:x,children:x},x))}),m.jsxs("span",{className:"text-2xl font-bold",children:["$",(d==null?void 0:d.price.toFixed(2))||"-.--"]}),m.jsxs("span",{className:`${d!=null&&d.change24h.isPositive()?"text-green-500":"text-red-500"}`,children:[d==null?void 0:d.change24h.toFixed(2),"%"]})]}),m.jsxs("div",{className:"flex items-center space-x-2 w-full md:w-auto",children:[m.jsx("div",{className:"flex items-center space-x-2 flex-grow md:flex-grow-0",children:g.map(x=>m.jsxs("button",{onClick:()=>r(x.id),className:`flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ${t===x.id?"bg-blue-500 text-white":"bg-gray-800 hover:bg-gray-700"}`,children:[x.icon,m.jsx("span",{className:"hidden md:inline",children:x.name})]},x.id))}),m.jsxs("div",{className:"relative",children:[m.jsxs("button",{onClick:()=>i(!s),className:"p-2 bg-gray-800 rounded-lg hover:bg-gray-700 flex items-center",children:[m.jsx(Ng,{className:"w-4 h-4 mr-2"}),m.jsx(D2,{className:"w-4 h-4"})]}),s&&m.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-gray-800 rounded-lg shadow-lg py-2 z-10",children:[m.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-700",children:"1 Minute"}),m.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-700",children:"5 Minutes"}),m.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-700",children:"15 Minutes"}),m.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-700",children:"1 Hour"}),m.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-700",children:"4 Hours"}),m.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-700",children:"1 Day"})]})]})]})]}),m.jsx("div",{className:"h-[600px] rounded-lg overflow-hidden border border-gray-800",children:E()}),m.jsx("div",{className:"grid grid-cols-4 gap-4 mt-4",children:["Volume","RSI","MACD","Bollinger"].map(x=>m.jsxs("div",{className:"bg-gray-800 p-3 rounded-lg",children:[m.jsx("h4",{className:"text-sm text-gray-400 mb-1",children:x}),m.jsx("div",{className:"h-[60px] border-b border-gray-700"})]},x))})]})}class Yg{constructor(){we(this,"windowSize");we(this,"state");we(this,"priceHistory");we(this,"volatilityThreshold");we(this,"atrPeriod");we(this,"atrMultiplierTP");we(this,"atrMultiplierSL");this.windowSize=20,this.atrPeriod=14,this.atrMultiplierTP=1.5,this.atrMultiplierSL=1,this.volatilityThreshold=.02,this.priceHistory=[],this.state={enabled:!0,volatilityScore:0,performanceScore:0,returns:[]}}calculateATR(e){if(e.length<2)return new ce(0);const t=[];for(let r=1;r<e.length;r++){const s=e[r].minus(e[r-1]).abs();t.push(s)}return t.reduce((r,s)=>r.plus(s),new ce(0)).dividedBy(t.length)}calculateVolatility(e){if(e.length<2)return 0;const t=[];for(let i=1;i<e.length;i++)t.push(e[i].minus(e[i-1]).dividedBy(e[i-1]).toNumber());const r=t.reduce((i,o)=>i+o,0)/t.length,s=t.map(i=>Math.pow(i-r,2)).reduce((i,o)=>i+o,0)/t.length;return Math.sqrt(s)}calculateSharpe(e){if(e.length<2)return new ce(0);const t=e.reduce((o,l)=>o.plus(l),new ce(0)).dividedBy(e.length),r=new ce(.02).dividedBy(252),i=e.map(o=>o.minus(t).pow(2)).reduce((o,l)=>o.plus(l),new ce(0)).dividedBy(e.length).sqrt();return i.isZero()?new ce(0):t.minus(r).dividedBy(i).times(Math.sqrt(252))}calculatePerformanceMetrics(){const e=this.state.returns,t=e.filter(u=>u.greaterThan(0)),r=e.filter(u=>u.lessThanOrEqualTo(0)),s=new ce(t.length).dividedBy(e.length),i=t.reduce((u,h)=>u.plus(h),new ce(0)),o=r.reduce((u,h)=>u.plus(h.abs()),new ce(0)),l=o.isZero()?new ce(0):i.dividedBy(o);return{sharpe:this.calculateSharpe(e),winRate:s,profitFactor:l}}calculateTargetLevels(e,t,r){const s=e,i=t.times(this.atrMultiplierTP),o=r==="BUY"?s.plus(i):s.minus(i),l=r==="BUY"?s.minus(t.times(this.atrMultiplierSL)):s.plus(t.times(this.atrMultiplierSL)),u=r==="BUY"?o.minus(s).dividedBy(s.minus(l)):s.minus(o).dividedBy(l.minus(s));return{entry:s,takeProfit:o,stopLoss:l,riskRewardRatio:u}}updateState(e){this.priceHistory.push(e),this.priceHistory.length>this.windowSize&&this.priceHistory.shift();const t=this.calculateVolatility(this.priceHistory);if(this.state.volatilityScore=t,this.state.enabled=t<=this.volatilityThreshold,this.state.returns.length>0){const{sharpe:r}=this.calculatePerformanceMetrics();this.state.performanceScore=r.toNumber()}}}class Ij extends Yg{constructor(t=20,r=2){super();we(this,"deviationThreshold");this.windowSize=t,this.deviationThreshold=r}calculateSMA(t){return t.reduce((r,s)=>r.plus(s),new ce(0)).dividedBy(t.length)}calculateStandardDeviation(t,r){const s=t.map(o=>o.minus(r).pow(2));return this.calculateSMA(s).sqrt()}analyze(t){if(this.updateState(t.price),!this.state.enabled||this.priceHistory.length<this.windowSize)return null;const r=this.calculateSMA(this.priceHistory),s=this.calculateStandardDeviation(this.priceHistory,r),i=t.price.minus(r).dividedBy(s),o=this.calculateATR(this.priceHistory);let l=null;if(i.abs().greaterThan(this.deviationThreshold)){const u=i.isNegative()?"BUY":"SELL",h=this.calculateTargetLevels(t.price,o,u),d=this.calculatePerformanceMetrics();l={symbol:t.symbol,type:u,confidence:Math.min(Math.abs(i.toNumber())/3,1),price:t.price,timestamp:Date.now(),strategy:"Mean Reversion",metadata:{sma:r.toNumber(),stdDev:s.toNumber(),zScore:i.toNumber(),volatilityScore:this.state.volatilityScore,performanceScore:this.state.performanceScore},targets:h,performance:d}}return l}}class Pj extends Yg{constructor(t=10,r=30){super();we(this,"shortPeriod");we(this,"longPeriod");this.shortPeriod=t,this.longPeriod=r,this.volatilityThreshold=.015}calculateEMA(t,r){const s=new ce(2).dividedBy(r+1);let i=t[0];for(let o=1;o<t.length;o++)i=t[o].times(s).plus(i.times(new ce(1).minus(s)));return i}analyze(t){if(this.updateState(t.price),this.state.volatilityScore<this.volatilityThreshold||this.priceHistory.length<this.longPeriod)return null;const r=this.calculateEMA(this.priceHistory.slice(-this.shortPeriod),this.shortPeriod),s=this.calculateEMA(this.priceHistory,this.longPeriod),i=r.minus(s),o=this.calculateATR(this.priceHistory);let l=null;if(!i.isZero()){const u=i.isPositive()?"BUY":"SELL",h=i.abs().dividedBy(s),d=this.calculateTargetLevels(t.price,o,u),g=this.calculatePerformanceMetrics();l={symbol:t.symbol,type:u,confidence:Math.min(h.toNumber()*10,1),price:t.price,timestamp:Date.now(),strategy:"Trend Following",metadata:{shortEMA:r.toNumber(),longEMA:s.toNumber(),difference:i.toNumber(),volatilityScore:this.state.volatilityScore,performanceScore:this.state.performanceScore},targets:d,performance:g}}return l}}class Cj extends Yg{constructor(t=20,r=2.5){super();we(this,"volatilityMultiplier");this.windowSize=t,this.volatilityMultiplier=r}analyze(t){if(this.updateState(t.price),this.priceHistory.length<this.windowSize)return null;const r=this.calculateATR(this.priceHistory),s=this.priceHistory[this.priceHistory.length-2],i=t.price.minus(s).abs();let o=null;if(i.greaterThan(r.times(this.volatilityMultiplier))){const l=t.price.greaterThan(s)?"BUY":"SELL",u=this.calculateTargetLevels(t.price,r,l),h=this.calculatePerformanceMetrics();o={symbol:t.symbol,type:l,confidence:Math.min(i.dividedBy(r).toNumber()/5,1),price:t.price,timestamp:Date.now(),strategy:"Breakout Detection",metadata:{atr:r.toNumber(),priceChange:i.toNumber(),threshold:r.times(this.volatilityMultiplier).toNumber(),volatilityScore:this.state.volatilityScore,performanceScore:this.state.performanceScore},targets:u,performance:h}}return o}}const Nj=new D1,Oj=new Ij,kj=new Pj,jj=new Cj;function Dj(){const[n,e]=se.useState([]);return se.useEffect(()=>{const t=Nj.onPriceUpdate(r=>{const s=[],i=Oj.analyze(r),o=kj.analyze(r),l=jj.analyze(r);i&&s.push(i),o&&s.push(o),l&&s.push(l),s.length>0&&e(u=>[...s,...u].slice(0,50))});return()=>t()},[]),n}function Mj(){const n=Dj(),e=[{name:"Mean Reversion",type:"Statistical",performance:"+8.7%",status:"Active",risk:"Medium",allocation:"40%",icon:m.jsx(fl,{className:"w-5 h-5 text-purple-500"}),description:"Identifies and trades price deviations from historical means"},{name:"Trend Following",type:"Machine Learning",performance:"+12.3%",status:"Active",risk:"High",allocation:"30%",icon:m.jsx(Ui,{className:"w-5 h-5 text-blue-500"}),description:"Captures momentum using adaptive moving averages"},{name:"Breakout Detection",type:"AI-Powered",performance:"+5.2%",status:"Active",risk:"Low",allocation:"30%",icon:m.jsx(ri,{className:"w-5 h-5 text-green-500"}),description:"Detects and trades significant price movements"}];return m.jsxs("div",{className:"bg-gray-900 rounded-lg p-6",children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsx("h2",{className:"text-xl font-bold",children:"Trading Algorithms"}),m.jsxs("select",{className:"bg-gray-800 border border-gray-700 rounded-lg px-3 py-1 text-sm",children:[m.jsx("option",{children:"Sort by Performance"}),m.jsx("option",{children:"Sort by Risk"}),m.jsx("option",{children:"Sort by Allocation"})]})]}),m.jsx("div",{className:"space-y-4",children:e.map((t,r)=>m.jsxs("div",{className:"border border-gray-800 rounded-lg p-4 hover:border-gray-700 transition-colors",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsxs("div",{className:"flex items-center space-x-2",children:[t.icon,m.jsx("h3",{className:"font-semibold",children:t.name})]}),m.jsx("span",{className:"text-green-500",children:t.performance})]}),m.jsx("p",{className:"text-sm text-gray-400 mb-3",children:t.description}),m.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-3 text-sm",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-500",children:"Type"}),m.jsx("p",{className:"text-gray-300",children:t.type})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-500",children:"Risk Level"}),m.jsx("p",{className:"text-gray-300",children:t.risk})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-500",children:"Allocation"}),m.jsx("p",{className:"text-gray-300",children:t.allocation})]})]}),m.jsxs("div",{className:"flex items-center justify-between mt-4",children:[m.jsx("span",{className:"px-2 py-1 bg-green-500/20 text-green-500 rounded-full text-sm",children:t.status}),m.jsx("button",{className:"text-sm text-blue-500 hover:text-blue-400",children:"Configure"})]})]},r))}),n.length>0&&m.jsxs("div",{className:"mt-6",children:[m.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Recent Signals"}),m.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:n.map((t,r)=>m.jsxs("div",{className:"flex items-center justify-between bg-gray-800 p-2 rounded-lg text-sm",children:[m.jsxs("div",{className:"flex items-center space-x-3",children:[m.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${t.type==="BUY"?"bg-green-500/20 text-green-500":"bg-red-500/20 text-red-500"}`,children:t.type}),m.jsx("span",{children:t.symbol})]}),m.jsxs("div",{className:"flex items-center space-x-4",children:[m.jsx("span",{className:"text-gray-400",children:t.strategy}),m.jsxs("span",{children:["$",t.price.toFixed(2)]}),m.jsxs("span",{className:"text-gray-400",children:[Math.round(t.confidence*100),"%"]})]})]},r))})]}),m.jsx("button",{className:"w-full mt-6 bg-blue-500 hover:bg-blue-600 py-3 rounded-lg font-semibold transition-colors",children:"Deploy New Algorithm"})]})}const Xg=kg((n,e)=>({portfolios:[],isLoading:!1,error:null,loadPortfolios:async()=>{try{n({isLoading:!0,error:null});const{data:t,error:r}=await Xt.from("portfolios").select("*").order("created_at",{ascending:!1});if(r)throw r;const s=await Promise.all(t.map(async i=>{const{data:o,error:l}=await Xt.from("positions").select("*").eq("portfolio_id",i.id);if(l)throw l;const u=o.map(g=>({...g,quantity:new ce(g.quantity),entry_price:new ce(g.entry_price),current_price:new ce(g.current_price),pnl:new ce(g.pnl)})),h=u.reduce((g,v)=>g.plus(v.quantity.times(v.current_price)),new ce(0)),d=u.reduce((g,v)=>g.plus(v.pnl),new ce(0));return{...i,positions:u,total_value:h,total_pnl:d}}));n({portfolios:s})}catch(t){n({error:t.message})}finally{n({isLoading:!1})}},createPortfolio:async(t,r)=>{try{n({isLoading:!0,error:null});const{error:s}=await Xt.from("portfolios").insert({name:t,description:r});if(s)throw s;await e().loadPortfolios()}catch(s){n({error:s.message})}finally{n({isLoading:!1})}},updatePortfolio:async(t,r)=>{try{n({isLoading:!0,error:null});const{error:s}=await Xt.from("portfolios").update(r).eq("id",t);if(s)throw s;await e().loadPortfolios()}catch(s){n({error:s.message})}finally{n({isLoading:!1})}},deletePortfolio:async t=>{try{n({isLoading:!0,error:null});const{error:r}=await Xt.from("portfolios").delete().eq("id",t);if(r)throw r;await e().loadPortfolios()}catch(r){n({error:r.message})}finally{n({isLoading:!1})}},addPosition:async(t,r)=>{try{n({isLoading:!0,error:null});const{error:s}=await Xt.from("positions").insert({portfolio_id:t,...r,quantity:r.quantity.toString(),entry_price:r.entry_price.toString(),current_price:r.current_price.toString(),pnl:r.pnl.toString()});if(s)throw s;await e().loadPortfolios()}catch(s){n({error:s.message})}finally{n({isLoading:!1})}},updatePosition:async(t,r)=>{var s,i,o,l;try{n({isLoading:!0,error:null});const{error:u}=await Xt.from("positions").update({...r,quantity:(s=r.quantity)==null?void 0:s.toString(),entry_price:(i=r.entry_price)==null?void 0:i.toString(),current_price:(o=r.current_price)==null?void 0:o.toString(),pnl:(l=r.pnl)==null?void 0:l.toString()}).eq("id",t);if(u)throw u;await e().loadPortfolios()}catch(u){n({error:u.message})}finally{n({isLoading:!1})}},deletePosition:async t=>{try{n({isLoading:!0,error:null});const{error:r}=await Xt.from("positions").delete().eq("id",t);if(r)throw r;await e().loadPortfolios()}catch(r){n({error:r.message})}finally{n({isLoading:!1})}}}));function Lj(){const{portfolios:n,isLoading:e,error:t,loadPortfolios:r,createPortfolio:s,updatePortfolio:i,deletePortfolio:o,addPosition:l,updatePosition:u,deletePosition:h}=Xg(),[d,g]=se.useState(""),[v,_]=se.useState(""),[E,x]=se.useState(null),[R,I]=se.useState({symbol:"",quantity:"",entry_price:""});se.useEffect(()=>{r()},[r]);const F=async $=>{$.preventDefault(),d.trim()&&(await s(d,v),g(""),_(""))},V=async $=>{if($.preventDefault(),!E||!R.symbol||!R.quantity||!R.entry_price)return;const W={symbol:R.symbol.toUpperCase(),quantity:new ce(R.quantity),entry_price:new ce(R.entry_price),current_price:new ce(R.entry_price),pnl:new ce(0)};await l(E,W),I({symbol:"",quantity:"",entry_price:""})};return m.jsx("div",{className:"p-6 bg-gray-900 rounded-lg",children:m.jsxs("div",{className:"mb-8",children:[m.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Portfolios"}),m.jsx("form",{onSubmit:F,className:"mb-6",children:m.jsxs("div",{className:"flex gap-4",children:[m.jsx("input",{type:"text",placeholder:"Portfolio Name",value:d,onChange:$=>g($.target.value),className:"flex-1 bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white"}),m.jsx("input",{type:"text",placeholder:"Description (optional)",value:v,onChange:$=>_($.target.value),className:"flex-1 bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white"}),m.jsxs("button",{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center",children:[m.jsx(Oy,{className:"w-5 h-5 mr-2"}),"Create Portfolio"]})]})}),t&&m.jsx("div",{className:"text-red-500 mb-4",children:t}),m.jsx("div",{className:"grid grid-cols-1 gap-6",children:n.map($=>m.jsxs("div",{className:"border border-gray-800 rounded-lg p-6",children:[m.jsxs("div",{className:"flex items-center justify-between mb-4",children:[m.jsx("h3",{className:"text-xl font-semibold",children:$.name}),m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx("button",{onClick:()=>x($.id),className:"text-blue-500 hover:text-blue-400",children:m.jsx(M2,{className:"w-5 h-5"})}),m.jsx("button",{onClick:()=>o($.id),className:"text-red-500 hover:text-red-400",children:m.jsx(ky,{className:"w-5 h-5"})})]})]}),$.description&&m.jsx("p",{className:"text-gray-400 mb-4",children:$.description}),m.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[m.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg",children:[m.jsx("p",{className:"text-gray-400",children:"Total Value"}),m.jsxs("p",{className:"text-2xl font-bold",children:["$",$.total_value.toFixed(2)]})]}),m.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg",children:[m.jsx("p",{className:"text-gray-400",children:"Total P&L"}),m.jsxs("p",{className:`text-2xl font-bold ${$.total_pnl.isPositive()?"text-green-500":"text-red-500"}`,children:["$",$.total_pnl.toFixed(2)]})]})]}),E===$.id&&m.jsx("form",{onSubmit:V,className:"mb-4",children:m.jsxs("div",{className:"flex gap-4",children:[m.jsx("input",{type:"text",placeholder:"Symbol",value:R.symbol,onChange:W=>I({...R,symbol:W.target.value}),className:"flex-1 bg-gray-800 border border-gray-700 rounded-lg px-4 py-2"}),m.jsx("input",{type:"number",step:"any",placeholder:"Quantity",value:R.quantity,onChange:W=>I({...R,quantity:W.target.value}),className:"flex-1 bg-gray-800 border border-gray-700 rounded-lg px-4 py-2"}),m.jsx("input",{type:"number",step:"any",placeholder:"Entry Price",value:R.entry_price,onChange:W=>I({...R,entry_price:W.target.value}),className:"flex-1 bg-gray-800 border border-gray-700 rounded-lg px-4 py-2"}),m.jsxs("button",{type:"submit",className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center",children:[m.jsx(Oy,{className:"w-5 h-5 mr-2"}),"Add Position"]})]})}),m.jsx("div",{className:"overflow-x-auto",children:m.jsxs("table",{className:"w-full",children:[m.jsx("thead",{children:m.jsxs("tr",{className:"text-left",children:[m.jsx("th",{className:"pb-2 text-gray-400",children:"Symbol"}),m.jsx("th",{className:"pb-2 text-gray-400",children:"Quantity"}),m.jsx("th",{className:"pb-2 text-gray-400",children:"Entry Price"}),m.jsx("th",{className:"pb-2 text-gray-400",children:"Current Price"}),m.jsx("th",{className:"pb-2 text-gray-400",children:"P&L"}),m.jsx("th",{className:"pb-2 text-gray-400",children:"Actions"})]})}),m.jsx("tbody",{children:$.positions.map(W=>m.jsxs("tr",{className:"border-t border-gray-800",children:[m.jsx("td",{className:"py-2",children:W.symbol}),m.jsx("td",{className:"py-2",children:W.quantity.toString()}),m.jsxs("td",{className:"py-2",children:["$",W.entry_price.toFixed(2)]}),m.jsxs("td",{className:"py-2",children:["$",W.current_price.toFixed(2)]}),m.jsxs("td",{className:`py-2 ${W.pnl.isPositive()?"text-green-500":"text-red-500"}`,children:["$",W.pnl.toFixed(2)]}),m.jsx("td",{className:"py-2",children:m.jsx("button",{onClick:()=>h(W.id),className:"text-red-500 hover:text-red-400",children:m.jsx(ky,{className:"w-4 h-4"})})})]},W.id))})]})})]},$.id))})]})})}class Vj{constructor(e){we(this,"positions",new Map);we(this,"priceHistory",new Map);we(this,"volatilityHistory",new Map);we(this,"correlationMatrix",null);we(this,"riskLimits");we(this,"confidenceLevel",.95);we(this,"riskFreeRate",new ce(.02));we(this,"historicalWindow",252);we(this,"stressScenarios",{"Market Crash":-.2,"Currency Crisis":-.15,"Political Event":-.1,"Natural Disaster":-.12,"Tech Bubble":-.25,"Interest Rate Hike":-.08});this.riskLimits={maxPositionSize:new ce(.2),maxPortfolioExposure:new ce(.8),maxDrawdown:new ce(.15),stopLossThreshold:new ce(.05),volatilityThreshold:new ce(.3),...e}}async calculateRiskMetrics(){const e=this.calculatePortfolioValue(),t=this.calculateHistoricalReturns(),r=this.calculateVolatility(t),s=this.calculateVaR(t,e),i=this.calculateCVaR(t,e),o=this.calculateSharpeRatio(t,r),l=this.calculateMaxDrawdown(),u=await this.calculatePortfolioBeta(),h=this.calculateCorrelations(),d=this.calculateKellyFraction(t),g=this.runStressTests(e);return{var:s,cvar:i,sharpeRatio:o,maxDrawdown:l,beta:u,correlations:h,kellyFraction:d,volatility:new ce(r),stressTestResults:g}}validatePosition(e,t,r){const s=[],i=this.calculatePortfolioValue(),l=t.times(r).dividedBy(i);l.greaterThan(this.riskLimits.maxPositionSize)&&s.push("Position size exceeds maximum allowed exposure"),this.calculateTotalExposure().plus(l).greaterThan(this.riskLimits.maxPortfolioExposure)&&s.push("Total portfolio exposure would exceed limit"),this.getAssetVolatility(e).greaterThan(this.riskLimits.volatilityThreshold)&&s.push("Asset volatility exceeds threshold");const d=this.checkCorrelationRisk(e);return d.isHigh&&s.push(`High correlation with existing positions: ${d.correlatedAssets.join(", ")}`),{isValid:s.length===0,reasons:s}}monitorPositions(){for(const[e,t]of this.positions.entries()){const r=t.current_price,s=t.entry_price,i=r.minus(s).dividedBy(s);i.lessThan(this.riskLimits.stopLossThreshold.negated())&&this.triggerStopLoss(e,t),i.lessThan(this.riskLimits.maxDrawdown.negated())&&this.triggerDrawdownAlert(e,t,i)}}calculatePortfolioValue(){return Array.from(this.positions.values()).reduce((e,t)=>e.plus(t.quantity.times(t.current_price)),new ce(0))}calculateHistoricalReturns(){const e=[],t=Array.from(this.positions.keys());for(let r=1;r<this.historicalWindow;r++){let s=0;for(const i of t){const o=this.priceHistory.get(i);if(o&&o.length>r){const l=this.positions.get(i),u=l.quantity.times(l.current_price).dividedBy(this.calculatePortfolioValue()).toNumber(),h=o[r].minus(o[r-1]).dividedBy(o[r-1]).toNumber();s+=u*h}}e.push(s)}return e}calculateVolatility(e){const t=e.reduce((s,i)=>s+i,0)/e.length,r=e.map(s=>Math.pow(s-t,2)).reduce((s,i)=>s+i,0)/(e.length-1);return Math.sqrt(r*252)}calculateVaR(e,t){const r=e.sort((o,l)=>o-l),s=Math.floor(e.length*(1-this.confidenceLevel)),i=r[s];return t.times(new ce(i))}calculateCVaR(e,t){const r=e.sort((l,u)=>l-u),s=Math.floor(e.length*(1-this.confidenceLevel)),i=r.slice(0,s),o=i.reduce((l,u)=>l+u,0)/i.length;return t.times(new ce(o))}calculateSharpeRatio(e,t){const r=e.reduce((s,i)=>s+i,0)/e.length;return new ce(r-this.riskFreeRate.toNumber()).dividedBy(new ce(t))}calculateMaxDrawdown(){let e=new ce(0);const t=[];for(let s=0;s<this.historicalWindow;s++){let i=new ce(0);for(const[o,l]of this.positions.entries()){const u=this.priceHistory.get(o);u&&u.length>s&&(i=i.plus(l.quantity.times(u[s])))}t.push(i)}let r=t[0];for(const s of t)if(s.greaterThan(r))r=s;else{const i=r.minus(s).dividedBy(r);i.greaterThan(e)&&(e=i)}return e}async calculatePortfolioBeta(){const e=await this.fetchMarketReturns(),t=this.calculateHistoricalReturns(),r=this.calculateCovariance(t,e),s=this.calculateVariance(e);return new ce(r).dividedBy(new ce(s))}calculateCorrelations(){const e={},t=Array.from(this.positions.keys());for(let r=0;r<t.length;r++)for(let s=r+1;s<t.length;s++){const i=t[r],o=t[s],l=this.calculateAssetReturns(i),u=this.calculateAssetReturns(o),h=this.calculateCorrelation(l,u);e[`${i}_${o}`]=h}return e}calculateKellyFraction(e){const t=e.filter(l=>l>0),r=e.filter(l=>l<0),s=t.length/e.length,i=t.reduce((l,u)=>l+u,0)/t.length,o=Math.abs(r.reduce((l,u)=>l+u,0)/r.length);return new ce(s).times(new ce(i)).dividedBy(new ce(o)).minus(new ce(1).minus(new ce(s)))}runStressTests(e){return Object.entries(this.stressScenarios).map(([t,r])=>{const s=e.times(new ce(r)),i=this.identifyImpactedAssets(t);return{scenario:t,potentialLoss:s,probabilityOfOccurrence:this.calculateScenarioProbability(t),impactedAssets:i}})}calculateTotalExposure(){return Array.from(this.positions.values()).reduce((e,t)=>e.plus(t.quantity.times(t.current_price)),new ce(0)).dividedBy(this.calculatePortfolioValue())}getAssetVolatility(e){const t=this.volatilityHistory.get(e);return!t||t.length===0?new ce(0):t[t.length-1]}checkCorrelationRisk(e){const t=[];for(const[s]of this.positions.entries())if(s!==e){const i=this.calculatePairwiseCorrelation(e,s);Math.abs(i)>.7&&t.push(s)}return{isHigh:t.length>0,correlatedAssets:t}}calculatePairwiseCorrelation(e,t){const r=this.calculateAssetReturns(e),s=this.calculateAssetReturns(t);return this.calculateCorrelation(r,s)}calculateAssetReturns(e){const t=this.priceHistory.get(e);if(!t||t.length<2)return[];const r=[];for(let s=1;s<t.length;s++)r.push(t[s].minus(t[s-1]).dividedBy(t[s-1]).toNumber());return r}calculateCorrelation(e,t){const r=this.calculateCovariance(e,t),s=Math.sqrt(this.calculateVariance(e)),i=Math.sqrt(this.calculateVariance(t));return r/(s*i)}calculateCovariance(e,t){const r=e.reduce((i,o)=>i+o,0)/e.length,s=t.reduce((i,o)=>i+o,0)/t.length;return e.reduce((i,o,l)=>i+(o-r)*(t[l]-s),0)/(e.length-1)}calculateVariance(e){const t=e.reduce((r,s)=>r+s,0)/e.length;return e.reduce((r,s)=>r+Math.pow(s-t,2),0)/(e.length-1)}async fetchMarketReturns(){return Array(this.historicalWindow).fill(0).map(()=>(Math.random()-.5)*.02)}identifyImpactedAssets(e){const t=[],r=Array.from(this.positions.entries());switch(e){case"Market Crash":t.push(...r.map(([s])=>s));break;case"Currency Crisis":t.push(...r.filter(([s])=>s.includes("/")).map(([s])=>s));break;case"Tech Bubble":t.push(...r.filter(([s])=>["BTC","ETH","SOL"].includes(s)).map(([s])=>s));break}return t}calculateScenarioProbability(e){const t={"Market Crash":.05,"Currency Crisis":.08,"Political Event":.12,"Natural Disaster":.07,"Tech Bubble":.1,"Interest Rate Hike":.15};return new ce(t[e]||.05)}triggerStopLoss(e,t){console.warn(`Stop loss triggered for ${e} at ${t.current_price}`)}triggerDrawdownAlert(e,t,r){console.warn(`Drawdown alert for ${e}: ${r.times(100).toFixed(2)}%`)}updatePosition(e,t){this.positions.set(e,t)}updatePriceHistory(e,t){this.priceHistory.has(e)||this.priceHistory.set(e,[]);const r=this.priceHistory.get(e);r.push(t),r.length>this.historicalWindow&&r.shift(),this.volatilityHistory.has(e)||this.volatilityHistory.set(e,[]);const s=this.volatilityHistory.get(e);if(r.length>1){const i=this.calculateAssetReturns(e),o=Math.sqrt(this.calculateVariance(i)*252);s.push(new ce(o)),s.length>this.historicalWindow&&s.shift()}}setRiskLimits(e){this.riskLimits={...this.riskLimits,...e}}}const bp=new Vj;function Fj(){const{portfolios:n}=Xg(),[e,t]=se.useState(null),[r,s]=se.useState(!0);se.useEffect(()=>{i()},[n]);const i=async()=>{s(!0);try{n.forEach(l=>{l.positions.forEach(u=>{bp.updatePosition(u.symbol,u),bp.updatePriceHistory(u.symbol,u.current_price)})});const o=await bp.calculateRiskMetrics();t(o)}catch(o){console.error("Error calculating risk metrics:",o)}finally{s(!1)}};return r?m.jsx("div",{className:"p-6 bg-gray-900 rounded-lg",children:m.jsxs("div",{className:"animate-pulse",children:[m.jsx("div",{className:"h-4 bg-gray-800 rounded w-1/4 mb-4"}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsx("div",{className:"h-24 bg-gray-800 rounded"}),m.jsx("div",{className:"h-24 bg-gray-800 rounded"})]})]})}):e?m.jsxs("div",{className:"p-6 bg-gray-900 rounded-lg",children:[m.jsxs("h2",{className:"text-2xl font-bold mb-6 flex items-center",children:[m.jsx(L2,{className:"w-6 h-6 mr-2 text-blue-500"}),"Risk Management"]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[m.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsx("h3",{className:"text-gray-400",children:"Value at Risk (95%)"}),m.jsx(Og,{className:"w-5 h-5 text-yellow-500"})]}),m.jsxs("p",{className:"text-2xl font-bold",children:["$",Math.abs(e.var.toNumber()).toFixed(2)]}),m.jsx("p",{className:"text-sm text-gray-500",children:"Daily VaR"})]}),m.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsx("h3",{className:"text-gray-400",children:"Portfolio Beta"}),m.jsx(Fp,{className:"w-5 h-5 text-blue-500"})]}),m.jsx("p",{className:"text-2xl font-bold",children:e.beta.toFixed(2)}),m.jsx("p",{className:"text-sm text-gray-500",children:"Market Sensitivity"})]}),m.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsx("h3",{className:"text-gray-400",children:"Sharpe Ratio"}),m.jsx(ri,{className:"w-5 h-5 text-green-500"})]}),m.jsx("p",{className:"text-2xl font-bold",children:e.sharpeRatio.toFixed(2)}),m.jsx("p",{className:"text-sm text-gray-500",children:"Risk-Adjusted Returns"})]}),m.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsx("h3",{className:"text-gray-400",children:"Max Drawdown"}),m.jsx(Fp,{className:"w-5 h-5 text-red-500"})]}),m.jsxs("p",{className:"text-2xl font-bold",children:[e.maxDrawdown.times(100).toFixed(2),"%"]}),m.jsx("p",{className:"text-sm text-gray-500",children:"Historical Maximum Loss"})]})]}),m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[m.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[m.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Stress Test Scenarios"}),m.jsx("div",{className:"space-y-4",children:e.stressTestResults.map((o,l)=>m.jsxs("div",{className:"border-b border-gray-700 pb-4",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsx("span",{className:"text-gray-300",children:o.scenario}),m.jsxs("span",{className:"text-red-500",children:["-$",Math.abs(o.potentialLoss.toNumber()).toFixed(2)]})]}),m.jsxs("div",{className:"flex items-center justify-between text-sm",children:[m.jsxs("span",{className:"text-gray-500",children:["Probability: ",o.probabilityOfOccurrence.times(100).toFixed(1),"%"]}),m.jsxs("span",{className:"text-gray-500",children:[o.impactedAssets.length," assets affected"]})]})]},l))})]}),m.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[m.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Asset Correlations"}),m.jsx("div",{className:"space-y-4",children:Object.entries(e.correlations).map(([o,l],u)=>{const[h,d]=o.split("_"),g=l.toFixed(2),v=Math.abs(l)>.7;return m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("span",{className:"text-gray-300",children:[h," → ",d]}),m.jsx("span",{className:`${v?l>0?"text-red-500":"text-yellow-500":"text-green-500"}`,children:g})]},u)})})]})]})]}):m.jsx("div",{className:"p-6 bg-gray-900 rounded-lg",children:m.jsx("p",{className:"text-gray-400",children:"No risk metrics available"})})}function Su({name:n,value:e,baseValue:t,minValue:r,maxValue:s,adaptiveFactors:i,onChange:o}){const l=()=>{const h=Math.abs(e-t)/t;return h>.5?"text-red-500":h>.2?"text-yellow-500":"text-green-500"},u=()=>i.volatility&&i.volatility>.5?m.jsx(ri,{className:"w-4 h-4 text-blue-500"}):i.performance&&i.performance>.5?m.jsx(Ui,{className:"w-4 h-4 text-green-500"}):m.jsx(Ng,{className:"w-4 h-4 text-gray-500"});return m.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsxs("div",{className:"flex items-center space-x-2",children:[u(),m.jsx("span",{className:"font-medium",children:n})]}),m.jsxs("span",{className:`font-bold ${l()}`,children:[(e*100).toFixed(1),"%"]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("input",{type:"range",min:r*100,max:s*100,step:.1,value:e*100,onChange:h=>o(Number(h.target.value)/100),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"}),m.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400",children:[m.jsxs("span",{children:[(r*100).toFixed(1),"%"]}),m.jsxs("span",{children:["Base: ",(t*100).toFixed(1),"%"]}),m.jsxs("span",{children:[(s*100).toFixed(1),"%"]})]}),Object.entries(i).map(([h,d])=>m.jsxs("div",{className:"flex items-center justify-between text-sm",children:[m.jsx("span",{className:"text-gray-400",children:h}),m.jsxs("div",{className:"flex items-center space-x-1",children:[m.jsx("div",{className:"w-16 h-1 bg-gray-700 rounded-full overflow-hidden",children:m.jsx("div",{className:"h-full bg-blue-500 rounded-full",style:{width:`${d*100}%`}})}),m.jsxs("span",{className:"text-gray-400",children:[(d*100).toFixed(0),"%"]})]})]},h))]})]})}function Uj({volatility:n,trend:e,correlation:t,regime:r}){const s=()=>{switch(r){case"trending":return"text-green-500";case"mean_reverting":return"text-blue-500";case"neutral":return"text-yellow-500"}},i=()=>{switch(r){case"trending":return m.jsx(Ui,{className:"w-5 h-5"});case"mean_reverting":return m.jsx(Fp,{className:"w-5 h-5"});case"neutral":return m.jsx(ri,{className:"w-5 h-5"})}};return m.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[m.jsxs("div",{className:"flex items-center justify-between mb-4",children:[m.jsx("h3",{className:"text-lg font-semibold",children:"Market Regime"}),m.jsxs("div",{className:`flex items-center space-x-2 ${s()}`,children:[i(),m.jsx("span",{className:"capitalize",children:r.replace("_"," ")})]})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[m.jsx("span",{className:"text-gray-400",children:"Volatility"}),m.jsxs("span",{className:n>.5?"text-red-500":"text-green-500",children:[(n*100).toFixed(1),"%"]})]}),m.jsx("div",{className:"h-1 bg-gray-700 rounded-full overflow-hidden",children:m.jsx("div",{className:`h-full rounded-full ${n>.5?"bg-red-500":"bg-green-500"}`,style:{width:`${n*100}%`}})})]}),m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[m.jsx("span",{className:"text-gray-400",children:"Trend Strength"}),m.jsxs("span",{className:"text-blue-500",children:[(Math.abs(e)*100).toFixed(1),"%"]})]}),m.jsx("div",{className:"h-1 bg-gray-700 rounded-full overflow-hidden",children:m.jsx("div",{className:"h-full bg-blue-500 rounded-full",style:{width:`${Math.abs(e)*100}%`}})})]}),m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[m.jsx("span",{className:"text-gray-400",children:"Correlation"}),m.jsxs("span",{className:Math.abs(t)>.7?"text-yellow-500":"text-green-500",children:[(t*100).toFixed(1),"%"]})]}),m.jsx("div",{className:"h-1 bg-gray-700 rounded-full overflow-hidden",children:m.jsx("div",{className:`h-full rounded-full ${Math.abs(t)>.7?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.abs(t)*100}%`}})})]})]})]})}function $j({winRate:n,sharpeRatio:e,profitFactor:t,recentPnL:r}){const s=r.length>1?r[r.length-1]>r[r.length-2]:!0;return m.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[m.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[m.jsx(__,{className:"w-5 h-5 text-blue-500 mr-2"}),"Performance Metrics"]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{className:"bg-gray-900 rounded-lg p-3",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsx("span",{className:"text-gray-400",children:"Win Rate"}),m.jsx(ri,{className:"w-4 h-4 text-green-500"})]}),m.jsxs("span",{className:"text-2xl font-bold text-green-500",children:[(n*100).toFixed(1),"%"]})]}),m.jsxs("div",{className:"bg-gray-900 rounded-lg p-3",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsx("span",{className:"text-gray-400",children:"Sharpe Ratio"}),m.jsx(Ui,{className:"w-4 h-4 text-blue-500"})]}),m.jsx("span",{className:"text-2xl font-bold text-blue-500",children:e.toFixed(2)})]}),m.jsxs("div",{className:"bg-gray-900 rounded-lg p-3",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsx("span",{className:"text-gray-400",children:"Profit Factor"}),m.jsx(V2,{className:"w-4 h-4 text-yellow-500"})]}),m.jsx("span",{className:"text-2xl font-bold text-yellow-500",children:t.toFixed(2)})]}),m.jsxs("div",{className:"bg-gray-900 rounded-lg p-3",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsx("span",{className:"text-gray-400",children:"PnL Trend"}),m.jsx(Ui,{className:`w-4 h-4 ${s?"text-green-500":"text-red-500"}`})]}),m.jsx("span",{className:`text-2xl font-bold ${s?"text-green-500":"text-red-500"}`,children:s?"Positive":"Negative"})]})]}),m.jsxs("div",{className:"mt-4",children:[m.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[m.jsx("span",{className:"text-gray-400",children:"Recent PnL"}),m.jsxs("span",{className:s?"text-green-500":"text-red-500",children:["$",r[r.length-1].toFixed(2)]})]}),m.jsx("div",{className:"h-16 flex items-end space-x-1",children:r.map((i,o)=>m.jsx("div",{className:`w-full ${i>=0?"bg-green-500":"bg-red-500"} rounded-sm`,style:{height:`${Math.min(Math.abs(i)/Math.max(...r.map(Math.abs))*100,100)}%`}},o))})]})]})}const Jw=[{name:"Mean Reversion",description:"Trades price deviations from historical averages",icon:m.jsx(fl,{className:"w-5 h-5"}),defaultRisk:.5},{name:"Trend Following",description:"Follows established market trends",icon:m.jsx(Lu,{className:"w-5 h-5"}),defaultRisk:1},{name:"Breakout",description:"Captures significant price movements",icon:m.jsx(ri,{className:"w-5 h-5"}),defaultRisk:1.5}];function Bj(){const[n,e]=se.useState(Jw[0].name),[t,r]=se.useState(!1),[s,i]=se.useState(!0),{portfolios:o}=Xg(),[l,u]=se.useState(.02),[h,d]=se.useState(.03),[g,v]=se.useState(.7),[_,E]=se.useState(.1),[x,R]=se.useState({volatility:.15,trend:.65,correlation:.45,regime:"trending"}),[I,F]=se.useState({winRate:.65,sharpeRatio:1.8,profitFactor:1.5,recentPnL:[100,150,-50,200,180]}),V=o.reduce((W,X)=>W.plus(X.total_value),new ce(0)),$=()=>{const W={strategy:n,stopLoss:l,takeProfit:h,entryConfidence:g,positionSize:_,telegramAlerts:s};localStorage.setItem("autoTraderConfig",JSON.stringify(W))};return m.jsxs("div",{className:"bg-gray-900 rounded-lg p-6",children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsxs("h2",{className:"text-2xl font-bold flex items-center",children:[m.jsx(F2,{className:"w-6 h-6 text-blue-500 mr-2"}),"AutoTrader Dashboard"]}),m.jsxs("div",{className:"flex items-center space-x-4",children:[m.jsx("button",{onClick:$,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg flex items-center",children:"Save Config"}),m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx(U2,{className:`w-5 h-5 ${s?"text-blue-500":"text-gray-500"}`}),m.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[m.jsx("input",{type:"checkbox",className:"sr-only peer",checked:s,onChange:W=>i(W.target.checked)}),m.jsx("div",{className:"w-11 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})]})]}),m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[m.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Strategy Type"}),m.jsx("select",{value:n,onChange:W=>e(W.target.value),className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2",children:Jw.map(W=>m.jsx("option",{value:W.name,children:W.name},W.name))})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Available Balance"}),m.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg px-4 py-2",children:["$",V.toFixed(2)]})]})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsx(Su,{name:"Stop Loss",value:l,baseValue:.02,minValue:.01,maxValue:.05,adaptiveFactors:{volatility:.8,performance:.5,marketRegime:.3},onChange:u}),m.jsx(Su,{name:"Take Profit",value:h,baseValue:.03,minValue:.02,maxValue:.1,adaptiveFactors:{volatility:.7,performance:.6,marketRegime:.4},onChange:d})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsx(Su,{name:"Entry Confidence",value:g,baseValue:.7,minValue:.5,maxValue:.9,adaptiveFactors:{volatility:.5,performance:.8,marketRegime:.4},onChange:v}),m.jsx(Su,{name:"Position Size",value:_,baseValue:.1,minValue:.05,maxValue:.2,adaptiveFactors:{volatility:.9,performance:.6,marketRegime:.3},onChange:E})]})]}),m.jsxs("div",{className:"space-y-6",children:[m.jsx(Uj,{...x}),m.jsx($j,{...I})]})]}),m.jsxs("div",{className:"flex items-center justify-between bg-gray-800 p-4 rounded-lg mb-6",children:[m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx(Og,{className:`w-5 h-5 ${t?"text-green-500":"text-red-500"}`}),m.jsx("span",{className:"font-medium",children:t?"Trading Enabled":"Trading Disabled"})]}),m.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[m.jsx("input",{type:"checkbox",className:"sr-only peer",checked:t,onChange:W=>r(W.target.checked)}),m.jsx("div",{className:"w-14 h-7 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-green-600"})]})]}),m.jsxs("div",{className:"flex items-center justify-between mb-4",children:[m.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[m.jsx(ri,{className:"w-5 h-5 text-blue-500 mr-2"}),"Live Strategy Feed"]}),m.jsxs("div",{className:"flex items-center space-x-4",children:[m.jsxs("button",{className:"flex items-center space-x-2 text-gray-400 hover:text-white",children:[m.jsx($2,{className:"w-4 h-4"}),m.jsx("span",{children:"Trade History"})]}),m.jsxs("button",{className:"flex items-center space-x-2 text-gray-400 hover:text-white",children:[m.jsx(B2,{className:"w-4 h-4"}),m.jsx("span",{children:"Strategy Info"})]})]})]}),m.jsx("div",{className:"bg-gray-800 rounded-lg overflow-hidden",children:m.jsxs("table",{className:"w-full",children:[m.jsx("thead",{children:m.jsxs("tr",{className:"text-left text-gray-400 text-sm",children:[m.jsx("th",{className:"p-4",children:"Time"}),m.jsx("th",{className:"p-4",children:"Symbol"}),m.jsx("th",{className:"p-4",children:"Signal"}),m.jsx("th",{className:"p-4",children:"Price"}),m.jsx("th",{className:"p-4",children:"Confidence"}),m.jsx("th",{className:"p-4",children:"Status"})]})}),m.jsx("tbody",{children:m.jsxs("tr",{className:"border-t border-gray-700",children:[m.jsx("td",{className:"p-4",children:"10:30:15"}),m.jsx("td",{className:"p-4",children:"BTC/USDT"}),m.jsx("td",{className:"p-4",children:m.jsx("span",{className:"px-2 py-1 bg-green-500/20 text-green-500 rounded-full text-xs",children:"BUY"})}),m.jsx("td",{className:"p-4",children:"$42,150.00"}),m.jsx("td",{className:"p-4",children:"85%"}),m.jsx("td",{className:"p-4",children:m.jsx("span",{className:"px-2 py-1 bg-blue-500/20 text-blue-500 rounded-full text-xs",children:"PENDING"})})]})})]})})]})}function qj(n){if(n.length===0)return 0;var e=n[0],t=0,r;if(typeof e!="number")return Number.NaN;for(var s=1;s<n.length;s++){if(typeof n[s]!="number")return Number.NaN;r=e+n[s],Math.abs(e)>=Math.abs(n[s])?t+=e-r+n[s]:t+=n[s]-r+e,e=r}return e+t}function jn(n){if(n.length===0)throw new Error("mean requires at least one data point");return qj(n)/n.length}function L1(n,e){var t=jn(n),r=0,s,i;for(i=0;i<n.length;i++)s=n[i]-t,r+=s*s;return r}function Wj(n){if(n.length===0)throw new Error("variance requires at least one data point");return L1(n)/n.length}function nh(n){if(n.length===1)return 0;var e=Wj(n);return Math.sqrt(e)}function V1(n,e){if(n.length!==e.length)throw new Error("sampleCovariance requires samples with equal lengths");if(n.length<2)throw new Error("sampleCovariance requires at least two data points in each sample");for(var t=jn(n),r=jn(e),s=0,i=0;i<n.length;i++)s+=(n[i]-t)*(e[i]-r);var o=n.length-1;return s/o}function zj(n){if(n.length<2)throw new Error("sampleVariance requires at least two data points");var e=L1(n),t=n.length-1;return e/t}function Yw(n){var e=zj(n);return Math.sqrt(e)}function Xw(n,e){var t=V1(n,e),r=Yw(n),s=Yw(e);return t/r/s}class Gj{constructor(){we(this,"strategies",new Map)}async evaluateStrategy(e,t){try{const r={data:this.prepareData(t),parameters:e.parameters,calculateSMA:this.calculateSMA,calculateEMA:this.calculateEMA,calculateRSI:this.calculateRSI,calculateBollingerBands:this.calculateBollingerBands,calculateATR:this.calculateATR,console:{log:console.log}},i=await new Function("sandbox",`with (sandbox) { ${e.code} }`)(r),o=this.calculateMetrics(i,t);return{signals:i,metrics:o}}catch(r){throw console.error("Strategy evaluation error:",r),r}}prepareData(e){return{timestamp:e.map(t=>t.timestamp),open:e.map(t=>t.open),high:e.map(t=>t.high),low:e.map(t=>t.low),close:e.map(t=>t.close),volume:e.map(t=>t.volume)}}calculateSMA(e,t){const r=new Array(e.length).fill(0);for(let s=t-1;s<e.length;s++){let i=0;for(let o=0;o<t;o++)i+=e[s-o];r[s]=i/t}return r}calculateEMA(e,t){const r=new Array(e.length).fill(0),s=2/(t+1);r[0]=e[0];for(let i=1;i<e.length;i++)r[i]=(e[i]-r[i-1])*s+r[i-1];return r}calculateRSI(e,t){const r=new Array(e.length).fill(0),s=new Array(e.length).fill(0),i=new Array(e.length).fill(0);for(let o=1;o<e.length;o++){const l=e[o]-e[o-1];s[o]=l>0?l:0,i[o]=l<0?-l:0}for(let o=t;o<e.length;o++){const l=jn(s.slice(o-t+1,o+1)),u=jn(i.slice(o-t+1,o+1)),h=l/(u||1e-10);r[o]=100-100/(1+h)}return r}calculateBollingerBands(e,t,r){const s=this.calculateSMA(e,t),i=new Array(e.length).fill(0),o=new Array(e.length).fill(0);for(let l=t-1;l<e.length;l++){const u=e.slice(l-t+1,l+1),h=nh(u);i[l]=s[l]+r*h,o[l]=s[l]-r*h}return{upper:i,middle:s,lower:o}}calculateATR(e,t,r,s){const i=new Array(e.length).fill(0),o=new Array(e.length).fill(0);i[0]=e[0]-t[0];for(let l=1;l<e.length;l++)i[l]=Math.max(e[l]-t[l],Math.abs(e[l]-r[l-1]),Math.abs(t[l]-r[l-1]));o[s-1]=jn(i.slice(0,s));for(let l=s;l<e.length;l++)o[l]=(o[l-1]*(s-1)+i[l])/s;return o}calculateMetrics(e,t){const r=this.simulateTrades(e,t),s=this.calculateReturns(r),i=r.filter(_=>_.pnl>0),o=r.filter(_=>_.pnl<=0),l=i.length/r.length,u=i.reduce((_,E)=>_+E.pnl,0),h=Math.abs(o.reduce((_,E)=>_+E.pnl,0)),d=h===0?0:u/h,g=this.calculateSharpeRatio(s),v=this.calculateMaxDrawdown(r);return{winRate:l,profitFactor:d,sharpeRatio:g,maxDrawdown:v}}simulateTrades(e,t){const r=[];let s=null;for(const i of e)if(!s&&i.type==="BUY")s={entry:i.price,timestamp:i.timestamp,type:i.type};else if(s&&i.type==="SELL"){const o=s.type==="BUY"?i.price.minus(s.entry):s.entry.minus(i.price);r.push({entry:s.entry,exit:i.price,pnl:o.toNumber(),entryTime:s.timestamp,exitTime:i.timestamp}),s=null}return r}calculateReturns(e){return e.map(t=>t.pnl)}calculateSharpeRatio(e){const t=jn(e),r=nh(e);return r===0?0:t/r*Math.sqrt(252)}calculateMaxDrawdown(e){let t=0,r=0,s=0;for(const i of e){s+=i.pnl,s>t&&(t=s);const o=(t-s)/t;o>r&&(r=o)}return r}}var Fe={};const Hj=Object.prototype.toString;function Dn(n){const e=Hj.call(n);return e.endsWith("Array]")&&!e.includes("Big")}const Kj=Object.freeze(Object.defineProperty({__proto__:null,isAnyArray:Dn},Symbol.toStringTag,{value:"Module"})),Qj=zi(Kj);function Jj(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Dn(n))throw new TypeError("input must be an array");if(n.length===0)throw new TypeError("input must not be empty");var t=e.fromIndex,r=t===void 0?0:t,s=e.toIndex,i=s===void 0?n.length:s;if(r<0||r>=n.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(i<=r||i>n.length||!Number.isInteger(i))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=n[r],l=r+1;l<i;l++)n[l]>o&&(o=n[l]);return o}function Yj(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Dn(n))throw new TypeError("input must be an array");if(n.length===0)throw new TypeError("input must not be empty");var t=e.fromIndex,r=t===void 0?0:t,s=e.toIndex,i=s===void 0?n.length:s;if(r<0||r>=n.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(i<=r||i>n.length||!Number.isInteger(i))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=n[r],l=r+1;l<i;l++)n[l]<o&&(o=n[l]);return o}function Xj(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Dn(n)){if(n.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var t;if(e.output!==void 0){if(!Dn(e.output))throw new TypeError("output option must be an array if specified");t=e.output}else t=new Array(n.length);var r=Yj(n),s=Jj(n);if(r===s)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var i=e.min,o=i===void 0?e.autoMinMax?r:0:i,l=e.max,u=l===void 0?e.autoMinMax?s:1:l;if(o>=u)throw new RangeError("min option must be smaller than max option");for(var h=(u-o)/(s-r),d=0;d<n.length;d++)t[d]=(n[d]-r)*h+o;return t}const Zj=Object.freeze(Object.defineProperty({__proto__:null,default:Xj},Symbol.toStringTag,{value:"Module"})),eD=zi(Zj);Object.defineProperty(Fe,"__esModule",{value:!0});var Or=Qj,Zw=eD;const xu=" ".repeat(2),F1=" ".repeat(4);function tD(){return U1(this)}function U1(n,e={}){const{maxRows:t=15,maxColumns:r=10,maxNumSize:s=8,padMinus:i="auto"}=e;return`${n.constructor.name} {
${xu}[
${F1}${rD(n,t,r,s,i)}
${xu}]
${xu}rows: ${n.rows}
${xu}columns: ${n.columns}
}`}function rD(n,e,t,r,s){const{rows:i,columns:o}=n,l=Math.min(i,e),u=Math.min(o,t),h=[];if(s==="auto"){s=!1;e:for(let d=0;d<l;d++)for(let g=0;g<u;g++)if(n.get(d,g)<0){s=!0;break e}}for(let d=0;d<l;d++){let g=[];for(let v=0;v<u;v++)g.push(nD(n.get(d,v),r,s));h.push(`${g.join(" ")}`)}return u!==o&&(h[h.length-1]+=` ... ${o-t} more columns`),l!==i&&h.push(`... ${i-e} more rows`),h.join(`
${F1}`)}function nD(n,e,t){return(n>=0&&t?` ${ev(n,e-1)}`:ev(n,e)).padEnd(e)}function ev(n,e){let t=n.toString();if(t.length<=e)return t;let r=n.toFixed(e);if(r.length>e&&(r=n.toFixed(Math.max(0,e-(r.length-e)))),r.length<=e&&!r.startsWith("0.000")&&!r.startsWith("-0.000"))return r;let s=n.toExponential(e);return s.length>e&&(s=n.toExponential(Math.max(0,e-(s.length-e)))),s.slice(0)}function sD(n,e){n.prototype.add=function(r){return typeof r=="number"?this.addS(r):this.addM(r)},n.prototype.addS=function(r){for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)+r);return this},n.prototype.addM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)+r.get(s,i));return this},n.add=function(r,s){return new e(r).add(s)},n.prototype.sub=function(r){return typeof r=="number"?this.subS(r):this.subM(r)},n.prototype.subS=function(r){for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)-r);return this},n.prototype.subM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)-r.get(s,i));return this},n.sub=function(r,s){return new e(r).sub(s)},n.prototype.subtract=n.prototype.sub,n.prototype.subtractS=n.prototype.subS,n.prototype.subtractM=n.prototype.subM,n.subtract=n.sub,n.prototype.mul=function(r){return typeof r=="number"?this.mulS(r):this.mulM(r)},n.prototype.mulS=function(r){for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)*r);return this},n.prototype.mulM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)*r.get(s,i));return this},n.mul=function(r,s){return new e(r).mul(s)},n.prototype.multiply=n.prototype.mul,n.prototype.multiplyS=n.prototype.mulS,n.prototype.multiplyM=n.prototype.mulM,n.multiply=n.mul,n.prototype.div=function(r){return typeof r=="number"?this.divS(r):this.divM(r)},n.prototype.divS=function(r){for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)/r);return this},n.prototype.divM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)/r.get(s,i));return this},n.div=function(r,s){return new e(r).div(s)},n.prototype.divide=n.prototype.div,n.prototype.divideS=n.prototype.divS,n.prototype.divideM=n.prototype.divM,n.divide=n.div,n.prototype.mod=function(r){return typeof r=="number"?this.modS(r):this.modM(r)},n.prototype.modS=function(r){for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)%r);return this},n.prototype.modM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)%r.get(s,i));return this},n.mod=function(r,s){return new e(r).mod(s)},n.prototype.modulus=n.prototype.mod,n.prototype.modulusS=n.prototype.modS,n.prototype.modulusM=n.prototype.modM,n.modulus=n.mod,n.prototype.and=function(r){return typeof r=="number"?this.andS(r):this.andM(r)},n.prototype.andS=function(r){for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)&r);return this},n.prototype.andM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)&r.get(s,i));return this},n.and=function(r,s){return new e(r).and(s)},n.prototype.or=function(r){return typeof r=="number"?this.orS(r):this.orM(r)},n.prototype.orS=function(r){for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)|r);return this},n.prototype.orM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)|r.get(s,i));return this},n.or=function(r,s){return new e(r).or(s)},n.prototype.xor=function(r){return typeof r=="number"?this.xorS(r):this.xorM(r)},n.prototype.xorS=function(r){for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)^r);return this},n.prototype.xorM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)^r.get(s,i));return this},n.xor=function(r,s){return new e(r).xor(s)},n.prototype.leftShift=function(r){return typeof r=="number"?this.leftShiftS(r):this.leftShiftM(r)},n.prototype.leftShiftS=function(r){for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)<<r);return this},n.prototype.leftShiftM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)<<r.get(s,i));return this},n.leftShift=function(r,s){return new e(r).leftShift(s)},n.prototype.signPropagatingRightShift=function(r){return typeof r=="number"?this.signPropagatingRightShiftS(r):this.signPropagatingRightShiftM(r)},n.prototype.signPropagatingRightShiftS=function(r){for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)>>r);return this},n.prototype.signPropagatingRightShiftM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)>>r.get(s,i));return this},n.signPropagatingRightShift=function(r,s){return new e(r).signPropagatingRightShift(s)},n.prototype.rightShift=function(r){return typeof r=="number"?this.rightShiftS(r):this.rightShiftM(r)},n.prototype.rightShiftS=function(r){for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)>>>r);return this},n.prototype.rightShiftM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)>>>r.get(s,i));return this},n.rightShift=function(r,s){return new e(r).rightShift(s)},n.prototype.zeroFillRightShift=n.prototype.rightShift,n.prototype.zeroFillRightShiftS=n.prototype.rightShiftS,n.prototype.zeroFillRightShiftM=n.prototype.rightShiftM,n.zeroFillRightShift=n.rightShift,n.prototype.not=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,~this.get(r,s));return this},n.not=function(r){return new e(r).not()},n.prototype.abs=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.abs(this.get(r,s)));return this},n.abs=function(r){return new e(r).abs()},n.prototype.acos=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.acos(this.get(r,s)));return this},n.acos=function(r){return new e(r).acos()},n.prototype.acosh=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.acosh(this.get(r,s)));return this},n.acosh=function(r){return new e(r).acosh()},n.prototype.asin=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.asin(this.get(r,s)));return this},n.asin=function(r){return new e(r).asin()},n.prototype.asinh=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.asinh(this.get(r,s)));return this},n.asinh=function(r){return new e(r).asinh()},n.prototype.atan=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.atan(this.get(r,s)));return this},n.atan=function(r){return new e(r).atan()},n.prototype.atanh=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.atanh(this.get(r,s)));return this},n.atanh=function(r){return new e(r).atanh()},n.prototype.cbrt=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.cbrt(this.get(r,s)));return this},n.cbrt=function(r){return new e(r).cbrt()},n.prototype.ceil=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.ceil(this.get(r,s)));return this},n.ceil=function(r){return new e(r).ceil()},n.prototype.clz32=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.clz32(this.get(r,s)));return this},n.clz32=function(r){return new e(r).clz32()},n.prototype.cos=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.cos(this.get(r,s)));return this},n.cos=function(r){return new e(r).cos()},n.prototype.cosh=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.cosh(this.get(r,s)));return this},n.cosh=function(r){return new e(r).cosh()},n.prototype.exp=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.exp(this.get(r,s)));return this},n.exp=function(r){return new e(r).exp()},n.prototype.expm1=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.expm1(this.get(r,s)));return this},n.expm1=function(r){return new e(r).expm1()},n.prototype.floor=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.floor(this.get(r,s)));return this},n.floor=function(r){return new e(r).floor()},n.prototype.fround=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.fround(this.get(r,s)));return this},n.fround=function(r){return new e(r).fround()},n.prototype.log=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.log(this.get(r,s)));return this},n.log=function(r){return new e(r).log()},n.prototype.log1p=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.log1p(this.get(r,s)));return this},n.log1p=function(r){return new e(r).log1p()},n.prototype.log10=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.log10(this.get(r,s)));return this},n.log10=function(r){return new e(r).log10()},n.prototype.log2=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.log2(this.get(r,s)));return this},n.log2=function(r){return new e(r).log2()},n.prototype.round=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.round(this.get(r,s)));return this},n.round=function(r){return new e(r).round()},n.prototype.sign=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.sign(this.get(r,s)));return this},n.sign=function(r){return new e(r).sign()},n.prototype.sin=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.sin(this.get(r,s)));return this},n.sin=function(r){return new e(r).sin()},n.prototype.sinh=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.sinh(this.get(r,s)));return this},n.sinh=function(r){return new e(r).sinh()},n.prototype.sqrt=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.sqrt(this.get(r,s)));return this},n.sqrt=function(r){return new e(r).sqrt()},n.prototype.tan=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.tan(this.get(r,s)));return this},n.tan=function(r){return new e(r).tan()},n.prototype.tanh=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.tanh(this.get(r,s)));return this},n.tanh=function(r){return new e(r).tanh()},n.prototype.trunc=function(){for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.set(r,s,Math.trunc(this.get(r,s)));return this},n.trunc=function(r){return new e(r).trunc()},n.pow=function(r,s){return new e(r).pow(s)},n.prototype.pow=function(r){return typeof r=="number"?this.powS(r):this.powM(r)},n.prototype.powS=function(r){for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)**r);return this},n.prototype.powM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)**r.get(s,i));return this}}function rn(n,e,t){let r=t?n.rows:n.rows-1;if(e<0||e>r)throw new RangeError("Row index out of range")}function nn(n,e,t){let r=t?n.columns:n.columns-1;if(e<0||e>r)throw new RangeError("Column index out of range")}function jo(n,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==n.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function Do(n,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==n.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function Zg(n,e){if(!Or.isAnyArray(e))throw new TypeError("row indices must be an array");for(let t=0;t<e.length;t++)if(e[t]<0||e[t]>=n.rows)throw new RangeError("row indices are out of range")}function em(n,e){if(!Or.isAnyArray(e))throw new TypeError("column indices must be an array");for(let t=0;t<e.length;t++)if(e[t]<0||e[t]>=n.columns)throw new RangeError("column indices are out of range")}function rg(n,e,t,r,s){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(Au("startRow",e),Au("endRow",t),Au("startColumn",r),Au("endColumn",s),e>t||r>s||e<0||e>=n.rows||t<0||t>=n.rows||r<0||r>=n.columns||s<0||s>=n.columns)throw new RangeError("Submatrix indices are out of range")}function qh(n,e=0){let t=[];for(let r=0;r<n;r++)t.push(e);return t}function Au(n,e){if(typeof e!="number")throw new TypeError(`${n} must be a number`)}function Oo(n){if(n.isEmpty())throw new Error("Empty matrix has no elements to index")}function iD(n){let e=qh(n.rows);for(let t=0;t<n.rows;++t)for(let r=0;r<n.columns;++r)e[t]+=n.get(t,r);return e}function oD(n){let e=qh(n.columns);for(let t=0;t<n.rows;++t)for(let r=0;r<n.columns;++r)e[r]+=n.get(t,r);return e}function aD(n){let e=0;for(let t=0;t<n.rows;t++)for(let r=0;r<n.columns;r++)e+=n.get(t,r);return e}function lD(n){let e=qh(n.rows,1);for(let t=0;t<n.rows;++t)for(let r=0;r<n.columns;++r)e[t]*=n.get(t,r);return e}function cD(n){let e=qh(n.columns,1);for(let t=0;t<n.rows;++t)for(let r=0;r<n.columns;++r)e[r]*=n.get(t,r);return e}function uD(n){let e=1;for(let t=0;t<n.rows;t++)for(let r=0;r<n.columns;r++)e*=n.get(t,r);return e}function hD(n,e,t){const r=n.rows,s=n.columns,i=[];for(let o=0;o<r;o++){let l=0,u=0,h=0;for(let d=0;d<s;d++)h=n.get(o,d)-t[o],l+=h,u+=h*h;e?i.push((u-l*l/s)/(s-1)):i.push((u-l*l/s)/s)}return i}function fD(n,e,t){const r=n.rows,s=n.columns,i=[];for(let o=0;o<s;o++){let l=0,u=0,h=0;for(let d=0;d<r;d++)h=n.get(d,o)-t[o],l+=h,u+=h*h;e?i.push((u-l*l/r)/(r-1)):i.push((u-l*l/r)/r)}return i}function dD(n,e,t){const r=n.rows,s=n.columns,i=r*s;let o=0,l=0,u=0;for(let h=0;h<r;h++)for(let d=0;d<s;d++)u=n.get(h,d)-t,o+=u,l+=u*u;return e?(l-o*o/i)/(i-1):(l-o*o/i)/i}function pD(n,e){for(let t=0;t<n.rows;t++)for(let r=0;r<n.columns;r++)n.set(t,r,n.get(t,r)-e[t])}function gD(n,e){for(let t=0;t<n.rows;t++)for(let r=0;r<n.columns;r++)n.set(t,r,n.get(t,r)-e[r])}function mD(n,e){for(let t=0;t<n.rows;t++)for(let r=0;r<n.columns;r++)n.set(t,r,n.get(t,r)-e)}function yD(n){const e=[];for(let t=0;t<n.rows;t++){let r=0;for(let s=0;s<n.columns;s++)r+=n.get(t,s)**2/(n.columns-1);e.push(Math.sqrt(r))}return e}function wD(n,e){for(let t=0;t<n.rows;t++)for(let r=0;r<n.columns;r++)n.set(t,r,n.get(t,r)/e[t])}function vD(n){const e=[];for(let t=0;t<n.columns;t++){let r=0;for(let s=0;s<n.rows;s++)r+=n.get(s,t)**2/(n.rows-1);e.push(Math.sqrt(r))}return e}function _D(n,e){for(let t=0;t<n.rows;t++)for(let r=0;r<n.columns;r++)n.set(t,r,n.get(t,r)/e[r])}function bD(n){const e=n.size-1;let t=0;for(let r=0;r<n.columns;r++)for(let s=0;s<n.rows;s++)t+=n.get(s,r)**2/e;return Math.sqrt(t)}function ED(n,e){for(let t=0;t<n.rows;t++)for(let r=0;r<n.columns;r++)n.set(t,r,n.get(t,r)/e)}let _t=class Ft{static from1DArray(e,t,r){if(e*t!==r.length)throw new RangeError("data length does not match given dimensions");let i=new ae(e,t);for(let o=0;o<e;o++)for(let l=0;l<t;l++)i.set(o,l,r[o*t+l]);return i}static rowVector(e){let t=new ae(1,e.length);for(let r=0;r<e.length;r++)t.set(0,r,e[r]);return t}static columnVector(e){let t=new ae(e.length,1);for(let r=0;r<e.length;r++)t.set(r,0,e[r]);return t}static zeros(e,t){return new ae(e,t)}static ones(e,t){return new ae(e,t).fill(1)}static rand(e,t,r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{random:s=Math.random}=r;let i=new ae(e,t);for(let o=0;o<e;o++)for(let l=0;l<t;l++)i.set(o,l,s());return i}static randInt(e,t,r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{min:s=0,max:i=1e3,random:o=Math.random}=r;if(!Number.isInteger(s))throw new TypeError("min must be an integer");if(!Number.isInteger(i))throw new TypeError("max must be an integer");if(s>=i)throw new RangeError("min must be smaller than max");let l=i-s,u=new ae(e,t);for(let h=0;h<e;h++)for(let d=0;d<t;d++){let g=s+Math.round(o()*l);u.set(h,d,g)}return u}static eye(e,t,r){t===void 0&&(t=e),r===void 0&&(r=1);let s=Math.min(e,t),i=this.zeros(e,t);for(let o=0;o<s;o++)i.set(o,o,r);return i}static diag(e,t,r){let s=e.length;t===void 0&&(t=s),r===void 0&&(r=t);let i=Math.min(s,t,r),o=this.zeros(t,r);for(let l=0;l<i;l++)o.set(l,l,e[l]);return o}static min(e,t){e=this.checkMatrix(e),t=this.checkMatrix(t);let r=e.rows,s=e.columns,i=new ae(r,s);for(let o=0;o<r;o++)for(let l=0;l<s;l++)i.set(o,l,Math.min(e.get(o,l),t.get(o,l)));return i}static max(e,t){e=this.checkMatrix(e),t=this.checkMatrix(t);let r=e.rows,s=e.columns,i=new this(r,s);for(let o=0;o<r;o++)for(let l=0;l<s;l++)i.set(o,l,Math.max(e.get(o,l),t.get(o,l)));return i}static checkMatrix(e){return Ft.isMatrix(e)?e:new ae(e)}static isMatrix(e){return e!=null&&e.klass==="Matrix"}get size(){return this.rows*this.columns}apply(e){if(typeof e!="function")throw new TypeError("callback must be a function");for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)e.call(this,t,r);return this}to1DArray(){let e=[];for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)e.push(this.get(t,r));return e}to2DArray(){let e=[];for(let t=0;t<this.rows;t++){e.push([]);for(let r=0;r<this.columns;r++)e[t].push(this.get(t,r))}return e}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let e=0;e<this.rows;e++)for(let t=0;t<=e;t++)if(this.get(e,t)!==this.get(t,e))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let e=0;e<this.rows;e++)if(this.get(e,e)!==0)return!1;return!0}isEchelonForm(){let e=0,t=0,r=-1,s=!0,i=!1;for(;e<this.rows&&s;){for(t=0,i=!1;t<this.columns&&i===!1;)this.get(e,t)===0?t++:this.get(e,t)===1&&t>r?(i=!0,r=t):(s=!1,i=!0);e++}return s}isReducedEchelonForm(){let e=0,t=0,r=-1,s=!0,i=!1;for(;e<this.rows&&s;){for(t=0,i=!1;t<this.columns&&i===!1;)this.get(e,t)===0?t++:this.get(e,t)===1&&t>r?(i=!0,r=t):(s=!1,i=!0);for(let o=t+1;o<this.rows;o++)this.get(e,o)!==0&&(s=!1);e++}return s}echelonForm(){let e=this.clone(),t=0,r=0;for(;t<e.rows&&r<e.columns;){let s=t;for(let i=t;i<e.rows;i++)e.get(i,r)>e.get(s,r)&&(s=i);if(e.get(s,r)===0)r++;else{e.swapRows(t,s);let i=e.get(t,r);for(let o=r;o<e.columns;o++)e.set(t,o,e.get(t,o)/i);for(let o=t+1;o<e.rows;o++){let l=e.get(o,r)/e.get(t,r);e.set(o,r,0);for(let u=r+1;u<e.columns;u++)e.set(o,u,e.get(o,u)-e.get(t,u)*l)}t++,r++}}return e}reducedEchelonForm(){let e=this.echelonForm(),t=e.columns,r=e.rows,s=r-1;for(;s>=0;)if(e.maxRow(s)===0)s--;else{let i=0,o=!1;for(;i<r&&o===!1;)e.get(s,i)===1?o=!0:i++;for(let l=0;l<s;l++){let u=e.get(l,i);for(let h=i;h<t;h++){let d=e.get(l,h)-u*e.get(s,h);e.set(l,h,d)}}s--}return e}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{rows:t=1,columns:r=1}=e;if(!Number.isInteger(t)||t<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(r)||r<=0)throw new TypeError("columns must be a positive integer");let s=new ae(this.rows*t,this.columns*r);for(let i=0;i<t;i++)for(let o=0;o<r;o++)s.setSubMatrix(this,this.rows*i,this.columns*o);return s}fill(e){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,e);return this}neg(){return this.mulS(-1)}getRow(e){rn(this,e);let t=[];for(let r=0;r<this.columns;r++)t.push(this.get(e,r));return t}getRowVector(e){return ae.rowVector(this.getRow(e))}setRow(e,t){rn(this,e),t=jo(this,t);for(let r=0;r<this.columns;r++)this.set(e,r,t[r]);return this}swapRows(e,t){rn(this,e),rn(this,t);for(let r=0;r<this.columns;r++){let s=this.get(e,r);this.set(e,r,this.get(t,r)),this.set(t,r,s)}return this}getColumn(e){nn(this,e);let t=[];for(let r=0;r<this.rows;r++)t.push(this.get(r,e));return t}getColumnVector(e){return ae.columnVector(this.getColumn(e))}setColumn(e,t){nn(this,e),t=Do(this,t);for(let r=0;r<this.rows;r++)this.set(r,e,t[r]);return this}swapColumns(e,t){nn(this,e),nn(this,t);for(let r=0;r<this.rows;r++){let s=this.get(r,e);this.set(r,e,this.get(r,t)),this.set(r,t,s)}return this}addRowVector(e){e=jo(this,e);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)+e[r]);return this}subRowVector(e){e=jo(this,e);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)-e[r]);return this}mulRowVector(e){e=jo(this,e);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)*e[r]);return this}divRowVector(e){e=jo(this,e);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)/e[r]);return this}addColumnVector(e){e=Do(this,e);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)+e[t]);return this}subColumnVector(e){e=Do(this,e);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)-e[t]);return this}mulColumnVector(e){e=Do(this,e);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)*e[t]);return this}divColumnVector(e){e=Do(this,e);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)/e[t]);return this}mulRow(e,t){rn(this,e);for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t);return this}mulColumn(e,t){nn(this,e);for(let r=0;r<this.rows;r++)this.set(r,e,this.get(r,e)*t);return this}max(e){if(this.isEmpty())return NaN;switch(e){case"row":{const t=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.get(r,s)>t[r]&&(t[r]=this.get(r,s));return t}case"column":{const t=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.get(r,s)>t[s]&&(t[s]=this.get(r,s));return t}case void 0:{let t=this.get(0,0);for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.get(r,s)>t&&(t=this.get(r,s));return t}default:throw new Error(`invalid option: ${e}`)}}maxIndex(){Oo(this);let e=this.get(0,0),t=[0,0];for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.get(r,s)>e&&(e=this.get(r,s),t[0]=r,t[1]=s);return t}min(e){if(this.isEmpty())return NaN;switch(e){case"row":{const t=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.get(r,s)<t[r]&&(t[r]=this.get(r,s));return t}case"column":{const t=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.get(r,s)<t[s]&&(t[s]=this.get(r,s));return t}case void 0:{let t=this.get(0,0);for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.get(r,s)<t&&(t=this.get(r,s));return t}default:throw new Error(`invalid option: ${e}`)}}minIndex(){Oo(this);let e=this.get(0,0),t=[0,0];for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.get(r,s)<e&&(e=this.get(r,s),t[0]=r,t[1]=s);return t}maxRow(e){if(rn(this,e),this.isEmpty())return NaN;let t=this.get(e,0);for(let r=1;r<this.columns;r++)this.get(e,r)>t&&(t=this.get(e,r));return t}maxRowIndex(e){rn(this,e),Oo(this);let t=this.get(e,0),r=[e,0];for(let s=1;s<this.columns;s++)this.get(e,s)>t&&(t=this.get(e,s),r[1]=s);return r}minRow(e){if(rn(this,e),this.isEmpty())return NaN;let t=this.get(e,0);for(let r=1;r<this.columns;r++)this.get(e,r)<t&&(t=this.get(e,r));return t}minRowIndex(e){rn(this,e),Oo(this);let t=this.get(e,0),r=[e,0];for(let s=1;s<this.columns;s++)this.get(e,s)<t&&(t=this.get(e,s),r[1]=s);return r}maxColumn(e){if(nn(this,e),this.isEmpty())return NaN;let t=this.get(0,e);for(let r=1;r<this.rows;r++)this.get(r,e)>t&&(t=this.get(r,e));return t}maxColumnIndex(e){nn(this,e),Oo(this);let t=this.get(0,e),r=[0,e];for(let s=1;s<this.rows;s++)this.get(s,e)>t&&(t=this.get(s,e),r[0]=s);return r}minColumn(e){if(nn(this,e),this.isEmpty())return NaN;let t=this.get(0,e);for(let r=1;r<this.rows;r++)this.get(r,e)<t&&(t=this.get(r,e));return t}minColumnIndex(e){nn(this,e),Oo(this);let t=this.get(0,e),r=[0,e];for(let s=1;s<this.rows;s++)this.get(s,e)<t&&(t=this.get(s,e),r[0]=s);return r}diag(){let e=Math.min(this.rows,this.columns),t=[];for(let r=0;r<e;r++)t.push(this.get(r,r));return t}norm(e="frobenius"){switch(e){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${e}`)}}cumulativeSum(){let e=0;for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)e+=this.get(t,r),this.set(t,r,e);return this}dot(e){Ft.isMatrix(e)&&(e=e.to1DArray());let t=this.to1DArray();if(t.length!==e.length)throw new RangeError("vectors do not have the same size");let r=0;for(let s=0;s<t.length;s++)r+=t[s]*e[s];return r}mmul(e){e=ae.checkMatrix(e);let t=this.rows,r=this.columns,s=e.columns,i=new ae(t,s),o=new Float64Array(r);for(let l=0;l<s;l++){for(let u=0;u<r;u++)o[u]=e.get(u,l);for(let u=0;u<t;u++){let h=0;for(let d=0;d<r;d++)h+=this.get(u,d)*o[d];i.set(u,l,h)}}return i}mpow(e){if(!this.isSquare())throw new RangeError("Matrix must be square");if(!Number.isInteger(e)||e<0)throw new RangeError("Exponent must be a non-negative integer");let t=ae.eye(this.rows),r=this;for(let s=e;s>=1;s/=2)s&1&&(t=t.mmul(r)),r=r.mmul(r);return t}strassen2x2(e){e=ae.checkMatrix(e);let t=new ae(2,2);const r=this.get(0,0),s=e.get(0,0),i=this.get(0,1),o=e.get(0,1),l=this.get(1,0),u=e.get(1,0),h=this.get(1,1),d=e.get(1,1),g=(r+h)*(s+d),v=(l+h)*s,_=r*(o-d),E=h*(u-s),x=(r+i)*d,R=(l-r)*(s+o),I=(i-h)*(u+d),F=g+E-x+I,V=_+x,$=v+E,W=g-v+_+R;return t.set(0,0,F),t.set(0,1,V),t.set(1,0,$),t.set(1,1,W),t}strassen3x3(e){e=ae.checkMatrix(e);let t=new ae(3,3);const r=this.get(0,0),s=this.get(0,1),i=this.get(0,2),o=this.get(1,0),l=this.get(1,1),u=this.get(1,2),h=this.get(2,0),d=this.get(2,1),g=this.get(2,2),v=e.get(0,0),_=e.get(0,1),E=e.get(0,2),x=e.get(1,0),R=e.get(1,1),I=e.get(1,2),F=e.get(2,0),V=e.get(2,1),$=e.get(2,2),W=(r+s+i-o-l-d-g)*R,X=(r-o)*(-_+R),j=l*(-v+_+x-R-I-F+$),A=(-r+o+l)*(v-_+R),D=(o+l)*(-v+_),T=r*v,k=(-r+h+d)*(v-E+I),M=(-r+h)*(E-I),C=(h+d)*(-v+E),Te=(r+s+i-l-u-h-d)*I,ne=d*(-v+E+x-R-I-F+V),oe=(-i+d+g)*(R+F-V),Ae=(i-g)*(R-V),Le=i*F,wt=(d+g)*(-F+V),nt=(-i+l+u)*(I+F-$),me=(i-u)*(I-$),Re=(l+u)*(-F+$),ue=s*x,at=u*V,Ge=o*E,Nt=h*_,ht=g*$,Bn=T+Le+ue,qn=W+A+D+T+oe+Le+wt,vs=T+k+C+Te+Le+nt+Re,an=X+j+A+T+Le+nt+me,Sn=X+A+D+T+at,_s=Le+nt+me+Re+Ge,Ht=T+k+M+ne+oe+Ae+Le,ln=oe+Ae+Le+wt+Nt,Yi=T+k+M+C+ht;return t.set(0,0,Bn),t.set(0,1,qn),t.set(0,2,vs),t.set(1,0,an),t.set(1,1,Sn),t.set(1,2,_s),t.set(2,0,Ht),t.set(2,1,ln),t.set(2,2,Yi),t}mmulStrassen(e){e=ae.checkMatrix(e);let t=this.clone(),r=t.rows,s=t.columns,i=e.rows,o=e.columns;s!==i&&console.warn(`Multiplying ${r} x ${s} and ${i} x ${o} matrix: dimensions do not match.`);function l(g,v,_){let E=g.rows,x=g.columns;if(E===v&&x===_)return g;{let R=Ft.zeros(v,_);return R=R.setSubMatrix(g,0,0),R}}let u=Math.max(r,i),h=Math.max(s,o);t=l(t,u,h),e=l(e,u,h);function d(g,v,_,E){if(_<=512||E<=512)return g.mmul(v);_%2===1&&E%2===1?(g=l(g,_+1,E+1),v=l(v,_+1,E+1)):_%2===1?(g=l(g,_+1,E),v=l(v,_+1,E)):E%2===1&&(g=l(g,_,E+1),v=l(v,_,E+1));let x=parseInt(g.rows/2,10),R=parseInt(g.columns/2,10),I=g.subMatrix(0,x-1,0,R-1),F=v.subMatrix(0,x-1,0,R-1),V=g.subMatrix(0,x-1,R,g.columns-1),$=v.subMatrix(0,x-1,R,v.columns-1),W=g.subMatrix(x,g.rows-1,0,R-1),X=v.subMatrix(x,v.rows-1,0,R-1),j=g.subMatrix(x,g.rows-1,R,g.columns-1),A=v.subMatrix(x,v.rows-1,R,v.columns-1),D=d(Ft.add(I,j),Ft.add(F,A),x,R),T=d(Ft.add(W,j),F,x,R),k=d(I,Ft.sub($,A),x,R),M=d(j,Ft.sub(X,F),x,R),C=d(Ft.add(I,V),A,x,R),Te=d(Ft.sub(W,I),Ft.add(F,$),x,R),ne=d(Ft.sub(V,j),Ft.add(X,A),x,R),oe=Ft.add(D,M);oe.sub(C),oe.add(ne);let Ae=Ft.add(k,C),Le=Ft.add(T,M),wt=Ft.sub(D,T);wt.add(k),wt.add(Te);let nt=Ft.zeros(2*oe.rows,2*oe.columns);return nt=nt.setSubMatrix(oe,0,0),nt=nt.setSubMatrix(Ae,oe.rows,0),nt=nt.setSubMatrix(Le,0,oe.columns),nt=nt.setSubMatrix(wt,oe.rows,oe.columns),nt.subMatrix(0,_-1,0,E-1)}return d(t,e,u,h)}scaleRows(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:t=0,max:r=1}=e;if(!Number.isFinite(t))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(t>=r)throw new RangeError("min must be smaller than max");let s=new ae(this.rows,this.columns);for(let i=0;i<this.rows;i++){const o=this.getRow(i);o.length>0&&Zw(o,{min:t,max:r,output:o}),s.setRow(i,o)}return s}scaleColumns(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:t=0,max:r=1}=e;if(!Number.isFinite(t))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(t>=r)throw new RangeError("min must be smaller than max");let s=new ae(this.rows,this.columns);for(let i=0;i<this.columns;i++){const o=this.getColumn(i);o.length&&Zw(o,{min:t,max:r,output:o}),s.setColumn(i,o)}return s}flipRows(){const e=Math.ceil(this.columns/2);for(let t=0;t<this.rows;t++)for(let r=0;r<e;r++){let s=this.get(t,r),i=this.get(t,this.columns-1-r);this.set(t,r,i),this.set(t,this.columns-1-r,s)}return this}flipColumns(){const e=Math.ceil(this.rows/2);for(let t=0;t<this.columns;t++)for(let r=0;r<e;r++){let s=this.get(r,t),i=this.get(this.rows-1-r,t);this.set(r,t,i),this.set(this.rows-1-r,t,s)}return this}kroneckerProduct(e){e=ae.checkMatrix(e);let t=this.rows,r=this.columns,s=e.rows,i=e.columns,o=new ae(t*s,r*i);for(let l=0;l<t;l++)for(let u=0;u<r;u++)for(let h=0;h<s;h++)for(let d=0;d<i;d++)o.set(s*l+h,i*u+d,this.get(l,u)*e.get(h,d));return o}kroneckerSum(e){if(e=ae.checkMatrix(e),!this.isSquare()||!e.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let t=this.rows,r=e.rows,s=this.kroneckerProduct(ae.eye(r,r)),i=ae.eye(t,t).kroneckerProduct(e);return s.add(i)}transpose(){let e=new ae(this.columns,this.rows);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)e.set(r,t,this.get(t,r));return e}sortRows(e=tv){for(let t=0;t<this.rows;t++)this.setRow(t,this.getRow(t).sort(e));return this}sortColumns(e=tv){for(let t=0;t<this.columns;t++)this.setColumn(t,this.getColumn(t).sort(e));return this}subMatrix(e,t,r,s){rg(this,e,t,r,s);let i=new ae(t-e+1,s-r+1);for(let o=e;o<=t;o++)for(let l=r;l<=s;l++)i.set(o-e,l-r,this.get(o,l));return i}subMatrixRow(e,t,r){if(t===void 0&&(t=0),r===void 0&&(r=this.columns-1),t>r||t<0||t>=this.columns||r<0||r>=this.columns)throw new RangeError("Argument out of range");let s=new ae(e.length,r-t+1);for(let i=0;i<e.length;i++)for(let o=t;o<=r;o++){if(e[i]<0||e[i]>=this.rows)throw new RangeError(`Row index out of range: ${e[i]}`);s.set(i,o-t,this.get(e[i],o))}return s}subMatrixColumn(e,t,r){if(t===void 0&&(t=0),r===void 0&&(r=this.rows-1),t>r||t<0||t>=this.rows||r<0||r>=this.rows)throw new RangeError("Argument out of range");let s=new ae(r-t+1,e.length);for(let i=0;i<e.length;i++)for(let o=t;o<=r;o++){if(e[i]<0||e[i]>=this.columns)throw new RangeError(`Column index out of range: ${e[i]}`);s.set(o-t,i,this.get(o,e[i]))}return s}setSubMatrix(e,t,r){if(e=ae.checkMatrix(e),e.isEmpty())return this;let s=t+e.rows-1,i=r+e.columns-1;rg(this,t,s,r,i);for(let o=0;o<e.rows;o++)for(let l=0;l<e.columns;l++)this.set(t+o,r+l,e.get(o,l));return this}selection(e,t){Zg(this,e),em(this,t);let r=new ae(e.length,t.length);for(let s=0;s<e.length;s++){let i=e[s];for(let o=0;o<t.length;o++){let l=t[o];r.set(s,o,this.get(i,l))}}return r}trace(){let e=Math.min(this.rows,this.columns),t=0;for(let r=0;r<e;r++)t+=this.get(r,r);return t}clone(){return this.constructor.copy(this,new ae(this.rows,this.columns))}static copy(e,t){for(const[r,s,i]of e.entries())t.set(r,s,i);return t}sum(e){switch(e){case"row":return iD(this);case"column":return oD(this);case void 0:return aD(this);default:throw new Error(`invalid option: ${e}`)}}product(e){switch(e){case"row":return lD(this);case"column":return cD(this);case void 0:return uD(this);default:throw new Error(`invalid option: ${e}`)}}mean(e){const t=this.sum(e);switch(e){case"row":{for(let r=0;r<this.rows;r++)t[r]/=this.columns;return t}case"column":{for(let r=0;r<this.columns;r++)t[r]/=this.rows;return t}case void 0:return t/this.size;default:throw new Error(`invalid option: ${e}`)}}variance(e,t={}){if(typeof e=="object"&&(t=e,e=void 0),typeof t!="object")throw new TypeError("options must be an object");const{unbiased:r=!0,mean:s=this.mean(e)}=t;if(typeof r!="boolean")throw new TypeError("unbiased must be a boolean");switch(e){case"row":{if(!Or.isAnyArray(s))throw new TypeError("mean must be an array");return hD(this,r,s)}case"column":{if(!Or.isAnyArray(s))throw new TypeError("mean must be an array");return fD(this,r,s)}case void 0:{if(typeof s!="number")throw new TypeError("mean must be a number");return dD(this,r,s)}default:throw new Error(`invalid option: ${e}`)}}standardDeviation(e,t){typeof e=="object"&&(t=e,e=void 0);const r=this.variance(e,t);if(e===void 0)return Math.sqrt(r);for(let s=0;s<r.length;s++)r[s]=Math.sqrt(r[s]);return r}center(e,t={}){if(typeof e=="object"&&(t=e,e=void 0),typeof t!="object")throw new TypeError("options must be an object");const{center:r=this.mean(e)}=t;switch(e){case"row":{if(!Or.isAnyArray(r))throw new TypeError("center must be an array");return pD(this,r),this}case"column":{if(!Or.isAnyArray(r))throw new TypeError("center must be an array");return gD(this,r),this}case void 0:{if(typeof r!="number")throw new TypeError("center must be a number");return mD(this,r),this}default:throw new Error(`invalid option: ${e}`)}}scale(e,t={}){if(typeof e=="object"&&(t=e,e=void 0),typeof t!="object")throw new TypeError("options must be an object");let r=t.scale;switch(e){case"row":{if(r===void 0)r=yD(this);else if(!Or.isAnyArray(r))throw new TypeError("scale must be an array");return wD(this,r),this}case"column":{if(r===void 0)r=vD(this);else if(!Or.isAnyArray(r))throw new TypeError("scale must be an array");return _D(this,r),this}case void 0:{if(r===void 0)r=bD(this);else if(typeof r!="number")throw new TypeError("scale must be a number");return ED(this,r),this}default:throw new Error(`invalid option: ${e}`)}}toString(e){return U1(this,e)}[Symbol.iterator](){return this.entries()}*entries(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)yield[e,t,this.get(e,t)]}*values(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)yield this.get(e,t)}};_t.prototype.klass="Matrix";typeof Symbol<"u"&&(_t.prototype[Symbol.for("nodejs.util.inspect.custom")]=tD);function tv(n,e){return n-e}function TD(n){return n.every(e=>typeof e=="number")}_t.random=_t.rand;_t.randomInt=_t.randInt;_t.diagonal=_t.diag;_t.prototype.diagonal=_t.prototype.diag;_t.identity=_t.eye;_t.prototype.negate=_t.prototype.neg;_t.prototype.tensorProduct=_t.prototype.kroneckerProduct;var Ml,ng,Vi;let ae=(Vi=class extends _t{constructor(t,r){super();Ed(this,Ml);we(this,"data");if(Vi.isMatrix(t))Td(this,Ml,ng).call(this,t.rows,t.columns),Vi.copy(t,this);else if(Number.isInteger(t)&&t>=0)Td(this,Ml,ng).call(this,t,r);else if(Or.isAnyArray(t)){const s=t;if(t=s.length,r=t?s[0].length:0,typeof r!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let i=0;i<t;i++){if(s[i].length!==r)throw new RangeError("Inconsistent array dimensions");if(!TD(s[i]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(s[i]))}this.rows=t,this.columns=r}else throw new TypeError("First argument must be a positive number or an array")}set(t,r,s){return this.data[t][r]=s,this}get(t,r){return this.data[t][r]}removeRow(t){return rn(this,t),this.data.splice(t,1),this.rows-=1,this}addRow(t,r){return r===void 0&&(r=t,t=this.rows),rn(this,t,!0),r=Float64Array.from(jo(this,r)),this.data.splice(t,0,r),this.rows+=1,this}removeColumn(t){nn(this,t);for(let r=0;r<this.rows;r++){const s=new Float64Array(this.columns-1);for(let i=0;i<t;i++)s[i]=this.data[r][i];for(let i=t+1;i<this.columns;i++)s[i-1]=this.data[r][i];this.data[r]=s}return this.columns-=1,this}addColumn(t,r){typeof r>"u"&&(r=t,t=this.columns),nn(this,t,!0),r=Do(this,r);for(let s=0;s<this.rows;s++){const i=new Float64Array(this.columns+1);let o=0;for(;o<t;o++)i[o]=this.data[s][o];for(i[o++]=r[s];o<this.columns+1;o++)i[o]=this.data[s][o-1];this.data[s]=i}return this.columns+=1,this}},Ml=new WeakSet,ng=function(t,r){if(this.data=[],Number.isInteger(r)&&r>=0)for(let s=0;s<t;s++)this.data.push(new Float64Array(r));else throw new TypeError("nColumns must be a positive integer");this.rows=t,this.columns=r},Vi);sD(_t,ae);var pr,Fi;let yl=(Fi=class extends _t{constructor(t){super();Ed(this,pr);if(ae.isMatrix(t)){if(!t.isSymmetric())throw new TypeError("not symmetric data");gu(this,pr,ae.copy(t,new ae(t.rows,t.rows)))}else if(Number.isInteger(t)&&t>=0)gu(this,pr,new ae(t,t));else if(gu(this,pr,new ae(t)),!this.isSymmetric())throw new TypeError("not symmetric data")}get size(){return yn(this,pr).size}get rows(){return yn(this,pr).rows}get columns(){return yn(this,pr).columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(t){return ae.isMatrix(t)&&t.klassType==="SymmetricMatrix"}static zeros(t){return new this(t)}static ones(t){return new this(t).fill(1)}clone(){const t=new Fi(this.diagonalSize);for(const[r,s,i]of this.upperRightEntries())t.set(r,s,i);return t}toMatrix(){return new ae(this)}get(t,r){return yn(this,pr).get(t,r)}set(t,r,s){return yn(this,pr).set(t,r,s),yn(this,pr).set(r,t,s),this}removeCross(t){return yn(this,pr).removeRow(t),yn(this,pr).removeColumn(t),this}addCross(t,r){r===void 0&&(r=t,t=this.diagonalSize);const s=r.slice();return s.splice(t,1),yn(this,pr).addRow(t,s),yn(this,pr).addColumn(t,r),this}applyMask(t){if(t.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const r=[];for(const[s,i]of t.entries())i||r.push(s);r.reverse();for(const s of r)this.removeCross(s);return this}toCompact(){const{diagonalSize:t}=this,r=new Array(t*(t+1)/2);for(let s=0,i=0,o=0;o<r.length;o++)r[o]=this.get(i,s),++s>=t&&(s=++i);return r}static fromCompact(t){const r=t.length,s=(Math.sqrt(8*r+1)-1)/2;if(!Number.isInteger(s))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(t)}`);const i=new Fi(s);for(let o=0,l=0,u=0;u<r;u++)i.set(o,l,t[u]),++o>=s&&(o=++l);return i}*upperRightEntries(){for(let t=0,r=0;t<this.diagonalSize;void 0){const s=this.get(t,r);yield[t,r,s],++r>=this.diagonalSize&&(r=++t)}}*upperRightValues(){for(let t=0,r=0;t<this.diagonalSize;void 0)yield this.get(t,r),++r>=this.diagonalSize&&(r=++t)}},pr=new WeakMap,Fi);yl.prototype.klassType="SymmetricMatrix";let $1=class B1 extends yl{static isDistanceMatrix(e){return yl.isSymmetricMatrix(e)&&e.klassSubType==="DistanceMatrix"}constructor(e){if(super(e),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(e,t,r){return e===t&&(r=0),super.set(e,t,r)}addCross(e,t){return t===void 0&&(t=e,e=this.diagonalSize),t=t.slice(),t[e]=0,super.addCross(e,t)}toSymmetricMatrix(){return new yl(this)}clone(){const e=new B1(this.diagonalSize);for(const[t,r,s]of this.upperRightEntries())t!==r&&e.set(t,r,s);return e}toCompact(){const{diagonalSize:e}=this,t=(e-1)*e/2,r=new Array(t);for(let s=1,i=0,o=0;o<r.length;o++)r[o]=this.get(i,s),++s>=e&&(s=++i+1);return r}static fromCompact(e){const t=e.length;if(t===0)return new this(0);const r=(Math.sqrt(8*t+1)+1)/2;if(!Number.isInteger(r))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(e)}`);const s=new this(r);for(let i=1,o=0,l=0;l<t;l++)s.set(i,o,e[l]),++i>=r&&(i=++o+1);return s}};$1.prototype.klassSubType="DistanceMatrix";class ws extends _t{constructor(e,t,r){super(),this.matrix=e,this.rows=t,this.columns=r}}let SD=class extends ws{constructor(e,t){nn(e,t),super(e,e.rows,1),this.column=t}set(e,t,r){return this.matrix.set(e,this.column,r),this}get(e){return this.matrix.get(e,this.column)}},xD=class extends ws{constructor(e,t){em(e,t),super(e,e.rows,t.length),this.columnIndices=t}set(e,t,r){return this.matrix.set(e,this.columnIndices[t],r),this}get(e,t){return this.matrix.get(e,this.columnIndices[t])}},AD=class extends ws{constructor(e){super(e,e.rows,e.columns)}set(e,t,r){return this.matrix.set(e,this.columns-t-1,r),this}get(e,t){return this.matrix.get(e,this.columns-t-1)}},RD=class extends ws{constructor(e){super(e,e.rows,e.columns)}set(e,t,r){return this.matrix.set(this.rows-e-1,t,r),this}get(e,t){return this.matrix.get(this.rows-e-1,t)}},ID=class extends ws{constructor(e,t){rn(e,t),super(e,1,e.columns),this.row=t}set(e,t,r){return this.matrix.set(this.row,t,r),this}get(e,t){return this.matrix.get(this.row,t)}},PD=class extends ws{constructor(e,t){Zg(e,t),super(e,t.length,e.columns),this.rowIndices=t}set(e,t,r){return this.matrix.set(this.rowIndices[e],t,r),this}get(e,t){return this.matrix.get(this.rowIndices[e],t)}},Bu=class extends ws{constructor(e,t,r){Zg(e,t),em(e,r),super(e,t.length,r.length),this.rowIndices=t,this.columnIndices=r}set(e,t,r){return this.matrix.set(this.rowIndices[e],this.columnIndices[t],r),this}get(e,t){return this.matrix.get(this.rowIndices[e],this.columnIndices[t])}},CD=class extends ws{constructor(e,t,r,s,i){rg(e,t,r,s,i),super(e,r-t+1,i-s+1),this.startRow=t,this.startColumn=s}set(e,t,r){return this.matrix.set(this.startRow+e,this.startColumn+t,r),this}get(e,t){return this.matrix.get(this.startRow+e,this.startColumn+t)}},ND=class extends ws{constructor(e){super(e,e.columns,e.rows)}set(e,t,r){return this.matrix.set(t,e,r),this}get(e,t){return this.matrix.get(t,e)}},q1=class extends _t{constructor(e,t={}){const{rows:r=1}=t;if(e.length%r!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=r,this.columns=e.length/r,this.data=e}set(e,t,r){let s=this._calculateIndex(e,t);return this.data[s]=r,this}get(e,t){let r=this._calculateIndex(e,t);return this.data[r]}_calculateIndex(e,t){return e*this.columns+t}},qr=class extends _t{constructor(e){super(),this.data=e,this.rows=e.length,this.columns=e[0].length}set(e,t,r){return this.data[e][t]=r,this}get(e,t){return this.data[e][t]}};function OD(n,e){if(Or.isAnyArray(n))return n[0]&&Or.isAnyArray(n[0])?new qr(n):new q1(n,e);throw new Error("the argument is not an array")}let Wh=class{constructor(e){e=qr.checkMatrix(e);let t=e.clone(),r=t.rows,s=t.columns,i=new Float64Array(r),o=1,l,u,h,d,g,v,_,E,x;for(l=0;l<r;l++)i[l]=l;for(E=new Float64Array(r),u=0;u<s;u++){for(l=0;l<r;l++)E[l]=t.get(l,u);for(l=0;l<r;l++){for(x=Math.min(l,u),g=0,h=0;h<x;h++)g+=t.get(l,h)*E[h];E[l]-=g,t.set(l,u,E[l])}for(d=u,l=u+1;l<r;l++)Math.abs(E[l])>Math.abs(E[d])&&(d=l);if(d!==u){for(h=0;h<s;h++)v=t.get(d,h),t.set(d,h,t.get(u,h)),t.set(u,h,v);_=i[d],i[d]=i[u],i[u]=_,o=-o}if(u<r&&t.get(u,u)!==0)for(l=u+1;l<r;l++)t.set(l,u,t.get(l,u)/t.get(u,u))}this.LU=t,this.pivotVector=i,this.pivotSign=o}isSingular(){let e=this.LU,t=e.columns;for(let r=0;r<t;r++)if(e.get(r,r)===0)return!0;return!1}solve(e){e=ae.checkMatrix(e);let t=this.LU;if(t.rows!==e.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let s=e.columns,i=e.subMatrixRow(this.pivotVector,0,s-1),o=t.columns,l,u,h;for(h=0;h<o;h++)for(l=h+1;l<o;l++)for(u=0;u<s;u++)i.set(l,u,i.get(l,u)-i.get(h,u)*t.get(l,h));for(h=o-1;h>=0;h--){for(u=0;u<s;u++)i.set(h,u,i.get(h,u)/t.get(h,h));for(l=0;l<h;l++)for(u=0;u<s;u++)i.set(l,u,i.get(l,u)-i.get(h,u)*t.get(l,h))}return i}get determinant(){let e=this.LU;if(!e.isSquare())throw new Error("Matrix must be square");let t=this.pivotSign,r=e.columns;for(let s=0;s<r;s++)t*=e.get(s,s);return t}get lowerTriangularMatrix(){let e=this.LU,t=e.rows,r=e.columns,s=new ae(t,r);for(let i=0;i<t;i++)for(let o=0;o<r;o++)i>o?s.set(i,o,e.get(i,o)):i===o?s.set(i,o,1):s.set(i,o,0);return s}get upperTriangularMatrix(){let e=this.LU,t=e.rows,r=e.columns,s=new ae(t,r);for(let i=0;i<t;i++)for(let o=0;o<r;o++)i<=o?s.set(i,o,e.get(i,o)):s.set(i,o,0);return s}get pivotPermutationVector(){return Array.from(this.pivotVector)}};function cs(n,e){let t=0;return Math.abs(n)>Math.abs(e)?(t=e/n,Math.abs(n)*Math.sqrt(1+t*t)):e!==0?(t=n/e,Math.abs(e)*Math.sqrt(1+t*t)):0}let tm=class{constructor(e){e=qr.checkMatrix(e);let t=e.clone(),r=e.rows,s=e.columns,i=new Float64Array(s),o,l,u,h;for(u=0;u<s;u++){let d=0;for(o=u;o<r;o++)d=cs(d,t.get(o,u));if(d!==0){for(t.get(u,u)<0&&(d=-d),o=u;o<r;o++)t.set(o,u,t.get(o,u)/d);for(t.set(u,u,t.get(u,u)+1),l=u+1;l<s;l++){for(h=0,o=u;o<r;o++)h+=t.get(o,u)*t.get(o,l);for(h=-h/t.get(u,u),o=u;o<r;o++)t.set(o,l,t.get(o,l)+h*t.get(o,u))}}i[u]=-d}this.QR=t,this.Rdiag=i}solve(e){e=ae.checkMatrix(e);let t=this.QR,r=t.rows;if(e.rows!==r)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let s=e.columns,i=e.clone(),o=t.columns,l,u,h,d;for(h=0;h<o;h++)for(u=0;u<s;u++){for(d=0,l=h;l<r;l++)d+=t.get(l,h)*i.get(l,u);for(d=-d/t.get(h,h),l=h;l<r;l++)i.set(l,u,i.get(l,u)+d*t.get(l,h))}for(h=o-1;h>=0;h--){for(u=0;u<s;u++)i.set(h,u,i.get(h,u)/this.Rdiag[h]);for(l=0;l<h;l++)for(u=0;u<s;u++)i.set(l,u,i.get(l,u)-i.get(h,u)*t.get(l,h))}return i.subMatrix(0,o-1,0,s-1)}isFullRank(){let e=this.QR.columns;for(let t=0;t<e;t++)if(this.Rdiag[t]===0)return!1;return!0}get upperTriangularMatrix(){let e=this.QR,t=e.columns,r=new ae(t,t),s,i;for(s=0;s<t;s++)for(i=0;i<t;i++)s<i?r.set(s,i,e.get(s,i)):s===i?r.set(s,i,this.Rdiag[s]):r.set(s,i,0);return r}get orthogonalMatrix(){let e=this.QR,t=e.rows,r=e.columns,s=new ae(t,r),i,o,l,u;for(l=r-1;l>=0;l--){for(i=0;i<t;i++)s.set(i,l,0);for(s.set(l,l,1),o=l;o<r;o++)if(e.get(l,l)!==0){for(u=0,i=l;i<t;i++)u+=e.get(i,l)*s.get(i,o);for(u=-u/e.get(l,l),i=l;i<t;i++)s.set(i,o,s.get(i,o)+u*e.get(i,l))}}return s}},aa=class{constructor(e,t={}){if(e=qr.checkMatrix(e),e.isEmpty())throw new Error("Matrix must be non-empty");let r=e.rows,s=e.columns;const{computeLeftSingularVectors:i=!0,computeRightSingularVectors:o=!0,autoTranspose:l=!1}=t;let u=!!i,h=!!o,d=!1,g;if(r<s)if(!l)g=e.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{g=e.transpose(),r=g.rows,s=g.columns,d=!0;let T=u;u=h,h=T}else g=e.clone();let v=Math.min(r,s),_=Math.min(r+1,s),E=new Float64Array(_),x=new ae(r,v),R=new ae(s,s),I=new Float64Array(s),F=new Float64Array(r),V=new Float64Array(_);for(let T=0;T<_;T++)V[T]=T;let $=Math.min(r-1,s),W=Math.max(0,Math.min(s-2,r)),X=Math.max($,W);for(let T=0;T<X;T++){if(T<$){E[T]=0;for(let k=T;k<r;k++)E[T]=cs(E[T],g.get(k,T));if(E[T]!==0){g.get(T,T)<0&&(E[T]=-E[T]);for(let k=T;k<r;k++)g.set(k,T,g.get(k,T)/E[T]);g.set(T,T,g.get(T,T)+1)}E[T]=-E[T]}for(let k=T+1;k<s;k++){if(T<$&&E[T]!==0){let M=0;for(let C=T;C<r;C++)M+=g.get(C,T)*g.get(C,k);M=-M/g.get(T,T);for(let C=T;C<r;C++)g.set(C,k,g.get(C,k)+M*g.get(C,T))}I[k]=g.get(T,k)}if(u&&T<$)for(let k=T;k<r;k++)x.set(k,T,g.get(k,T));if(T<W){I[T]=0;for(let k=T+1;k<s;k++)I[T]=cs(I[T],I[k]);if(I[T]!==0){I[T+1]<0&&(I[T]=0-I[T]);for(let k=T+1;k<s;k++)I[k]/=I[T];I[T+1]+=1}if(I[T]=-I[T],T+1<r&&I[T]!==0){for(let k=T+1;k<r;k++)F[k]=0;for(let k=T+1;k<r;k++)for(let M=T+1;M<s;M++)F[k]+=I[M]*g.get(k,M);for(let k=T+1;k<s;k++){let M=-I[k]/I[T+1];for(let C=T+1;C<r;C++)g.set(C,k,g.get(C,k)+M*F[C])}}if(h)for(let k=T+1;k<s;k++)R.set(k,T,I[k])}}let j=Math.min(s,r+1);if($<s&&(E[$]=g.get($,$)),r<j&&(E[j-1]=0),W+1<j&&(I[W]=g.get(W,j-1)),I[j-1]=0,u){for(let T=$;T<v;T++){for(let k=0;k<r;k++)x.set(k,T,0);x.set(T,T,1)}for(let T=$-1;T>=0;T--)if(E[T]!==0){for(let k=T+1;k<v;k++){let M=0;for(let C=T;C<r;C++)M+=x.get(C,T)*x.get(C,k);M=-M/x.get(T,T);for(let C=T;C<r;C++)x.set(C,k,x.get(C,k)+M*x.get(C,T))}for(let k=T;k<r;k++)x.set(k,T,-x.get(k,T));x.set(T,T,1+x.get(T,T));for(let k=0;k<T-1;k++)x.set(k,T,0)}else{for(let k=0;k<r;k++)x.set(k,T,0);x.set(T,T,1)}}if(h)for(let T=s-1;T>=0;T--){if(T<W&&I[T]!==0)for(let k=T+1;k<s;k++){let M=0;for(let C=T+1;C<s;C++)M+=R.get(C,T)*R.get(C,k);M=-M/R.get(T+1,T);for(let C=T+1;C<s;C++)R.set(C,k,R.get(C,k)+M*R.get(C,T))}for(let k=0;k<s;k++)R.set(k,T,0);R.set(T,T,1)}let A=j-1,D=Number.EPSILON;for(;j>0;){let T,k;for(T=j-2;T>=-1&&T!==-1;T--){const M=Number.MIN_VALUE+D*Math.abs(E[T]+Math.abs(E[T+1]));if(Math.abs(I[T])<=M||Number.isNaN(I[T])){I[T]=0;break}}if(T===j-2)k=4;else{let M;for(M=j-1;M>=T&&M!==T;M--){let C=(M!==j?Math.abs(I[M]):0)+(M!==T+1?Math.abs(I[M-1]):0);if(Math.abs(E[M])<=D*C){E[M]=0;break}}M===T?k=3:M===j-1?k=1:(k=2,T=M)}switch(T++,k){case 1:{let M=I[j-2];I[j-2]=0;for(let C=j-2;C>=T;C--){let Te=cs(E[C],M),ne=E[C]/Te,oe=M/Te;if(E[C]=Te,C!==T&&(M=-oe*I[C-1],I[C-1]=ne*I[C-1]),h)for(let Ae=0;Ae<s;Ae++)Te=ne*R.get(Ae,C)+oe*R.get(Ae,j-1),R.set(Ae,j-1,-oe*R.get(Ae,C)+ne*R.get(Ae,j-1)),R.set(Ae,C,Te)}break}case 2:{let M=I[T-1];I[T-1]=0;for(let C=T;C<j;C++){let Te=cs(E[C],M),ne=E[C]/Te,oe=M/Te;if(E[C]=Te,M=-oe*I[C],I[C]=ne*I[C],u)for(let Ae=0;Ae<r;Ae++)Te=ne*x.get(Ae,C)+oe*x.get(Ae,T-1),x.set(Ae,T-1,-oe*x.get(Ae,C)+ne*x.get(Ae,T-1)),x.set(Ae,C,Te)}break}case 3:{const M=Math.max(Math.abs(E[j-1]),Math.abs(E[j-2]),Math.abs(I[j-2]),Math.abs(E[T]),Math.abs(I[T])),C=E[j-1]/M,Te=E[j-2]/M,ne=I[j-2]/M,oe=E[T]/M,Ae=I[T]/M,Le=((Te+C)*(Te-C)+ne*ne)/2,wt=C*ne*(C*ne);let nt=0;(Le!==0||wt!==0)&&(Le<0?nt=0-Math.sqrt(Le*Le+wt):nt=Math.sqrt(Le*Le+wt),nt=wt/(Le+nt));let me=(oe+C)*(oe-C)+nt,Re=oe*Ae;for(let ue=T;ue<j-1;ue++){let at=cs(me,Re);at===0&&(at=Number.MIN_VALUE);let Ge=me/at,Nt=Re/at;if(ue!==T&&(I[ue-1]=at),me=Ge*E[ue]+Nt*I[ue],I[ue]=Ge*I[ue]-Nt*E[ue],Re=Nt*E[ue+1],E[ue+1]=Ge*E[ue+1],h)for(let ht=0;ht<s;ht++)at=Ge*R.get(ht,ue)+Nt*R.get(ht,ue+1),R.set(ht,ue+1,-Nt*R.get(ht,ue)+Ge*R.get(ht,ue+1)),R.set(ht,ue,at);if(at=cs(me,Re),at===0&&(at=Number.MIN_VALUE),Ge=me/at,Nt=Re/at,E[ue]=at,me=Ge*I[ue]+Nt*E[ue+1],E[ue+1]=-Nt*I[ue]+Ge*E[ue+1],Re=Nt*I[ue+1],I[ue+1]=Ge*I[ue+1],u&&ue<r-1)for(let ht=0;ht<r;ht++)at=Ge*x.get(ht,ue)+Nt*x.get(ht,ue+1),x.set(ht,ue+1,-Nt*x.get(ht,ue)+Ge*x.get(ht,ue+1)),x.set(ht,ue,at)}I[j-2]=me;break}case 4:{if(E[T]<=0&&(E[T]=E[T]<0?-E[T]:0,h))for(let M=0;M<=A;M++)R.set(M,T,-R.get(M,T));for(;T<A&&!(E[T]>=E[T+1]);){let M=E[T];if(E[T]=E[T+1],E[T+1]=M,h&&T<s-1)for(let C=0;C<s;C++)M=R.get(C,T+1),R.set(C,T+1,R.get(C,T)),R.set(C,T,M);if(u&&T<r-1)for(let C=0;C<r;C++)M=x.get(C,T+1),x.set(C,T+1,x.get(C,T)),x.set(C,T,M);T++}j--;break}}}if(d){let T=R;R=x,x=T}this.m=r,this.n=s,this.s=E,this.U=x,this.V=R}solve(e){let t=e,r=this.threshold,s=this.s.length,i=ae.zeros(s,s);for(let v=0;v<s;v++)Math.abs(this.s[v])<=r?i.set(v,v,0):i.set(v,v,1/this.s[v]);let o=this.U,l=this.rightSingularVectors,u=l.mmul(i),h=l.rows,d=o.rows,g=ae.zeros(h,d);for(let v=0;v<h;v++)for(let _=0;_<d;_++){let E=0;for(let x=0;x<s;x++)E+=u.get(v,x)*o.get(_,x);g.set(v,_,E)}return g.mmul(t)}solveForDiagonal(e){return this.solve(ae.diag(e))}inverse(){let e=this.V,t=this.threshold,r=e.rows,s=e.columns,i=new ae(r,this.s.length);for(let d=0;d<r;d++)for(let g=0;g<s;g++)Math.abs(this.s[g])>t&&i.set(d,g,e.get(d,g)/this.s[g]);let o=this.U,l=o.rows,u=o.columns,h=new ae(r,l);for(let d=0;d<r;d++)for(let g=0;g<l;g++){let v=0;for(let _=0;_<u;_++)v+=i.get(d,_)*o.get(g,_);h.set(d,g,v)}return h}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let e=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,t=0,r=this.s;for(let s=0,i=r.length;s<i;s++)r[s]>e&&t++;return t}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return ae.diag(this.s)}};function kD(n,e=!1){return n=qr.checkMatrix(n),e?new aa(n).inverse():W1(n,ae.eye(n.rows))}function W1(n,e,t=!1){return n=qr.checkMatrix(n),e=qr.checkMatrix(e),t?new aa(n).solve(e):n.isSquare()?new Wh(n).solve(e):new tm(n).solve(e)}function qu(n){if(n=ae.checkMatrix(n),n.isSquare()){if(n.columns===0)return 1;let e,t,r,s;if(n.columns===2)return e=n.get(0,0),t=n.get(0,1),r=n.get(1,0),s=n.get(1,1),e*s-t*r;if(n.columns===3){let i,o,l;return i=new Bu(n,[1,2],[1,2]),o=new Bu(n,[1,2],[0,2]),l=new Bu(n,[1,2],[0,1]),e=n.get(0,0),t=n.get(0,1),r=n.get(0,2),e*qu(i)-t*qu(o)+r*qu(l)}else return new Wh(n).determinant}else throw Error("determinant can only be calculated for a square matrix")}function jD(n,e){let t=[];for(let r=0;r<n;r++)r!==e&&t.push(r);return t}function DD(n,e,t,r=1e-9,s=1e-9){if(n>s)return new Array(e.rows+1).fill(0);{let i=e.addRow(t,[0]);for(let o=0;o<i.rows;o++)Math.abs(i.get(o,0))<r&&i.set(o,0,0);return i.to1DArray()}}function MD(n,e={}){const{thresholdValue:t=1e-9,thresholdError:r=1e-9}=e;n=ae.checkMatrix(n);let s=n.rows,i=new ae(s,s);for(let o=0;o<s;o++){let l=ae.columnVector(n.getRow(o)),u=n.subMatrixRow(jD(s,o)).transpose(),d=new aa(u).solve(l),g=ae.sub(l,u.mmul(d)).abs().max();i.setRow(o,DD(g,d,o,t,r))}return i}function LD(n,e=Number.EPSILON){if(n=ae.checkMatrix(n),n.isEmpty())return n.transpose();let t=new aa(n,{autoTranspose:!0}),r=t.leftSingularVectors,s=t.rightSingularVectors,i=t.diagonal;for(let o=0;o<i.length;o++)Math.abs(i[o])>e?i[o]=1/i[o]:i[o]=0;return s.mmul(ae.diag(i).mmul(r.transpose()))}function VD(n,e=n,t={}){n=new ae(n);let r=!1;if(typeof e=="object"&&!ae.isMatrix(e)&&!Or.isAnyArray(e)?(t=e,e=n,r=!0):e=new ae(e),n.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:s=!0}=t;s&&(n=n.center("column"),r||(e=e.center("column")));const i=n.transpose().mmul(e);for(let o=0;o<i.rows;o++)for(let l=0;l<i.columns;l++)i.set(o,l,i.get(o,l)*(1/(n.rows-1)));return i}function FD(n,e=n,t={}){n=new ae(n);let r=!1;if(typeof e=="object"&&!ae.isMatrix(e)&&!Or.isAnyArray(e)?(t=e,e=n,r=!0):e=new ae(e),n.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:s=!0,scale:i=!0}=t;s&&(n.center("column"),r||e.center("column")),i&&(n.scale("column"),r||e.scale("column"));const o=n.standardDeviation("column",{unbiased:!0}),l=r?o:e.standardDeviation("column",{unbiased:!0}),u=n.transpose().mmul(e);for(let h=0;h<u.rows;h++)for(let d=0;d<u.columns;d++)u.set(h,d,u.get(h,d)*(1/(o[h]*l[d]))*(1/(n.rows-1)));return u}let z1=class{constructor(e,t={}){const{assumeSymmetric:r=!1}=t;if(e=qr.checkMatrix(e),!e.isSquare())throw new Error("Matrix is not a square matrix");if(e.isEmpty())throw new Error("Matrix must be non-empty");let s=e.columns,i=new ae(s,s),o=new Float64Array(s),l=new Float64Array(s),u=e,h,d,g=!1;if(r?g=!0:g=e.isSymmetric(),g){for(h=0;h<s;h++)for(d=0;d<s;d++)i.set(h,d,u.get(h,d));UD(s,l,o,i),$D(s,l,o,i)}else{let v=new ae(s,s),_=new Float64Array(s);for(d=0;d<s;d++)for(h=0;h<s;h++)v.set(h,d,u.get(h,d));BD(s,v,_,i),qD(s,l,o,i,v)}this.n=s,this.e=l,this.d=o,this.V=i}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let e=this.n,t=this.e,r=this.d,s=new ae(e,e),i,o;for(i=0;i<e;i++){for(o=0;o<e;o++)s.set(i,o,0);s.set(i,i,r[i]),t[i]>0?s.set(i,i+1,t[i]):t[i]<0&&s.set(i,i-1,t[i])}return s}};function UD(n,e,t,r){let s,i,o,l,u,h,d,g;for(u=0;u<n;u++)t[u]=r.get(n-1,u);for(l=n-1;l>0;l--){for(g=0,o=0,h=0;h<l;h++)g=g+Math.abs(t[h]);if(g===0)for(e[l]=t[l-1],u=0;u<l;u++)t[u]=r.get(l-1,u),r.set(l,u,0),r.set(u,l,0);else{for(h=0;h<l;h++)t[h]/=g,o+=t[h]*t[h];for(s=t[l-1],i=Math.sqrt(o),s>0&&(i=-i),e[l]=g*i,o=o-s*i,t[l-1]=s-i,u=0;u<l;u++)e[u]=0;for(u=0;u<l;u++){for(s=t[u],r.set(u,l,s),i=e[u]+r.get(u,u)*s,h=u+1;h<=l-1;h++)i+=r.get(h,u)*t[h],e[h]+=r.get(h,u)*s;e[u]=i}for(s=0,u=0;u<l;u++)e[u]/=o,s+=e[u]*t[u];for(d=s/(o+o),u=0;u<l;u++)e[u]-=d*t[u];for(u=0;u<l;u++){for(s=t[u],i=e[u],h=u;h<=l-1;h++)r.set(h,u,r.get(h,u)-(s*e[h]+i*t[h]));t[u]=r.get(l-1,u),r.set(l,u,0)}}t[l]=o}for(l=0;l<n-1;l++){if(r.set(n-1,l,r.get(l,l)),r.set(l,l,1),o=t[l+1],o!==0){for(h=0;h<=l;h++)t[h]=r.get(h,l+1)/o;for(u=0;u<=l;u++){for(i=0,h=0;h<=l;h++)i+=r.get(h,l+1)*r.get(h,u);for(h=0;h<=l;h++)r.set(h,u,r.get(h,u)-i*t[h])}}for(h=0;h<=l;h++)r.set(h,l+1,0)}for(u=0;u<n;u++)t[u]=r.get(n-1,u),r.set(n-1,u,0);r.set(n-1,n-1,1),e[0]=0}function $D(n,e,t,r){let s,i,o,l,u,h,d,g,v,_,E,x,R,I,F,V;for(o=1;o<n;o++)e[o-1]=e[o];e[n-1]=0;let $=0,W=0,X=Number.EPSILON;for(h=0;h<n;h++){for(W=Math.max(W,Math.abs(t[h])+Math.abs(e[h])),d=h;d<n&&!(Math.abs(e[d])<=X*W);)d++;if(d>h)do{for(s=t[h],g=(t[h+1]-s)/(2*e[h]),v=cs(g,1),g<0&&(v=-v),t[h]=e[h]/(g+v),t[h+1]=e[h]*(g+v),_=t[h+1],i=s-t[h],o=h+2;o<n;o++)t[o]-=i;for($=$+i,g=t[d],E=1,x=E,R=E,I=e[h+1],F=0,V=0,o=d-1;o>=h;o--)for(R=x,x=E,V=F,s=E*e[o],i=E*g,v=cs(g,e[o]),e[o+1]=F*v,F=e[o]/v,E=g/v,g=E*t[o]-F*s,t[o+1]=i+F*(E*s+F*t[o]),u=0;u<n;u++)i=r.get(u,o+1),r.set(u,o+1,F*r.get(u,o)+E*i),r.set(u,o,E*r.get(u,o)-F*i);g=-F*V*R*I*e[h]/_,e[h]=F*g,t[h]=E*g}while(Math.abs(e[h])>X*W);t[h]=t[h]+$,e[h]=0}for(o=0;o<n-1;o++){for(u=o,g=t[o],l=o+1;l<n;l++)t[l]<g&&(u=l,g=t[l]);if(u!==o)for(t[u]=t[o],t[o]=g,l=0;l<n;l++)g=r.get(l,o),r.set(l,o,r.get(l,u)),r.set(l,u,g)}}function BD(n,e,t,r){let s=0,i=n-1,o,l,u,h,d,g,v;for(g=s+1;g<=i-1;g++){for(v=0,h=g;h<=i;h++)v=v+Math.abs(e.get(h,g-1));if(v!==0){for(u=0,h=i;h>=g;h--)t[h]=e.get(h,g-1)/v,u+=t[h]*t[h];for(l=Math.sqrt(u),t[g]>0&&(l=-l),u=u-t[g]*l,t[g]=t[g]-l,d=g;d<n;d++){for(o=0,h=i;h>=g;h--)o+=t[h]*e.get(h,d);for(o=o/u,h=g;h<=i;h++)e.set(h,d,e.get(h,d)-o*t[h])}for(h=0;h<=i;h++){for(o=0,d=i;d>=g;d--)o+=t[d]*e.get(h,d);for(o=o/u,d=g;d<=i;d++)e.set(h,d,e.get(h,d)-o*t[d])}t[g]=v*t[g],e.set(g,g-1,v*l)}}for(h=0;h<n;h++)for(d=0;d<n;d++)r.set(h,d,h===d?1:0);for(g=i-1;g>=s+1;g--)if(e.get(g,g-1)!==0){for(h=g+1;h<=i;h++)t[h]=e.get(h,g-1);for(d=g;d<=i;d++){for(l=0,h=g;h<=i;h++)l+=t[h]*r.get(h,d);for(l=l/t[g]/e.get(g,g-1),h=g;h<=i;h++)r.set(h,d,r.get(h,d)+l*t[h])}}}function qD(n,e,t,r,s){let i=n-1,o=0,l=n-1,u=Number.EPSILON,h=0,d=0,g=0,v=0,_=0,E=0,x=0,R=0,I,F,V,$,W,X,j,A,D,T,k,M,C,Te,ne;for(I=0;I<n;I++)for((I<o||I>l)&&(t[I]=s.get(I,I),e[I]=0),F=Math.max(I-1,0);F<n;F++)d=d+Math.abs(s.get(I,F));for(;i>=o;){for($=i;$>o&&(E=Math.abs(s.get($-1,$-1))+Math.abs(s.get($,$)),E===0&&(E=d),!(Math.abs(s.get($,$-1))<u*E));)$--;if($===i)s.set(i,i,s.get(i,i)+h),t[i]=s.get(i,i),e[i]=0,i--,R=0;else if($===i-1){if(j=s.get(i,i-1)*s.get(i-1,i),g=(s.get(i-1,i-1)-s.get(i,i))/2,v=g*g+j,x=Math.sqrt(Math.abs(v)),s.set(i,i,s.get(i,i)+h),s.set(i-1,i-1,s.get(i-1,i-1)+h),A=s.get(i,i),v>=0){for(x=g>=0?g+x:g-x,t[i-1]=A+x,t[i]=t[i-1],x!==0&&(t[i]=A-j/x),e[i-1]=0,e[i]=0,A=s.get(i,i-1),E=Math.abs(A)+Math.abs(x),g=A/E,v=x/E,_=Math.sqrt(g*g+v*v),g=g/_,v=v/_,F=i-1;F<n;F++)x=s.get(i-1,F),s.set(i-1,F,v*x+g*s.get(i,F)),s.set(i,F,v*s.get(i,F)-g*x);for(I=0;I<=i;I++)x=s.get(I,i-1),s.set(I,i-1,v*x+g*s.get(I,i)),s.set(I,i,v*s.get(I,i)-g*x);for(I=o;I<=l;I++)x=r.get(I,i-1),r.set(I,i-1,v*x+g*r.get(I,i)),r.set(I,i,v*r.get(I,i)-g*x)}else t[i-1]=A+g,t[i]=A+g,e[i-1]=x,e[i]=-x;i=i-2,R=0}else{if(A=s.get(i,i),D=0,j=0,$<i&&(D=s.get(i-1,i-1),j=s.get(i,i-1)*s.get(i-1,i)),R===10){for(h+=A,I=o;I<=i;I++)s.set(I,I,s.get(I,I)-A);E=Math.abs(s.get(i,i-1))+Math.abs(s.get(i-1,i-2)),A=D=.75*E,j=-.4375*E*E}if(R===30&&(E=(D-A)/2,E=E*E+j,E>0)){for(E=Math.sqrt(E),D<A&&(E=-E),E=A-j/((D-A)/2+E),I=o;I<=i;I++)s.set(I,I,s.get(I,I)-E);h+=E,A=D=j=.964}for(R=R+1,W=i-2;W>=$&&(x=s.get(W,W),_=A-x,E=D-x,g=(_*E-j)/s.get(W+1,W)+s.get(W,W+1),v=s.get(W+1,W+1)-x-_-E,_=s.get(W+2,W+1),E=Math.abs(g)+Math.abs(v)+Math.abs(_),g=g/E,v=v/E,_=_/E,!(W===$||Math.abs(s.get(W,W-1))*(Math.abs(v)+Math.abs(_))<u*(Math.abs(g)*(Math.abs(s.get(W-1,W-1))+Math.abs(x)+Math.abs(s.get(W+1,W+1))))));)W--;for(I=W+2;I<=i;I++)s.set(I,I-2,0),I>W+2&&s.set(I,I-3,0);for(V=W;V<=i-1&&(Te=V!==i-1,V!==W&&(g=s.get(V,V-1),v=s.get(V+1,V-1),_=Te?s.get(V+2,V-1):0,A=Math.abs(g)+Math.abs(v)+Math.abs(_),A!==0&&(g=g/A,v=v/A,_=_/A)),A!==0);V++)if(E=Math.sqrt(g*g+v*v+_*_),g<0&&(E=-E),E!==0){for(V!==W?s.set(V,V-1,-E*A):$!==W&&s.set(V,V-1,-s.get(V,V-1)),g=g+E,A=g/E,D=v/E,x=_/E,v=v/g,_=_/g,F=V;F<n;F++)g=s.get(V,F)+v*s.get(V+1,F),Te&&(g=g+_*s.get(V+2,F),s.set(V+2,F,s.get(V+2,F)-g*x)),s.set(V,F,s.get(V,F)-g*A),s.set(V+1,F,s.get(V+1,F)-g*D);for(I=0;I<=Math.min(i,V+3);I++)g=A*s.get(I,V)+D*s.get(I,V+1),Te&&(g=g+x*s.get(I,V+2),s.set(I,V+2,s.get(I,V+2)-g*_)),s.set(I,V,s.get(I,V)-g),s.set(I,V+1,s.get(I,V+1)-g*v);for(I=o;I<=l;I++)g=A*r.get(I,V)+D*r.get(I,V+1),Te&&(g=g+x*r.get(I,V+2),r.set(I,V+2,r.get(I,V+2)-g*_)),r.set(I,V,r.get(I,V)-g),r.set(I,V+1,r.get(I,V+1)-g*v)}}}if(d!==0){for(i=n-1;i>=0;i--)if(g=t[i],v=e[i],v===0)for($=i,s.set(i,i,1),I=i-1;I>=0;I--){for(j=s.get(I,I)-g,_=0,F=$;F<=i;F++)_=_+s.get(I,F)*s.get(F,i);if(e[I]<0)x=j,E=_;else if($=I,e[I]===0?s.set(I,i,j!==0?-_/j:-_/(u*d)):(A=s.get(I,I+1),D=s.get(I+1,I),v=(t[I]-g)*(t[I]-g)+e[I]*e[I],X=(A*E-x*_)/v,s.set(I,i,X),s.set(I+1,i,Math.abs(A)>Math.abs(x)?(-_-j*X)/A:(-E-D*X)/x)),X=Math.abs(s.get(I,i)),u*X*X>1)for(F=I;F<=i;F++)s.set(F,i,s.get(F,i)/X)}else if(v<0)for($=i-1,Math.abs(s.get(i,i-1))>Math.abs(s.get(i-1,i))?(s.set(i-1,i-1,v/s.get(i,i-1)),s.set(i-1,i,-(s.get(i,i)-g)/s.get(i,i-1))):(ne=Ru(0,-s.get(i-1,i),s.get(i-1,i-1)-g,v),s.set(i-1,i-1,ne[0]),s.set(i-1,i,ne[1])),s.set(i,i-1,0),s.set(i,i,1),I=i-2;I>=0;I--){for(T=0,k=0,F=$;F<=i;F++)T=T+s.get(I,F)*s.get(F,i-1),k=k+s.get(I,F)*s.get(F,i);if(j=s.get(I,I)-g,e[I]<0)x=j,_=T,E=k;else if($=I,e[I]===0?(ne=Ru(-T,-k,j,v),s.set(I,i-1,ne[0]),s.set(I,i,ne[1])):(A=s.get(I,I+1),D=s.get(I+1,I),M=(t[I]-g)*(t[I]-g)+e[I]*e[I]-v*v,C=(t[I]-g)*2*v,M===0&&C===0&&(M=u*d*(Math.abs(j)+Math.abs(v)+Math.abs(A)+Math.abs(D)+Math.abs(x))),ne=Ru(A*_-x*T+v*k,A*E-x*k-v*T,M,C),s.set(I,i-1,ne[0]),s.set(I,i,ne[1]),Math.abs(A)>Math.abs(x)+Math.abs(v)?(s.set(I+1,i-1,(-T-j*s.get(I,i-1)+v*s.get(I,i))/A),s.set(I+1,i,(-k-j*s.get(I,i)-v*s.get(I,i-1))/A)):(ne=Ru(-_-D*s.get(I,i-1),-E-D*s.get(I,i),x,v),s.set(I+1,i-1,ne[0]),s.set(I+1,i,ne[1]))),X=Math.max(Math.abs(s.get(I,i-1)),Math.abs(s.get(I,i))),u*X*X>1)for(F=I;F<=i;F++)s.set(F,i-1,s.get(F,i-1)/X),s.set(F,i,s.get(F,i)/X)}for(I=0;I<n;I++)if(I<o||I>l)for(F=I;F<n;F++)r.set(I,F,s.get(I,F));for(F=n-1;F>=o;F--)for(I=o;I<=l;I++){for(x=0,V=o;V<=Math.min(F,l);V++)x=x+r.get(I,V)*s.get(V,F);r.set(I,F,x)}}}function Ru(n,e,t,r){let s,i;return Math.abs(t)>Math.abs(r)?(s=r/t,i=t+s*r,[(n+s*e)/i,(e-s*n)/i]):(s=t/r,i=r+s*t,[(s*n+e)/i,(s*e-n)/i])}let G1=class{constructor(e){if(e=qr.checkMatrix(e),!e.isSymmetric())throw new Error("Matrix is not symmetric");let t=e,r=t.rows,s=new ae(r,r),i=!0,o,l,u;for(l=0;l<r;l++){let h=0;for(u=0;u<l;u++){let d=0;for(o=0;o<u;o++)d+=s.get(u,o)*s.get(l,o);d=(t.get(l,u)-d)/s.get(u,u),s.set(l,u,d),h=h+d*d}for(h=t.get(l,l)-h,i&&(i=h>0),s.set(l,l,Math.sqrt(Math.max(h,0))),u=l+1;u<r;u++)s.set(l,u,0)}this.L=s,this.positiveDefinite=i}isPositiveDefinite(){return this.positiveDefinite}solve(e){e=qr.checkMatrix(e);let t=this.L,r=t.rows;if(e.rows!==r)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let s=e.columns,i=e.clone(),o,l,u;for(u=0;u<r;u++)for(l=0;l<s;l++){for(o=0;o<u;o++)i.set(u,l,i.get(u,l)-i.get(o,l)*t.get(u,o));i.set(u,l,i.get(u,l)/t.get(u,u))}for(u=r-1;u>=0;u--)for(l=0;l<s;l++){for(o=u+1;o<r;o++)i.set(u,l,i.get(u,l)-i.get(o,l)*t.get(o,u));i.set(u,l,i.get(u,l)/t.get(u,u))}return i}get lowerTriangularMatrix(){return this.L}};class H1{constructor(e,t={}){e=qr.checkMatrix(e);let{Y:r}=t;const{scaleScores:s=!1,maxIterations:i=1e3,terminationCriteria:o=1e-10}=t;let l;if(r){if(Or.isAnyArray(r)&&typeof r[0]=="number"?r=ae.columnVector(r):r=qr.checkMatrix(r),r.rows!==e.rows)throw new Error("Y should have the same number of rows as X");l=r.getColumnVector(0)}else l=e.getColumnVector(0);let u=1,h,d,g,v;for(let _=0;_<i&&u>o;_++)g=e.transpose().mmul(l).div(l.transpose().mmul(l).get(0,0)),g=g.div(g.norm()),h=e.mmul(g).div(g.transpose().mmul(g).get(0,0)),_>0&&(u=h.clone().sub(v).pow(2).sum()),v=h.clone(),r?(d=r.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0)),d=d.div(d.norm()),l=r.mmul(d).div(d.transpose().mmul(d).get(0,0))):l=h;if(r){let _=e.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0));_=_.div(_.norm());let E=e.clone().sub(h.clone().mmul(_.transpose())),x=l.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0)),R=r.clone().sub(h.clone().mulS(x.get(0,0)).mmul(d.transpose()));this.t=h,this.p=_.transpose(),this.w=g.transpose(),this.q=d,this.u=l,this.s=h.transpose().mmul(h),this.xResidual=E,this.yResidual=R,this.betas=x}else this.w=g.transpose(),this.s=h.transpose().mmul(h).sqrt(),s?this.t=h.clone().div(this.s.get(0,0)):this.t=h,this.xResidual=e.sub(h.mmul(g.transpose()))}}var WD=Fe.AbstractMatrix=_t,zD=Fe.CHO=G1,GD=Fe.CholeskyDecomposition=G1,HD=Fe.DistanceMatrix=$1,KD=Fe.EVD=z1,QD=Fe.EigenvalueDecomposition=z1,JD=Fe.LU=Wh,YD=Fe.LuDecomposition=Wh,K1=Fe.Matrix=ae,XD=Fe.MatrixColumnSelectionView=xD,ZD=Fe.MatrixColumnView=SD,eM=Fe.MatrixFlipColumnView=AD,tM=Fe.MatrixFlipRowView=RD,rM=Fe.MatrixRowSelectionView=PD,nM=Fe.MatrixRowView=ID,sM=Fe.MatrixSelectionView=Bu,iM=Fe.MatrixSubView=CD,oM=Fe.MatrixTransposeView=ND,aM=Fe.NIPALS=H1,lM=Fe.Nipals=H1,cM=Fe.QR=tm,uM=Fe.QrDecomposition=tm,hM=Fe.SVD=aa,fM=Fe.SingularValueDecomposition=aa,dM=Fe.SymmetricMatrix=yl,pM=Fe.WrapperMatrix1D=q1,gM=Fe.WrapperMatrix2D=qr,mM=Fe.correlation=FD,yM=Fe.covariance=VD,rv=Fe.default=ae,wM=Fe.determinant=qu,vM=Fe.inverse=kD,_M=Fe.linearDependencies=MD,bM=Fe.pseudoInverse=LD,EM=Fe.solve=W1,TM=Fe.wrap=OD;const SM=WD,xM=zD,AM=GD,RM=HD,Q1=KD,IM=QD,PM=JD,CM=YD,Ur=K1,NM=XD,OM=ZD,kM=eM,jM=tM,DM=rM,MM=nM,LM=sM,VM=iM,J1=oM,Y1=aM,FM=lM,UM=cM,$M=uM,X1=hM,BM=fM,qM=dM,WM=pM,zM=gM,GM=mM,HM=yM,KM=rv.Matrix?rv.Matrix:K1,QM=wM,JM=vM,YM=_M,XM=bM,ZM=EM,eL=TM,tL=Object.freeze(Object.defineProperty({__proto__:null,AbstractMatrix:SM,CHO:xM,CholeskyDecomposition:AM,DistanceMatrix:RM,EVD:Q1,EigenvalueDecomposition:IM,LU:PM,LuDecomposition:CM,Matrix:Ur,MatrixColumnSelectionView:NM,MatrixColumnView:OM,MatrixFlipColumnView:kM,MatrixFlipRowView:jM,MatrixRowSelectionView:DM,MatrixRowView:MM,MatrixSelectionView:LM,MatrixSubView:VM,MatrixTransposeView:J1,NIPALS:Y1,Nipals:FM,QR:UM,QrDecomposition:$M,SVD:X1,SingularValueDecomposition:BM,SymmetricMatrix:qM,WrapperMatrix1D:WM,WrapperMatrix2D:zM,correlation:GM,covariance:HM,default:KM,determinant:QM,inverse:JM,linearDependencies:YM,pseudoInverse:XM,solve:ZM,wrap:eL},Symbol.toStringTag,{value:"Module"}));class sh{constructor(e,t={},r){if(this.U=null,this.S=null,r){this.center=r.center,this.scale=r.scale,this.means=r.means,this.stdevs=r.stdevs,this.U=Ur.checkMatrix(r.U),this.S=r.S,this.R=r.R,this.excludedFeatures=r.excludedFeatures||[];return}let s;Array.isArray(e)?s=new Ur(e):s=new Ur(e);const{isCovarianceMatrix:i=!1,method:o="SVD",nCompNIPALS:l=2,center:u=!0,scale:h=!1,ignoreZeroVariance:d=!1}=t;if(this.center=u,this.scale=h,this.means=null,this.stdevs=null,this.excludedFeatures=[],i){this._computeFromCovarianceMatrix(s);return}switch(this._adjust(s,d),o){case"covarianceMatrix":{const g=new J1(s).mmul(s).div(s.rows-1);this._computeFromCovarianceMatrix(g);break}case"NIPALS":{this._computeWithNIPALS(s,l);break}case"SVD":{const g=new X1(s,{computeLeftSingularVectors:!1,computeRightSingularVectors:!0,autoTranspose:!0});this.U=g.rightSingularVectors;const v=g.diagonal,_=[];for(const E of v)_.push(E*E/(s.rows-1));this.S=_;break}default:throw new Error(`unknown method: ${o}`)}}static load(e){if(typeof e.name!="string")throw new TypeError("model must have a name property");if(e.name!=="PCA")throw new RangeError(`invalid model: ${e.name}`);return new sh(void 0,void 0,e)}predict(e,t={}){const{nComponents:r=this.U.columns}=t;let s;if(Array.isArray(e)?s=new Ur(e):s=new Ur(e),this.center&&(s.subRowVector(this.means),this.scale)){for(let o of this.excludedFeatures)s.removeColumn(o);s.divRowVector(this.stdevs)}let i=s.mmul(this.U);return i.subMatrix(0,i.rows-1,0,r-1)}invert(e){e=Ur.checkMatrix(e);let t=e.mmul(this.U.transpose());return this.center&&(this.scale&&t.mulRowVector(this.stdevs),t.addRowVector(this.means)),t}getExplainedVariance(){let e=0;if(this.S)for(const t of this.S)e+=t;return this.S?this.S.map(t=>t/e):[]}getCumulativeVariance(){let e=this.getExplainedVariance();for(let t=1;t<e.length;t++)e[t]+=e[t-1];return e}getEigenvectors(){return this.U}getEigenvalues(){return this.S}getStandardDeviations(){return this.S.map(e=>Math.sqrt(e))}getLoadings(){return this.U.transpose()}toJSON(){return{name:"PCA",center:this.center,scale:this.scale,means:this.means,stdevs:this.stdevs,U:this.U,S:this.S,excludedFeatures:this.excludedFeatures}}_adjust(e,t){if(this.center){const r=e.mean("column"),s=this.scale?e.standardDeviation("column",{mean:r}):null;if(this.means=r,e.subRowVector(r),this.scale){for(let i=0;i<s.length;i++)if(s[i]===0)if(t)e.removeColumn(i),s.splice(i,1),this.excludedFeatures.push(i),i--;else throw new RangeError(`Cannot scale the dataset (standard deviation is zero at index ${i}`);this.stdevs=s,e.divRowVector(s)}}}_computeFromCovarianceMatrix(e){const t=new Q1(e,{assumeSymmetric:!0});this.U=t.eigenvectorMatrix,this.U.flipRows(),this.S=t.realEigenvalues,this.S.reverse()}_computeWithNIPALS(e,t){this.U=new Ur(t,e.columns),this.S=[];let r=e;for(let s=0;s<t;s++){let i=new Y1(r);this.U.setRow(s,i.w.transpose()),this.S.push(Math.pow(i.s.get(0,0),2)),r=i.xResidual}this.U=this.U.transpose()}}function Ep(n,e){return n<0?(n=0-n,typeof e=="number"?`- ${n.toPrecision(e)}`:`- ${n.toString()}`):typeof e=="number"?n.toPrecision(e):n.toString()}function rL(n,e){if(!Dn(n)||!Dn(e))throw new TypeError("x and y must be arrays");if(n.length!==e.length)throw new RangeError("x and y arrays must have the same length")}class rm{constructor(){if(new.target===rm)throw new Error("BaseRegression must be subclassed")}predict(e){if(typeof e=="number")return this._predict(e);if(Dn(e)){const t=[];for(let r=0;r<e.length;r++)t.push(this._predict(e[r]));return t}else throw new TypeError("x must be a number or array")}_predict(){throw new Error("_predict must be implemented")}train(){}toString(){return""}toLaTeX(){return""}score(e,t){if(!Dn(e)||!Dn(t)||e.length!==t.length)throw new Error("x and y must be arrays of the same length");const r=e.length,s=new Array(r);for(let _=0;_<r;_++)s[_]=this._predict(e[_]);let i=0,o=0,l=0,u=0,h=0,d=0,g=0;for(let _=0;_<r;_++)i+=s[_],o+=t[_],h+=s[_]*s[_],d+=t[_]*t[_],g+=s[_]*t[_],t[_]!==0&&(l+=(t[_]-s[_])*(t[_]-s[_])/t[_]),u+=(t[_]-s[_])*(t[_]-s[_]);const v=(r*g-i*o)/Math.sqrt((r*h-i*i)*(r*d-o*o));return{r:v,r2:v*v,chi2:l,rmsd:Math.sqrt(u/r)}}}class nm extends rm{constructor(e,t){super(),e===!0?(this.slope=t.slope,this.intercept=t.intercept,this.coefficients=[t.intercept,t.slope]):(rL(e,t),nL(this,e,t))}toJSON(){return{name:"simpleLinearRegression",slope:this.slope,intercept:this.intercept}}_predict(e){return this.slope*e+this.intercept}computeX(e){return(e-this.intercept)/this.slope}toString(e){let t="f(x) = ";if(this.slope!==0){const r=Ep(this.slope,e);if(t+=`${r==="1"?"":`${r} * `}x`,this.intercept!==0){const s=Math.abs(this.intercept),i=s===this.intercept?"+":"-";t+=` ${i} ${Ep(s,e)}`}}else t+=Ep(this.intercept,e);return t}toLaTeX(e){return this.toString(e)}static load(e){if(e.name!=="simpleLinearRegression")throw new TypeError("not a SLR model");return new nm(!0,e)}}function nL(n,e,t){const r=e.length;let s=0,i=0,o=0,l=0;for(let h=0;h<r;h++)s+=e[h],i+=t[h],o+=e[h]*e[h],l+=e[h]*t[h];const u=r*l-s*i;n.slope=u/(r*o-s*s),n.intercept=1/r*i-n.slope*(1/r)*s,n.coefficients=[n.intercept,n.slope]}const sL=zi(tL);function Z1(n,e){let t=0;for(let r=0;r<n.length;r++)t+=(n[r]-e[r])*(n[r]-e[r]);return t}function iL(n,e){return Math.sqrt(Z1(n,e))}const oL=Object.freeze(Object.defineProperty({__proto__:null,euclidean:iL,squaredEuclidean:Z1},Symbol.toStringTag,{value:"Module"})),la=zi(oL),{squaredEuclidean:_6}=la,{squaredEuclidean:b6}=la,{euclidean:E6}=la,{euclidean:T6}=la,{squaredEuclidean:S6}=la,{squaredEuclidean:x6}=la,{Matrix:A6,MatrixTransposeView:R6}=sL;var aL={exports:{}};(function(n){(function(){function e(s){for(var i=0,o=s.length-1,l=void 0,u=void 0,h=void 0,d=r(i,o);;){if(o<=i)return s[d];if(o==i+1)return s[i]>s[o]&&t(s,i,o),s[d];for(l=r(i,o),s[l]>s[o]&&t(s,l,o),s[i]>s[o]&&t(s,i,o),s[l]>s[i]&&t(s,l,i),t(s,l,i+1),u=i+1,h=o;;){do u++;while(s[i]>s[u]);do h--;while(s[h]>s[i]);if(h<u)break;t(s,u,h)}t(s,i,h),h<=d&&(i=u),h>=d&&(o=h-1)}}var t=function(i,o,l){var u;return u=[i[l],i[o]],i[o]=u[0],i[l]=u[1],u},r=function(i,o){return~~((i+o)/2)};n.exports?n.exports=e:window.median=e})()})(aL);class lL{constructor(){we(this,"factorData",new Map);we(this,"correlationMatrix",null);we(this,"pca",null);we(this,"lookbackPeriod",252);we(this,"zScoreThreshold",2);we(this,"minCorrelation",.7)}async calculateFactorScores(e){const t=new Ur(e.map(o=>Object.values(o.factors))),r=this.standardizeMatrix(t);this.pca=new sh(r),this.pca.getExplainedVariance();const s=this.pca.getEigenvectors(),i={};return e.forEach((o,l)=>{const u=r.getRow(l),h=s.mmul(Ur.columnVector(u)).get(0,0);i[o.symbol]=h}),i}findPairs(e){const t=Array.from(e.keys()),r=[];for(let s=0;s<t.length;s++)for(let i=s+1;i<t.length;i++){const o=t[s],l=t[i],u=this.calculateReturns(e.get(o)),h=this.calculateReturns(e.get(l)),d=Xw(u,h);if(Math.abs(d)>this.minCorrelation){const v=new nm(u,h).slope,_=this.calculateSpread(e.get(o),e.get(l),v),E=this.calculateZScore(_);r.push({symbol1:o,symbol2:l,beta:v,correlation:d,spreadZScore:E})}}return r}generateStatArbSignals(e){const t=[];for(const r of e)if(Math.abs(r.spreadZScore)>this.zScoreThreshold){const s=r.spreadZScore<-this.zScoreThreshold;t.push({symbol:r.symbol1,type:s?"BUY":"SELL",confidence:Math.min(Math.abs(r.spreadZScore)/4,1),price:new ce(0),timestamp:Date.now(),strategy:"Statistical Arbitrage",metadata:{pair:r.symbol2,correlation:r.correlation,beta:r.beta,spreadZScore:r.spreadZScore}}),t.push({symbol:r.symbol2,type:s?"SELL":"BUY",confidence:Math.min(Math.abs(r.spreadZScore)/4,1),price:new ce(0),timestamp:Date.now(),strategy:"Statistical Arbitrage",metadata:{pair:r.symbol1,correlation:r.correlation,beta:r.beta,spreadZScore:r.spreadZScore}})}return t}async findClusters(e){this.correlationMatrix=this.calculateCorrelationMatrix(e),this.pca=new sh(e);const t=this.pca.getEigenvectors(),r=e.mmul(t);return this.kMeansClustering(r.subMatrix(0,r.rows-1,0,1),3)}optimizePortfolio(e,t=.02){const r=e.map(h=>jn(h)),s=this.calculateCovarianceMatrix(e),i=this.findOptimalWeights(r,s),o=i.reduce((h,d,g)=>h+d*r[g],0),l=Math.sqrt(i.reduce((h,d,g)=>h+i.reduce((v,_,E)=>v+d*_*s.get(g,E),0),0)),u=(o-t)/l;return{weights:i,expectedReturn:o,volatility:l,sharpeRatio:u}}standardizeMatrix(e){const t=[],r=[];for(let s=0;s<e.columns;s++){const i=e.getColumn(s);t.push(jn(i)),r.push(nh(i))}return new Ur(e.to2DArray().map(s=>s.map((i,o)=>(i-t[o])/r[o])))}calculateReturns(e){const t=[];for(let r=1;r<e.length;r++)t.push((e[r]-e[r-1])/e[r-1]);return t}calculateSpread(e,t,r){return e.map((s,i)=>Math.log(s)-r*Math.log(t[i]))}calculateZScore(e){const t=jn(e),r=nh(e);return(e[e.length-1]-t)/r}calculateCorrelationMatrix(e){const t=new Ur(e.columns,e.columns);for(let r=0;r<e.columns;r++)for(let s=r;s<e.columns;s++){const i=Xw(e.getColumn(r),e.getColumn(s));t.set(r,s,i),t.set(s,r,i)}return t}calculateCovarianceMatrix(e){const t=e.length,r=new Ur(t,t);for(let s=0;s<t;s++)for(let i=s;i<t;i++){const o=V1(e[s],e[i]);r.set(s,i,o),r.set(i,s,o)}return r}kMeansClustering(e,t){const r=e.to2DArray(),s=r.length;let i=r.slice(0,t),o=new Array(s).fill(0),l=!0;for(;l;){l=!1;for(let d=0;d<s;d++){const g=r[d];let v=1/0,_=0;for(let E=0;E<t;E++){const x=this.euclideanDistance(g,i[E]);x<v&&(v=x,_=E)}o[d]!==_&&(o[d]=_,l=!0)}const u=new Array(t).fill(0).map(()=>[0,0]),h=new Array(t).fill(0);for(let d=0;d<s;d++){const g=o[d],v=r[d];u[g][0]+=v[0],u[g][1]+=v[1],h[g]++}i=u.map((d,g)=>[d[0]/h[g],d[1]/h[g]])}return o}euclideanDistance(e,t){return Math.sqrt(e.reduce((r,s,i)=>r+Math.pow(s-t[i],2),0))}findOptimalWeights(e,t){const r=e.length,s=new Array(r).fill(1/r);for(let i=0;i<100;i++){const o=s.map((d,g)=>s.reduce((v,_,E)=>v+_*t.get(g,E),0)),u=Math.sqrt(s.reduce((d,g,v)=>d+g*o[v],0))/r;s.forEach((d,g)=>{s[g]=d*(u/o[g])});const h=s.reduce((d,g)=>d+g,0);s.forEach((d,g)=>{s[g]=d/h})}return s}}function eb(n,e){return function(){return n.apply(e,arguments)}}const{toString:cL}=Object.prototype,{getPrototypeOf:sm}=Object,zh=(n=>e=>{const t=cL.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Tn=n=>(n=n.toLowerCase(),e=>zh(e)===n),Gh=n=>e=>typeof e===n,{isArray:ca}=Array,xl=Gh("undefined");function uL(n){return n!==null&&!xl(n)&&n.constructor!==null&&!xl(n.constructor)&&Br(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const tb=Tn("ArrayBuffer");function hL(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&tb(n.buffer),e}const fL=Gh("string"),Br=Gh("function"),rb=Gh("number"),Hh=n=>n!==null&&typeof n=="object",dL=n=>n===!0||n===!1,Wu=n=>{if(zh(n)!=="object")return!1;const e=sm(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},pL=Tn("Date"),gL=Tn("File"),mL=Tn("Blob"),yL=Tn("FileList"),wL=n=>Hh(n)&&Br(n.pipe),vL=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||Br(n.append)&&((e=zh(n))==="formdata"||e==="object"&&Br(n.toString)&&n.toString()==="[object FormData]"))},_L=Tn("URLSearchParams"),[bL,EL,TL,SL]=["ReadableStream","Request","Response","Headers"].map(Tn),xL=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function zl(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let r,s;if(typeof n!="object"&&(n=[n]),ca(n))for(r=0,s=n.length;r<s;r++)e.call(null,n[r],r,n);else{const i=t?Object.getOwnPropertyNames(n):Object.keys(n),o=i.length;let l;for(r=0;r<o;r++)l=i[r],e.call(null,n[l],l,n)}}function nb(n,e){e=e.toLowerCase();const t=Object.keys(n);let r=t.length,s;for(;r-- >0;)if(s=t[r],e===s.toLowerCase())return s;return null}const ji=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,sb=n=>!xl(n)&&n!==ji;function sg(){const{caseless:n}=sb(this)&&this||{},e={},t=(r,s)=>{const i=n&&nb(e,s)||s;Wu(e[i])&&Wu(r)?e[i]=sg(e[i],r):Wu(r)?e[i]=sg({},r):ca(r)?e[i]=r.slice():e[i]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&zl(arguments[r],t);return e}const AL=(n,e,t,{allOwnKeys:r}={})=>(zl(e,(s,i)=>{t&&Br(s)?n[i]=eb(s,t):n[i]=s},{allOwnKeys:r}),n),RL=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),IL=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},PL=(n,e,t,r)=>{let s,i,o;const l={};if(e=e||{},n==null)return e;do{for(s=Object.getOwnPropertyNames(n),i=s.length;i-- >0;)o=s[i],(!r||r(o,n,e))&&!l[o]&&(e[o]=n[o],l[o]=!0);n=t!==!1&&sm(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},CL=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},NL=n=>{if(!n)return null;if(ca(n))return n;let e=n.length;if(!rb(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},OL=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&sm(Uint8Array)),kL=(n,e)=>{const r=(n&&n[Symbol.iterator]).call(n);let s;for(;(s=r.next())&&!s.done;){const i=s.value;e.call(n,i[0],i[1])}},jL=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},DL=Tn("HTMLFormElement"),ML=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,s){return r.toUpperCase()+s}),nv=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),LL=Tn("RegExp"),ib=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};zl(t,(s,i)=>{let o;(o=e(s,i,n))!==!1&&(r[i]=o||s)}),Object.defineProperties(n,r)},VL=n=>{ib(n,(e,t)=>{if(Br(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if(Br(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},FL=(n,e)=>{const t={},r=s=>{s.forEach(i=>{t[i]=!0})};return ca(n)?r(n):r(String(n).split(e)),t},UL=()=>{},$L=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e;function BL(n){return!!(n&&Br(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const qL=n=>{const e=new Array(10),t=(r,s)=>{if(Hh(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[s]=r;const i=ca(r)?[]:{};return zl(r,(o,l)=>{const u=t(o,s+1);!xl(u)&&(i[l]=u)}),e[s]=void 0,i}}return r};return t(n,0)},WL=Tn("AsyncFunction"),zL=n=>n&&(Hh(n)||Br(n))&&Br(n.then)&&Br(n.catch),ob=((n,e)=>n?setImmediate:e?((t,r)=>(ji.addEventListener("message",({source:s,data:i})=>{s===ji&&i===t&&r.length&&r.shift()()},!1),s=>{r.push(s),ji.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",Br(ji.postMessage)),GL=typeof queueMicrotask<"u"?queueMicrotask.bind(ji):typeof process<"u"&&process.nextTick||ob,K={isArray:ca,isArrayBuffer:tb,isBuffer:uL,isFormData:vL,isArrayBufferView:hL,isString:fL,isNumber:rb,isBoolean:dL,isObject:Hh,isPlainObject:Wu,isReadableStream:bL,isRequest:EL,isResponse:TL,isHeaders:SL,isUndefined:xl,isDate:pL,isFile:gL,isBlob:mL,isRegExp:LL,isFunction:Br,isStream:wL,isURLSearchParams:_L,isTypedArray:OL,isFileList:yL,forEach:zl,merge:sg,extend:AL,trim:xL,stripBOM:RL,inherits:IL,toFlatObject:PL,kindOf:zh,kindOfTest:Tn,endsWith:CL,toArray:NL,forEachEntry:kL,matchAll:jL,isHTMLForm:DL,hasOwnProperty:nv,hasOwnProp:nv,reduceDescriptors:ib,freezeMethods:VL,toObjectSet:FL,toCamelCase:ML,noop:UL,toFiniteNumber:$L,findKey:nb,global:ji,isContextDefined:sb,isSpecCompliantForm:BL,toJSONObject:qL,isAsyncFn:WL,isThenable:zL,setImmediate:ob,asap:GL};function Oe(n,e,t,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),s&&(this.response=s,this.status=s.status?s.status:null)}K.inherits(Oe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:K.toJSONObject(this.config),code:this.code,status:this.status}}});const ab=Oe.prototype,lb={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{lb[n]={value:n}});Object.defineProperties(Oe,lb);Object.defineProperty(ab,"isAxiosError",{value:!0});Oe.from=(n,e,t,r,s,i)=>{const o=Object.create(ab);return K.toFlatObject(n,o,function(u){return u!==Error.prototype},l=>l!=="isAxiosError"),Oe.call(o,n.message,e,t,r,s),o.cause=n,o.name=n.name,i&&Object.assign(o,i),o};const HL=null;function ig(n){return K.isPlainObject(n)||K.isArray(n)}function cb(n){return K.endsWith(n,"[]")?n.slice(0,-2):n}function sv(n,e,t){return n?n.concat(e).map(function(s,i){return s=cb(s),!t&&i?"["+s+"]":s}).join(t?".":""):e}function KL(n){return K.isArray(n)&&!n.some(ig)}const QL=K.toFlatObject(K,{},null,function(e){return/^is[A-Z]/.test(e)});function Kh(n,e,t){if(!K.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=K.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(x,R){return!K.isUndefined(R[x])});const r=t.metaTokens,s=t.visitor||d,i=t.dots,o=t.indexes,u=(t.Blob||typeof Blob<"u"&&Blob)&&K.isSpecCompliantForm(e);if(!K.isFunction(s))throw new TypeError("visitor must be a function");function h(E){if(E===null)return"";if(K.isDate(E))return E.toISOString();if(!u&&K.isBlob(E))throw new Oe("Blob is not supported. Use a Buffer instead.");return K.isArrayBuffer(E)||K.isTypedArray(E)?u&&typeof Blob=="function"?new Blob([E]):Buffer.from(E):E}function d(E,x,R){let I=E;if(E&&!R&&typeof E=="object"){if(K.endsWith(x,"{}"))x=r?x:x.slice(0,-2),E=JSON.stringify(E);else if(K.isArray(E)&&KL(E)||(K.isFileList(E)||K.endsWith(x,"[]"))&&(I=K.toArray(E)))return x=cb(x),I.forEach(function(V,$){!(K.isUndefined(V)||V===null)&&e.append(o===!0?sv([x],$,i):o===null?x:x+"[]",h(V))}),!1}return ig(E)?!0:(e.append(sv(R,x,i),h(E)),!1)}const g=[],v=Object.assign(QL,{defaultVisitor:d,convertValue:h,isVisitable:ig});function _(E,x){if(!K.isUndefined(E)){if(g.indexOf(E)!==-1)throw Error("Circular reference detected in "+x.join("."));g.push(E),K.forEach(E,function(I,F){(!(K.isUndefined(I)||I===null)&&s.call(e,I,K.isString(F)?F.trim():F,x,v))===!0&&_(I,x?x.concat(F):[F])}),g.pop()}}if(!K.isObject(n))throw new TypeError("data must be an object");return _(n),e}function iv(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function im(n,e){this._pairs=[],n&&Kh(n,this,e)}const ub=im.prototype;ub.append=function(e,t){this._pairs.push([e,t])};ub.toString=function(e){const t=e?function(r){return e.call(this,r,iv)}:iv;return this._pairs.map(function(s){return t(s[0])+"="+t(s[1])},"").join("&")};function JL(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function hb(n,e,t){if(!e)return n;const r=t&&t.encode||JL;K.isFunction(t)&&(t={serialize:t});const s=t&&t.serialize;let i;if(s?i=s(e,t):i=K.isURLSearchParams(e)?e.toString():new im(e,t).toString(r),i){const o=n.indexOf("#");o!==-1&&(n=n.slice(0,o)),n+=(n.indexOf("?")===-1?"?":"&")+i}return n}class ov{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){K.forEach(this.handlers,function(r){r!==null&&e(r)})}}const fb={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},YL=typeof URLSearchParams<"u"?URLSearchParams:im,XL=typeof FormData<"u"?FormData:null,ZL=typeof Blob<"u"?Blob:null,e4={isBrowser:!0,classes:{URLSearchParams:YL,FormData:XL,Blob:ZL},protocols:["http","https","file","blob","url","data"]},om=typeof window<"u"&&typeof document<"u",og=typeof navigator=="object"&&navigator||void 0,t4=om&&(!og||["ReactNative","NativeScript","NS"].indexOf(og.product)<0),r4=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",n4=om&&window.location.href||"http://localhost",s4=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:om,hasStandardBrowserEnv:t4,hasStandardBrowserWebWorkerEnv:r4,navigator:og,origin:n4},Symbol.toStringTag,{value:"Module"})),yr={...s4,...e4};function i4(n,e){return Kh(n,new yr.classes.URLSearchParams,Object.assign({visitor:function(t,r,s,i){return yr.isNode&&K.isBuffer(t)?(this.append(r,t.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},e))}function o4(n){return K.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function a4(n){const e={},t=Object.keys(n);let r;const s=t.length;let i;for(r=0;r<s;r++)i=t[r],e[i]=n[i];return e}function db(n){function e(t,r,s,i){let o=t[i++];if(o==="__proto__")return!0;const l=Number.isFinite(+o),u=i>=t.length;return o=!o&&K.isArray(s)?s.length:o,u?(K.hasOwnProp(s,o)?s[o]=[s[o],r]:s[o]=r,!l):((!s[o]||!K.isObject(s[o]))&&(s[o]=[]),e(t,r,s[o],i)&&K.isArray(s[o])&&(s[o]=a4(s[o])),!l)}if(K.isFormData(n)&&K.isFunction(n.entries)){const t={};return K.forEachEntry(n,(r,s)=>{e(o4(r),s,t,0)}),t}return null}function l4(n,e,t){if(K.isString(n))try{return(e||JSON.parse)(n),K.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}const Gl={transitional:fb,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",s=r.indexOf("application/json")>-1,i=K.isObject(e);if(i&&K.isHTMLForm(e)&&(e=new FormData(e)),K.isFormData(e))return s?JSON.stringify(db(e)):e;if(K.isArrayBuffer(e)||K.isBuffer(e)||K.isStream(e)||K.isFile(e)||K.isBlob(e)||K.isReadableStream(e))return e;if(K.isArrayBufferView(e))return e.buffer;if(K.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return i4(e,this.formSerializer).toString();if((l=K.isFileList(e))||r.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return Kh(l?{"files[]":e}:e,u&&new u,this.formSerializer)}}return i||s?(t.setContentType("application/json",!1),l4(e)):e}],transformResponse:[function(e){const t=this.transitional||Gl.transitional,r=t&&t.forcedJSONParsing,s=this.responseType==="json";if(K.isResponse(e)||K.isReadableStream(e))return e;if(e&&K.isString(e)&&(r&&!this.responseType||s)){const o=!(t&&t.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(l){if(o)throw l.name==="SyntaxError"?Oe.from(l,Oe.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:yr.classes.FormData,Blob:yr.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};K.forEach(["delete","get","head","post","put","patch"],n=>{Gl.headers[n]={}});const c4=K.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),u4=n=>{const e={};let t,r,s;return n&&n.split(`
`).forEach(function(o){s=o.indexOf(":"),t=o.substring(0,s).trim().toLowerCase(),r=o.substring(s+1).trim(),!(!t||e[t]&&c4[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},av=Symbol("internals");function sl(n){return n&&String(n).trim().toLowerCase()}function zu(n){return n===!1||n==null?n:K.isArray(n)?n.map(zu):String(n)}function h4(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const f4=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function Tp(n,e,t,r,s){if(K.isFunction(r))return r.call(this,e,t);if(s&&(e=t),!!K.isString(e)){if(K.isString(r))return e.indexOf(r)!==-1;if(K.isRegExp(r))return r.test(e)}}function d4(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function p4(n,e){const t=K.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(s,i,o){return this[r].call(this,e,s,i,o)},configurable:!0})})}let kr=class{constructor(e){e&&this.set(e)}set(e,t,r){const s=this;function i(l,u,h){const d=sl(u);if(!d)throw new Error("header name must be a non-empty string");const g=K.findKey(s,d);(!g||s[g]===void 0||h===!0||h===void 0&&s[g]!==!1)&&(s[g||u]=zu(l))}const o=(l,u)=>K.forEach(l,(h,d)=>i(h,d,u));if(K.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(K.isString(e)&&(e=e.trim())&&!f4(e))o(u4(e),t);else if(K.isHeaders(e))for(const[l,u]of e.entries())i(u,l,r);else e!=null&&i(t,e,r);return this}get(e,t){if(e=sl(e),e){const r=K.findKey(this,e);if(r){const s=this[r];if(!t)return s;if(t===!0)return h4(s);if(K.isFunction(t))return t.call(this,s,r);if(K.isRegExp(t))return t.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=sl(e),e){const r=K.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||Tp(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let s=!1;function i(o){if(o=sl(o),o){const l=K.findKey(r,o);l&&(!t||Tp(r,r[l],l,t))&&(delete r[l],s=!0)}}return K.isArray(e)?e.forEach(i):i(e),s}clear(e){const t=Object.keys(this);let r=t.length,s=!1;for(;r--;){const i=t[r];(!e||Tp(this,this[i],i,e,!0))&&(delete this[i],s=!0)}return s}normalize(e){const t=this,r={};return K.forEach(this,(s,i)=>{const o=K.findKey(r,i);if(o){t[o]=zu(s),delete t[i];return}const l=e?d4(i):String(i).trim();l!==i&&delete t[i],t[l]=zu(s),r[l]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return K.forEach(this,(r,s)=>{r!=null&&r!==!1&&(t[s]=e&&K.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(s=>r.set(s)),r}static accessor(e){const r=(this[av]=this[av]={accessors:{}}).accessors,s=this.prototype;function i(o){const l=sl(o);r[l]||(p4(s,o),r[l]=!0)}return K.isArray(e)?e.forEach(i):i(e),this}};kr.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);K.reduceDescriptors(kr.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[t]=r}}});K.freezeMethods(kr);function Sp(n,e){const t=this||Gl,r=e||t,s=kr.from(r.headers);let i=r.data;return K.forEach(n,function(l){i=l.call(t,i,s.normalize(),e?e.status:void 0)}),s.normalize(),i}function pb(n){return!!(n&&n.__CANCEL__)}function ua(n,e,t){Oe.call(this,n??"canceled",Oe.ERR_CANCELED,e,t),this.name="CanceledError"}K.inherits(ua,Oe,{__CANCEL__:!0});function gb(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new Oe("Request failed with status code "+t.status,[Oe.ERR_BAD_REQUEST,Oe.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function g4(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function m4(n,e){n=n||10;const t=new Array(n),r=new Array(n);let s=0,i=0,o;return e=e!==void 0?e:1e3,function(u){const h=Date.now(),d=r[i];o||(o=h),t[s]=u,r[s]=h;let g=i,v=0;for(;g!==s;)v+=t[g++],g=g%n;if(s=(s+1)%n,s===i&&(i=(i+1)%n),h-o<e)return;const _=d&&h-d;return _?Math.round(v*1e3/_):void 0}}function y4(n,e){let t=0,r=1e3/e,s,i;const o=(h,d=Date.now())=>{t=d,s=null,i&&(clearTimeout(i),i=null),n.apply(null,h)};return[(...h)=>{const d=Date.now(),g=d-t;g>=r?o(h,d):(s=h,i||(i=setTimeout(()=>{i=null,o(s)},r-g)))},()=>s&&o(s)]}const ih=(n,e,t=3)=>{let r=0;const s=m4(50,250);return y4(i=>{const o=i.loaded,l=i.lengthComputable?i.total:void 0,u=o-r,h=s(u),d=o<=l;r=o;const g={loaded:o,total:l,progress:l?o/l:void 0,bytes:u,rate:h||void 0,estimated:h&&l&&d?(l-o)/h:void 0,event:i,lengthComputable:l!=null,[e?"download":"upload"]:!0};n(g)},t)},lv=(n,e)=>{const t=n!=null;return[r=>e[0]({lengthComputable:t,total:n,loaded:r}),e[1]]},cv=n=>(...e)=>K.asap(()=>n(...e)),w4=yr.hasStandardBrowserEnv?((n,e)=>t=>(t=new URL(t,yr.origin),n.protocol===t.protocol&&n.host===t.host&&(e||n.port===t.port)))(new URL(yr.origin),yr.navigator&&/(msie|trident)/i.test(yr.navigator.userAgent)):()=>!0,v4=yr.hasStandardBrowserEnv?{write(n,e,t,r,s,i){const o=[n+"="+encodeURIComponent(e)];K.isNumber(t)&&o.push("expires="+new Date(t).toGMTString()),K.isString(r)&&o.push("path="+r),K.isString(s)&&o.push("domain="+s),i===!0&&o.push("secure"),document.cookie=o.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function _4(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function b4(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function mb(n,e,t){let r=!_4(e);return n&&(r||t==!1)?b4(n,e):e}const uv=n=>n instanceof kr?{...n}:n;function $i(n,e){e=e||{};const t={};function r(h,d,g,v){return K.isPlainObject(h)&&K.isPlainObject(d)?K.merge.call({caseless:v},h,d):K.isPlainObject(d)?K.merge({},d):K.isArray(d)?d.slice():d}function s(h,d,g,v){if(K.isUndefined(d)){if(!K.isUndefined(h))return r(void 0,h,g,v)}else return r(h,d,g,v)}function i(h,d){if(!K.isUndefined(d))return r(void 0,d)}function o(h,d){if(K.isUndefined(d)){if(!K.isUndefined(h))return r(void 0,h)}else return r(void 0,d)}function l(h,d,g){if(g in e)return r(h,d);if(g in n)return r(void 0,h)}const u={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:l,headers:(h,d,g)=>s(uv(h),uv(d),g,!0)};return K.forEach(Object.keys(Object.assign({},n,e)),function(d){const g=u[d]||s,v=g(n[d],e[d],d);K.isUndefined(v)&&g!==l||(t[d]=v)}),t}const yb=n=>{const e=$i({},n);let{data:t,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:i,headers:o,auth:l}=e;e.headers=o=kr.from(o),e.url=hb(mb(e.baseURL,e.url,e.allowAbsoluteUrls),n.params,n.paramsSerializer),l&&o.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):"")));let u;if(K.isFormData(t)){if(yr.hasStandardBrowserEnv||yr.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((u=o.getContentType())!==!1){const[h,...d]=u?u.split(";").map(g=>g.trim()).filter(Boolean):[];o.setContentType([h||"multipart/form-data",...d].join("; "))}}if(yr.hasStandardBrowserEnv&&(r&&K.isFunction(r)&&(r=r(e)),r||r!==!1&&w4(e.url))){const h=s&&i&&v4.read(i);h&&o.set(s,h)}return e},E4=typeof XMLHttpRequest<"u",T4=E4&&function(n){return new Promise(function(t,r){const s=yb(n);let i=s.data;const o=kr.from(s.headers).normalize();let{responseType:l,onUploadProgress:u,onDownloadProgress:h}=s,d,g,v,_,E;function x(){_&&_(),E&&E(),s.cancelToken&&s.cancelToken.unsubscribe(d),s.signal&&s.signal.removeEventListener("abort",d)}let R=new XMLHttpRequest;R.open(s.method.toUpperCase(),s.url,!0),R.timeout=s.timeout;function I(){if(!R)return;const V=kr.from("getAllResponseHeaders"in R&&R.getAllResponseHeaders()),W={data:!l||l==="text"||l==="json"?R.responseText:R.response,status:R.status,statusText:R.statusText,headers:V,config:n,request:R};gb(function(j){t(j),x()},function(j){r(j),x()},W),R=null}"onloadend"in R?R.onloadend=I:R.onreadystatechange=function(){!R||R.readyState!==4||R.status===0&&!(R.responseURL&&R.responseURL.indexOf("file:")===0)||setTimeout(I)},R.onabort=function(){R&&(r(new Oe("Request aborted",Oe.ECONNABORTED,n,R)),R=null)},R.onerror=function(){r(new Oe("Network Error",Oe.ERR_NETWORK,n,R)),R=null},R.ontimeout=function(){let $=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const W=s.transitional||fb;s.timeoutErrorMessage&&($=s.timeoutErrorMessage),r(new Oe($,W.clarifyTimeoutError?Oe.ETIMEDOUT:Oe.ECONNABORTED,n,R)),R=null},i===void 0&&o.setContentType(null),"setRequestHeader"in R&&K.forEach(o.toJSON(),function($,W){R.setRequestHeader(W,$)}),K.isUndefined(s.withCredentials)||(R.withCredentials=!!s.withCredentials),l&&l!=="json"&&(R.responseType=s.responseType),h&&([v,E]=ih(h,!0),R.addEventListener("progress",v)),u&&R.upload&&([g,_]=ih(u),R.upload.addEventListener("progress",g),R.upload.addEventListener("loadend",_)),(s.cancelToken||s.signal)&&(d=V=>{R&&(r(!V||V.type?new ua(null,n,R):V),R.abort(),R=null)},s.cancelToken&&s.cancelToken.subscribe(d),s.signal&&(s.signal.aborted?d():s.signal.addEventListener("abort",d)));const F=g4(s.url);if(F&&yr.protocols.indexOf(F)===-1){r(new Oe("Unsupported protocol "+F+":",Oe.ERR_BAD_REQUEST,n));return}R.send(i||null)})},S4=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let r=new AbortController,s;const i=function(h){if(!s){s=!0,l();const d=h instanceof Error?h:this.reason;r.abort(d instanceof Oe?d:new ua(d instanceof Error?d.message:d))}};let o=e&&setTimeout(()=>{o=null,i(new Oe(`timeout ${e} of ms exceeded`,Oe.ETIMEDOUT))},e);const l=()=>{n&&(o&&clearTimeout(o),o=null,n.forEach(h=>{h.unsubscribe?h.unsubscribe(i):h.removeEventListener("abort",i)}),n=null)};n.forEach(h=>h.addEventListener("abort",i));const{signal:u}=r;return u.unsubscribe=()=>K.asap(l),u}},x4=function*(n,e){let t=n.byteLength;if(t<e){yield n;return}let r=0,s;for(;r<t;)s=r+e,yield n.slice(r,s),r=s},A4=async function*(n,e){for await(const t of R4(n))yield*x4(t,e)},R4=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:r}=await e.read();if(t)break;yield r}}finally{await e.cancel()}},hv=(n,e,t,r)=>{const s=A4(n,e);let i=0,o,l=u=>{o||(o=!0,r&&r(u))};return new ReadableStream({async pull(u){try{const{done:h,value:d}=await s.next();if(h){l(),u.close();return}let g=d.byteLength;if(t){let v=i+=g;t(v)}u.enqueue(new Uint8Array(d))}catch(h){throw l(h),h}},cancel(u){return l(u),s.return()}},{highWaterMark:2})},Qh=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",wb=Qh&&typeof ReadableStream=="function",I4=Qh&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),vb=(n,...e)=>{try{return!!n(...e)}catch{return!1}},P4=wb&&vb(()=>{let n=!1;const e=new Request(yr.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),fv=64*1024,ag=wb&&vb(()=>K.isReadableStream(new Response("").body)),oh={stream:ag&&(n=>n.body)};Qh&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!oh[e]&&(oh[e]=K.isFunction(n[e])?t=>t[e]():(t,r)=>{throw new Oe(`Response type '${e}' is not supported`,Oe.ERR_NOT_SUPPORT,r)})})})(new Response);const C4=async n=>{if(n==null)return 0;if(K.isBlob(n))return n.size;if(K.isSpecCompliantForm(n))return(await new Request(yr.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(K.isArrayBufferView(n)||K.isArrayBuffer(n))return n.byteLength;if(K.isURLSearchParams(n)&&(n=n+""),K.isString(n))return(await I4(n)).byteLength},N4=async(n,e)=>{const t=K.toFiniteNumber(n.getContentLength());return t??C4(e)},O4=Qh&&(async n=>{let{url:e,method:t,data:r,signal:s,cancelToken:i,timeout:o,onDownloadProgress:l,onUploadProgress:u,responseType:h,headers:d,withCredentials:g="same-origin",fetchOptions:v}=yb(n);h=h?(h+"").toLowerCase():"text";let _=S4([s,i&&i.toAbortSignal()],o),E;const x=_&&_.unsubscribe&&(()=>{_.unsubscribe()});let R;try{if(u&&P4&&t!=="get"&&t!=="head"&&(R=await N4(d,r))!==0){let W=new Request(e,{method:"POST",body:r,duplex:"half"}),X;if(K.isFormData(r)&&(X=W.headers.get("content-type"))&&d.setContentType(X),W.body){const[j,A]=lv(R,ih(cv(u)));r=hv(W.body,fv,j,A)}}K.isString(g)||(g=g?"include":"omit");const I="credentials"in Request.prototype;E=new Request(e,{...v,signal:_,method:t.toUpperCase(),headers:d.normalize().toJSON(),body:r,duplex:"half",credentials:I?g:void 0});let F=await fetch(E);const V=ag&&(h==="stream"||h==="response");if(ag&&(l||V&&x)){const W={};["status","statusText","headers"].forEach(D=>{W[D]=F[D]});const X=K.toFiniteNumber(F.headers.get("content-length")),[j,A]=l&&lv(X,ih(cv(l),!0))||[];F=new Response(hv(F.body,fv,j,()=>{A&&A(),x&&x()}),W)}h=h||"text";let $=await oh[K.findKey(oh,h)||"text"](F,n);return!V&&x&&x(),await new Promise((W,X)=>{gb(W,X,{data:$,headers:kr.from(F.headers),status:F.status,statusText:F.statusText,config:n,request:E})})}catch(I){throw x&&x(),I&&I.name==="TypeError"&&/fetch/i.test(I.message)?Object.assign(new Oe("Network Error",Oe.ERR_NETWORK,n,E),{cause:I.cause||I}):Oe.from(I,I&&I.code,n,E)}}),lg={http:HL,xhr:T4,fetch:O4};K.forEach(lg,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const dv=n=>`- ${n}`,k4=n=>K.isFunction(n)||n===null||n===!1,_b={getAdapter:n=>{n=K.isArray(n)?n:[n];const{length:e}=n;let t,r;const s={};for(let i=0;i<e;i++){t=n[i];let o;if(r=t,!k4(t)&&(r=lg[(o=String(t)).toLowerCase()],r===void 0))throw new Oe(`Unknown adapter '${o}'`);if(r)break;s[o||"#"+i]=r}if(!r){const i=Object.entries(s).map(([l,u])=>`adapter ${l} `+(u===!1?"is not supported by the environment":"is not available in the build"));let o=e?i.length>1?`since :
`+i.map(dv).join(`
`):" "+dv(i[0]):"as no adapter specified";throw new Oe("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return r},adapters:lg};function xp(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new ua(null,n)}function pv(n){return xp(n),n.headers=kr.from(n.headers),n.data=Sp.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),_b.getAdapter(n.adapter||Gl.adapter)(n).then(function(r){return xp(n),r.data=Sp.call(n,n.transformResponse,r),r.headers=kr.from(r.headers),r},function(r){return pb(r)||(xp(n),r&&r.response&&(r.response.data=Sp.call(n,n.transformResponse,r.response),r.response.headers=kr.from(r.response.headers))),Promise.reject(r)})}const bb="1.8.4",Jh={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{Jh[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});const gv={};Jh.transitional=function(e,t,r){function s(i,o){return"[Axios v"+bb+"] Transitional option '"+i+"'"+o+(r?". "+r:"")}return(i,o,l)=>{if(e===!1)throw new Oe(s(o," has been removed"+(t?" in "+t:"")),Oe.ERR_DEPRECATED);return t&&!gv[o]&&(gv[o]=!0,console.warn(s(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(i,o,l):!0}};Jh.spelling=function(e){return(t,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function j4(n,e,t){if(typeof n!="object")throw new Oe("options must be an object",Oe.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let s=r.length;for(;s-- >0;){const i=r[s],o=e[i];if(o){const l=n[i],u=l===void 0||o(l,i,n);if(u!==!0)throw new Oe("option "+i+" must be "+u,Oe.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Oe("Unknown option "+i,Oe.ERR_BAD_OPTION)}}const Gu={assertOptions:j4,validators:Jh},Nn=Gu.validators;let Mi=class{constructor(e){this.defaults=e,this.interceptors={request:new ov,response:new ov}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const i=s.stack?s.stack.replace(/^.+\n/,""):"";try{r.stack?i&&!String(r.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+i):r.stack=i}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=$i(this.defaults,t);const{transitional:r,paramsSerializer:s,headers:i}=t;r!==void 0&&Gu.assertOptions(r,{silentJSONParsing:Nn.transitional(Nn.boolean),forcedJSONParsing:Nn.transitional(Nn.boolean),clarifyTimeoutError:Nn.transitional(Nn.boolean)},!1),s!=null&&(K.isFunction(s)?t.paramsSerializer={serialize:s}:Gu.assertOptions(s,{encode:Nn.function,serialize:Nn.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Gu.assertOptions(t,{baseUrl:Nn.spelling("baseURL"),withXsrfToken:Nn.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=i&&K.merge(i.common,i[t.method]);i&&K.forEach(["delete","get","head","post","put","patch","common"],E=>{delete i[E]}),t.headers=kr.concat(o,i);const l=[];let u=!0;this.interceptors.request.forEach(function(x){typeof x.runWhen=="function"&&x.runWhen(t)===!1||(u=u&&x.synchronous,l.unshift(x.fulfilled,x.rejected))});const h=[];this.interceptors.response.forEach(function(x){h.push(x.fulfilled,x.rejected)});let d,g=0,v;if(!u){const E=[pv.bind(this),void 0];for(E.unshift.apply(E,l),E.push.apply(E,h),v=E.length,d=Promise.resolve(t);g<v;)d=d.then(E[g++],E[g++]);return d}v=l.length;let _=t;for(g=0;g<v;){const E=l[g++],x=l[g++];try{_=E(_)}catch(R){x.call(this,R);break}}try{d=pv.call(this,_)}catch(E){return Promise.reject(E)}for(g=0,v=h.length;g<v;)d=d.then(h[g++],h[g++]);return d}getUri(e){e=$i(this.defaults,e);const t=mb(e.baseURL,e.url,e.allowAbsoluteUrls);return hb(t,e.params,e.paramsSerializer)}};K.forEach(["delete","get","head","options"],function(e){Mi.prototype[e]=function(t,r){return this.request($i(r||{},{method:e,url:t,data:(r||{}).data}))}});K.forEach(["post","put","patch"],function(e){function t(r){return function(i,o,l){return this.request($i(l||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}Mi.prototype[e]=t(),Mi.prototype[e+"Form"]=t(!0)});let D4=class Eb{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const r=this;this.promise.then(s=>{if(!r._listeners)return;let i=r._listeners.length;for(;i-- >0;)r._listeners[i](s);r._listeners=null}),this.promise.then=s=>{let i;const o=new Promise(l=>{r.subscribe(l),i=l}).then(s);return o.cancel=function(){r.unsubscribe(i)},o},e(function(i,o,l){r.reason||(r.reason=new ua(i,o,l),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=r=>{e.abort(r)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new Eb(function(s){e=s}),cancel:e}}};function M4(n){return function(t){return n.apply(null,t)}}function L4(n){return K.isObject(n)&&n.isAxiosError===!0}const cg={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(cg).forEach(([n,e])=>{cg[e]=n});function Tb(n){const e=new Mi(n),t=eb(Mi.prototype.request,e);return K.extend(t,Mi.prototype,e,{allOwnKeys:!0}),K.extend(t,e,null,{allOwnKeys:!0}),t.create=function(s){return Tb($i(n,s))},t}const Ct=Tb(Gl);Ct.Axios=Mi;Ct.CanceledError=ua;Ct.CancelToken=D4;Ct.isCancel=pb;Ct.VERSION=bb;Ct.toFormData=Kh;Ct.AxiosError=Oe;Ct.Cancel=Ct.CanceledError;Ct.all=function(e){return Promise.all(e)};Ct.spread=M4;Ct.isAxiosError=L4;Ct.mergeConfig=$i;Ct.AxiosHeaders=kr;Ct.formToJSON=n=>db(K.isHTMLForm(n)?new FormData(n):n);Ct.getAdapter=_b.getAdapter;Ct.HttpStatusCode=cg;Ct.default=Ct;const{Axios:C6,AxiosError:N6,CanceledError:O6,isCancel:k6,CancelToken:j6,VERSION:D6,all:M6,Cancel:L6,isAxiosError:V6,spread:F6,toFormData:U6,AxiosHeaders:$6,HttpStatusCode:B6,formToJSON:q6,getAdapter:W6,mergeConfig:z6}=Ct;let V4=class{constructor(){we(this,"logs",[]);we(this,"maxLogs",1e3)}createLogEntry(e,t,r){return{level:e,message:t,timestamp:new Date().toISOString(),data:this.sanitizeData(r)}}sanitizeData(e){return e instanceof ce?e.toString():Array.isArray(e)?e.map(t=>this.sanitizeData(t)):e&&typeof e=="object"?Object.fromEntries(Object.entries(e).map(([t,r])=>[t,this.sanitizeData(r)])):e}addLog(e){this.logs.push(e),this.logs.length>this.maxLogs&&this.logs.shift()}info(e,t){this.addLog(this.createLogEntry("info",e,t))}warn(e,t){this.addLog(this.createLogEntry("warn",e,t))}error(e,t){this.addLog(this.createLogEntry("error",e,t))}debug(e,t){}getLogs(e){return e?this.logs.filter(t=>t.level===e):this.logs}clearLogs(){this.logs=[]}};const ls=new V4;var F4={};class U4{constructor(e){we(this,"configs",[]);we(this,"retryAttempts",3);we(this,"retryDelay",1e3);e&&(this.configs=e)}async logBacktestResult(e){const t=this.configs.filter(r=>r.enabled).map(r=>this.sendWebhook(r,e));try{await Promise.all(t),ls.info("✅ Webhook logs sent successfully")}catch(r){throw ls.error("❌ Error sending webhook logs:",r),r}}async sendWebhook(e,t){const r=this.formatPayload(e.type,t),s={"Content-Type":"application/json",...e.headers};for(let i=1;i<=this.retryAttempts;i++)try{await Ct.post(e.url,r,{headers:s});return}catch(o){if(i===this.retryAttempts)throw o;await new Promise(l=>setTimeout(l,this.retryDelay*i))}}formatPayload(e,t){switch(e){case"discord":return this.formatDiscordPayload(t);case"notion":return this.formatNotionPayload(t);default:return this.formatCustomPayload(t)}}formatDiscordPayload(e){const t=e.pnl>=0?65280:16711680;return{embeds:[{title:`📊 Backtest Results: ${e.strategy}`,color:t,fields:[{name:"PnL",value:`$${e.pnl.toFixed(2)}`,inline:!0},{name:"Win Rate",value:`${(e.metrics.winRate*100).toFixed(1)}%`,inline:!0},{name:"Sharpe Ratio",value:e.metrics.sharpeRatio.toFixed(2),inline:!0},{name:"Max Drawdown",value:`${(e.metrics.maxDrawdown*100).toFixed(1)}%`,inline:!0},{name:"Profit Factor",value:e.metrics.profitFactor.toFixed(2),inline:!0},{name:"Total Trades",value:e.trades.length.toString(),inline:!0}],timestamp:e.timestamp}]}}formatNotionPayload(e){return{parent:{database_id:F4.NOTION_DATABASE_ID},properties:{Name:{title:[{text:{content:`Backtest: ${e.strategy}`}}]},PnL:{number:e.pnl},"Win Rate":{number:e.metrics.winRate*100},"Sharpe Ratio":{number:e.metrics.sharpeRatio},"Max Drawdown":{number:e.metrics.maxDrawdown*100},"Profit Factor":{number:e.metrics.profitFactor},"Total Trades":{number:e.trades.length},Date:{date:{start:e.timestamp}}}}}formatCustomPayload(e){return{strategy:e.strategy,pnl:e.pnl,metrics:e.metrics,trades:e.trades.map(t=>({timestamp:t.timestamp,type:t.type,price:t.price.toString(),confidence:t.confidence})),timestamp:e.timestamp}}addWebhook(e){this.configs.push(e)}removeWebhook(e){this.configs=this.configs.filter(t=>t.url!==e)}updateWebhook(e,t){const r=this.configs.findIndex(s=>s.url===e);r!==-1&&(this.configs[r]={...this.configs[r],...t})}getWebhooks(){return this.configs}}const $4=new Gj,B4=new lL,q4=new U4([{url:"",type:"discord",enabled:!0}]);function W4(){const[n,e]=se.useState("BTCUSDT"),[t,r]=se.useState("1D"),[s,i]=se.useState(!1),[o,l]=se.useState(null),[u,h]=se.useState({rsiPeriod:14,macdFast:12,macdSlow:26,macdSignal:9,atrPeriod:14,atrMultiplier:2}),[d,g]=se.useState(`// Strategy Template
function analyze(data) {
  const { close, high, low } = data;
  const signals = [];
  
  // Calculate indicators
  const rsi = calculateRSI(close, parameters.rsiPeriod);
  const macd = calculateMACD(close, parameters.macdFast, parameters.macdSlow, parameters.macdSignal);
  const atr = calculateATR(high, low, close, parameters.atrPeriod);
  
  // Generate signals
  for (let i = parameters.macdSlow; i < close.length; i++) {
    if (rsi[i] < 30 && macd.histogram[i] > 0) {
      signals.push({
        type: 'BUY',
        price: close[i],
        timestamp: data.timestamp[i],
        confidence: 0.8,
        metadata: {
          rsi: rsi[i],
          macd: macd.histogram[i],
          atr: atr[i]
        }
      });
    } else if (rsi[i] > 70 && macd.histogram[i] < 0) {
      signals.push({
        type: 'SELL',
        price: close[i],
        timestamp: data.timestamp[i],
        confidence: 0.8,
        metadata: {
          rsi: rsi[i],
          macd: macd.histogram[i],
          atr: atr[i]
        }
      });
    }
  }
  
  return signals;
}`),v=async()=>{i(!0);try{const x=await E(n,t),R=await $4.evaluateStrategy({name:"Custom Strategy",parameters:u,code:d},x),I=R.signals.map($=>$.price.toNumber()),F=B4.optimizePortfolio([I]),V={pnl:R.metrics.profitFactor*1e4,winRate:R.metrics.winRate*100,sharpeRatio:R.metrics.sharpeRatio,maxDrawdown:R.metrics.maxDrawdown*100,trades:R.signals,equity:_(R.signals)};l(V),await q4.logBacktestResult({strategy:"Custom Strategy",pnl:V.pnl,trades:R.signals,metrics:R.metrics,timestamp:new Date().toISOString()})}catch(x){console.error("Backtest error:",x)}finally{i(!1)}},_=x=>{const R=[1e4];let I=1e4;return x.forEach(F=>{I+=F.pnl,R.push(I)}),R},E=async(x,R)=>new Promise(I=>{setTimeout(()=>{I([])},1e3)});return m.jsxs("div",{className:"bg-gray-900 rounded-lg p-6",children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsxs("h2",{className:"text-2xl font-bold flex items-center",children:[m.jsx(_h,{className:"w-6 h-6 text-blue-500 mr-2"}),"Backtest Command Center"]}),m.jsxs("div",{className:"flex items-center space-x-4",children:[m.jsxs("select",{value:n,onChange:x=>e(x.target.value),className:"bg-gray-800 border border-gray-700 rounded-lg px-3 py-1",children:[m.jsx("option",{value:"BTCUSDT",children:"BTC/USDT"}),m.jsx("option",{value:"ETHUSDT",children:"ETH/USDT"}),m.jsx("option",{value:"SOLUSDT",children:"SOL/USDT"})]}),m.jsxs("select",{value:t,onChange:x=>r(x.target.value),className:"bg-gray-800 border border-gray-700 rounded-lg px-3 py-1",children:[m.jsx("option",{value:"1m",children:"1 Minute"}),m.jsx("option",{value:"5m",children:"5 Minutes"}),m.jsx("option",{value:"1h",children:"1 Hour"}),m.jsx("option",{value:"1D",children:"1 Day"})]})]})]}),m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[m.jsxs("div",{className:"space-y-6",children:[m.jsx("div",{className:"h-[400px] bg-gray-800 rounded-lg overflow-hidden",children:m.jsx(jg,{symbol:n,theme:"dark"})}),m.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[m.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Strategy Parameters"}),m.jsx("div",{className:"grid grid-cols-2 gap-4",children:Object.entries(u).map(([x,R])=>m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:x.charAt(0).toUpperCase()+x.slice(1)}),m.jsx("input",{type:"number",value:R,onChange:I=>h({...u,[x]:parseFloat(I.target.value)}),className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-1"})]},x))})]})]}),m.jsxs("div",{className:"space-y-6",children:[o&&m.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[m.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Backtest Results"}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-400",children:"Total PnL"}),m.jsxs("p",{className:`text-2xl font-bold ${o.pnl>=0?"text-green-500":"text-red-500"}`,children:["$",o.pnl.toFixed(2)]})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-400",children:"Win Rate"}),m.jsxs("p",{className:"text-2xl font-bold text-green-500",children:[o.winRate.toFixed(1),"%"]})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-400",children:"Sharpe Ratio"}),m.jsx("p",{className:"text-2xl font-bold text-blue-500",children:o.sharpeRatio.toFixed(2)})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-400",children:"Max Drawdown"}),m.jsxs("p",{className:"text-2xl font-bold text-red-500",children:[o.maxDrawdown.toFixed(1),"%"]})]})]})]}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("button",{onClick:v,disabled:s,className:`px-4 py-2 rounded-lg flex items-center space-x-2 ${s?"bg-gray-700 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:[s?m.jsx(b_,{className:"w-5 h-5 animate-spin"}):m.jsx(E_,{className:"w-5 h-5"}),m.jsx("span",{children:s?"Running...":"Run Backtest"})]}),m.jsxs("button",{onClick:()=>{},className:"px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg flex items-center space-x-2",children:[m.jsx(T_,{className:"w-5 h-5"}),m.jsx("span",{children:"Save Strategy"})]})]})]})]})]})}function z4(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function mv(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function yv(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?mv(Object(t),!0).forEach(function(r){z4(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):mv(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function G4(n,e){if(n==null)return{};var t={},r=Object.keys(n),s,i;for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&(t[s]=n[s]);return t}function H4(n,e){if(n==null)return{};var t=G4(n,e),r,s;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function K4(n,e){return Q4(n)||J4(n,e)||Y4(n,e)||X4()}function Q4(n){if(Array.isArray(n))return n}function J4(n,e){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(n)))){var t=[],r=!0,s=!1,i=void 0;try{for(var o=n[Symbol.iterator](),l;!(r=(l=o.next()).done)&&(t.push(l.value),!(e&&t.length===e));r=!0);}catch(u){s=!0,i=u}finally{try{!r&&o.return!=null&&o.return()}finally{if(s)throw i}}return t}}function Y4(n,e){if(n){if(typeof n=="string")return wv(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return wv(n,e)}}function wv(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function X4(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Z4(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function vv(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function _v(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?vv(Object(t),!0).forEach(function(r){Z4(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):vv(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function eV(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return function(r){return e.reduceRight(function(s,i){return i(s)},r)}}function ll(n){return function e(){for(var t=this,r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return s.length>=n.length?n.apply(this,s):function(){for(var o=arguments.length,l=new Array(o),u=0;u<o;u++)l[u]=arguments[u];return e.apply(t,[].concat(s,l))}}}function ah(n){return{}.toString.call(n).includes("Object")}function tV(n){return!Object.keys(n).length}function Al(n){return typeof n=="function"}function rV(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function nV(n,e){return ah(e)||Hs("changeType"),Object.keys(e).some(function(t){return!rV(n,t)})&&Hs("changeField"),e}function sV(n){Al(n)||Hs("selectorType")}function iV(n){Al(n)||ah(n)||Hs("handlerType"),ah(n)&&Object.values(n).some(function(e){return!Al(e)})&&Hs("handlersType")}function oV(n){n||Hs("initialIsRequired"),ah(n)||Hs("initialType"),tV(n)&&Hs("initialContent")}function aV(n,e){throw new Error(n[e]||n.default)}var lV={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},Hs=ll(aV)(lV),Iu={changes:nV,selector:sV,handler:iV,initial:oV};function cV(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Iu.initial(n),Iu.handler(e);var t={current:n},r=ll(fV)(t,e),s=ll(hV)(t),i=ll(Iu.changes)(n),o=ll(uV)(t);function l(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(d){return d};return Iu.selector(h),h(t.current)}function u(h){eV(r,s,i,o)(h)}return[l,u]}function uV(n,e){return Al(e)?e(n.current):e}function hV(n,e){return n.current=_v(_v({},n.current),e),e}function fV(n,e,t){return Al(e)?e(n.current):Object.keys(t).forEach(function(r){var s;return(s=e[r])===null||s===void 0?void 0:s.call(e,n.current[r])}),t}var dV={create:cV},pV={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs"}};function gV(n){return function e(){for(var t=this,r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return s.length>=n.length?n.apply(this,s):function(){for(var o=arguments.length,l=new Array(o),u=0;u<o;u++)l[u]=arguments[u];return e.apply(t,[].concat(s,l))}}}function mV(n){return{}.toString.call(n).includes("Object")}function yV(n){return n||bv("configIsRequired"),mV(n)||bv("configType"),n.urls?(wV(),{paths:{vs:n.urls.monacoBase}}):n}function wV(){console.warn(Sb.deprecation)}function vV(n,e){throw new Error(n[e]||n.default)}var Sb={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},bv=gV(vV)(Sb),_V={config:yV},bV=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(s){return t.reduceRight(function(i,o){return o(i)},s)}};function xb(n,e){return Object.keys(e).forEach(function(t){e[t]instanceof Object&&n[t]&&Object.assign(e[t],xb(n[t],e[t]))}),yv(yv({},n),e)}var EV={type:"cancelation",msg:"operation is manually canceled"};function Ap(n){var e=!1,t=new Promise(function(r,s){n.then(function(i){return e?s(EV):r(i)}),n.catch(s)});return t.cancel=function(){return e=!0},t}var TV=dV.create({config:pV,isInitialized:!1,resolve:null,reject:null,monaco:null}),Ab=K4(TV,2),Hl=Ab[0],Yh=Ab[1];function SV(n){var e=_V.config(n),t=e.monaco,r=H4(e,["monaco"]);Yh(function(s){return{config:xb(s.config,r),monaco:t}})}function xV(){var n=Hl(function(e){var t=e.monaco,r=e.isInitialized,s=e.resolve;return{monaco:t,isInitialized:r,resolve:s}});if(!n.isInitialized){if(Yh({isInitialized:!0}),n.monaco)return n.resolve(n.monaco),Ap(Rp);if(window.monaco&&window.monaco.editor)return Rb(window.monaco),n.resolve(window.monaco),Ap(Rp);bV(AV,IV)(PV)}return Ap(Rp)}function AV(n){return document.body.appendChild(n)}function RV(n){var e=document.createElement("script");return n&&(e.src=n),e}function IV(n){var e=Hl(function(r){var s=r.config,i=r.reject;return{config:s,reject:i}}),t=RV("".concat(e.config.paths.vs,"/loader.js"));return t.onload=function(){return n()},t.onerror=e.reject,t}function PV(){var n=Hl(function(t){var r=t.config,s=t.resolve,i=t.reject;return{config:r,resolve:s,reject:i}}),e=window.require;e.config(n.config),e(["vs/editor/editor.main"],function(t){Rb(t),n.resolve(t)},function(t){n.reject(t)})}function Rb(n){Hl().monaco||Yh({monaco:n})}function CV(){return Hl(function(n){var e=n.monaco;return e})}var Rp=new Promise(function(n,e){return Yh({resolve:n,reject:e})}),Ib={config:SV,init:xV,__getMonacoInstance:CV},NV={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}},Ip=NV,OV={container:{display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"}},kV=OV;function jV({children:n}){return Uo.createElement("div",{style:kV.container},n)}var DV=jV,MV=DV;function LV({width:n,height:e,isEditorReady:t,loading:r,_ref:s,className:i,wrapperProps:o}){return Uo.createElement("section",{style:{...Ip.wrapper,width:n,height:e},...o},!t&&Uo.createElement(MV,null,r),Uo.createElement("div",{ref:s,style:{...Ip.fullWidth,...!t&&Ip.hide},className:i}))}var VV=LV,Pb=se.memo(VV);function FV(n){se.useEffect(n,[])}var Cb=FV;function UV(n,e,t=!0){let r=se.useRef(!0);se.useEffect(r.current||!t?()=>{r.current=!1}:n,e)}var $r=UV;function wl(){}function Fo(n,e,t,r){return $V(n,r)||BV(n,e,t,r)}function $V(n,e){return n.editor.getModel(Nb(n,e))}function BV(n,e,t,r){return n.editor.createModel(e,t,r?Nb(n,r):void 0)}function Nb(n,e){return n.Uri.parse(e)}function qV({original:n,modified:e,language:t,originalLanguage:r,modifiedLanguage:s,originalModelPath:i,modifiedModelPath:o,keepCurrentOriginalModel:l=!1,keepCurrentModifiedModel:u=!1,theme:h="light",loading:d="Loading...",options:g={},height:v="100%",width:_="100%",className:E,wrapperProps:x={},beforeMount:R=wl,onMount:I=wl}){let[F,V]=se.useState(!1),[$,W]=se.useState(!0),X=se.useRef(null),j=se.useRef(null),A=se.useRef(null),D=se.useRef(I),T=se.useRef(R),k=se.useRef(!1);Cb(()=>{let ne=Ib.init();return ne.then(oe=>(j.current=oe)&&W(!1)).catch(oe=>(oe==null?void 0:oe.type)!=="cancelation"&&console.error("Monaco initialization: error:",oe)),()=>X.current?Te():ne.cancel()}),$r(()=>{if(X.current&&j.current){let ne=X.current.getOriginalEditor(),oe=Fo(j.current,n||"",r||t||"text",i||"");oe!==ne.getModel()&&ne.setModel(oe)}},[i],F),$r(()=>{if(X.current&&j.current){let ne=X.current.getModifiedEditor(),oe=Fo(j.current,e||"",s||t||"text",o||"");oe!==ne.getModel()&&ne.setModel(oe)}},[o],F),$r(()=>{let ne=X.current.getModifiedEditor();ne.getOption(j.current.editor.EditorOption.readOnly)?ne.setValue(e||""):e!==ne.getValue()&&(ne.executeEdits("",[{range:ne.getModel().getFullModelRange(),text:e||"",forceMoveMarkers:!0}]),ne.pushUndoStop())},[e],F),$r(()=>{var ne,oe;(oe=(ne=X.current)==null?void 0:ne.getModel())==null||oe.original.setValue(n||"")},[n],F),$r(()=>{let{original:ne,modified:oe}=X.current.getModel();j.current.editor.setModelLanguage(ne,r||t||"text"),j.current.editor.setModelLanguage(oe,s||t||"text")},[t,r,s],F),$r(()=>{var ne;(ne=j.current)==null||ne.editor.setTheme(h)},[h],F),$r(()=>{var ne;(ne=X.current)==null||ne.updateOptions(g)},[g],F);let M=se.useCallback(()=>{var Ae;if(!j.current)return;T.current(j.current);let ne=Fo(j.current,n||"",r||t||"text",i||""),oe=Fo(j.current,e||"",s||t||"text",o||"");(Ae=X.current)==null||Ae.setModel({original:ne,modified:oe})},[t,e,s,n,r,i,o]),C=se.useCallback(()=>{var ne;!k.current&&A.current&&(X.current=j.current.editor.createDiffEditor(A.current,{automaticLayout:!0,...g}),M(),(ne=j.current)==null||ne.editor.setTheme(h),V(!0),k.current=!0)},[g,h,M]);se.useEffect(()=>{F&&D.current(X.current,j.current)},[F]),se.useEffect(()=>{!$&&!F&&C()},[$,F,C]);function Te(){var oe,Ae,Le,wt;let ne=(oe=X.current)==null?void 0:oe.getModel();l||((Ae=ne==null?void 0:ne.original)==null||Ae.dispose()),u||((Le=ne==null?void 0:ne.modified)==null||Le.dispose()),(wt=X.current)==null||wt.dispose()}return Uo.createElement(Pb,{width:_,height:v,isEditorReady:F,loading:d,_ref:A,className:E,wrapperProps:x})}var WV=qV;se.memo(WV);function zV(n){let e=se.useRef();return se.useEffect(()=>{e.current=n},[n]),e.current}var GV=zV,Pu=new Map;function HV({defaultValue:n,defaultLanguage:e,defaultPath:t,value:r,language:s,path:i,theme:o="light",line:l,loading:u="Loading...",options:h={},overrideServices:d={},saveViewState:g=!0,keepCurrentModel:v=!1,width:_="100%",height:E="100%",className:x,wrapperProps:R={},beforeMount:I=wl,onMount:F=wl,onChange:V,onValidate:$=wl}){let[W,X]=se.useState(!1),[j,A]=se.useState(!0),D=se.useRef(null),T=se.useRef(null),k=se.useRef(null),M=se.useRef(F),C=se.useRef(I),Te=se.useRef(),ne=se.useRef(r),oe=GV(i),Ae=se.useRef(!1),Le=se.useRef(!1);Cb(()=>{let me=Ib.init();return me.then(Re=>(D.current=Re)&&A(!1)).catch(Re=>(Re==null?void 0:Re.type)!=="cancelation"&&console.error("Monaco initialization: error:",Re)),()=>T.current?nt():me.cancel()}),$r(()=>{var Re,ue,at,Ge;let me=Fo(D.current,n||r||"",e||s||"",i||t||"");me!==((Re=T.current)==null?void 0:Re.getModel())&&(g&&Pu.set(oe,(ue=T.current)==null?void 0:ue.saveViewState()),(at=T.current)==null||at.setModel(me),g&&((Ge=T.current)==null||Ge.restoreViewState(Pu.get(i))))},[i],W),$r(()=>{var me;(me=T.current)==null||me.updateOptions(h)},[h],W),$r(()=>{!T.current||r===void 0||(T.current.getOption(D.current.editor.EditorOption.readOnly)?T.current.setValue(r):r!==T.current.getValue()&&(Le.current=!0,T.current.executeEdits("",[{range:T.current.getModel().getFullModelRange(),text:r,forceMoveMarkers:!0}]),T.current.pushUndoStop(),Le.current=!1))},[r],W),$r(()=>{var Re,ue;let me=(Re=T.current)==null?void 0:Re.getModel();me&&s&&((ue=D.current)==null||ue.editor.setModelLanguage(me,s))},[s],W),$r(()=>{var me;l!==void 0&&((me=T.current)==null||me.revealLine(l))},[l],W),$r(()=>{var me;(me=D.current)==null||me.editor.setTheme(o)},[o],W);let wt=se.useCallback(()=>{var me;if(!(!k.current||!D.current)&&!Ae.current){C.current(D.current);let Re=i||t,ue=Fo(D.current,r||n||"",e||s||"",Re||"");T.current=(me=D.current)==null?void 0:me.editor.create(k.current,{model:ue,automaticLayout:!0,...h},d),g&&T.current.restoreViewState(Pu.get(Re)),D.current.editor.setTheme(o),l!==void 0&&T.current.revealLine(l),X(!0),Ae.current=!0}},[n,e,t,r,s,i,h,d,g,o,l]);se.useEffect(()=>{W&&M.current(T.current,D.current)},[W]),se.useEffect(()=>{!j&&!W&&wt()},[j,W,wt]),ne.current=r,se.useEffect(()=>{var me,Re;W&&V&&((me=Te.current)==null||me.dispose(),Te.current=(Re=T.current)==null?void 0:Re.onDidChangeModelContent(ue=>{Le.current||V(T.current.getValue(),ue)}))},[W,V]),se.useEffect(()=>{if(W){let me=D.current.editor.onDidChangeMarkers(Re=>{var at;let ue=(at=T.current.getModel())==null?void 0:at.uri;if(ue&&Re.find(Ge=>Ge.path===ue.path)){let Ge=D.current.editor.getModelMarkers({resource:ue});$==null||$(Ge)}});return()=>{me==null||me.dispose()}}return()=>{}},[W,$]);function nt(){var me,Re;(me=Te.current)==null||me.dispose(),v?g&&Pu.set(i,T.current.saveViewState()):(Re=T.current.getModel())==null||Re.dispose(),T.current.dispose()}return Uo.createElement(Pb,{width:_,height:E,isEditorReady:W,loading:u,_ref:k,className:x,wrapperProps:R})}var KV=HV,QV=se.memo(KV),JV=QV;const YV=`// Strategy Template
function analyze(data) {
  const { close, high, low } = data;
  
  // Calculate SMA
  const period = 20;
  const sma = calculateSMA(close, period);
  
  // Calculate Bollinger Bands
  const stdDev = calculateStdDev(close, period);
  const upperBand = sma + stdDev * 2;
  const lowerBand = sma - stdDev * 2;
  
  // Generate signals
  const signals = [];
  for (let i = period; i < close.length; i++) {
    if (close[i] < lowerBand[i]) {
      signals.push({
        type: 'BUY',
        price: close[i],
        confidence: 0.8,
        metadata: {
          indicator: 'BB_LOWER',
          deviation: (lowerBand[i] - close[i]) / stdDev[i]
        }
      });
    } else if (close[i] > upperBand[i]) {
      signals.push({
        type: 'SELL',
        price: close[i],
        confidence: 0.8,
        metadata: {
          indicator: 'BB_UPPER',
          deviation: (close[i] - upperBand[i]) / stdDev[i]
        }
      });
    }
  }
  
  return signals;
}

// Helper Functions
function calculateSMA(data, period) {
  const result = new Array(data.length).fill(0);
  for (let i = period - 1; i < data.length; i++) {
    let sum = 0;
    for (let j = 0; j < period; j++) {
      sum += data[i - j];
    }
    result[i] = sum / period;
  }
  return result;
}

function calculateStdDev(data, period) {
  const sma = calculateSMA(data, period);
  const result = new Array(data.length).fill(0);
  
  for (let i = period - 1; i < data.length; i++) {
    let sumSquares = 0;
    for (let j = 0; j < period; j++) {
      sumSquares += Math.pow(data[i - j] - sma[i], 2);
    }
    result[i] = Math.sqrt(sumSquares / period);
  }
  return result;
}`;function XV(){const[n,e]=se.useState(YV),[t,r]=se.useState("1D"),[s,i]=se.useState(!1),[o,l]=se.useState(!1),[u,h]=se.useState([{name:"SMA Period",type:"number",value:20,min:5,max:200,step:1},{name:"BB Multiplier",type:"number",value:2,min:.5,max:4,step:.1},{name:"Use RSI Filter",type:"boolean",value:!0},{name:"RSI Period",type:"number",value:14,min:2,max:50,step:1},{name:"RSI Threshold",type:"number",value:30,min:0,max:100,step:1}]),d=(_,E)=>{const x=[...u];x[_].value=E,h(x)},g=async()=>{i(!0);try{await new Promise(_=>setTimeout(_,2e3))}finally{i(!1)}},v=()=>{const _={code:n,parameters:u.reduce((E,x)=>({...E,[x.name]:x.value}),{})};localStorage.setItem("savedStrategy",JSON.stringify(_))};return m.jsxs("div",{className:"bg-gray-900 rounded-lg p-6",children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsx("h2",{className:"text-2xl font-bold",children:"Strategy Builder"}),m.jsxs("div",{className:"flex items-center space-x-4",children:[m.jsxs("select",{value:t,onChange:_=>r(_.target.value),className:"bg-gray-800 border border-gray-700 rounded-lg px-3 py-1",children:[m.jsx("option",{value:"1m",children:"1 Minute"}),m.jsx("option",{value:"5m",children:"5 Minutes"}),m.jsx("option",{value:"15m",children:"15 Minutes"}),m.jsx("option",{value:"1h",children:"1 Hour"}),m.jsx("option",{value:"4h",children:"4 Hours"}),m.jsx("option",{value:"1D",children:"1 Day"})]}),m.jsx("button",{onClick:()=>l(!o),className:"p-2 bg-gray-800 hover:bg-gray-700 rounded-lg",children:m.jsx(Ng,{className:"w-5 h-5"})})]})]}),m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[m.jsxs("div",{className:"space-y-6",children:[m.jsx("div",{className:"h-[400px] bg-gray-800 rounded-lg overflow-hidden",children:m.jsx(jg,{symbol:"BTCUSDT",theme:"dark"})}),o&&m.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[m.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Strategy Parameters"}),m.jsx("div",{className:"space-y-4",children:u.map((_,E)=>m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("label",{className:"text-sm text-gray-400",children:_.name}),_.type==="number"?m.jsxs("div",{className:"flex items-center space-x-4",children:[m.jsx("input",{type:"range",min:_.min,max:_.max,step:_.step,value:_.value,onChange:x=>d(E,parseFloat(x.target.value)),className:"w-32 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"}),m.jsx("span",{className:"w-12 text-right",children:_.value})]}):_.type==="boolean"?m.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[m.jsx("input",{type:"checkbox",className:"sr-only peer",checked:_.value,onChange:x=>d(E,x.target.checked)}),m.jsx("div",{className:"w-11 h-6 bg-gray-700 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]}):m.jsx("input",{type:"text",value:_.value,onChange:x=>d(E,x.target.value),className:"bg-gray-700 border border-gray-600 rounded px-2 py-1"})]},_.name))})]})]}),m.jsxs("div",{className:"space-y-6",children:[m.jsx("div",{className:"h-[400px] bg-gray-800 rounded-lg overflow-hidden",children:m.jsx(JV,{height:"100%",defaultLanguage:"javascript",theme:"vs-dark",value:n,onChange:_=>e(_||""),options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",roundedSelection:!1,scrollBeyondLastLine:!1,automaticLayout:!0}})}),m.jsx("div",{className:"flex items-center justify-between",children:m.jsxs("div",{className:"flex items-center space-x-4",children:[m.jsxs("button",{onClick:g,disabled:s,className:`px-4 py-2 rounded-lg flex items-center space-x-2 ${s?"bg-gray-700 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:[s?m.jsx(b_,{className:"w-5 h-5 animate-spin"}):m.jsx(E_,{className:"w-5 h-5"}),m.jsx("span",{children:s?"Running...":"Run Backtest"})]}),m.jsxs("button",{onClick:v,className:"px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg flex items-center space-x-2",children:[m.jsx(T_,{className:"w-5 h-5"}),m.jsx("span",{children:"Save Strategy"})]})]})}),m.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[m.jsxs("div",{className:"flex items-center space-x-2 text-yellow-500 mb-4",children:[m.jsx(Og,{className:"w-5 h-5"}),m.jsx("span",{className:"font-medium",children:"Strategy Analysis"})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-gray-400",children:"Win Rate"}),m.jsx("span",{className:"text-green-500",children:"65.2%"})]}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-gray-400",children:"Profit Factor"}),m.jsx("span",{className:"text-green-500",children:"1.85"})]}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-gray-400",children:"Max Drawdown"}),m.jsx("span",{className:"text-red-500",children:"-12.3%"})]}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-gray-400",children:"Sharpe Ratio"}),m.jsx("span",{className:"text-green-500",children:"1.92"})]})]})]})]})]})]})}var Ev={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ob=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},ZV=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],l=n[t++],u=((s&7)<<18|(i&63)<<12|(o&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},kb={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,l=o?n[s+1]:0,u=s+2<n.length,h=u?n[s+2]:0,d=i>>2,g=(i&3)<<4|l>>4;let v=(l&15)<<2|h>>6,_=h&63;u||(_=64,o||(v=64)),r.push(t[d],t[g],t[v],t[_])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Ob(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):ZV(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],l=s<n.length?t[n.charAt(s)]:0;++s;const h=s<n.length?t[n.charAt(s)]:64;++s;const g=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||l==null||h==null||g==null)throw new eF;const v=i<<2|l>>4;if(r.push(v),h!==64){const _=l<<4&240|h>>2;if(r.push(_),g!==64){const E=h<<6&192|g;r.push(E)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class eF extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const tF=function(n){const e=Ob(n);return kb.encodeByteArray(e,!0)},lh=function(n){return tF(n).replace(/\./g,"")},rF=function(n){try{return kb.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nF(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sF=()=>nF().__FIREBASE_DEFAULTS__,iF=()=>{if(typeof process>"u"||typeof Ev>"u")return;const n=Ev.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},oF=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&rF(n[1]);return e&&JSON.parse(e)},am=()=>{try{return sF()||iF()||oF()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},aF=n=>{var e,t;return(t=(e=am())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},lF=n=>{const e=aF(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},jb=()=>{var n;return(n=am())===null||n===void 0?void 0:n.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cF{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uF(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n);return[lh(JSON.stringify(t)),lh(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hF(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function fF(){var n;const e=(n=am())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function dF(){return!fF()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function pF(){try{return typeof indexedDB=="object"}catch{return!1}}function gF(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mF="FirebaseError";class ha extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=mF,Object.setPrototypeOf(this,ha.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Db.prototype.create)}}class Db{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?yF(i,r):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new ha(s,l,r)}}function yF(n,e){return n.replace(wF,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const wF=/\{\$([^}]+)}/g;function ug(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(Tv(i)&&Tv(o)){if(!ug(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Tv(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ho(n){return n&&n._delegate?n._delegate:n}class Rl{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oi="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vF{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new cF;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(bF(e))try{this.getOrInitializeService({instanceIdentifier:Oi})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Oi){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Oi){return this.instances.has(e)}getOptions(e=Oi){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:_F(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Oi){return this.component?this.component.multipleInstances?e:Oi:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function _F(n){return n===Oi?void 0:n}function bF(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EF{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new vF(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var He;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(He||(He={}));const TF={debug:He.DEBUG,verbose:He.VERBOSE,info:He.INFO,warn:He.WARN,error:He.ERROR,silent:He.SILENT},SF=He.INFO,xF={[He.DEBUG]:"log",[He.VERBOSE]:"log",[He.INFO]:"info",[He.WARN]:"warn",[He.ERROR]:"error"},AF=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=xF[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Mb{constructor(e){this.name=e,this._logLevel=SF,this._logHandler=AF,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in He))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?TF[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,He.DEBUG,...e),this._logHandler(this,He.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,He.VERBOSE,...e),this._logHandler(this,He.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,He.INFO,...e),this._logHandler(this,He.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,He.WARN,...e),this._logHandler(this,He.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,He.ERROR,...e),this._logHandler(this,He.ERROR,...e)}}const RF=(n,e)=>e.some(t=>n instanceof t);let Sv,xv;function IF(){return Sv||(Sv=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function PF(){return xv||(xv=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Lb=new WeakMap,hg=new WeakMap,Vb=new WeakMap,Pp=new WeakMap,lm=new WeakMap;function CF(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Ks(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Lb.set(t,n)}).catch(()=>{}),lm.set(e,n),e}function NF(n){if(hg.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});hg.set(n,e)}let fg={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return hg.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Vb.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ks(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function OF(n){fg=n(fg)}function kF(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Cp(this),e,...t);return Vb.set(r,e.sort?e.sort():[e]),Ks(r)}:PF().includes(n)?function(...e){return n.apply(Cp(this),e),Ks(Lb.get(this))}:function(...e){return Ks(n.apply(Cp(this),e))}}function jF(n){return typeof n=="function"?kF(n):(n instanceof IDBTransaction&&NF(n),RF(n,IF())?new Proxy(n,fg):n)}function Ks(n){if(n instanceof IDBRequest)return CF(n);if(Pp.has(n))return Pp.get(n);const e=jF(n);return e!==n&&(Pp.set(n,e),lm.set(e,n)),e}const Cp=n=>lm.get(n);function DF(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),l=Ks(o);return r&&o.addEventListener("upgradeneeded",u=>{r(Ks(o.result),u.oldVersion,u.newVersion,Ks(o.transaction),u)}),t&&o.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),l.then(u=>{i&&u.addEventListener("close",()=>i()),s&&u.addEventListener("versionchange",h=>s(h.oldVersion,h.newVersion,h))}).catch(()=>{}),l}const MF=["get","getKey","getAll","getAllKeys","count"],LF=["put","add","delete","clear"],Np=new Map;function Av(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Np.get(e))return Np.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=LF.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||MF.includes(t)))return;const i=async function(o,...l){const u=this.transaction(o,s?"readwrite":"readonly");let h=u.store;return r&&(h=h.index(l.shift())),(await Promise.all([h[t](...l),s&&u.done]))[0]};return Np.set(e,i),i}OF(n=>({...n,get:(e,t,r)=>Av(e,t)||n.get(e,t,r),has:(e,t)=>!!Av(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VF{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(FF(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function FF(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const dg="@firebase/app",Rv="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fs=new Mb("@firebase/app"),UF="@firebase/app-compat",$F="@firebase/analytics-compat",BF="@firebase/analytics",qF="@firebase/app-check-compat",WF="@firebase/app-check",zF="@firebase/auth",GF="@firebase/auth-compat",HF="@firebase/database",KF="@firebase/data-connect",QF="@firebase/database-compat",JF="@firebase/functions",YF="@firebase/functions-compat",XF="@firebase/installations",ZF="@firebase/installations-compat",e5="@firebase/messaging",t5="@firebase/messaging-compat",r5="@firebase/performance",n5="@firebase/performance-compat",s5="@firebase/remote-config",i5="@firebase/remote-config-compat",o5="@firebase/storage",a5="@firebase/storage-compat",l5="@firebase/firestore",c5="@firebase/vertexai-preview",u5="@firebase/firestore-compat",h5="firebase",f5="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pg="[DEFAULT]",d5={[dg]:"fire-core",[UF]:"fire-core-compat",[BF]:"fire-analytics",[$F]:"fire-analytics-compat",[WF]:"fire-app-check",[qF]:"fire-app-check-compat",[zF]:"fire-auth",[GF]:"fire-auth-compat",[HF]:"fire-rtdb",[KF]:"fire-data-connect",[QF]:"fire-rtdb-compat",[JF]:"fire-fn",[YF]:"fire-fn-compat",[XF]:"fire-iid",[ZF]:"fire-iid-compat",[e5]:"fire-fcm",[t5]:"fire-fcm-compat",[r5]:"fire-perf",[n5]:"fire-perf-compat",[s5]:"fire-rc",[i5]:"fire-rc-compat",[o5]:"fire-gcs",[a5]:"fire-gcs-compat",[l5]:"fire-fst",[u5]:"fire-fst-compat",[c5]:"fire-vertex","fire-js":"fire-js",[h5]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ch=new Map,p5=new Map,gg=new Map;function Iv(n,e){try{n.container.addComponent(e)}catch(t){fs.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function uh(n){const e=n.name;if(gg.has(e))return fs.debug(`There were multiple attempts to register component ${e}.`),!1;gg.set(e,n);for(const t of ch.values())Iv(t,n);for(const t of p5.values())Iv(t,n);return!0}function g5(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m5={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Qs=new Db("app","Firebase",m5);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y5{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Rl("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Qs.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w5=f5;function Fb(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:pg,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw Qs.create("bad-app-name",{appName:String(s)});if(t||(t=jb()),!t)throw Qs.create("no-options");const i=ch.get(s);if(i){if(ug(t,i.options)&&ug(r,i.config))return i;throw Qs.create("duplicate-app",{appName:s})}const o=new EF(s);for(const u of gg.values())o.addComponent(u);const l=new y5(t,r,o);return ch.set(s,l),l}function v5(n=pg){const e=ch.get(n);if(!e&&n===pg&&jb())return Fb();if(!e)throw Qs.create("no-app",{appName:n});return e}function Bo(n,e,t){var r;let s=(r=d5[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const l=[`Unable to register library "${s}" with version "${e}":`];i&&l.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),fs.warn(l.join(" "));return}uh(new Rl(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _5="firebase-heartbeat-database",b5=1,Il="firebase-heartbeat-store";let Op=null;function Ub(){return Op||(Op=DF(_5,b5,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Il)}catch(t){console.warn(t)}}}}).catch(n=>{throw Qs.create("idb-open",{originalErrorMessage:n.message})})),Op}async function E5(n){try{const t=(await Ub()).transaction(Il),r=await t.objectStore(Il).get($b(n));return await t.done,r}catch(e){if(e instanceof ha)fs.warn(e.message);else{const t=Qs.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});fs.warn(t.message)}}}async function Pv(n,e){try{const r=(await Ub()).transaction(Il,"readwrite");await r.objectStore(Il).put(e,$b(n)),await r.done}catch(t){if(t instanceof ha)fs.warn(t.message);else{const r=Qs.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});fs.warn(r.message)}}}function $b(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T5=1024,S5=30*24*60*60*1e3;class x5{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new R5(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Cv();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const l=new Date(o.date).valueOf();return Date.now()-l<=S5}),this._storage.overwrite(this._heartbeatsCache))}catch(r){fs.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Cv(),{heartbeatsToSend:r,unsentEntries:s}=A5(this._heartbeatsCache.heartbeats),i=lh(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return fs.warn(t),""}}}function Cv(){return new Date().toISOString().substring(0,10)}function A5(n,e=T5){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),Nv(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Nv(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class R5{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return pF()?gF().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await E5(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Pv(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Pv(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Nv(n){return lh(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I5(n){uh(new Rl("platform-logger",e=>new VF(e),"PRIVATE")),uh(new Rl("heartbeat",e=>new x5(e),"PRIVATE")),Bo(dg,Rv,n),Bo(dg,Rv,"esm2017"),Bo("fire-js","")}I5("");var P5="firebase",C5="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Bo(P5,C5,"app");var Ov=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Li,Bb;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(j,A){function D(){}D.prototype=A.prototype,j.D=A.prototype,j.prototype=new D,j.prototype.constructor=j,j.C=function(T,k,M){for(var C=Array(arguments.length-2),Te=2;Te<arguments.length;Te++)C[Te-2]=arguments[Te];return A.prototype[k].apply(T,C)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(j,A,D){D||(D=0);var T=Array(16);if(typeof A=="string")for(var k=0;16>k;++k)T[k]=A.charCodeAt(D++)|A.charCodeAt(D++)<<8|A.charCodeAt(D++)<<16|A.charCodeAt(D++)<<24;else for(k=0;16>k;++k)T[k]=A[D++]|A[D++]<<8|A[D++]<<16|A[D++]<<24;A=j.g[0],D=j.g[1],k=j.g[2];var M=j.g[3],C=A+(M^D&(k^M))+T[0]+3614090360&4294967295;A=D+(C<<7&4294967295|C>>>25),C=M+(k^A&(D^k))+T[1]+3905402710&4294967295,M=A+(C<<12&4294967295|C>>>20),C=k+(D^M&(A^D))+T[2]+606105819&4294967295,k=M+(C<<17&4294967295|C>>>15),C=D+(A^k&(M^A))+T[3]+3250441966&4294967295,D=k+(C<<22&4294967295|C>>>10),C=A+(M^D&(k^M))+T[4]+4118548399&4294967295,A=D+(C<<7&4294967295|C>>>25),C=M+(k^A&(D^k))+T[5]+1200080426&4294967295,M=A+(C<<12&4294967295|C>>>20),C=k+(D^M&(A^D))+T[6]+2821735955&4294967295,k=M+(C<<17&4294967295|C>>>15),C=D+(A^k&(M^A))+T[7]+4249261313&4294967295,D=k+(C<<22&4294967295|C>>>10),C=A+(M^D&(k^M))+T[8]+1770035416&4294967295,A=D+(C<<7&4294967295|C>>>25),C=M+(k^A&(D^k))+T[9]+2336552879&4294967295,M=A+(C<<12&4294967295|C>>>20),C=k+(D^M&(A^D))+T[10]+4294925233&4294967295,k=M+(C<<17&4294967295|C>>>15),C=D+(A^k&(M^A))+T[11]+2304563134&4294967295,D=k+(C<<22&4294967295|C>>>10),C=A+(M^D&(k^M))+T[12]+1804603682&4294967295,A=D+(C<<7&4294967295|C>>>25),C=M+(k^A&(D^k))+T[13]+4254626195&4294967295,M=A+(C<<12&4294967295|C>>>20),C=k+(D^M&(A^D))+T[14]+2792965006&4294967295,k=M+(C<<17&4294967295|C>>>15),C=D+(A^k&(M^A))+T[15]+1236535329&4294967295,D=k+(C<<22&4294967295|C>>>10),C=A+(k^M&(D^k))+T[1]+4129170786&4294967295,A=D+(C<<5&4294967295|C>>>27),C=M+(D^k&(A^D))+T[6]+3225465664&4294967295,M=A+(C<<9&4294967295|C>>>23),C=k+(A^D&(M^A))+T[11]+643717713&4294967295,k=M+(C<<14&4294967295|C>>>18),C=D+(M^A&(k^M))+T[0]+3921069994&4294967295,D=k+(C<<20&4294967295|C>>>12),C=A+(k^M&(D^k))+T[5]+3593408605&4294967295,A=D+(C<<5&4294967295|C>>>27),C=M+(D^k&(A^D))+T[10]+38016083&4294967295,M=A+(C<<9&4294967295|C>>>23),C=k+(A^D&(M^A))+T[15]+3634488961&4294967295,k=M+(C<<14&4294967295|C>>>18),C=D+(M^A&(k^M))+T[4]+3889429448&4294967295,D=k+(C<<20&4294967295|C>>>12),C=A+(k^M&(D^k))+T[9]+568446438&4294967295,A=D+(C<<5&4294967295|C>>>27),C=M+(D^k&(A^D))+T[14]+3275163606&4294967295,M=A+(C<<9&4294967295|C>>>23),C=k+(A^D&(M^A))+T[3]+4107603335&4294967295,k=M+(C<<14&4294967295|C>>>18),C=D+(M^A&(k^M))+T[8]+1163531501&4294967295,D=k+(C<<20&4294967295|C>>>12),C=A+(k^M&(D^k))+T[13]+2850285829&4294967295,A=D+(C<<5&4294967295|C>>>27),C=M+(D^k&(A^D))+T[2]+4243563512&4294967295,M=A+(C<<9&4294967295|C>>>23),C=k+(A^D&(M^A))+T[7]+1735328473&4294967295,k=M+(C<<14&4294967295|C>>>18),C=D+(M^A&(k^M))+T[12]+2368359562&4294967295,D=k+(C<<20&4294967295|C>>>12),C=A+(D^k^M)+T[5]+4294588738&4294967295,A=D+(C<<4&4294967295|C>>>28),C=M+(A^D^k)+T[8]+2272392833&4294967295,M=A+(C<<11&4294967295|C>>>21),C=k+(M^A^D)+T[11]+1839030562&4294967295,k=M+(C<<16&4294967295|C>>>16),C=D+(k^M^A)+T[14]+4259657740&4294967295,D=k+(C<<23&4294967295|C>>>9),C=A+(D^k^M)+T[1]+2763975236&4294967295,A=D+(C<<4&4294967295|C>>>28),C=M+(A^D^k)+T[4]+1272893353&4294967295,M=A+(C<<11&4294967295|C>>>21),C=k+(M^A^D)+T[7]+4139469664&4294967295,k=M+(C<<16&4294967295|C>>>16),C=D+(k^M^A)+T[10]+3200236656&4294967295,D=k+(C<<23&4294967295|C>>>9),C=A+(D^k^M)+T[13]+681279174&4294967295,A=D+(C<<4&4294967295|C>>>28),C=M+(A^D^k)+T[0]+3936430074&4294967295,M=A+(C<<11&4294967295|C>>>21),C=k+(M^A^D)+T[3]+3572445317&4294967295,k=M+(C<<16&4294967295|C>>>16),C=D+(k^M^A)+T[6]+76029189&4294967295,D=k+(C<<23&4294967295|C>>>9),C=A+(D^k^M)+T[9]+3654602809&4294967295,A=D+(C<<4&4294967295|C>>>28),C=M+(A^D^k)+T[12]+3873151461&4294967295,M=A+(C<<11&4294967295|C>>>21),C=k+(M^A^D)+T[15]+530742520&4294967295,k=M+(C<<16&4294967295|C>>>16),C=D+(k^M^A)+T[2]+3299628645&4294967295,D=k+(C<<23&4294967295|C>>>9),C=A+(k^(D|~M))+T[0]+4096336452&4294967295,A=D+(C<<6&4294967295|C>>>26),C=M+(D^(A|~k))+T[7]+1126891415&4294967295,M=A+(C<<10&4294967295|C>>>22),C=k+(A^(M|~D))+T[14]+2878612391&4294967295,k=M+(C<<15&4294967295|C>>>17),C=D+(M^(k|~A))+T[5]+4237533241&4294967295,D=k+(C<<21&4294967295|C>>>11),C=A+(k^(D|~M))+T[12]+1700485571&4294967295,A=D+(C<<6&4294967295|C>>>26),C=M+(D^(A|~k))+T[3]+2399980690&4294967295,M=A+(C<<10&4294967295|C>>>22),C=k+(A^(M|~D))+T[10]+4293915773&4294967295,k=M+(C<<15&4294967295|C>>>17),C=D+(M^(k|~A))+T[1]+2240044497&4294967295,D=k+(C<<21&4294967295|C>>>11),C=A+(k^(D|~M))+T[8]+1873313359&4294967295,A=D+(C<<6&4294967295|C>>>26),C=M+(D^(A|~k))+T[15]+4264355552&4294967295,M=A+(C<<10&4294967295|C>>>22),C=k+(A^(M|~D))+T[6]+2734768916&4294967295,k=M+(C<<15&4294967295|C>>>17),C=D+(M^(k|~A))+T[13]+1309151649&4294967295,D=k+(C<<21&4294967295|C>>>11),C=A+(k^(D|~M))+T[4]+4149444226&4294967295,A=D+(C<<6&4294967295|C>>>26),C=M+(D^(A|~k))+T[11]+3174756917&4294967295,M=A+(C<<10&4294967295|C>>>22),C=k+(A^(M|~D))+T[2]+718787259&4294967295,k=M+(C<<15&4294967295|C>>>17),C=D+(M^(k|~A))+T[9]+3951481745&4294967295,j.g[0]=j.g[0]+A&4294967295,j.g[1]=j.g[1]+(k+(C<<21&4294967295|C>>>11))&4294967295,j.g[2]=j.g[2]+k&4294967295,j.g[3]=j.g[3]+M&4294967295}r.prototype.u=function(j,A){A===void 0&&(A=j.length);for(var D=A-this.blockSize,T=this.B,k=this.h,M=0;M<A;){if(k==0)for(;M<=D;)s(this,j,M),M+=this.blockSize;if(typeof j=="string"){for(;M<A;)if(T[k++]=j.charCodeAt(M++),k==this.blockSize){s(this,T),k=0;break}}else for(;M<A;)if(T[k++]=j[M++],k==this.blockSize){s(this,T),k=0;break}}this.h=k,this.o+=A},r.prototype.v=function(){var j=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);j[0]=128;for(var A=1;A<j.length-8;++A)j[A]=0;var D=8*this.o;for(A=j.length-8;A<j.length;++A)j[A]=D&255,D/=256;for(this.u(j),j=Array(16),A=D=0;4>A;++A)for(var T=0;32>T;T+=8)j[D++]=this.g[A]>>>T&255;return j};function i(j,A){var D=l;return Object.prototype.hasOwnProperty.call(D,j)?D[j]:D[j]=A(j)}function o(j,A){this.h=A;for(var D=[],T=!0,k=j.length-1;0<=k;k--){var M=j[k]|0;T&&M==A||(D[k]=M,T=!1)}this.g=D}var l={};function u(j){return-128<=j&&128>j?i(j,function(A){return new o([A|0],0>A?-1:0)}):new o([j|0],0>j?-1:0)}function h(j){if(isNaN(j)||!isFinite(j))return g;if(0>j)return R(h(-j));for(var A=[],D=1,T=0;j>=D;T++)A[T]=j/D|0,D*=4294967296;return new o(A,0)}function d(j,A){if(j.length==0)throw Error("number format error: empty string");if(A=A||10,2>A||36<A)throw Error("radix out of range: "+A);if(j.charAt(0)=="-")return R(d(j.substring(1),A));if(0<=j.indexOf("-"))throw Error('number format error: interior "-" character');for(var D=h(Math.pow(A,8)),T=g,k=0;k<j.length;k+=8){var M=Math.min(8,j.length-k),C=parseInt(j.substring(k,k+M),A);8>M?(M=h(Math.pow(A,M)),T=T.j(M).add(h(C))):(T=T.j(D),T=T.add(h(C)))}return T}var g=u(0),v=u(1),_=u(16777216);n=o.prototype,n.m=function(){if(x(this))return-R(this).m();for(var j=0,A=1,D=0;D<this.g.length;D++){var T=this.i(D);j+=(0<=T?T:4294967296+T)*A,A*=4294967296}return j},n.toString=function(j){if(j=j||10,2>j||36<j)throw Error("radix out of range: "+j);if(E(this))return"0";if(x(this))return"-"+R(this).toString(j);for(var A=h(Math.pow(j,6)),D=this,T="";;){var k=$(D,A).g;D=I(D,k.j(A));var M=((0<D.g.length?D.g[0]:D.h)>>>0).toString(j);if(D=k,E(D))return M+T;for(;6>M.length;)M="0"+M;T=M+T}},n.i=function(j){return 0>j?0:j<this.g.length?this.g[j]:this.h};function E(j){if(j.h!=0)return!1;for(var A=0;A<j.g.length;A++)if(j.g[A]!=0)return!1;return!0}function x(j){return j.h==-1}n.l=function(j){return j=I(this,j),x(j)?-1:E(j)?0:1};function R(j){for(var A=j.g.length,D=[],T=0;T<A;T++)D[T]=~j.g[T];return new o(D,~j.h).add(v)}n.abs=function(){return x(this)?R(this):this},n.add=function(j){for(var A=Math.max(this.g.length,j.g.length),D=[],T=0,k=0;k<=A;k++){var M=T+(this.i(k)&65535)+(j.i(k)&65535),C=(M>>>16)+(this.i(k)>>>16)+(j.i(k)>>>16);T=C>>>16,M&=65535,C&=65535,D[k]=C<<16|M}return new o(D,D[D.length-1]&-2147483648?-1:0)};function I(j,A){return j.add(R(A))}n.j=function(j){if(E(this)||E(j))return g;if(x(this))return x(j)?R(this).j(R(j)):R(R(this).j(j));if(x(j))return R(this.j(R(j)));if(0>this.l(_)&&0>j.l(_))return h(this.m()*j.m());for(var A=this.g.length+j.g.length,D=[],T=0;T<2*A;T++)D[T]=0;for(T=0;T<this.g.length;T++)for(var k=0;k<j.g.length;k++){var M=this.i(T)>>>16,C=this.i(T)&65535,Te=j.i(k)>>>16,ne=j.i(k)&65535;D[2*T+2*k]+=C*ne,F(D,2*T+2*k),D[2*T+2*k+1]+=M*ne,F(D,2*T+2*k+1),D[2*T+2*k+1]+=C*Te,F(D,2*T+2*k+1),D[2*T+2*k+2]+=M*Te,F(D,2*T+2*k+2)}for(T=0;T<A;T++)D[T]=D[2*T+1]<<16|D[2*T];for(T=A;T<2*A;T++)D[T]=0;return new o(D,0)};function F(j,A){for(;(j[A]&65535)!=j[A];)j[A+1]+=j[A]>>>16,j[A]&=65535,A++}function V(j,A){this.g=j,this.h=A}function $(j,A){if(E(A))throw Error("division by zero");if(E(j))return new V(g,g);if(x(j))return A=$(R(j),A),new V(R(A.g),R(A.h));if(x(A))return A=$(j,R(A)),new V(R(A.g),A.h);if(30<j.g.length){if(x(j)||x(A))throw Error("slowDivide_ only works with positive integers.");for(var D=v,T=A;0>=T.l(j);)D=W(D),T=W(T);var k=X(D,1),M=X(T,1);for(T=X(T,2),D=X(D,2);!E(T);){var C=M.add(T);0>=C.l(j)&&(k=k.add(D),M=C),T=X(T,1),D=X(D,1)}return A=I(j,k.j(A)),new V(k,A)}for(k=g;0<=j.l(A);){for(D=Math.max(1,Math.floor(j.m()/A.m())),T=Math.ceil(Math.log(D)/Math.LN2),T=48>=T?1:Math.pow(2,T-48),M=h(D),C=M.j(A);x(C)||0<C.l(j);)D-=T,M=h(D),C=M.j(A);E(M)&&(M=v),k=k.add(M),j=I(j,C)}return new V(k,j)}n.A=function(j){return $(this,j).h},n.and=function(j){for(var A=Math.max(this.g.length,j.g.length),D=[],T=0;T<A;T++)D[T]=this.i(T)&j.i(T);return new o(D,this.h&j.h)},n.or=function(j){for(var A=Math.max(this.g.length,j.g.length),D=[],T=0;T<A;T++)D[T]=this.i(T)|j.i(T);return new o(D,this.h|j.h)},n.xor=function(j){for(var A=Math.max(this.g.length,j.g.length),D=[],T=0;T<A;T++)D[T]=this.i(T)^j.i(T);return new o(D,this.h^j.h)};function W(j){for(var A=j.g.length+1,D=[],T=0;T<A;T++)D[T]=j.i(T)<<1|j.i(T-1)>>>31;return new o(D,j.h)}function X(j,A){var D=A>>5;A%=32;for(var T=j.g.length-D,k=[],M=0;M<T;M++)k[M]=0<A?j.i(M+D)>>>A|j.i(M+D+1)<<32-A:j.i(M+D);return new o(k,j.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Bb=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=d,Li=o}).apply(typeof Ov<"u"?Ov:typeof self<"u"?self:typeof window<"u"?window:{});var Cu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var qb,cl,Wb,Hu,mg,zb,Gb,Hb;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(f,y,b){return f==Array.prototype||f==Object.prototype||(f[y]=b.value),f};function t(f){f=[typeof globalThis=="object"&&globalThis,f,typeof window=="object"&&window,typeof self=="object"&&self,typeof Cu=="object"&&Cu];for(var y=0;y<f.length;++y){var b=f[y];if(b&&b.Math==Math)return b}throw Error("Cannot find global object")}var r=t(this);function s(f,y){if(y)e:{var b=r;f=f.split(".");for(var N=0;N<f.length-1;N++){var z=f[N];if(!(z in b))break e;b=b[z]}f=f[f.length-1],N=b[f],y=y(N),y!=N&&y!=null&&e(b,f,{configurable:!0,writable:!0,value:y})}}function i(f,y){f instanceof String&&(f+="");var b=0,N=!1,z={next:function(){if(!N&&b<f.length){var H=b++;return{value:y(H,f[H]),done:!1}}return N=!0,{done:!0,value:void 0}}};return z[Symbol.iterator]=function(){return z},z}s("Array.prototype.values",function(f){return f||function(){return i(this,function(y,b){return b})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},l=this||self;function u(f){var y=typeof f;return y=y!="object"?y:f?Array.isArray(f)?"array":y:"null",y=="array"||y=="object"&&typeof f.length=="number"}function h(f){var y=typeof f;return y=="object"&&f!=null||y=="function"}function d(f,y,b){return f.call.apply(f.bind,arguments)}function g(f,y,b){if(!f)throw Error();if(2<arguments.length){var N=Array.prototype.slice.call(arguments,2);return function(){var z=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(z,N),f.apply(y,z)}}return function(){return f.apply(y,arguments)}}function v(f,y,b){return v=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:g,v.apply(null,arguments)}function _(f,y){var b=Array.prototype.slice.call(arguments,1);return function(){var N=b.slice();return N.push.apply(N,arguments),f.apply(this,N)}}function E(f,y){function b(){}b.prototype=y.prototype,f.aa=y.prototype,f.prototype=new b,f.prototype.constructor=f,f.Qb=function(N,z,H){for(var ie=Array(arguments.length-2),Xe=2;Xe<arguments.length;Xe++)ie[Xe-2]=arguments[Xe];return y.prototype[z].apply(N,ie)}}function x(f){const y=f.length;if(0<y){const b=Array(y);for(let N=0;N<y;N++)b[N]=f[N];return b}return[]}function R(f,y){for(let b=1;b<arguments.length;b++){const N=arguments[b];if(u(N)){const z=f.length||0,H=N.length||0;f.length=z+H;for(let ie=0;ie<H;ie++)f[z+ie]=N[ie]}else f.push(N)}}class I{constructor(y,b){this.i=y,this.j=b,this.h=0,this.g=null}get(){let y;return 0<this.h?(this.h--,y=this.g,this.g=y.next,y.next=null):y=this.i(),y}}function F(f){return/^[\s\xa0]*$/.test(f)}function V(){var f=l.navigator;return f&&(f=f.userAgent)?f:""}function $(f){return $[" "](f),f}$[" "]=function(){};var W=V().indexOf("Gecko")!=-1&&!(V().toLowerCase().indexOf("webkit")!=-1&&V().indexOf("Edge")==-1)&&!(V().indexOf("Trident")!=-1||V().indexOf("MSIE")!=-1)&&V().indexOf("Edge")==-1;function X(f,y,b){for(const N in f)y.call(b,f[N],N,f)}function j(f,y){for(const b in f)y.call(void 0,f[b],b,f)}function A(f){const y={};for(const b in f)y[b]=f[b];return y}const D="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function T(f,y){let b,N;for(let z=1;z<arguments.length;z++){N=arguments[z];for(b in N)f[b]=N[b];for(let H=0;H<D.length;H++)b=D[H],Object.prototype.hasOwnProperty.call(N,b)&&(f[b]=N[b])}}function k(f){var y=1;f=f.split(":");const b=[];for(;0<y&&f.length;)b.push(f.shift()),y--;return f.length&&b.push(f.join(":")),b}function M(f){l.setTimeout(()=>{throw f},0)}function C(){var f=wt;let y=null;return f.g&&(y=f.g,f.g=f.g.next,f.g||(f.h=null),y.next=null),y}class Te{constructor(){this.h=this.g=null}add(y,b){const N=ne.get();N.set(y,b),this.h?this.h.next=N:this.g=N,this.h=N}}var ne=new I(()=>new oe,f=>f.reset());class oe{constructor(){this.next=this.g=this.h=null}set(y,b){this.h=y,this.g=b,this.next=null}reset(){this.next=this.g=this.h=null}}let Ae,Le=!1,wt=new Te,nt=()=>{const f=l.Promise.resolve(void 0);Ae=()=>{f.then(me)}};var me=()=>{for(var f;f=C();){try{f.h.call(f.g)}catch(b){M(b)}var y=ne;y.j(f),100>y.h&&(y.h++,f.next=y.g,y.g=f)}Le=!1};function Re(){this.s=this.s,this.C=this.C}Re.prototype.s=!1,Re.prototype.ma=function(){this.s||(this.s=!0,this.N())},Re.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ue(f,y){this.type=f,this.g=this.target=y,this.defaultPrevented=!1}ue.prototype.h=function(){this.defaultPrevented=!0};var at=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var f=!1,y=Object.defineProperty({},"passive",{get:function(){f=!0}});try{const b=()=>{};l.addEventListener("test",b,y),l.removeEventListener("test",b,y)}catch{}return f}();function Ge(f,y){if(ue.call(this,f?f.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,f){var b=this.type=f.type,N=f.changedTouches&&f.changedTouches.length?f.changedTouches[0]:null;if(this.target=f.target||f.srcElement,this.g=y,y=f.relatedTarget){if(W){e:{try{$(y.nodeName);var z=!0;break e}catch{}z=!1}z||(y=null)}}else b=="mouseover"?y=f.fromElement:b=="mouseout"&&(y=f.toElement);this.relatedTarget=y,N?(this.clientX=N.clientX!==void 0?N.clientX:N.pageX,this.clientY=N.clientY!==void 0?N.clientY:N.pageY,this.screenX=N.screenX||0,this.screenY=N.screenY||0):(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0),this.button=f.button,this.key=f.key||"",this.ctrlKey=f.ctrlKey,this.altKey=f.altKey,this.shiftKey=f.shiftKey,this.metaKey=f.metaKey,this.pointerId=f.pointerId||0,this.pointerType=typeof f.pointerType=="string"?f.pointerType:Nt[f.pointerType]||"",this.state=f.state,this.i=f,f.defaultPrevented&&Ge.aa.h.call(this)}}E(Ge,ue);var Nt={2:"touch",3:"pen",4:"mouse"};Ge.prototype.h=function(){Ge.aa.h.call(this);var f=this.i;f.preventDefault?f.preventDefault():f.returnValue=!1};var ht="closure_listenable_"+(1e6*Math.random()|0),Bn=0;function qn(f,y,b,N,z){this.listener=f,this.proxy=null,this.src=y,this.type=b,this.capture=!!N,this.ha=z,this.key=++Bn,this.da=this.fa=!1}function vs(f){f.da=!0,f.listener=null,f.proxy=null,f.src=null,f.ha=null}function an(f){this.src=f,this.g={},this.h=0}an.prototype.add=function(f,y,b,N,z){var H=f.toString();f=this.g[H],f||(f=this.g[H]=[],this.h++);var ie=_s(f,y,N,z);return-1<ie?(y=f[ie],b||(y.fa=!1)):(y=new qn(y,this.src,H,!!N,z),y.fa=b,f.push(y)),y};function Sn(f,y){var b=y.type;if(b in f.g){var N=f.g[b],z=Array.prototype.indexOf.call(N,y,void 0),H;(H=0<=z)&&Array.prototype.splice.call(N,z,1),H&&(vs(y),f.g[b].length==0&&(delete f.g[b],f.h--))}}function _s(f,y,b,N){for(var z=0;z<f.length;++z){var H=f[z];if(!H.da&&H.listener==y&&H.capture==!!b&&H.ha==N)return z}return-1}var Ht="closure_lm_"+(1e6*Math.random()|0),ln={};function Yi(f,y,b,N,z){if(Array.isArray(y)){for(var H=0;H<y.length;H++)Yi(f,y[H],b,N,z);return null}return b=Es(b),f&&f[ht]?f.K(y,b,h(N)?!!N.capture:!1,z):cn(f,y,b,!1,N,z)}function cn(f,y,b,N,z,H){if(!y)throw Error("Invalid event type");var ie=h(z)?!!z.capture:!!z,Xe=bs(f);if(Xe||(f[Ht]=Xe=new an(f)),b=Xe.add(y,b,N,ie,H),b.proxy)return b;if(N=ec(),b.proxy=N,N.src=f,N.listener=b,f.addEventListener)at||(z=ie),z===void 0&&(z=!1),f.addEventListener(y.toString(),N,z);else if(f.attachEvent)f.attachEvent(Sr(y.toString()),N);else if(f.addListener&&f.removeListener)f.addListener(N);else throw Error("addEventListener and attachEvent are unavailable.");return b}function ec(){function f(b){return y.call(f.src,f.listener,b)}const y=ai;return f}function tc(f,y,b,N,z){if(Array.isArray(y))for(var H=0;H<y.length;H++)tc(f,y[H],b,N,z);else N=h(N)?!!N.capture:!!N,b=Es(b),f&&f[ht]?(f=f.i,y=String(y).toString(),y in f.g&&(H=f.g[y],b=_s(H,b,N,z),-1<b&&(vs(H[b]),Array.prototype.splice.call(H,b,1),H.length==0&&(delete f.g[y],f.h--)))):f&&(f=bs(f))&&(y=f.g[y.toString()],f=-1,y&&(f=_s(y,b,N,z)),(b=-1<f?y[f]:null)&&Wn(b))}function Wn(f){if(typeof f!="number"&&f&&!f.da){var y=f.src;if(y&&y[ht])Sn(y.i,f);else{var b=f.type,N=f.proxy;y.removeEventListener?y.removeEventListener(b,N,f.capture):y.detachEvent?y.detachEvent(Sr(b),N):y.addListener&&y.removeListener&&y.removeListener(N),(b=bs(y))?(Sn(b,f),b.h==0&&(b.src=null,y[Ht]=null)):vs(f)}}}function Sr(f){return f in ln?ln[f]:ln[f]="on"+f}function ai(f,y){if(f.da)f=!0;else{y=new Ge(y,this);var b=f.listener,N=f.ha||f.src;f.fa&&Wn(f),f=b.call(N,y)}return f}function bs(f){return f=f[Ht],f instanceof an?f:null}var ya="__closure_events_fn_"+(1e9*Math.random()>>>0);function Es(f){return typeof f=="function"?f:(f[ya]||(f[ya]=function(y){return f.handleEvent(y)}),f[ya])}function Bt(){Re.call(this),this.i=new an(this),this.M=this,this.F=null}E(Bt,Re),Bt.prototype[ht]=!0,Bt.prototype.removeEventListener=function(f,y,b,N){tc(this,f,y,b,N)};function At(f,y){var b,N=f.F;if(N)for(b=[];N;N=N.F)b.push(N);if(f=f.M,N=y.type||y,typeof y=="string")y=new ue(y,f);else if(y instanceof ue)y.target=y.target||f;else{var z=y;y=new ue(N,f),T(y,z)}if(z=!0,b)for(var H=b.length-1;0<=H;H--){var ie=y.g=b[H];z=un(ie,N,!0,y)&&z}if(ie=y.g=f,z=un(ie,N,!0,y)&&z,z=un(ie,N,!1,y)&&z,b)for(H=0;H<b.length;H++)ie=y.g=b[H],z=un(ie,N,!1,y)&&z}Bt.prototype.N=function(){if(Bt.aa.N.call(this),this.i){var f=this.i,y;for(y in f.g){for(var b=f.g[y],N=0;N<b.length;N++)vs(b[N]);delete f.g[y],f.h--}}this.F=null},Bt.prototype.K=function(f,y,b,N){return this.i.add(String(f),y,!1,b,N)},Bt.prototype.L=function(f,y,b,N){return this.i.add(String(f),y,!0,b,N)};function un(f,y,b,N){if(y=f.i.g[String(y)],!y)return!0;y=y.concat();for(var z=!0,H=0;H<y.length;++H){var ie=y[H];if(ie&&!ie.da&&ie.capture==b){var Xe=ie.listener,Mt=ie.ha||ie.src;ie.fa&&Sn(f.i,ie),z=Xe.call(Mt,N)!==!1&&z}}return z&&!N.defaultPrevented}function Xi(f,y,b){if(typeof f=="function")b&&(f=v(f,b));else if(f&&typeof f.handleEvent=="function")f=v(f.handleEvent,f);else throw Error("Invalid listener argument");return 2147483647<Number(y)?-1:l.setTimeout(f,y||0)}function Zi(f){f.g=Xi(()=>{f.g=null,f.i&&(f.i=!1,Zi(f))},f.l);const y=f.h;f.h=null,f.m.apply(null,y)}class wa extends Re{constructor(y,b){super(),this.m=y,this.l=b,this.h=null,this.i=!1,this.g=null}j(y){this.h=arguments,this.g?this.i=!0:Zi(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function zn(f){Re.call(this),this.h=f,this.g={}}E(zn,Re);var eo=[];function to(f){X(f.g,function(y,b){this.g.hasOwnProperty(b)&&Wn(y)},f),f.g={}}zn.prototype.N=function(){zn.aa.N.call(this),to(this)},zn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var li=l.JSON.stringify,va=l.JSON.parse,_a=class{stringify(f){return l.JSON.stringify(f,void 0)}parse(f){return l.JSON.parse(f,void 0)}};function ba(){}ba.prototype.h=null;function rc(f){return f.h||(f.h=f.i())}function nc(){}var Ts={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ro(){ue.call(this,"d")}E(ro,ue);function Ea(){ue.call(this,"c")}E(Ea,ue);var Gn={},sc=null;function no(){return sc=sc||new Bt}Gn.La="serverreachability";function Ta(f){ue.call(this,Gn.La,f)}E(Ta,ue);function ci(f){const y=no();At(y,new Ta(y))}Gn.STAT_EVENT="statevent";function ic(f,y){ue.call(this,Gn.STAT_EVENT,f),this.stat=y}E(ic,ue);function Kt(f){const y=no();At(y,new ic(y,f))}Gn.Ma="timingevent";function so(f,y){ue.call(this,Gn.Ma,f),this.size=y}E(so,ue);function ui(f,y){if(typeof f!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){f()},y)}function Hn(){this.g=!0}Hn.prototype.xa=function(){this.g=!1};function ff(f,y,b,N,z,H){f.info(function(){if(f.g)if(H)for(var ie="",Xe=H.split("&"),Mt=0;Mt<Xe.length;Mt++){var qe=Xe[Mt].split("=");if(1<qe.length){var tt=qe[0];qe=qe[1];var Ot=tt.split("_");ie=2<=Ot.length&&Ot[1]=="type"?ie+(tt+"="+qe+"&"):ie+(tt+"=redacted&")}}else ie=null;else ie=H;return"XMLHTTP REQ ("+N+") [attempt "+z+"]: "+y+`
`+b+`
`+ie})}function df(f,y,b,N,z,H,ie){f.info(function(){return"XMLHTTP RESP ("+N+") [ attempt "+z+"]: "+y+`
`+b+`
`+H+" "+ie})}function Ss(f,y,b,N){f.info(function(){return"XMLHTTP TEXT ("+y+"): "+gf(f,b)+(N?" "+N:"")})}function pf(f,y){f.info(function(){return"TIMEOUT: "+y})}Hn.prototype.info=function(){};function gf(f,y){if(!f.g)return y;if(!y)return null;try{var b=JSON.parse(y);if(b){for(f=0;f<b.length;f++)if(Array.isArray(b[f])){var N=b[f];if(!(2>N.length)){var z=N[1];if(Array.isArray(z)&&!(1>z.length)){var H=z[0];if(H!="noop"&&H!="stop"&&H!="close")for(var ie=1;ie<z.length;ie++)z[ie]=""}}}}return li(b)}catch{return y}}var io={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},oc={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Sa;function hi(){}E(hi,ba),hi.prototype.g=function(){return new XMLHttpRequest},hi.prototype.i=function(){return{}},Sa=new hi;function xn(f,y,b,N){this.j=f,this.i=y,this.l=b,this.R=N||1,this.U=new zn(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ac}function ac(){this.i=null,this.g="",this.h=!1}var lc={},xa={};function Aa(f,y,b){f.L=1,f.v=As(zr(y)),f.m=b,f.P=!0,cc(f,null)}function cc(f,y){f.F=Date.now(),Kn(f),f.A=zr(f.v);var b=f.A,N=f.R;Array.isArray(N)||(N=[String(N)]),ja(b.i,"t",N),f.C=0,b=f.j.J,f.h=new ac,f.g=Cc(f.j,b?y:null,!f.m),0<f.O&&(f.M=new wa(v(f.Y,f,f.g),f.O)),y=f.U,b=f.g,N=f.ca;var z="readystatechange";Array.isArray(z)||(z&&(eo[0]=z.toString()),z=eo);for(var H=0;H<z.length;H++){var ie=Yi(b,z[H],N||y.handleEvent,!1,y.h||y);if(!ie)break;y.g[ie.key]=ie}y=f.H?A(f.H):{},f.m?(f.u||(f.u="POST"),y["Content-Type"]="application/x-www-form-urlencoded",f.g.ea(f.A,f.u,f.m,y)):(f.u="GET",f.g.ea(f.A,f.u,null,y)),ci(),ff(f.i,f.u,f.A,f.l,f.R,f.m)}xn.prototype.ca=function(f){f=f.target;const y=this.M;y&&Qt(f)==3?y.j():this.Y(f)},xn.prototype.Y=function(f){try{if(f==this.g)e:{const Ot=Qt(this.g);var y=this.g.Ba();const Qr=this.g.Z();if(!(3>Ot)&&(Ot!=3||this.g&&(this.h.h||this.g.oa()||La(this.g)))){this.J||Ot!=4||y==7||(y==8||0>=Qr?ci(3):ci(2)),Ra(this);var b=this.g.Z();this.X=b;t:if(fi(this)){var N=La(this.g);f="";var z=N.length,H=Qt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){An(this),di(this);var ie="";break t}this.h.i=new l.TextDecoder}for(y=0;y<z;y++)this.h.h=!0,f+=this.h.i.decode(N[y],{stream:!(H&&y==z-1)});N.length=0,this.h.g+=f,this.C=0,ie=this.h.g}else ie=this.g.oa();if(this.o=b==200,df(this.i,this.u,this.A,this.l,this.R,Ot,b),this.o){if(this.T&&!this.K){t:{if(this.g){var Xe,Mt=this.g;if((Xe=Mt.g?Mt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!F(Xe)){var qe=Xe;break t}}qe=null}if(b=qe)Ss(this.i,this.l,b,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,oo(this,b);else{this.o=!1,this.s=3,Kt(12),An(this),di(this);break e}}if(this.P){b=!0;let xr;for(;!this.J&&this.C<ie.length;)if(xr=mf(this,ie),xr==xa){Ot==4&&(this.s=4,Kt(14),b=!1),Ss(this.i,this.l,null,"[Incomplete Response]");break}else if(xr==lc){this.s=4,Kt(15),Ss(this.i,this.l,ie,"[Invalid Chunk]"),b=!1;break}else Ss(this.i,this.l,xr,null),oo(this,xr);if(fi(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ot!=4||ie.length!=0||this.h.h||(this.s=1,Kt(16),b=!1),this.o=this.o&&b,!b)Ss(this.i,this.l,ie,"[Invalid Chunked Response]"),An(this),di(this);else if(0<ie.length&&!this.W){this.W=!0;var tt=this.j;tt.g==this&&tt.ba&&!tt.M&&(tt.j.info("Great, no buffering proxy detected. Bytes received: "+ie.length),Kr(tt),tt.M=!0,Kt(11))}}else Ss(this.i,this.l,ie,null),oo(this,ie);Ot==4&&An(this),this.o&&!this.J&&(Ot==4?lt(this.j,this):(this.o=!1,Kn(this)))}else Va(this.g),b==400&&0<ie.indexOf("Unknown SID")?(this.s=3,Kt(12)):(this.s=0,Kt(13)),An(this),di(this)}}}catch{}finally{}};function fi(f){return f.g?f.u=="GET"&&f.L!=2&&f.j.Ca:!1}function mf(f,y){var b=f.C,N=y.indexOf(`
`,b);return N==-1?xa:(b=Number(y.substring(b,N)),isNaN(b)?lc:(N+=1,N+b>y.length?xa:(y=y.slice(N,N+b),f.C=N+b,y)))}xn.prototype.cancel=function(){this.J=!0,An(this)};function Kn(f){f.S=Date.now()+f.I,uc(f,f.I)}function uc(f,y){if(f.B!=null)throw Error("WatchDog timer not null");f.B=ui(v(f.ba,f),y)}function Ra(f){f.B&&(l.clearTimeout(f.B),f.B=null)}xn.prototype.ba=function(){this.B=null;const f=Date.now();0<=f-this.S?(pf(this.i,this.A),this.L!=2&&(ci(),Kt(17)),An(this),this.s=2,di(this)):uc(this,this.S-f)};function di(f){f.j.G==0||f.J||lt(f.j,f)}function An(f){Ra(f);var y=f.M;y&&typeof y.ma=="function"&&y.ma(),f.M=null,to(f.U),f.g&&(y=f.g,f.g=null,y.abort(),y.ma())}function oo(f,y){try{var b=f.j;if(b.G!=0&&(b.g==f||Ia(b.h,f))){if(!f.K&&Ia(b.h,f)&&b.G==3){try{var N=b.Da.g.parse(y)}catch{N=null}if(Array.isArray(N)&&N.length==3){var z=N;if(z[0]==0){e:if(!b.u){if(b.g)if(b.g.F+3e3<f.F)Ps(b),mi(b);else break e;fo(b),Kt(18)}}else b.za=z[1],0<b.za-b.T&&37500>z[2]&&b.F&&b.v==0&&!b.C&&(b.C=ui(v(b.Za,b),6e3));if(1>=pc(b.h)&&b.ca){try{b.ca()}catch{}b.ca=void 0}}else fn(b,11)}else if((f.K||b.g==f)&&Ps(b),!F(y))for(z=b.Da.g.parse(y),y=0;y<z.length;y++){let qe=z[y];if(b.T=qe[0],qe=qe[1],b.G==2)if(qe[0]=="c"){b.K=qe[1],b.ia=qe[2];const tt=qe[3];tt!=null&&(b.la=tt,b.j.info("VER="+b.la));const Ot=qe[4];Ot!=null&&(b.Aa=Ot,b.j.info("SVER="+b.Aa));const Qr=qe[5];Qr!=null&&typeof Qr=="number"&&0<Qr&&(N=1.5*Qr,b.L=N,b.j.info("backChannelRequestTimeoutMs_="+N)),N=b;const xr=f.g;if(xr){const bi=xr.g?xr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(bi){var H=N.h;H.g||bi.indexOf("spdy")==-1&&bi.indexOf("quic")==-1&&bi.indexOf("h2")==-1||(H.j=H.l,H.g=new Set,H.h&&(ao(H,H.h),H.h=null))}if(N.D){const $a=xr.g?xr.g.getResponseHeader("X-HTTP-Session-Id"):null;$a&&(N.ya=$a,ot(N.I,N.D,$a))}}b.G=3,b.l&&b.l.ua(),b.ba&&(b.R=Date.now()-f.F,b.j.info("Handshake RTT: "+b.R+"ms")),N=b;var ie=f;if(N.qa=po(N,N.J?N.ia:null,N.W),ie.K){Pa(N.h,ie);var Xe=ie,Mt=N.L;Mt&&(Xe.I=Mt),Xe.B&&(Ra(Xe),Kn(Xe)),N.g=ie}else Ic(N);0<b.i.length&&yi(b)}else qe[0]!="stop"&&qe[0]!="close"||fn(b,7);else b.G==3&&(qe[0]=="stop"||qe[0]=="close"?qe[0]=="stop"?fn(b,7):ho(b):qe[0]!="noop"&&b.l&&b.l.ta(qe),b.v=0)}}ci(4)}catch{}}var hc=class{constructor(f,y){this.g=f,this.map=y}};function fc(f){this.l=f||10,l.PerformanceNavigationTiming?(f=l.performance.getEntriesByType("navigation"),f=0<f.length&&(f[0].nextHopProtocol=="hq"||f[0].nextHopProtocol=="h2")):f=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=f?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function dc(f){return f.h?!0:f.g?f.g.size>=f.j:!1}function pc(f){return f.h?1:f.g?f.g.size:0}function Ia(f,y){return f.h?f.h==y:f.g?f.g.has(y):!1}function ao(f,y){f.g?f.g.add(y):f.h=y}function Pa(f,y){f.h&&f.h==y?f.h=null:f.g&&f.g.has(y)&&f.g.delete(y)}fc.prototype.cancel=function(){if(this.i=Ca(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const f of this.g.values())f.cancel();this.g.clear()}};function Ca(f){if(f.h!=null)return f.i.concat(f.h.D);if(f.g!=null&&f.g.size!==0){let y=f.i;for(const b of f.g.values())y=y.concat(b.D);return y}return x(f.i)}function Na(f){if(f.V&&typeof f.V=="function")return f.V();if(typeof Map<"u"&&f instanceof Map||typeof Set<"u"&&f instanceof Set)return Array.from(f.values());if(typeof f=="string")return f.split("");if(u(f)){for(var y=[],b=f.length,N=0;N<b;N++)y.push(f[N]);return y}y=[],b=0;for(N in f)y[b++]=f[N];return y}function yf(f){if(f.na&&typeof f.na=="function")return f.na();if(!f.V||typeof f.V!="function"){if(typeof Map<"u"&&f instanceof Map)return Array.from(f.keys());if(!(typeof Set<"u"&&f instanceof Set)){if(u(f)||typeof f=="string"){var y=[];f=f.length;for(var b=0;b<f;b++)y.push(b);return y}y=[],b=0;for(const N in f)y[b++]=N;return y}}}function Oa(f,y){if(f.forEach&&typeof f.forEach=="function")f.forEach(y,void 0);else if(u(f)||typeof f=="string")Array.prototype.forEach.call(f,y,void 0);else for(var b=yf(f),N=Na(f),z=N.length,H=0;H<z;H++)y.call(void 0,N[H],b&&b[H],f)}var pi=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function gc(f,y){if(f){f=f.split("&");for(var b=0;b<f.length;b++){var N=f[b].indexOf("="),z=null;if(0<=N){var H=f[b].substring(0,N);z=f[b].substring(N+1)}else H=f[b];y(H,z?decodeURIComponent(z.replace(/\+/g," ")):"")}}}function Qn(f){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,f instanceof Qn){this.h=f.h,gi(this,f.j),this.o=f.o,this.g=f.g,xs(this,f.s),this.l=f.l;var y=f.i,b=new Rs;b.i=y.i,y.g&&(b.g=new Map(y.g),b.h=y.h),mc(this,b),this.m=f.m}else f&&(y=String(f).match(pi))?(this.h=!1,gi(this,y[1]||"",!0),this.o=Jn(y[2]||""),this.g=Jn(y[3]||"",!0),xs(this,y[4]),this.l=Jn(y[5]||"",!0),mc(this,y[6]||"",!0),this.m=Jn(y[7]||"")):(this.h=!1,this.i=new Rs(null,this.h))}Qn.prototype.toString=function(){var f=[],y=this.j;y&&f.push(Gr(y,ka,!0),":");var b=this.g;return(b||y=="file")&&(f.push("//"),(y=this.o)&&f.push(Gr(y,ka,!0),"@"),f.push(encodeURIComponent(String(b)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),b=this.s,b!=null&&f.push(":",String(b))),(b=this.l)&&(this.g&&b.charAt(0)!="/"&&f.push("/"),f.push(Gr(b,b.charAt(0)=="/"?wc:wf,!0))),(b=this.i.toString())&&f.push("?",b),(b=this.m)&&f.push("#",Gr(b,_c)),f.join("")};function zr(f){return new Qn(f)}function gi(f,y,b){f.j=b?Jn(y,!0):y,f.j&&(f.j=f.j.replace(/:$/,""))}function xs(f,y){if(y){if(y=Number(y),isNaN(y)||0>y)throw Error("Bad port number "+y);f.s=y}else f.s=null}function mc(f,y,b){y instanceof Rs?(f.i=y,vf(f.i,f.h)):(b||(y=Gr(y,vc)),f.i=new Rs(y,f.h))}function ot(f,y,b){f.i.set(y,b)}function As(f){return ot(f,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),f}function Jn(f,y){return f?y?decodeURI(f.replace(/%25/g,"%2525")):decodeURIComponent(f):""}function Gr(f,y,b){return typeof f=="string"?(f=encodeURI(f).replace(y,yc),b&&(f=f.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f):null}function yc(f){return f=f.charCodeAt(0),"%"+(f>>4&15).toString(16)+(f&15).toString(16)}var ka=/[#\/\?@]/g,wf=/[#\?:]/g,wc=/[#\?]/g,vc=/[#\?@]/g,_c=/#/g;function Rs(f,y){this.h=this.g=null,this.i=f||null,this.j=!!y}function Rn(f){f.g||(f.g=new Map,f.h=0,f.i&&gc(f.i,function(y,b){f.add(decodeURIComponent(y.replace(/\+/g," ")),b)}))}n=Rs.prototype,n.add=function(f,y){Rn(this),this.i=null,f=Is(this,f);var b=this.g.get(f);return b||this.g.set(f,b=[]),b.push(y),this.h+=1,this};function bc(f,y){Rn(f),y=Is(f,y),f.g.has(y)&&(f.i=null,f.h-=f.g.get(y).length,f.g.delete(y))}function Ec(f,y){return Rn(f),y=Is(f,y),f.g.has(y)}n.forEach=function(f,y){Rn(this),this.g.forEach(function(b,N){b.forEach(function(z){f.call(y,z,N,this)},this)},this)},n.na=function(){Rn(this);const f=Array.from(this.g.values()),y=Array.from(this.g.keys()),b=[];for(let N=0;N<y.length;N++){const z=f[N];for(let H=0;H<z.length;H++)b.push(y[N])}return b},n.V=function(f){Rn(this);let y=[];if(typeof f=="string")Ec(this,f)&&(y=y.concat(this.g.get(Is(this,f))));else{f=Array.from(this.g.values());for(let b=0;b<f.length;b++)y=y.concat(f[b])}return y},n.set=function(f,y){return Rn(this),this.i=null,f=Is(this,f),Ec(this,f)&&(this.h-=this.g.get(f).length),this.g.set(f,[y]),this.h+=1,this},n.get=function(f,y){return f?(f=this.V(f),0<f.length?String(f[0]):y):y};function ja(f,y,b){bc(f,y),0<b.length&&(f.i=null,f.g.set(Is(f,y),x(b)),f.h+=b.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const f=[],y=Array.from(this.g.keys());for(var b=0;b<y.length;b++){var N=y[b];const H=encodeURIComponent(String(N)),ie=this.V(N);for(N=0;N<ie.length;N++){var z=H;ie[N]!==""&&(z+="="+encodeURIComponent(String(ie[N]))),f.push(z)}}return this.i=f.join("&")};function Is(f,y){return y=String(y),f.j&&(y=y.toLowerCase()),y}function vf(f,y){y&&!f.j&&(Rn(f),f.i=null,f.g.forEach(function(b,N){var z=N.toLowerCase();N!=z&&(bc(this,N),ja(this,z,b))},f)),f.j=y}function _f(f,y){const b=new Hn;if(l.Image){const N=new Image;N.onload=_(Hr,b,"TestLoadImage: loaded",!0,y,N),N.onerror=_(Hr,b,"TestLoadImage: error",!1,y,N),N.onabort=_(Hr,b,"TestLoadImage: abort",!1,y,N),N.ontimeout=_(Hr,b,"TestLoadImage: timeout",!1,y,N),l.setTimeout(function(){N.ontimeout&&N.ontimeout()},1e4),N.src=f}else y(!1)}function bf(f,y){const b=new Hn,N=new AbortController,z=setTimeout(()=>{N.abort(),Hr(b,"TestPingServer: timeout",!1,y)},1e4);fetch(f,{signal:N.signal}).then(H=>{clearTimeout(z),H.ok?Hr(b,"TestPingServer: ok",!0,y):Hr(b,"TestPingServer: server error",!1,y)}).catch(()=>{clearTimeout(z),Hr(b,"TestPingServer: error",!1,y)})}function Hr(f,y,b,N,z){try{z&&(z.onload=null,z.onerror=null,z.onabort=null,z.ontimeout=null),N(b)}catch{}}function Ef(){this.g=new _a}function Tf(f,y,b){const N=b||"";try{Oa(f,function(z,H){let ie=z;h(z)&&(ie=li(z)),y.push(N+H+"="+encodeURIComponent(ie))})}catch(z){throw y.push(N+"type="+encodeURIComponent("_badmap")),z}}function lo(f){this.l=f.Ub||null,this.j=f.eb||!1}E(lo,ba),lo.prototype.g=function(){return new co(this.l,this.j)},lo.prototype.i=function(f){return function(){return f}}({});function co(f,y){Bt.call(this),this.D=f,this.o=y,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}E(co,Bt),n=co.prototype,n.open=function(f,y){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=f,this.A=y,this.readyState=1,Ke(this)},n.send=function(f){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const y={headers:this.u,method:this.B,credentials:this.m,cache:void 0};f&&(y.body=f),(this.D||l).fetch(new Request(this.A,y)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ye(this)),this.readyState=0},n.Sa=function(f){if(this.g&&(this.l=f,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=f.headers,this.readyState=2,Ke(this)),this.g&&(this.readyState=3,Ke(this),this.g)))if(this.responseType==="arraybuffer")f.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in f){if(this.j=f.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Tc(this)}else f.text().then(this.Ra.bind(this),this.ga.bind(this))};function Tc(f){f.j.read().then(f.Pa.bind(f)).catch(f.ga.bind(f))}n.Pa=function(f){if(this.g){if(this.o&&f.value)this.response.push(f.value);else if(!this.o){var y=f.value?f.value:new Uint8Array(0);(y=this.v.decode(y,{stream:!f.done}))&&(this.response=this.responseText+=y)}f.done?Ye(this):Ke(this),this.readyState==3&&Tc(this)}},n.Ra=function(f){this.g&&(this.response=this.responseText=f,Ye(this))},n.Qa=function(f){this.g&&(this.response=f,Ye(this))},n.ga=function(){this.g&&Ye(this)};function Ye(f){f.readyState=4,f.l=null,f.j=null,f.v=null,Ke(f)}n.setRequestHeader=function(f,y){this.u.append(f,y)},n.getResponseHeader=function(f){return this.h&&this.h.get(f.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const f=[],y=this.h.entries();for(var b=y.next();!b.done;)b=b.value,f.push(b[0]+": "+b[1]),b=y.next();return f.join(`\r
`)};function Ke(f){f.onreadystatechange&&f.onreadystatechange.call(f)}Object.defineProperty(co.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(f){this.m=f?"include":"same-origin"}});function Sc(f){let y="";return X(f,function(b,N){y+=N,y+=":",y+=b,y+=`\r
`}),y}function Da(f,y,b){e:{for(N in b){var N=!1;break e}N=!0}N||(b=Sc(b),typeof f=="string"?b!=null&&encodeURIComponent(String(b)):ot(f,y,b))}function yt(f){Bt.call(this),this.headers=new Map,this.o=f||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}E(yt,Bt);var Sf=/^https?$/i,xf=["POST","PUT"];n=yt.prototype,n.Ha=function(f){this.J=f},n.ea=function(f,y,b,N){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+f);y=y?y.toUpperCase():"GET",this.D=f,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Sa.g(),this.v=this.o?rc(this.o):rc(Sa),this.g.onreadystatechange=v(this.Ea,this);try{this.B=!0,this.g.open(y,String(f),!0),this.B=!1}catch(H){xc(this,H);return}if(f=b||"",b=new Map(this.headers),N)if(Object.getPrototypeOf(N)===Object.prototype)for(var z in N)b.set(z,N[z]);else if(typeof N.keys=="function"&&typeof N.get=="function")for(const H of N.keys())b.set(H,N.get(H));else throw Error("Unknown input type for opt_headers: "+String(N));N=Array.from(b.keys()).find(H=>H.toLowerCase()=="content-type"),z=l.FormData&&f instanceof l.FormData,!(0<=Array.prototype.indexOf.call(xf,y,void 0))||N||z||b.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[H,ie]of b)this.g.setRequestHeader(H,ie);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{uo(this),this.u=!0,this.g.send(f),this.u=!1}catch(H){xc(this,H)}};function xc(f,y){f.h=!1,f.g&&(f.j=!0,f.g.abort(),f.j=!1),f.l=y,f.m=5,Ma(f),Tt(f)}function Ma(f){f.A||(f.A=!0,At(f,"complete"),At(f,"error"))}n.abort=function(f){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=f||7,At(this,"complete"),At(this,"abort"),Tt(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Tt(this,!0)),yt.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Ac(this):this.bb())},n.bb=function(){Ac(this)};function Ac(f){if(f.h&&typeof o<"u"&&(!f.v[1]||Qt(f)!=4||f.Z()!=2)){if(f.u&&Qt(f)==4)Xi(f.Ea,0,f);else if(At(f,"readystatechange"),Qt(f)==4){f.h=!1;try{const ie=f.Z();e:switch(ie){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var y=!0;break e;default:y=!1}var b;if(!(b=y)){var N;if(N=ie===0){var z=String(f.D).match(pi)[1]||null;!z&&l.self&&l.self.location&&(z=l.self.location.protocol.slice(0,-1)),N=!Sf.test(z?z.toLowerCase():"")}b=N}if(b)At(f,"complete"),At(f,"success");else{f.m=6;try{var H=2<Qt(f)?f.g.statusText:""}catch{H=""}f.l=H+" ["+f.Z()+"]",Ma(f)}}finally{Tt(f)}}}}function Tt(f,y){if(f.g){uo(f);const b=f.g,N=f.v[0]?()=>{}:null;f.g=null,f.v=null,y||At(f,"ready");try{b.onreadystatechange=N}catch{}}}function uo(f){f.I&&(l.clearTimeout(f.I),f.I=null)}n.isActive=function(){return!!this.g};function Qt(f){return f.g?f.g.readyState:0}n.Z=function(){try{return 2<Qt(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(f){if(this.g){var y=this.g.responseText;return f&&y.indexOf(f)==0&&(y=y.substring(f.length)),va(y)}};function La(f){try{if(!f.g)return null;if("response"in f.g)return f.g.response;switch(f.H){case"":case"text":return f.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in f.g)return f.g.mozResponseArrayBuffer}return null}catch{return null}}function Va(f){const y={};f=(f.g&&2<=Qt(f)&&f.g.getAllResponseHeaders()||"").split(`\r
`);for(let N=0;N<f.length;N++){if(F(f[N]))continue;var b=k(f[N]);const z=b[0];if(b=b[1],typeof b!="string")continue;b=b.trim();const H=y[z]||[];y[z]=H,H.push(b)}j(y,function(N){return N.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function qt(f,y,b){return b&&b.internalChannelParams&&b.internalChannelParams[f]||y}function Fa(f){this.Aa=0,this.i=[],this.j=new Hn,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=qt("failFast",!1,f),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=qt("baseRetryDelayMs",5e3,f),this.cb=qt("retryDelaySeedMs",1e4,f),this.Wa=qt("forwardChannelMaxRetries",2,f),this.wa=qt("forwardChannelRequestTimeoutMs",2e4,f),this.pa=f&&f.xmlHttpFactory||void 0,this.Xa=f&&f.Tb||void 0,this.Ca=f&&f.useFetchStreams||!1,this.L=void 0,this.J=f&&f.supportsCrossDomainXhr||!1,this.K="",this.h=new fc(f&&f.concurrentRequestLimit),this.Da=new Ef,this.P=f&&f.fastHandshake||!1,this.O=f&&f.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=f&&f.Rb||!1,f&&f.xa&&this.j.xa(),f&&f.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&f&&f.detectBufferingProxy||!1,this.ja=void 0,f&&f.longPollingTimeout&&0<f.longPollingTimeout&&(this.ja=f.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Fa.prototype,n.la=8,n.G=1,n.connect=function(f,y,b,N){Kt(0),this.W=f,this.H=y||{},b&&N!==void 0&&(this.H.OSID=b,this.H.OAID=N),this.F=this.X,this.I=po(this,null,this.W),yi(this)};function ho(f){if(Ua(f),f.G==3){var y=f.U++,b=zr(f.I);if(ot(b,"SID",f.K),ot(b,"RID",y),ot(b,"TYPE","terminate"),wi(f,b),y=new xn(f,f.j,y),y.L=2,y.v=As(zr(b)),b=!1,l.navigator&&l.navigator.sendBeacon)try{b=l.navigator.sendBeacon(y.v.toString(),"")}catch{}!b&&l.Image&&(new Image().src=y.v,b=!0),b||(y.g=Cc(y.j,null),y.g.ea(y.v)),y.F=Date.now(),Kn(y)}Pc(f)}function mi(f){f.g&&(Kr(f),f.g.cancel(),f.g=null)}function Ua(f){mi(f),f.u&&(l.clearTimeout(f.u),f.u=null),Ps(f),f.h.cancel(),f.s&&(typeof f.s=="number"&&l.clearTimeout(f.s),f.s=null)}function yi(f){if(!dc(f.h)&&!f.s){f.s=!0;var y=f.Ga;Ae||nt(),Le||(Ae(),Le=!0),wt.add(y,f),f.B=0}}function Rc(f,y){return pc(f.h)>=f.h.j-(f.s?1:0)?!1:f.s?(f.i=y.D.concat(f.i),!0):f.G==1||f.G==2||f.B>=(f.Va?0:f.Wa)?!1:(f.s=ui(v(f.Ga,f,y),hn(f,f.B)),f.B++,!0)}n.Ga=function(f){if(this.s)if(this.s=null,this.G==1){if(!f){this.U=Math.floor(1e5*Math.random()),f=this.U++;const z=new xn(this,this.j,f);let H=this.o;if(this.S&&(H?(H=A(H),T(H,this.S)):H=this.S),this.m!==null||this.O||(z.H=H,H=null),this.P)e:{for(var y=0,b=0;b<this.i.length;b++){t:{var N=this.i[b];if("__data__"in N.map&&(N=N.map.__data__,typeof N=="string")){N=N.length;break t}N=void 0}if(N===void 0)break;if(y+=N,4096<y){y=b;break e}if(y===4096||b===this.i.length-1){y=b+1;break e}}y=1e3}else y=1e3;y=_r(this,z,y),b=zr(this.I),ot(b,"RID",f),ot(b,"CVER",22),this.D&&ot(b,"X-HTTP-Session-Id",this.D),wi(this,b),H&&(this.O?y="headers="+encodeURIComponent(String(Sc(H)))+"&"+y:this.m&&Da(b,this.m,H)),ao(this.h,z),this.Ua&&ot(b,"TYPE","init"),this.P?(ot(b,"$req",y),ot(b,"SID","null"),z.T=!0,Aa(z,b,null)):Aa(z,b,y),this.G=2}}else this.G==3&&(f?ir(this,f):this.i.length==0||dc(this.h)||ir(this))};function ir(f,y){var b;y?b=y.l:b=f.U++;const N=zr(f.I);ot(N,"SID",f.K),ot(N,"RID",b),ot(N,"AID",f.T),wi(f,N),f.m&&f.o&&Da(N,f.m,f.o),b=new xn(f,f.j,b,f.B+1),f.m===null&&(b.H=f.o),y&&(f.i=y.D.concat(f.i)),y=_r(f,b,1e3),b.I=Math.round(.5*f.wa)+Math.round(.5*f.wa*Math.random()),ao(f.h,b),Aa(b,N,y)}function wi(f,y){f.H&&X(f.H,function(b,N){ot(y,N,b)}),f.l&&Oa({},function(b,N){ot(y,N,b)})}function _r(f,y,b){b=Math.min(f.i.length,b);var N=f.l?v(f.l.Na,f.l,f):null;e:{var z=f.i;let H=-1;for(;;){const ie=["count="+b];H==-1?0<b?(H=z[0].g,ie.push("ofs="+H)):H=0:ie.push("ofs="+H);let Xe=!0;for(let Mt=0;Mt<b;Mt++){let qe=z[Mt].g;const tt=z[Mt].map;if(qe-=H,0>qe)H=Math.max(0,z[Mt].g-100),Xe=!1;else try{Tf(tt,ie,"req"+qe+"_")}catch{N&&N(tt)}}if(Xe){N=ie.join("&");break e}}}return f=f.i.splice(0,b),y.D=f,N}function Ic(f){if(!f.g&&!f.u){f.Y=1;var y=f.Fa;Ae||nt(),Le||(Ae(),Le=!0),wt.add(y,f),f.v=0}}function fo(f){return f.g||f.u||3<=f.v?!1:(f.Y++,f.u=ui(v(f.Fa,f),hn(f,f.v)),f.v++,!0)}n.Fa=function(){if(this.u=null,vi(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var f=2*this.R;this.j.info("BP detection timer enabled: "+f),this.A=ui(v(this.ab,this),f)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Kt(10),mi(this),vi(this))};function Kr(f){f.A!=null&&(l.clearTimeout(f.A),f.A=null)}function vi(f){f.g=new xn(f,f.j,"rpc",f.Y),f.m===null&&(f.g.H=f.o),f.g.O=0;var y=zr(f.qa);ot(y,"RID","rpc"),ot(y,"SID",f.K),ot(y,"AID",f.T),ot(y,"CI",f.F?"0":"1"),!f.F&&f.ja&&ot(y,"TO",f.ja),ot(y,"TYPE","xmlhttp"),wi(f,y),f.m&&f.o&&Da(y,f.m,f.o),f.L&&(f.g.I=f.L);var b=f.g;f=f.ia,b.L=1,b.v=As(zr(y)),b.m=null,b.P=!0,cc(b,f)}n.Za=function(){this.C!=null&&(this.C=null,mi(this),fo(this),Kt(19))};function Ps(f){f.C!=null&&(l.clearTimeout(f.C),f.C=null)}function lt(f,y){var b=null;if(f.g==y){Ps(f),Kr(f),f.g=null;var N=2}else if(Ia(f.h,y))b=y.D,Pa(f.h,y),N=1;else return;if(f.G!=0){if(y.o)if(N==1){b=y.m?y.m.length:0,y=Date.now()-y.F;var z=f.B;N=no(),At(N,new so(N,b)),yi(f)}else Ic(f);else if(z=y.s,z==3||z==0&&0<y.X||!(N==1&&Rc(f,y)||N==2&&fo(f)))switch(b&&0<b.length&&(y=f.h,y.i=y.i.concat(b)),z){case 1:fn(f,5);break;case 4:fn(f,10);break;case 3:fn(f,6);break;default:fn(f,2)}}}function hn(f,y){let b=f.Ta+Math.floor(Math.random()*f.cb);return f.isActive()||(b*=2),b*y}function fn(f,y){if(f.j.info("Error code "+y),y==2){var b=v(f.fb,f),N=f.Xa;const z=!N;N=new Qn(N||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||gi(N,"https"),As(N),z?_f(N.toString(),b):bf(N.toString(),b)}else Kt(2);f.G=0,f.l&&f.l.sa(y),Pc(f),Ua(f)}n.fb=function(f){f?(this.j.info("Successfully pinged google.com"),Kt(2)):(this.j.info("Failed to ping google.com"),Kt(1))};function Pc(f){if(f.G=0,f.ka=[],f.l){const y=Ca(f.h);(y.length!=0||f.i.length!=0)&&(R(f.ka,y),R(f.ka,f.i),f.h.i.length=0,x(f.i),f.i.length=0),f.l.ra()}}function po(f,y,b){var N=b instanceof Qn?zr(b):new Qn(b);if(N.g!="")y&&(N.g=y+"."+N.g),xs(N,N.s);else{var z=l.location;N=z.protocol,y=y?y+"."+z.hostname:z.hostname,z=+z.port;var H=new Qn(null);N&&gi(H,N),y&&(H.g=y),z&&xs(H,z),b&&(H.l=b),N=H}return b=f.D,y=f.ya,b&&y&&ot(N,b,y),ot(N,"VER",f.la),wi(f,N),N}function Cc(f,y,b){if(y&&!f.J)throw Error("Can't create secondary domain capable XhrIo object.");return y=f.Ca&&!f.pa?new yt(new lo({eb:b})):new yt(f.pa),y.Ha(f.J),y}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Nc(){}n=Nc.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function go(){}go.prototype.g=function(f,y){return new or(f,y)};function or(f,y){Bt.call(this),this.g=new Fa(y),this.l=f,this.h=y&&y.messageUrlParams||null,f=y&&y.messageHeaders||null,y&&y.clientProtocolHeaderRequired&&(f?f["X-Client-Protocol"]="webchannel":f={"X-Client-Protocol":"webchannel"}),this.g.o=f,f=y&&y.initMessageHeaders||null,y&&y.messageContentType&&(f?f["X-WebChannel-Content-Type"]=y.messageContentType:f={"X-WebChannel-Content-Type":y.messageContentType}),y&&y.va&&(f?f["X-WebChannel-Client-Profile"]=y.va:f={"X-WebChannel-Client-Profile":y.va}),this.g.S=f,(f=y&&y.Sb)&&!F(f)&&(this.g.m=f),this.v=y&&y.supportsCrossDomainXhr||!1,this.u=y&&y.sendRawJson||!1,(y=y&&y.httpSessionIdParam)&&!F(y)&&(this.g.D=y,f=this.h,f!==null&&y in f&&(f=this.h,y in f&&delete f[y])),this.j=new Cs(this)}E(or,Bt),or.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},or.prototype.close=function(){ho(this.g)},or.prototype.o=function(f){var y=this.g;if(typeof f=="string"){var b={};b.__data__=f,f=b}else this.u&&(b={},b.__data__=li(f),f=b);y.i.push(new hc(y.Ya++,f)),y.G==3&&yi(y)},or.prototype.N=function(){this.g.l=null,delete this.j,ho(this.g),delete this.g,or.aa.N.call(this)};function _i(f){ro.call(this),f.__headers__&&(this.headers=f.__headers__,this.statusCode=f.__status__,delete f.__headers__,delete f.__status__);var y=f.__sm__;if(y){e:{for(const b in y){f=b;break e}f=void 0}(this.i=f)&&(f=this.i,y=y!==null&&f in y?y[f]:void 0),this.data=y}else this.data=f}E(_i,ro);function Yn(){Ea.call(this),this.status=1}E(Yn,Ea);function Cs(f){this.g=f}E(Cs,Nc),Cs.prototype.ua=function(){At(this.g,"a")},Cs.prototype.ta=function(f){At(this.g,new _i(f))},Cs.prototype.sa=function(f){At(this.g,new Yn)},Cs.prototype.ra=function(){At(this.g,"b")},go.prototype.createWebChannel=go.prototype.g,or.prototype.send=or.prototype.o,or.prototype.open=or.prototype.m,or.prototype.close=or.prototype.close,Hb=function(){return new go},Gb=function(){return no()},zb=Gn,mg={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},io.NO_ERROR=0,io.TIMEOUT=8,io.HTTP_ERROR=6,Hu=io,oc.COMPLETE="complete",Wb=oc,nc.EventType=Ts,Ts.OPEN="a",Ts.CLOSE="b",Ts.ERROR="c",Ts.MESSAGE="d",Bt.prototype.listen=Bt.prototype.K,cl=nc,yt.prototype.listenOnce=yt.prototype.L,yt.prototype.getLastError=yt.prototype.Ka,yt.prototype.getLastErrorCode=yt.prototype.Ba,yt.prototype.getStatus=yt.prototype.Z,yt.prototype.getResponseJson=yt.prototype.Oa,yt.prototype.getResponseText=yt.prototype.oa,yt.prototype.send=yt.prototype.ea,yt.prototype.setWithCredentials=yt.prototype.Ha,qb=yt}).apply(typeof Cu<"u"?Cu:typeof self<"u"?self:typeof window<"u"?window:{});const kv="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gr{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}gr.UNAUTHENTICATED=new gr(null),gr.GOOGLE_CREDENTIALS=new gr("google-credentials-uid"),gr.FIRST_PARTY=new gr("first-party-uid"),gr.MOCK_USER=new gr("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fa="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bi=new Mb("@firebase/firestore");function il(){return Bi.logLevel}function de(n,...e){if(Bi.logLevel<=He.DEBUG){const t=e.map(cm);Bi.debug(`Firestore (${fa}): ${n}`,...t)}}function ds(n,...e){if(Bi.logLevel<=He.ERROR){const t=e.map(cm);Bi.error(`Firestore (${fa}): ${n}`,...t)}}function Ko(n,...e){if(Bi.logLevel<=He.WARN){const t=e.map(cm);Bi.warn(`Firestore (${fa}): ${n}`,...t)}}function cm(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Se(n="Unexpected state"){const e=`FIRESTORE (${fa}) INTERNAL ASSERTION FAILED: `+n;throw ds(e),new Error(e)}function it(n,e){n||Se()}function Ce(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class fe extends ha{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Js{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kb{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class N5{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(gr.UNAUTHENTICATED))}shutdown(){}}class O5{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class k5{constructor(e){this.t=e,this.currentUser=gr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){it(this.o===void 0);let r=this.i;const s=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve();let i=new Js;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Js,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const u=i;e.enqueueRetryable(async()=>{await u.promise,await s(this.currentUser)})},l=u=>{de("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(u=>l(u)),setTimeout(()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?l(u):(de("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Js)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(de("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(it(typeof r.accessToken=="string"),new Kb(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return it(e===null||typeof e=="string"),new gr(e)}}class j5{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=gr.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class D5{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new j5(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(gr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class M5{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class L5{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){it(this.o===void 0);const r=i=>{i.error!=null&&de("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,de("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{de("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):de("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(it(typeof t.token=="string"),this.R=t.token,new M5(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V5(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qb{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=V5(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function Qe(n,e){return n<e?-1:n>e?1:0}function Qo(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pt{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new fe(Z.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new fe(Z.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new fe(Z.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new fe(Z.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return pt.fromMillis(Date.now())}static fromDate(e){return pt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new pt(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Qe(this.nanoseconds,e.nanoseconds):Qe(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pe{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Pe(e)}static min(){return new Pe(new pt(0,0))}static max(){return new Pe(new pt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pl{constructor(e,t,r){t===void 0?t=0:t>e.length&&Se(),r===void 0?r=e.length-t:r>e.length-t&&Se(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Pl.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Pl?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class gt extends Pl{construct(e,t,r){return new gt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new fe(Z.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new gt(t)}static emptyPath(){return new gt([])}}const F5=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class er extends Pl{construct(e,t,r){return new er(e,t,r)}static isValidIdentifier(e){return F5.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),er.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new er(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new fe(Z.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new fe(Z.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new fe(Z.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else l==="`"?(o=!o,s++):l!=="."||o?(r+=l,s++):(i(),s++)}if(i(),o)throw new fe(Z.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new er(t)}static emptyPath(){return new er([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ye{constructor(e){this.path=e}static fromPath(e){return new ye(gt.fromString(e))}static fromName(e){return new ye(gt.fromString(e).popFirst(5))}static empty(){return new ye(gt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&gt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return gt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ye(new gt(e.slice()))}}function U5(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Pe.fromTimestamp(r===1e9?new pt(t+1,0):new pt(t,r));return new Zs(s,ye.empty(),e)}function $5(n){return new Zs(n.readTime,n.key,-1)}class Zs{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Zs(Pe.min(),ye.empty(),-1)}static max(){return new Zs(Pe.max(),ye.empty(),-1)}}function B5(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=ye.comparator(n.documentKey,e.documentKey),t!==0?t:Qe(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q5="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class W5{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kl(n){if(n.code!==Z.FAILED_PRECONDITION||n.message!==q5)throw n;de("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class re{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Se(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new re((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof re?t:re.resolve(t)}catch(t){return re.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):re.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):re.reject(t)}static resolve(e){return new re((t,r)=>{t(e)})}static reject(e){return new re((t,r)=>{r(e)})}static waitFor(e){return new re((t,r)=>{let s=0,i=0,o=!1;e.forEach(l=>{++s,l.next(()=>{++i,o&&i===s&&t()},u=>r(u))}),o=!0,i===s&&t()})}static or(e){let t=re.resolve(!1);for(const r of e)t=t.next(s=>s?re.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new re((r,s)=>{const i=e.length,o=new Array(i);let l=0;for(let u=0;u<i;u++){const h=u;t(e[h]).next(d=>{o[h]=d,++l,l===i&&r(o)},d=>s(d))}})}static doWhile(e,t){return new re((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}function z5(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Ql(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class um{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}um.oe=-1;function Xh(n){return n==null}function hh(n){return n===0&&1/n==-1/0}function G5(n){return typeof n=="number"&&Number.isInteger(n)&&!hh(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jv(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function da(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Jb(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bt{constructor(e,t){this.comparator=e,this.root=t||Zt.EMPTY}insert(e,t){return new bt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Zt.BLACK,null,null))}remove(e){return new bt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Zt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Nu(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Nu(this.root,e,this.comparator,!1)}getReverseIterator(){return new Nu(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Nu(this.root,e,this.comparator,!0)}}class Nu{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Zt{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Zt.RED,this.left=s??Zt.EMPTY,this.right=i??Zt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Zt(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Zt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Zt.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Zt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Zt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Se();const e=this.left.check();if(e!==this.right.check())throw Se();return e+(this.isRed()?0:1)}}Zt.EMPTY=null,Zt.RED=!0,Zt.BLACK=!1;Zt.EMPTY=new class{constructor(){this.size=0}get key(){throw Se()}get value(){throw Se()}get color(){throw Se()}get left(){throw Se()}get right(){throw Se()}copy(e,t,r,s,i){return this}insert(e,t,r){return new Zt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rr{constructor(e){this.comparator=e,this.data=new bt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Dv(this.data.getIterator())}getIteratorFrom(e){return new Dv(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof rr)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new rr(this.comparator);return t.data=e,t}}class Dv{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vn{constructor(e){this.fields=e,e.sort(er.comparator)}static empty(){return new vn([])}unionWith(e){let t=new rr(er.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new vn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Qo(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yb extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nr{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Yb("Invalid base64 string: "+i):i}}(e);return new nr(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new nr(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Qe(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}nr.EMPTY_BYTE_STRING=new nr("");const H5=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ei(n){if(it(!!n),typeof n=="string"){let e=0;const t=H5.exec(n);if(it(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Pt(n.seconds),nanos:Pt(n.nanos)}}function Pt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function qi(n){return typeof n=="string"?nr.fromBase64String(n):nr.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hm(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function fm(n){const e=n.mapValue.fields.__previous_value__;return hm(e)?fm(e):e}function Cl(n){const e=ei(n.mapValue.fields.__local_write_time__.timestampValue);return new pt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K5{constructor(e,t,r,s,i,o,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=l,this.longPollingOptions=u,this.useFetchStreams=h}}class Nl{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Nl("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Nl&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ou={mapValue:{}};function Wi(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?hm(n)?4:J5(n)?9007199254740991:Q5(n)?10:11:Se()}function Fn(n,e){if(n===e)return!0;const t=Wi(n);if(t!==Wi(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Cl(n).isEqual(Cl(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=ei(s.timestampValue),l=ei(i.timestampValue);return o.seconds===l.seconds&&o.nanos===l.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return qi(s.bytesValue).isEqual(qi(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return Pt(s.geoPointValue.latitude)===Pt(i.geoPointValue.latitude)&&Pt(s.geoPointValue.longitude)===Pt(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Pt(s.integerValue)===Pt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Pt(s.doubleValue),l=Pt(i.doubleValue);return o===l?hh(o)===hh(l):isNaN(o)&&isNaN(l)}return!1}(n,e);case 9:return Qo(n.arrayValue.values||[],e.arrayValue.values||[],Fn);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},l=i.mapValue.fields||{};if(jv(o)!==jv(l))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(l[u]===void 0||!Fn(o[u],l[u])))return!1;return!0}(n,e);default:return Se()}}function Ol(n,e){return(n.values||[]).find(t=>Fn(t,e))!==void 0}function Jo(n,e){if(n===e)return 0;const t=Wi(n),r=Wi(e);if(t!==r)return Qe(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Qe(n.booleanValue,e.booleanValue);case 2:return function(i,o){const l=Pt(i.integerValue||i.doubleValue),u=Pt(o.integerValue||o.doubleValue);return l<u?-1:l>u?1:l===u?0:isNaN(l)?isNaN(u)?0:-1:1}(n,e);case 3:return Mv(n.timestampValue,e.timestampValue);case 4:return Mv(Cl(n),Cl(e));case 5:return Qe(n.stringValue,e.stringValue);case 6:return function(i,o){const l=qi(i),u=qi(o);return l.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const l=i.split("/"),u=o.split("/");for(let h=0;h<l.length&&h<u.length;h++){const d=Qe(l[h],u[h]);if(d!==0)return d}return Qe(l.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const l=Qe(Pt(i.latitude),Pt(o.latitude));return l!==0?l:Qe(Pt(i.longitude),Pt(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Lv(n.arrayValue,e.arrayValue);case 10:return function(i,o){var l,u,h,d;const g=i.fields||{},v=o.fields||{},_=(l=g.value)===null||l===void 0?void 0:l.arrayValue,E=(u=v.value)===null||u===void 0?void 0:u.arrayValue,x=Qe(((h=_==null?void 0:_.values)===null||h===void 0?void 0:h.length)||0,((d=E==null?void 0:E.values)===null||d===void 0?void 0:d.length)||0);return x!==0?x:Lv(_,E)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===Ou.mapValue&&o===Ou.mapValue)return 0;if(i===Ou.mapValue)return 1;if(o===Ou.mapValue)return-1;const l=i.fields||{},u=Object.keys(l),h=o.fields||{},d=Object.keys(h);u.sort(),d.sort();for(let g=0;g<u.length&&g<d.length;++g){const v=Qe(u[g],d[g]);if(v!==0)return v;const _=Jo(l[u[g]],h[d[g]]);if(_!==0)return _}return Qe(u.length,d.length)}(n.mapValue,e.mapValue);default:throw Se()}}function Mv(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Qe(n,e);const t=ei(n),r=ei(e),s=Qe(t.seconds,r.seconds);return s!==0?s:Qe(t.nanos,r.nanos)}function Lv(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Jo(t[s],r[s]);if(i)return i}return Qe(t.length,r.length)}function Yo(n){return yg(n)}function yg(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=ei(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return qi(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return ye.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=yg(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${yg(t.fields[o])}`;return s+"}"}(n.mapValue):Se()}function Vv(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function wg(n){return!!n&&"integerValue"in n}function dm(n){return!!n&&"arrayValue"in n}function Fv(n){return!!n&&"nullValue"in n}function Uv(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ku(n){return!!n&&"mapValue"in n}function Q5(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function vl(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return da(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=vl(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=vl(n.arrayValue.values[t]);return e}return Object.assign({},n)}function J5(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sn{constructor(e){this.value=e}static empty(){return new sn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Ku(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=vl(t)}setAll(e){let t=er.emptyPath(),r={},s=[];e.forEach((o,l)=>{if(!t.isImmediateParentOf(l)){const u=this.getFieldsMap(t);this.applyChanges(u,r,s),r={},s=[],t=l.popLast()}o?r[l.lastSegment()]=vl(o):s.push(l.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Ku(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Fn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Ku(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){da(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new sn(vl(this.value))}}function Xb(n){const e=[];return da(n.fields,(t,r)=>{const s=new er([t]);if(Ku(r)){const i=Xb(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new vn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mr{constructor(e,t,r,s,i,o,l){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=l}static newInvalidDocument(e){return new mr(e,0,Pe.min(),Pe.min(),Pe.min(),sn.empty(),0)}static newFoundDocument(e,t,r,s){return new mr(e,1,t,Pe.min(),r,s,0)}static newNoDocument(e,t){return new mr(e,2,t,Pe.min(),Pe.min(),sn.empty(),0)}static newUnknownDocument(e,t){return new mr(e,3,t,Pe.min(),Pe.min(),sn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Pe.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=sn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=sn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Pe.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof mr&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new mr(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fh{constructor(e,t){this.position=e,this.inclusive=t}}function $v(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=ye.comparator(ye.fromName(o.referenceValue),t.key):r=Jo(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function Bv(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Fn(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kl{constructor(e,t="asc"){this.field=e,this.dir=t}}function Y5(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zb{}class jt extends Zb{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Z5(e,t,r):t==="array-contains"?new rU(e,r):t==="in"?new nU(e,r):t==="not-in"?new sU(e,r):t==="array-contains-any"?new iU(e,r):new jt(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new eU(e,r):new tU(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Jo(t,this.value)):t!==null&&Wi(this.value)===Wi(t)&&this.matchesComparison(Jo(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Se()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class bn extends Zb{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new bn(e,t)}matches(e){return eE(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function eE(n){return n.op==="and"}function tE(n){return X5(n)&&eE(n)}function X5(n){for(const e of n.filters)if(e instanceof bn)return!1;return!0}function vg(n){if(n instanceof jt)return n.field.canonicalString()+n.op.toString()+Yo(n.value);if(tE(n))return n.filters.map(e=>vg(e)).join(",");{const e=n.filters.map(t=>vg(t)).join(",");return`${n.op}(${e})`}}function rE(n,e){return n instanceof jt?function(r,s){return s instanceof jt&&r.op===s.op&&r.field.isEqual(s.field)&&Fn(r.value,s.value)}(n,e):n instanceof bn?function(r,s){return s instanceof bn&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,l)=>i&&rE(o,s.filters[l]),!0):!1}(n,e):void Se()}function nE(n){return n instanceof jt?function(t){return`${t.field.canonicalString()} ${t.op} ${Yo(t.value)}`}(n):n instanceof bn?function(t){return t.op.toString()+" {"+t.getFilters().map(nE).join(" ,")+"}"}(n):"Filter"}class Z5 extends jt{constructor(e,t,r){super(e,t,r),this.key=ye.fromName(r.referenceValue)}matches(e){const t=ye.comparator(e.key,this.key);return this.matchesComparison(t)}}class eU extends jt{constructor(e,t){super(e,"in",t),this.keys=sE("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class tU extends jt{constructor(e,t){super(e,"not-in",t),this.keys=sE("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function sE(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>ye.fromName(r.referenceValue))}class rU extends jt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return dm(t)&&Ol(t.arrayValue,this.value)}}class nU extends jt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Ol(this.value.arrayValue,t)}}class sU extends jt{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ol(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Ol(this.value.arrayValue,t)}}class iU extends jt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!dm(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Ol(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oU{constructor(e,t=null,r=[],s=[],i=null,o=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=l,this.ue=null}}function qv(n,e=null,t=[],r=[],s=null,i=null,o=null){return new oU(n,e,t,r,s,i,o)}function pm(n){const e=Ce(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>vg(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Xh(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Yo(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Yo(r)).join(",")),e.ue=t}return e.ue}function gm(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Y5(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!rE(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Bv(n.startAt,e.startAt)&&Bv(n.endAt,e.endAt)}function _g(n){return ye.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pa{constructor(e,t=null,r=[],s=[],i=null,o="F",l=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=l,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function aU(n,e,t,r,s,i,o,l){return new pa(n,e,t,r,s,i,o,l)}function iE(n){return new pa(n)}function Wv(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function oE(n){return n.collectionGroup!==null}function _l(n){const e=Ce(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let l=new rr(er.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(h=>{h.isInequality()&&(l=l.add(h.field))})}),l})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new kl(i,r))}),t.has(er.keyField().canonicalString())||e.ce.push(new kl(er.keyField(),r))}return e.ce}function Mn(n){const e=Ce(n);return e.le||(e.le=lU(e,_l(n))),e.le}function lU(n,e){if(n.limitType==="F")return qv(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new kl(s.field,i)});const t=n.endAt?new fh(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new fh(n.startAt.position,n.startAt.inclusive):null;return qv(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function bg(n,e){const t=n.filters.concat([e]);return new pa(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Eg(n,e,t){return new pa(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Zh(n,e){return gm(Mn(n),Mn(e))&&n.limitType===e.limitType}function aE(n){return`${pm(Mn(n))}|lt:${n.limitType}`}function Mo(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>nE(s)).join(", ")}]`),Xh(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Yo(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Yo(s)).join(",")),`Target(${r})`}(Mn(n))}; limitType=${n.limitType})`}function ef(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):ye.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of _l(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,l,u){const h=$v(o,l,u);return o.inclusive?h<=0:h<0}(r.startAt,_l(r),s)||r.endAt&&!function(o,l,u){const h=$v(o,l,u);return o.inclusive?h>=0:h>0}(r.endAt,_l(r),s))}(n,e)}function cU(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function lE(n){return(e,t)=>{let r=!1;for(const s of _l(n)){const i=uU(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function uU(n,e,t){const r=n.field.isKeyField()?ye.comparator(e.key,t.key):function(i,o,l){const u=o.data.field(i),h=l.data.field(i);return u!==null&&h!==null?Jo(u,h):Se()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Se()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ga{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){da(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return Jb(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hU=new bt(ye.comparator);function ps(){return hU}const cE=new bt(ye.comparator);function ul(...n){let e=cE;for(const t of n)e=e.insert(t.key,t);return e}function uE(n){let e=cE;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Di(){return bl()}function hE(){return bl()}function bl(){return new ga(n=>n.toString(),(n,e)=>n.isEqual(e))}const fU=new bt(ye.comparator),dU=new rr(ye.comparator);function Be(...n){let e=dU;for(const t of n)e=e.add(t);return e}const pU=new rr(Qe);function gU(){return pU}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mm(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:hh(e)?"-0":e}}function fE(n){return{integerValue:""+n}}function mU(n,e){return G5(e)?fE(e):mm(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tf{constructor(){this._=void 0}}function yU(n,e,t){return n instanceof dh?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&hm(i)&&(i=fm(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof jl?pE(n,e):n instanceof Dl?gE(n,e):function(s,i){const o=dE(s,i),l=zv(o)+zv(s.Pe);return wg(o)&&wg(s.Pe)?fE(l):mm(s.serializer,l)}(n,e)}function wU(n,e,t){return n instanceof jl?pE(n,e):n instanceof Dl?gE(n,e):t}function dE(n,e){return n instanceof ph?function(r){return wg(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class dh extends tf{}class jl extends tf{constructor(e){super(),this.elements=e}}function pE(n,e){const t=mE(e);for(const r of n.elements)t.some(s=>Fn(s,r))||t.push(r);return{arrayValue:{values:t}}}class Dl extends tf{constructor(e){super(),this.elements=e}}function gE(n,e){let t=mE(e);for(const r of n.elements)t=t.filter(s=>!Fn(s,r));return{arrayValue:{values:t}}}class ph extends tf{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function zv(n){return Pt(n.integerValue||n.doubleValue)}function mE(n){return dm(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function vU(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof jl&&s instanceof jl||r instanceof Dl&&s instanceof Dl?Qo(r.elements,s.elements,Fn):r instanceof ph&&s instanceof ph?Fn(r.Pe,s.Pe):r instanceof dh&&s instanceof dh}(n.transform,e.transform)}class _U{constructor(e,t){this.version=e,this.transformResults=t}}class hs{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new hs}static exists(e){return new hs(void 0,e)}static updateTime(e){return new hs(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Qu(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class rf{}function yE(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new vE(n.key,hs.none()):new Jl(n.key,n.data,hs.none());{const t=n.data,r=sn.empty();let s=new rr(er.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Ki(n.key,r,new vn(s.toArray()),hs.none())}}function bU(n,e,t){n instanceof Jl?function(s,i,o){const l=s.value.clone(),u=Hv(s.fieldTransforms,i,o.transformResults);l.setAll(u),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):n instanceof Ki?function(s,i,o){if(!Qu(s.precondition,i))return void i.convertToUnknownDocument(o.version);const l=Hv(s.fieldTransforms,i,o.transformResults),u=i.data;u.setAll(wE(s)),u.setAll(l),i.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function El(n,e,t,r){return n instanceof Jl?function(i,o,l,u){if(!Qu(i.precondition,o))return l;const h=i.value.clone(),d=Kv(i.fieldTransforms,u,o);return h.setAll(d),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(n,e,t,r):n instanceof Ki?function(i,o,l,u){if(!Qu(i.precondition,o))return l;const h=Kv(i.fieldTransforms,u,o),d=o.data;return d.setAll(wE(i)),d.setAll(h),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(g=>g.field))}(n,e,t,r):function(i,o,l){return Qu(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):l}(n,e,t)}function EU(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=dE(r.transform,s||null);i!=null&&(t===null&&(t=sn.empty()),t.set(r.field,i))}return t||null}function Gv(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Qo(r,s,(i,o)=>vU(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Jl extends rf{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Ki extends rf{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function wE(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Hv(n,e,t){const r=new Map;it(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,l=e.data.field(i.field);r.set(i.field,wU(o,l,t[s]))}return r}function Kv(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,yU(i,o,e))}return r}class vE extends rf{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class TU extends rf{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SU{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&bU(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=El(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=El(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=hE();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let l=this.applyToLocalView(o,i.mutatedFields);l=t.has(s.key)?null:l;const u=yE(o,l);u!==null&&r.set(s.key,u),o.isValidDocument()||o.convertToNoDocument(Pe.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Be())}isEqual(e){return this.batchId===e.batchId&&Qo(this.mutations,e.mutations,(t,r)=>Gv(t,r))&&Qo(this.baseMutations,e.baseMutations,(t,r)=>Gv(t,r))}}class ym{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){it(e.mutations.length===r.length);let s=function(){return fU}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new ym(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xU{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AU{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var kt,ze;function RU(n){switch(n){default:return Se();case Z.CANCELLED:case Z.UNKNOWN:case Z.DEADLINE_EXCEEDED:case Z.RESOURCE_EXHAUSTED:case Z.INTERNAL:case Z.UNAVAILABLE:case Z.UNAUTHENTICATED:return!1;case Z.INVALID_ARGUMENT:case Z.NOT_FOUND:case Z.ALREADY_EXISTS:case Z.PERMISSION_DENIED:case Z.FAILED_PRECONDITION:case Z.ABORTED:case Z.OUT_OF_RANGE:case Z.UNIMPLEMENTED:case Z.DATA_LOSS:return!0}}function _E(n){if(n===void 0)return ds("GRPC error has no .code"),Z.UNKNOWN;switch(n){case kt.OK:return Z.OK;case kt.CANCELLED:return Z.CANCELLED;case kt.UNKNOWN:return Z.UNKNOWN;case kt.DEADLINE_EXCEEDED:return Z.DEADLINE_EXCEEDED;case kt.RESOURCE_EXHAUSTED:return Z.RESOURCE_EXHAUSTED;case kt.INTERNAL:return Z.INTERNAL;case kt.UNAVAILABLE:return Z.UNAVAILABLE;case kt.UNAUTHENTICATED:return Z.UNAUTHENTICATED;case kt.INVALID_ARGUMENT:return Z.INVALID_ARGUMENT;case kt.NOT_FOUND:return Z.NOT_FOUND;case kt.ALREADY_EXISTS:return Z.ALREADY_EXISTS;case kt.PERMISSION_DENIED:return Z.PERMISSION_DENIED;case kt.FAILED_PRECONDITION:return Z.FAILED_PRECONDITION;case kt.ABORTED:return Z.ABORTED;case kt.OUT_OF_RANGE:return Z.OUT_OF_RANGE;case kt.UNIMPLEMENTED:return Z.UNIMPLEMENTED;case kt.DATA_LOSS:return Z.DATA_LOSS;default:return Se()}}(ze=kt||(kt={}))[ze.OK=0]="OK",ze[ze.CANCELLED=1]="CANCELLED",ze[ze.UNKNOWN=2]="UNKNOWN",ze[ze.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ze[ze.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ze[ze.NOT_FOUND=5]="NOT_FOUND",ze[ze.ALREADY_EXISTS=6]="ALREADY_EXISTS",ze[ze.PERMISSION_DENIED=7]="PERMISSION_DENIED",ze[ze.UNAUTHENTICATED=16]="UNAUTHENTICATED",ze[ze.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ze[ze.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ze[ze.ABORTED=10]="ABORTED",ze[ze.OUT_OF_RANGE=11]="OUT_OF_RANGE",ze[ze.UNIMPLEMENTED=12]="UNIMPLEMENTED",ze[ze.INTERNAL=13]="INTERNAL",ze[ze.UNAVAILABLE=14]="UNAVAILABLE",ze[ze.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IU(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PU=new Li([4294967295,4294967295],0);function Qv(n){const e=IU().encode(n),t=new Bb;return t.update(e),new Uint8Array(t.digest())}function Jv(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Li([t,r],0),new Li([s,i],0)]}class wm{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new hl(`Invalid padding: ${t}`);if(r<0)throw new hl(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new hl(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new hl(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Li.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(Li.fromNumber(r)));return s.compare(PU)===1&&(s=new Li([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=Qv(e),[r,s]=Jv(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new wm(i,s,t);return r.forEach(l=>o.insert(l)),o}insert(e){if(this.Ie===0)return;const t=Qv(e),[r,s]=Jv(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class hl extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nf{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Yl.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new nf(Pe.min(),s,new bt(Qe),ps(),Be())}}class Yl{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Yl(r,t,Be(),Be(),Be())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ju{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class bE{constructor(e,t){this.targetId=e,this.me=t}}class EE{constructor(e,t,r=nr.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Yv{constructor(){this.fe=0,this.ge=Zv(),this.pe=nr.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Be(),t=Be(),r=Be();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:Se()}}),new Yl(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=Zv()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,it(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class CU{constructor(e){this.Le=e,this.Be=new Map,this.ke=ps(),this.qe=Xv(),this.Qe=new bt(Qe)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:Se()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(_g(i))if(r===0){const o=new ye(i.path);this.Ue(t,o,mr.newNoDocument(o,Pe.min()))}else it(r===1);else{const o=this.Ye(t);if(o!==r){const l=this.Ze(e),u=l?this.Xe(l,e,o):1;if(u!==0){this.je(t);const h=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,h)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,l;try{o=qi(r).toUint8Array()}catch(u){if(u instanceof Yb)return Ko("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{l=new wm(o,s,i)}catch(u){return Ko(u instanceof hl?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return l.Ie===0?null:l}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),l=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(l)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const l=this.Je(o);if(l){if(i.current&&_g(l.target)){const u=new ye(l.target.path);this.ke.get(u)!==null||this.it(o,u)||this.Ue(o,u,mr.newNoDocument(u,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=Be();this.qe.forEach((i,o)=>{let l=!0;o.forEachWhile(u=>{const h=this.Je(u);return!h||h.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new nf(e,t,this.Qe,this.ke,r);return this.ke=ps(),this.qe=Xv(),this.Qe=new bt(Qe),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Yv,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new rr(Qe),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||de("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Yv),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Xv(){return new bt(ye.comparator)}function Zv(){return new bt(ye.comparator)}const NU={asc:"ASCENDING",desc:"DESCENDING"},OU={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},kU={and:"AND",or:"OR"};class jU{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Tg(n,e){return n.useProto3Json||Xh(e)?e:{value:e}}function gh(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function TE(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function DU(n,e){return gh(n,e.toTimestamp())}function Ln(n){return it(!!n),Pe.fromTimestamp(function(t){const r=ei(t);return new pt(r.seconds,r.nanos)}(n))}function vm(n,e){return Sg(n,e).canonicalString()}function Sg(n,e){const t=function(s){return new gt(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function SE(n){const e=gt.fromString(n);return it(PE(e)),e}function xg(n,e){return vm(n.databaseId,e.path)}function kp(n,e){const t=SE(e);if(t.get(1)!==n.databaseId.projectId)throw new fe(Z.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new fe(Z.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new ye(AE(t))}function xE(n,e){return vm(n.databaseId,e)}function MU(n){const e=SE(n);return e.length===4?gt.emptyPath():AE(e)}function Ag(n){return new gt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function AE(n){return it(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function e_(n,e,t){return{name:xg(n,e),fields:t.value.mapValue.fields}}function LU(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:Se()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(h,d){return h.useProto3Json?(it(d===void 0||typeof d=="string"),nr.fromBase64String(d||"")):(it(d===void 0||d instanceof Buffer||d instanceof Uint8Array),nr.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,l=o&&function(h){const d=h.code===void 0?Z.UNKNOWN:_E(h.code);return new fe(d,h.message||"")}(o);t=new EE(r,s,i,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=kp(n,r.document.name),i=Ln(r.document.updateTime),o=r.document.createTime?Ln(r.document.createTime):Pe.min(),l=new sn({mapValue:{fields:r.document.fields}}),u=mr.newFoundDocument(s,i,o,l),h=r.targetIds||[],d=r.removedTargetIds||[];t=new Ju(h,d,u.key,u)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=kp(n,r.document),i=r.readTime?Ln(r.readTime):Pe.min(),o=mr.newNoDocument(s,i),l=r.removedTargetIds||[];t=new Ju([],l,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=kp(n,r.document),i=r.removedTargetIds||[];t=new Ju([],i,s,null)}else{if(!("filter"in e))return Se();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new AU(s,i),l=r.targetId;t=new bE(l,o)}}return t}function VU(n,e){let t;if(e instanceof Jl)t={update:e_(n,e.key,e.value)};else if(e instanceof vE)t={delete:xg(n,e.key)};else if(e instanceof Ki)t={update:e_(n,e.key,e.data),updateMask:HU(e.fieldMask)};else{if(!(e instanceof TU))return Se();t={verify:xg(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const l=o.transform;if(l instanceof dh)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof jl)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Dl)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof ph)return{fieldPath:o.field.canonicalString(),increment:l.Pe};throw Se()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:DU(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Se()}(n,e.precondition)),t}function FU(n,e){return n&&n.length>0?(it(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?Ln(s.updateTime):Ln(i);return o.isEqual(Pe.min())&&(o=Ln(i)),new _U(o,s.transformResults||[])}(t,e))):[]}function UU(n,e){return{documents:[xE(n,e.path)]}}function $U(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=xE(n,s);const i=function(h){if(h.length!==0)return IE(bn.create(h,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(h){if(h.length!==0)return h.map(d=>function(v){return{field:Lo(v.field),direction:WU(v.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const l=Tg(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{_t:t,parent:s}}function BU(n){let e=MU(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){it(r===1);const d=t.from[0];d.allDescendants?s=d.collectionId:e=e.child(d.collectionId)}let i=[];t.where&&(i=function(g){const v=RE(g);return v instanceof bn&&tE(v)?v.getFilters():[v]}(t.where));let o=[];t.orderBy&&(o=function(g){return g.map(v=>function(E){return new kl(Vo(E.field),function(R){switch(R){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(E.direction))}(v))}(t.orderBy));let l=null;t.limit&&(l=function(g){let v;return v=typeof g=="object"?g.value:g,Xh(v)?null:v}(t.limit));let u=null;t.startAt&&(u=function(g){const v=!!g.before,_=g.values||[];return new fh(_,v)}(t.startAt));let h=null;return t.endAt&&(h=function(g){const v=!g.before,_=g.values||[];return new fh(_,v)}(t.endAt)),aU(e,s,o,i,l,"F",u,h)}function qU(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Se()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function RE(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Vo(t.unaryFilter.field);return jt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Vo(t.unaryFilter.field);return jt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Vo(t.unaryFilter.field);return jt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Vo(t.unaryFilter.field);return jt.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Se()}}(n):n.fieldFilter!==void 0?function(t){return jt.create(Vo(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Se()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return bn.create(t.compositeFilter.filters.map(r=>RE(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Se()}}(t.compositeFilter.op))}(n):Se()}function WU(n){return NU[n]}function zU(n){return OU[n]}function GU(n){return kU[n]}function Lo(n){return{fieldPath:n.canonicalString()}}function Vo(n){return er.fromServerFormat(n.fieldPath)}function IE(n){return n instanceof jt?function(t){if(t.op==="=="){if(Uv(t.value))return{unaryFilter:{field:Lo(t.field),op:"IS_NAN"}};if(Fv(t.value))return{unaryFilter:{field:Lo(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Uv(t.value))return{unaryFilter:{field:Lo(t.field),op:"IS_NOT_NAN"}};if(Fv(t.value))return{unaryFilter:{field:Lo(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Lo(t.field),op:zU(t.op),value:t.value}}}(n):n instanceof bn?function(t){const r=t.getFilters().map(s=>IE(s));return r.length===1?r[0]:{compositeFilter:{op:GU(t.op),filters:r}}}(n):Se()}function HU(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function PE(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gs{constructor(e,t,r,s,i=Pe.min(),o=Pe.min(),l=nr.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=l,this.expectedCount=u}withSequenceNumber(e){return new Gs(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Gs(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Gs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Gs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KU{constructor(e){this.ct=e}}function QU(n){const e=BU({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Eg(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JU{constructor(){this.un=new YU}addToCollectionParentIndex(e,t){return this.un.add(t),re.resolve()}getCollectionParents(e,t){return re.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return re.resolve()}deleteFieldIndex(e,t){return re.resolve()}deleteAllFieldIndexes(e){return re.resolve()}createTargetIndexes(e,t){return re.resolve()}getDocumentsMatchingTarget(e,t){return re.resolve(null)}getIndexType(e,t){return re.resolve(0)}getFieldIndexes(e,t){return re.resolve([])}getNextCollectionGroupToUpdate(e){return re.resolve(null)}getMinOffset(e,t){return re.resolve(Zs.min())}getMinOffsetFromCollectionGroup(e,t){return re.resolve(Zs.min())}updateCollectionGroup(e,t,r){return re.resolve()}updateIndexEntries(e,t){return re.resolve()}}class YU{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new rr(gt.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new rr(gt.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xo{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Xo(0)}static kn(){return new Xo(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XU{constructor(){this.changes=new ga(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,mr.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?re.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZU{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e${constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&El(r.mutation,s,vn.empty(),pt.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Be()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Be()){const s=Di();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=ul();return i.forEach((l,u)=>{o=o.insert(l,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Di();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Be()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,l)=>{t.set(o,l)})})}computeViews(e,t,r,s){let i=ps();const o=bl(),l=function(){return bl()}();return t.forEach((u,h)=>{const d=r.get(h.key);s.has(h.key)&&(d===void 0||d.mutation instanceof Ki)?i=i.insert(h.key,h):d!==void 0?(o.set(h.key,d.mutation.getFieldMask()),El(d.mutation,h,d.mutation.getFieldMask(),pt.now())):o.set(h.key,vn.empty())}),this.recalculateAndSaveOverlays(e,i).next(u=>(u.forEach((h,d)=>o.set(h,d)),t.forEach((h,d)=>{var g;return l.set(h,new ZU(d,(g=o.get(h))!==null&&g!==void 0?g:null))}),l))}recalculateAndSaveOverlays(e,t){const r=bl();let s=new bt((o,l)=>o-l),i=Be();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const l of o)l.keys().forEach(u=>{const h=t.get(u);if(h===null)return;let d=r.get(u)||vn.empty();d=l.applyToLocalView(h,d),r.set(u,d);const g=(s.get(l.batchId)||Be()).add(u);s=s.insert(l.batchId,g)})}).next(()=>{const o=[],l=s.getReverseIterator();for(;l.hasNext();){const u=l.getNext(),h=u.key,d=u.value,g=hE();d.forEach(v=>{if(!i.has(v)){const _=yE(t.get(v),r.get(v));_!==null&&g.set(v,_),i=i.add(v)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,g))}return re.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return ye.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):oE(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):re.resolve(Di());let l=-1,u=i;return o.next(h=>re.forEach(h,(d,g)=>(l<g.largestBatchId&&(l=g.largestBatchId),i.get(d)?re.resolve():this.remoteDocumentCache.getEntry(e,d).next(v=>{u=u.insert(d,v)}))).next(()=>this.populateOverlays(e,h,i)).next(()=>this.computeViews(e,u,h,Be())).next(d=>({batchId:l,changes:uE(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ye(t)).next(r=>{let s=ul();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=ul();return this.indexManager.getCollectionParents(e,i).next(l=>re.forEach(l,u=>{const h=function(g,v){return new pa(v,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)}(t,u.child(i));return this.getDocumentsMatchingCollectionQuery(e,h,r,s).next(d=>{d.forEach((g,v)=>{o=o.insert(g,v)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((u,h)=>{const d=h.getKey();o.get(d)===null&&(o=o.insert(d,mr.newInvalidDocument(d)))});let l=ul();return o.forEach((u,h)=>{const d=i.get(u);d!==void 0&&El(d.mutation,h,vn.empty(),pt.now()),ef(t,h)&&(l=l.insert(u,h))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t${constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return re.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Ln(s.createTime)}}(t)),re.resolve()}getNamedQuery(e,t){return re.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:QU(s.bundledQuery),readTime:Ln(s.readTime)}}(t)),re.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r${constructor(){this.overlays=new bt(ye.comparator),this.Ir=new Map}getOverlay(e,t){return re.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Di();return re.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),re.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),re.resolve()}getOverlaysForCollection(e,t,r){const s=Di(),i=t.length+1,o=new ye(t.child("")),l=this.overlays.getIteratorFrom(o);for(;l.hasNext();){const u=l.getNext().value,h=u.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===i&&u.largestBatchId>r&&s.set(u.getKey(),u)}return re.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new bt((h,d)=>h-d);const o=this.overlays.getIterator();for(;o.hasNext();){const h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>r){let d=i.get(h.largestBatchId);d===null&&(d=Di(),i=i.insert(h.largestBatchId,d)),d.set(h.getKey(),h)}}const l=Di(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((h,d)=>l.set(h,d)),!(l.size()>=s)););return re.resolve(l)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new xU(t,r));let i=this.Ir.get(t);i===void 0&&(i=Be(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n${constructor(){this.sessionToken=nr.EMPTY_BYTE_STRING}getSessionToken(e){return re.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,re.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _m{constructor(){this.Tr=new rr(Gt.Er),this.dr=new rr(Gt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new Gt(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new Gt(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new ye(new gt([])),r=new Gt(t,e),s=new Gt(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new ye(new gt([])),r=new Gt(t,e),s=new Gt(t,e+1);let i=Be();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Gt(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Gt{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return ye.comparator(e.key,t.key)||Qe(e.wr,t.wr)}static Ar(e,t){return Qe(e.wr,t.wr)||ye.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s${constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new rr(Gt.Er)}checkEmpty(e){return re.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new SU(i,t,r,s);this.mutationQueue.push(o);for(const l of s)this.br=this.br.add(new Gt(l.key,i)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return re.resolve(o)}lookupMutationBatch(e,t){return re.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return re.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return re.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return re.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Gt(t,0),s=new Gt(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const l=this.Dr(o.wr);i.push(l)}),re.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new rr(Qe);return t.forEach(s=>{const i=new Gt(s,0),o=new Gt(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],l=>{r=r.add(l.wr)})}),re.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;ye.isDocumentKey(i)||(i=i.child(""));const o=new Gt(new ye(i),0);let l=new rr(Qe);return this.br.forEachWhile(u=>{const h=u.key.path;return!!r.isPrefixOf(h)&&(h.length===s&&(l=l.add(u.wr)),!0)},o),re.resolve(this.Cr(l))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){it(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return re.forEach(t.mutations,s=>{const i=new Gt(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new Gt(t,0),s=this.br.firstAfterOrEqual(r);return re.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,re.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i${constructor(e){this.Mr=e,this.docs=function(){return new bt(ye.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return re.resolve(r?r.document.mutableCopy():mr.newInvalidDocument(t))}getEntries(e,t){let r=ps();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():mr.newInvalidDocument(s))}),re.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=ps();const o=t.path,l=new ye(o.child("")),u=this.docs.getIteratorFrom(l);for(;u.hasNext();){const{key:h,value:{document:d}}=u.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||B5($5(d),r)<=0||(s.has(d.key)||ef(t,d))&&(i=i.insert(d.key,d.mutableCopy()))}return re.resolve(i)}getAllFromCollectionGroup(e,t,r,s){Se()}Or(e,t){return re.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new o$(this)}getSize(e){return re.resolve(this.size)}}class o$ extends XU{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),re.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a${constructor(e){this.persistence=e,this.Nr=new ga(t=>pm(t),gm),this.lastRemoteSnapshotVersion=Pe.min(),this.highestTargetId=0,this.Lr=0,this.Br=new _m,this.targetCount=0,this.kr=Xo.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),re.resolve()}getLastRemoteSnapshotVersion(e){return re.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return re.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),re.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),re.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Xo(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,re.resolve()}updateTargetData(e,t){return this.Kn(t),re.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,re.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,l)=>{l.sequenceNumber<=t&&r.get(l.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)}),re.waitFor(i).next(()=>s)}getTargetCount(e){return re.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return re.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),re.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),re.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),re.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return re.resolve(r)}containsKey(e,t){return re.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l${constructor(e,t){this.qr={},this.overlays={},this.Qr=new um(0),this.Kr=!1,this.Kr=!0,this.$r=new n$,this.referenceDelegate=e(this),this.Ur=new a$(this),this.indexManager=new JU,this.remoteDocumentCache=function(s){return new i$(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new KU(t),this.Gr=new t$(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new r$,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new s$(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){de("MemoryPersistence","Starting transaction:",e);const s=new c$(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return re.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class c$ extends W5{constructor(e){super(),this.currentSequenceNumber=e}}class bm{constructor(e){this.persistence=e,this.Jr=new _m,this.Yr=null}static Zr(e){return new bm(e)}get Xr(){if(this.Yr)return this.Yr;throw Se()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),re.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),re.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),re.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return re.forEach(this.Xr,r=>{const s=ye.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,Pe.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return re.or([()=>re.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Em{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=Be(),s=Be();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Em(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u${constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h${constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return dF()?8:z5(hF())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new u$;return this.Xi(e,t,o).next(l=>{if(i.result=l,this.zi)return this.es(e,t,o,l.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(il()<=He.DEBUG&&de("QueryEngine","SDK will not create cache indexes for query:",Mo(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),re.resolve()):(il()<=He.DEBUG&&de("QueryEngine","Query:",Mo(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(il()<=He.DEBUG&&de("QueryEngine","The SDK decides to create cache indexes for query:",Mo(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Mn(t))):re.resolve())}Yi(e,t){if(Wv(t))return re.resolve(null);let r=Mn(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=Eg(t,null,"F"),r=Mn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=Be(...i);return this.Ji.getDocuments(e,o).next(l=>this.indexManager.getMinOffset(e,r).next(u=>{const h=this.ts(t,l);return this.ns(t,h,o,u.readTime)?this.Yi(e,Eg(t,null,"F")):this.rs(e,h,t,u)}))})))}Zi(e,t,r,s){return Wv(t)||s.isEqual(Pe.min())?re.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?re.resolve(null):(il()<=He.DEBUG&&de("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Mo(t)),this.rs(e,o,t,U5(s,-1)).next(l=>l))})}ts(e,t){let r=new rr(lE(e));return t.forEach((s,i)=>{ef(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return il()<=He.DEBUG&&de("QueryEngine","Using full collection scan to execute query:",Mo(t)),this.Ji.getDocumentsMatchingQuery(e,t,Zs.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f${constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new bt(Qe),this._s=new ga(i=>pm(i),gm),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new e$(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function d$(n,e,t,r){return new f$(n,e,t,r)}async function CE(n,e){const t=Ce(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],l=[];let u=Be();for(const h of s){o.push(h.batchId);for(const d of h.mutations)u=u.add(d.key)}for(const h of i){l.push(h.batchId);for(const d of h.mutations)u=u.add(d.key)}return t.localDocuments.getDocuments(r,u).next(h=>({hs:h,removedBatchIds:o,addedBatchIds:l}))})})}function p$(n,e){const t=Ce(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(l,u,h,d){const g=h.batch,v=g.keys();let _=re.resolve();return v.forEach(E=>{_=_.next(()=>d.getEntry(u,E)).next(x=>{const R=h.docVersions.get(E);it(R!==null),x.version.compareTo(R)<0&&(g.applyToRemoteDocument(x,h),x.isValidDocument()&&(x.setReadTime(h.commitVersion),d.addEntry(x)))})}),_.next(()=>l.mutationQueue.removeMutationBatch(u,g))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let u=Be();for(let h=0;h<l.mutationResults.length;++h)l.mutationResults[h].transformResults.length>0&&(u=u.add(l.batch.mutations[h].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function NE(n){const e=Ce(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function g$(n,e){const t=Ce(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const l=[];e.targetChanges.forEach((d,g)=>{const v=s.get(g);if(!v)return;l.push(t.Ur.removeMatchingKeys(i,d.removedDocuments,g).next(()=>t.Ur.addMatchingKeys(i,d.addedDocuments,g)));let _=v.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(g)!==null?_=_.withResumeToken(nr.EMPTY_BYTE_STRING,Pe.min()).withLastLimboFreeSnapshotVersion(Pe.min()):d.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(d.resumeToken,r)),s=s.insert(g,_),function(x,R,I){return x.resumeToken.approximateByteSize()===0||R.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=3e8?!0:I.addedDocuments.size+I.modifiedDocuments.size+I.removedDocuments.size>0}(v,_,d)&&l.push(t.Ur.updateTargetData(i,_))});let u=ps(),h=Be();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(i,d))}),l.push(m$(i,o,e.documentUpdates).next(d=>{u=d.Ps,h=d.Is})),!r.isEqual(Pe.min())){const d=t.Ur.getLastRemoteSnapshotVersion(i).next(g=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));l.push(d)}return re.waitFor(l).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,u,h)).next(()=>u)}).then(i=>(t.os=s,i))}function m$(n,e,t){let r=Be(),s=Be();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=ps();return t.forEach((l,u)=>{const h=i.get(l);u.isFoundDocument()!==h.isFoundDocument()&&(s=s.add(l)),u.isNoDocument()&&u.version.isEqual(Pe.min())?(e.removeEntry(l,u.readTime),o=o.insert(l,u)):!h.isValidDocument()||u.version.compareTo(h.version)>0||u.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(u),o=o.insert(l,u)):de("LocalStore","Ignoring outdated watch update for ",l,". Current version:",h.version," Watch version:",u.version)}),{Ps:o,Is:s}})}function y$(n,e){const t=Ce(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function w$(n,e){const t=Ce(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,re.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new Gs(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function Rg(n,e,t){const r=Ce(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Ql(o))throw o;de("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function t_(n,e,t){const r=Ce(n);let s=Pe.min(),i=Be();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,h,d){const g=Ce(u),v=g._s.get(d);return v!==void 0?re.resolve(g.os.get(v)):g.Ur.getTargetData(h,d)}(r,o,Mn(e)).next(l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,l.targetId).next(u=>{i=u})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:Pe.min(),t?i:Be())).next(l=>(v$(r,cU(e),l),{documents:l,Ts:i})))}function v$(n,e,t){let r=n.us.get(e)||Pe.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}class r_{constructor(){this.activeTargetIds=gU()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class _${constructor(){this.so=new r_,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new r_,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b${_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n_{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){de("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){de("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ku=null;function jp(){return ku===null?ku=function(){return 268435456+Math.round(2147483648*Math.random())}():ku++,"0x"+ku.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E$={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T${constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dr="WebChannelConnection";class S$ extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const l=jp(),u=this.xo(t,r.toUriEncodedString());de("RestConnection",`Sending RPC '${t}' ${l}:`,u,s);const h={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(h,i,o),this.No(t,u,h,s).then(d=>(de("RestConnection",`Received RPC '${t}' ${l}: `,d),d),d=>{throw Ko("RestConnection",`RPC '${t}' ${l} failed with error: `,d,"url: ",u,"request:",s),d})}Lo(t,r,s,i,o,l){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+fa}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=E$[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=jp();return new Promise((o,l)=>{const u=new qb;u.setWithCredentials(!0),u.listenOnce(Wb.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Hu.NO_ERROR:const d=u.getResponseJson();de(dr,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(d)),o(d);break;case Hu.TIMEOUT:de(dr,`RPC '${e}' ${i} timed out`),l(new fe(Z.DEADLINE_EXCEEDED,"Request time out"));break;case Hu.HTTP_ERROR:const g=u.getStatus();if(de(dr,`RPC '${e}' ${i} failed with status:`,g,"response text:",u.getResponseText()),g>0){let v=u.getResponseJson();Array.isArray(v)&&(v=v[0]);const _=v==null?void 0:v.error;if(_&&_.status&&_.message){const E=function(R){const I=R.toLowerCase().replace(/_/g,"-");return Object.values(Z).indexOf(I)>=0?I:Z.UNKNOWN}(_.status);l(new fe(E,_.message))}else l(new fe(Z.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new fe(Z.UNAVAILABLE,"Connection failed."));break;default:Se()}}finally{de(dr,`RPC '${e}' ${i} completed.`)}});const h=JSON.stringify(s);de(dr,`RPC '${e}' ${i} sending request:`,s),u.send(t,"POST",h,r,15)})}Bo(e,t,r){const s=jp(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Hb(),l=Gb(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Oo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const d=i.join("");de(dr,`Creating RPC '${e}' stream ${s}: ${d}`,u);const g=o.createWebChannel(d,u);let v=!1,_=!1;const E=new T$({Io:R=>{_?de(dr,`Not sending because RPC '${e}' stream ${s} is closed:`,R):(v||(de(dr,`Opening RPC '${e}' stream ${s} transport.`),g.open(),v=!0),de(dr,`RPC '${e}' stream ${s} sending:`,R),g.send(R))},To:()=>g.close()}),x=(R,I,F)=>{R.listen(I,V=>{try{F(V)}catch($){setTimeout(()=>{throw $},0)}})};return x(g,cl.EventType.OPEN,()=>{_||(de(dr,`RPC '${e}' stream ${s} transport opened.`),E.yo())}),x(g,cl.EventType.CLOSE,()=>{_||(_=!0,de(dr,`RPC '${e}' stream ${s} transport closed`),E.So())}),x(g,cl.EventType.ERROR,R=>{_||(_=!0,Ko(dr,`RPC '${e}' stream ${s} transport errored:`,R),E.So(new fe(Z.UNAVAILABLE,"The operation could not be completed")))}),x(g,cl.EventType.MESSAGE,R=>{var I;if(!_){const F=R.data[0];it(!!F);const V=F,$=V.error||((I=V[0])===null||I===void 0?void 0:I.error);if($){de(dr,`RPC '${e}' stream ${s} received error:`,$);const W=$.status;let X=function(D){const T=kt[D];if(T!==void 0)return _E(T)}(W),j=$.message;X===void 0&&(X=Z.INTERNAL,j="Unknown error status: "+W+" with message "+$.message),_=!0,E.So(new fe(X,j)),g.close()}else de(dr,`RPC '${e}' stream ${s} received:`,F),E.bo(F)}}),x(l,zb.STAT_EVENT,R=>{R.stat===mg.PROXY?de(dr,`RPC '${e}' stream ${s} detected buffering proxy`):R.stat===mg.NOPROXY&&de(dr,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{E.wo()},0),E}}function Dp(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sf(n){return new jU(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OE{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&de("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kE{constructor(e,t,r,s,i,o,l,u){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=l,this.listener=u,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new OE(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===Z.RESOURCE_EXHAUSTED?(ds(t.toString()),ds("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===Z.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new fe(Z.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return de("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(de("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class x$ extends kE{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=LU(this.serializer,e),r=function(i){if(!("targetChange"in i))return Pe.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Pe.min():o.readTime?Ln(o.readTime):Pe.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=Ag(this.serializer),t.addTarget=function(i,o){let l;const u=o.target;if(l=_g(u)?{documents:UU(i,u)}:{query:$U(i,u)._t},l.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){l.resumeToken=TE(i,o.resumeToken);const h=Tg(i,o.expectedCount);h!==null&&(l.expectedCount=h)}else if(o.snapshotVersion.compareTo(Pe.min())>0){l.readTime=gh(i,o.snapshotVersion.toTimestamp());const h=Tg(i,o.expectedCount);h!==null&&(l.expectedCount=h)}return l}(this.serializer,e);const r=qU(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=Ag(this.serializer),t.removeTarget=e,this.a_(t)}}class A$ extends kE{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return it(!!e.streamToken),this.lastStreamToken=e.streamToken,it(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){it(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=FU(e.writeResults,e.commitTime),r=Ln(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=Ag(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>VU(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R$ extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new fe(Z.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,Sg(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===Z.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new fe(Z.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,l])=>this.connection.Lo(e,Sg(t,r),s,o,l,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===Z.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new fe(Z.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class I${constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(ds(t),this.D_=!1):de("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P${constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{Qi(this)&&(de("RemoteStore","Restarting streams for network reachability change."),await async function(u){const h=Ce(u);h.L_.add(4),await Xl(h),h.q_.set("Unknown"),h.L_.delete(4),await of(h)}(this))})}),this.q_=new I$(r,s)}}async function of(n){if(Qi(n))for(const e of n.B_)await e(!0)}async function Xl(n){for(const e of n.B_)await e(!1)}function jE(n,e){const t=Ce(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Am(t)?xm(t):ma(t).r_()&&Sm(t,e))}function Tm(n,e){const t=Ce(n),r=ma(t);t.N_.delete(e),r.r_()&&DE(t,e),t.N_.size===0&&(r.r_()?r.o_():Qi(t)&&t.q_.set("Unknown"))}function Sm(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Pe.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ma(n).A_(e)}function DE(n,e){n.Q_.xe(e),ma(n).R_(e)}function xm(n){n.Q_=new CU({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),ma(n).start(),n.q_.v_()}function Am(n){return Qi(n)&&!ma(n).n_()&&n.N_.size>0}function Qi(n){return Ce(n).L_.size===0}function ME(n){n.Q_=void 0}async function C$(n){n.q_.set("Online")}async function N$(n){n.N_.forEach((e,t)=>{Sm(n,e)})}async function O$(n,e){ME(n),Am(n)?(n.q_.M_(e),xm(n)):n.q_.set("Unknown")}async function k$(n,e,t){if(n.q_.set("Online"),e instanceof EE&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const l of i.targetIds)s.N_.has(l)&&(await s.remoteSyncer.rejectListen(l,o),s.N_.delete(l),s.Q_.removeTarget(l))}(n,e)}catch(r){de("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await mh(n,r)}else if(e instanceof Ju?n.Q_.Ke(e):e instanceof bE?n.Q_.He(e):n.Q_.We(e),!t.isEqual(Pe.min()))try{const r=await NE(n.localStore);t.compareTo(r)>=0&&await function(i,o){const l=i.Q_.rt(o);return l.targetChanges.forEach((u,h)=>{if(u.resumeToken.approximateByteSize()>0){const d=i.N_.get(h);d&&i.N_.set(h,d.withResumeToken(u.resumeToken,o))}}),l.targetMismatches.forEach((u,h)=>{const d=i.N_.get(u);if(!d)return;i.N_.set(u,d.withResumeToken(nr.EMPTY_BYTE_STRING,d.snapshotVersion)),DE(i,u);const g=new Gs(d.target,u,h,d.sequenceNumber);Sm(i,g)}),i.remoteSyncer.applyRemoteEvent(l)}(n,t)}catch(r){de("RemoteStore","Failed to raise snapshot:",r),await mh(n,r)}}async function mh(n,e,t){if(!Ql(e))throw e;n.L_.add(1),await Xl(n),n.q_.set("Offline"),t||(t=()=>NE(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{de("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await of(n)})}function LE(n,e){return e().catch(t=>mh(n,t,e))}async function af(n){const e=Ce(n),t=ti(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;j$(e);)try{const s=await y$(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,D$(e,s)}catch(s){await mh(e,s)}VE(e)&&FE(e)}function j$(n){return Qi(n)&&n.O_.length<10}function D$(n,e){n.O_.push(e);const t=ti(n);t.r_()&&t.V_&&t.m_(e.mutations)}function VE(n){return Qi(n)&&!ti(n).n_()&&n.O_.length>0}function FE(n){ti(n).start()}async function M$(n){ti(n).p_()}async function L$(n){const e=ti(n);for(const t of n.O_)e.m_(t.mutations)}async function V$(n,e,t){const r=n.O_.shift(),s=ym.from(r,e,t);await LE(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await af(n)}async function F$(n,e){e&&ti(n).V_&&await async function(r,s){if(function(o){return RU(o)&&o!==Z.ABORTED}(s.code)){const i=r.O_.shift();ti(r).s_(),await LE(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await af(r)}}(n,e),VE(n)&&FE(n)}async function s_(n,e){const t=Ce(n);t.asyncQueue.verifyOperationInProgress(),de("RemoteStore","RemoteStore received new credentials");const r=Qi(t);t.L_.add(3),await Xl(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await of(t)}async function U$(n,e){const t=Ce(n);e?(t.L_.delete(2),await of(t)):e||(t.L_.add(2),await Xl(t),t.q_.set("Unknown"))}function ma(n){return n.K_||(n.K_=function(t,r,s){const i=Ce(t);return i.w_(),new x$(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:C$.bind(null,n),Ro:N$.bind(null,n),mo:O$.bind(null,n),d_:k$.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),Am(n)?xm(n):n.q_.set("Unknown")):(await n.K_.stop(),ME(n))})),n.K_}function ti(n){return n.U_||(n.U_=function(t,r,s){const i=Ce(t);return i.w_(),new A$(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:M$.bind(null,n),mo:F$.bind(null,n),f_:L$.bind(null,n),g_:V$.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await af(n)):(await n.U_.stop(),n.O_.length>0&&(de("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rm{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Js,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,l=new Rm(e,t,o,s,i);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new fe(Z.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Im(n,e){if(ds("AsyncQueue",`${e}: ${n}`),Ql(n))return new fe(Z.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qo{constructor(e){this.comparator=e?(t,r)=>e(t,r)||ye.comparator(t.key,r.key):(t,r)=>ye.comparator(t.key,r.key),this.keyedMap=ul(),this.sortedSet=new bt(this.comparator)}static emptySet(e){return new qo(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof qo)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new qo;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i_{constructor(){this.W_=new bt(ye.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Se():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Zo{constructor(e,t,r,s,i,o,l,u,h){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=l,this.excludesMetadataChanges=u,this.hasCachedResults=h}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(l=>{o.push({type:0,doc:l})}),new Zo(e,t,qo.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Zh(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $${constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class B${constructor(){this.queries=o_(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=Ce(t),i=s.queries;s.queries=o_(),i.forEach((o,l)=>{for(const u of l.j_)u.onError(r)})})(this,new fe(Z.ABORTED,"Firestore shutting down"))}}function o_(){return new ga(n=>aE(n),Zh)}async function q$(n,e){const t=Ce(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new $$,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const l=Im(o,`Initialization of query '${Mo(e.query)}' failed`);return void e.onError(l)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&Pm(t)}async function W$(n,e){const t=Ce(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function z$(n,e){const t=Ce(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const l of o.j_)l.X_(s)&&(r=!0);o.z_=s}}r&&Pm(t)}function G$(n,e,t){const r=Ce(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function Pm(n){n.Y_.forEach(e=>{e.next()})}var Ig,a_;(a_=Ig||(Ig={})).ea="default",a_.Cache="cache";class H${constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Zo(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Zo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Ig.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UE{constructor(e){this.key=e}}class $E{constructor(e){this.key=e}}class K${constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Be(),this.mutatedKeys=Be(),this.Aa=lE(e),this.Ra=new qo(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new i_,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,l=!1;const u=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,h=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((d,g)=>{const v=s.get(d),_=ef(this.query,g)?g:null,E=!!v&&this.mutatedKeys.has(v.key),x=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let R=!1;v&&_?v.data.isEqual(_.data)?E!==x&&(r.track({type:3,doc:_}),R=!0):this.ga(v,_)||(r.track({type:2,doc:_}),R=!0,(u&&this.Aa(_,u)>0||h&&this.Aa(_,h)<0)&&(l=!0)):!v&&_?(r.track({type:0,doc:_}),R=!0):v&&!_&&(r.track({type:1,doc:v}),R=!0,(u||h)&&(l=!0)),R&&(_?(o=o.add(_),i=x?i.add(d):i.delete(d)):(o=o.delete(d),i=i.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),i=i.delete(d.key),r.track({type:1,doc:d})}return{Ra:o,fa:r,ns:l,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((d,g)=>function(_,E){const x=R=>{switch(R){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Se()}};return x(_)-x(E)}(d.type,g.type)||this.Aa(d.doc,g.doc)),this.pa(r),s=s!=null&&s;const l=t&&!s?this.ya():[],u=this.da.size===0&&this.current&&!s?1:0,h=u!==this.Ea;return this.Ea=u,o.length!==0||h?{snapshot:new Zo(this.query,e.Ra,i,o,e.mutatedKeys,u===0,h,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:l}:{wa:l}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new i_,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Be(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new $E(r))}),this.da.forEach(r=>{e.has(r)||t.push(new UE(r))}),t}ba(e){this.Ta=e.Ts,this.da=Be();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Zo.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class Q${constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class J${constructor(e){this.key=e,this.va=!1}}class Y${constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new ga(l=>aE(l),Zh),this.Ma=new Map,this.xa=new Set,this.Oa=new bt(ye.comparator),this.Na=new Map,this.La=new _m,this.Ba={},this.ka=new Map,this.qa=Xo.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function X$(n,e,t=!0){const r=HE(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await BE(r,e,t,!0),s}async function Z$(n,e){const t=HE(n);await BE(t,e,!0,!1)}async function BE(n,e,t,r){const s=await w$(n.localStore,Mn(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let l;return r&&(l=await e3(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&jE(n.remoteStore,s),l}async function e3(n,e,t,r,s){n.Ka=(g,v,_)=>async function(x,R,I,F){let V=R.view.ma(I);V.ns&&(V=await t_(x.localStore,R.query,!1).then(({documents:j})=>R.view.ma(j,V)));const $=F&&F.targetChanges.get(R.targetId),W=F&&F.targetMismatches.get(R.targetId)!=null,X=R.view.applyChanges(V,x.isPrimaryClient,$,W);return c_(x,R.targetId,X.wa),X.snapshot}(n,g,v,_);const i=await t_(n.localStore,e,!0),o=new K$(e,i.Ts),l=o.ma(i.documents),u=Yl.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),h=o.applyChanges(l,n.isPrimaryClient,u);c_(n,t,h.wa);const d=new Q$(e,t,o);return n.Fa.set(e,d),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),h.snapshot}async function t3(n,e,t){const r=Ce(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!Zh(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Rg(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Tm(r.remoteStore,s.targetId),Pg(r,s.targetId)}).catch(Kl)):(Pg(r,s.targetId),await Rg(r.localStore,s.targetId,!0))}async function r3(n,e){const t=Ce(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Tm(t.remoteStore,r.targetId))}async function n3(n,e,t){const r=u3(n);try{const s=await function(o,l){const u=Ce(o),h=pt.now(),d=l.reduce((_,E)=>_.add(E.key),Be());let g,v;return u.persistence.runTransaction("Locally write mutations","readwrite",_=>{let E=ps(),x=Be();return u.cs.getEntries(_,d).next(R=>{E=R,E.forEach((I,F)=>{F.isValidDocument()||(x=x.add(I))})}).next(()=>u.localDocuments.getOverlayedDocuments(_,E)).next(R=>{g=R;const I=[];for(const F of l){const V=EU(F,g.get(F.key).overlayedDocument);V!=null&&I.push(new Ki(F.key,V,Xb(V.value.mapValue),hs.exists(!0)))}return u.mutationQueue.addMutationBatch(_,h,I,l)}).next(R=>{v=R;const I=R.applyToLocalDocumentSet(g,x);return u.documentOverlayCache.saveOverlays(_,R.batchId,I)})}).then(()=>({batchId:v.batchId,changes:uE(g)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,l,u){let h=o.Ba[o.currentUser.toKey()];h||(h=new bt(Qe)),h=h.insert(l,u),o.Ba[o.currentUser.toKey()]=h}(r,s.batchId,t),await Zl(r,s.changes),await af(r.remoteStore)}catch(s){const i=Im(s,"Failed to persist write");t.reject(i)}}async function qE(n,e){const t=Ce(n);try{const r=await g$(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(it(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?it(o.va):s.removedDocuments.size>0&&(it(o.va),o.va=!1))}),await Zl(t,r,e)}catch(r){await Kl(r)}}function l_(n,e,t){const r=Ce(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const l=o.view.Z_(e);l.snapshot&&s.push(l.snapshot)}),function(o,l){const u=Ce(o);u.onlineState=l;let h=!1;u.queries.forEach((d,g)=>{for(const v of g.j_)v.Z_(l)&&(h=!0)}),h&&Pm(u)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function s3(n,e,t){const r=Ce(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new bt(ye.comparator);o=o.insert(i,mr.newNoDocument(i,Pe.min()));const l=Be().add(i),u=new nf(Pe.min(),new Map,new bt(Qe),o,l);await qE(r,u),r.Oa=r.Oa.remove(i),r.Na.delete(e),Cm(r)}else await Rg(r.localStore,e,!1).then(()=>Pg(r,e,t)).catch(Kl)}async function i3(n,e){const t=Ce(n),r=e.batch.batchId;try{const s=await p$(t.localStore,e);zE(t,r,null),WE(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Zl(t,s)}catch(s){await Kl(s)}}async function o3(n,e,t){const r=Ce(n);try{const s=await function(o,l){const u=Ce(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let d;return u.mutationQueue.lookupMutationBatch(h,l).next(g=>(it(g!==null),d=g.keys(),u.mutationQueue.removeMutationBatch(h,g))).next(()=>u.mutationQueue.performConsistencyCheck(h)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(h,d,l)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,d)).next(()=>u.localDocuments.getDocuments(h,d))})}(r.localStore,e);zE(r,e,t),WE(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Zl(r,s)}catch(s){await Kl(s)}}function WE(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function zE(n,e,t){const r=Ce(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function Pg(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||GE(n,r)})}function GE(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(Tm(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),Cm(n))}function c_(n,e,t){for(const r of t)r instanceof UE?(n.La.addReference(r.key,e),a3(n,r)):r instanceof $E?(de("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||GE(n,r.key)):Se()}function a3(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(de("SyncEngine","New document in limbo: "+t),n.xa.add(r),Cm(n))}function Cm(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new ye(gt.fromString(e)),r=n.qa.next();n.Na.set(r,new J$(t)),n.Oa=n.Oa.insert(t,r),jE(n.remoteStore,new Gs(Mn(iE(t.path)),r,"TargetPurposeLimboResolution",um.oe))}}async function Zl(n,e,t){const r=Ce(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((l,u)=>{o.push(r.Ka(u,e,t).then(h=>{var d;if((h||t)&&r.isPrimaryClient){const g=h?!h.fromCache:(d=t==null?void 0:t.targetChanges.get(u.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(u.targetId,g?"current":"not-current")}if(h){s.push(h);const g=Em.Wi(u.targetId,h);i.push(g)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(u,h){const d=Ce(u);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",g=>re.forEach(h,v=>re.forEach(v.$i,_=>d.persistence.referenceDelegate.addReference(g,v.targetId,_)).next(()=>re.forEach(v.Ui,_=>d.persistence.referenceDelegate.removeReference(g,v.targetId,_)))))}catch(g){if(!Ql(g))throw g;de("LocalStore","Failed to update sequence numbers: "+g)}for(const g of h){const v=g.targetId;if(!g.fromCache){const _=d.os.get(v),E=_.snapshotVersion,x=_.withLastLimboFreeSnapshotVersion(E);d.os=d.os.insert(v,x)}}}(r.localStore,i))}async function l3(n,e){const t=Ce(n);if(!t.currentUser.isEqual(e)){de("SyncEngine","User change. New user:",e.toKey());const r=await CE(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(l=>{l.forEach(u=>{u.reject(new fe(Z.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Zl(t,r.hs)}}function c3(n,e){const t=Ce(n),r=t.Na.get(e);if(r&&r.va)return Be().add(r.key);{let s=Be();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const l=t.Fa.get(o);s=s.unionWith(l.view.Va)}return s}}function HE(n){const e=Ce(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=qE.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=c3.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=s3.bind(null,e),e.Ca.d_=z$.bind(null,e.eventManager),e.Ca.$a=G$.bind(null,e.eventManager),e}function u3(n){const e=Ce(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=i3.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=o3.bind(null,e),e}class yh{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=sf(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return d$(this.persistence,new h$,e.initialUser,this.serializer)}Ga(e){return new l$(bm.Zr,this.serializer)}Wa(e){return new _$}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}yh.provider={build:()=>new yh};class Cg{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>l_(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=l3.bind(null,this.syncEngine),await U$(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new B$}()}createDatastore(e){const t=sf(e.databaseInfo.databaseId),r=function(i){return new S$(i)}(e.databaseInfo);return function(i,o,l,u){return new R$(i,o,l,u)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,l){return new P$(r,s,i,o,l)}(this.localStore,this.datastore,e.asyncQueue,t=>l_(this.syncEngine,t,0),function(){return n_.D()?new n_:new b$}())}createSyncEngine(e,t){return function(s,i,o,l,u,h,d){const g=new Y$(s,i,o,l,u,h);return d&&(g.Qa=!0),g}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=Ce(s);de("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await Xl(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}Cg.provider={build:()=>new Cg};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h3{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):ds("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f3{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=gr.UNAUTHENTICATED,this.clientId=Qb.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{de("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(de("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Js;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Im(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Mp(n,e){n.asyncQueue.verifyOperationInProgress(),de("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await CE(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function u_(n,e){n.asyncQueue.verifyOperationInProgress();const t=await d3(n);de("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>s_(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>s_(e.remoteStore,s)),n._onlineComponents=e}async function d3(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){de("FirestoreClient","Using user provided OfflineComponentProvider");try{await Mp(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===Z.FAILED_PRECONDITION||s.code===Z.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Ko("Error using user provided cache. Falling back to memory cache: "+t),await Mp(n,new yh)}}else de("FirestoreClient","Using default OfflineComponentProvider"),await Mp(n,new yh);return n._offlineComponents}async function KE(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(de("FirestoreClient","Using user provided OnlineComponentProvider"),await u_(n,n._uninitializedComponentsProvider._online)):(de("FirestoreClient","Using default OnlineComponentProvider"),await u_(n,new Cg))),n._onlineComponents}function p3(n){return KE(n).then(e=>e.syncEngine)}async function g3(n){const e=await KE(n),t=e.eventManager;return t.onListen=X$.bind(null,e.syncEngine),t.onUnlisten=t3.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Z$.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=r3.bind(null,e.syncEngine),t}function m3(n,e,t={}){const r=new Js;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,l,u,h){const d=new h3({next:v=>{d.Za(),o.enqueueAndForget(()=>W$(i,g)),v.fromCache&&u.source==="server"?h.reject(new fe(Z.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(v)},error:v=>h.reject(v)}),g=new H$(l,d,{includeMetadataChanges:!0,_a:!0});return q$(i,g)}(await g3(n),n.asyncQueue,e,t,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QE(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h_=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JE(n,e,t){if(!t)throw new fe(Z.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function y3(n,e,t,r){if(e===!0&&r===!0)throw new fe(Z.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function f_(n){if(!ye.isDocumentKey(n))throw new fe(Z.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function d_(n){if(ye.isDocumentKey(n))throw new fe(Z.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function lf(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Se()}function wh(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new fe(Z.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=lf(n);throw new fe(Z.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p_{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new fe(Z.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new fe(Z.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}y3("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=QE((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new fe(Z.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new fe(Z.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new fe(Z.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class cf{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new p_({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new fe(Z.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new fe(Z.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new p_(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new N5;switch(r.type){case"firstParty":return new D5(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new fe(Z.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=h_.get(t);r&&(de("ComponentProvider","Removing Datastore"),h_.delete(t),r.terminate())}(this),Promise.resolve()}}function w3(n,e,t,r={}){var s;const i=(n=wh(n,cf))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&Ko("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let l,u;if(typeof r.mockUserToken=="string")l=r.mockUserToken,u=gr.MOCK_USER;else{l=uF(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const h=r.mockUserToken.sub||r.mockUserToken.user_id;if(!h)throw new fe(Z.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new gr(h)}n._authCredentials=new O5(new Kb(l,u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ji{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Ji(this.firestore,e,this._query)}}class on{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ys(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new on(this.firestore,e,this._key)}}class Ys extends Ji{constructor(e,t,r){super(e,t,iE(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new on(this.firestore,null,new ye(e))}withConverter(e){return new Ys(this.firestore,e,this._path)}}function ol(n,e,...t){if(n=Ho(n),JE("collection","path",e),n instanceof cf){const r=gt.fromString(e,...t);return d_(r),new Ys(n,null,r)}{if(!(n instanceof on||n instanceof Ys))throw new fe(Z.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(gt.fromString(e,...t));return d_(r),new Ys(n.firestore,null,r)}}function v3(n,e,...t){if(n=Ho(n),arguments.length===1&&(e=Qb.newId()),JE("doc","path",e),n instanceof cf){const r=gt.fromString(e,...t);return f_(r),new on(n,null,new ye(r))}{if(!(n instanceof on||n instanceof Ys))throw new fe(Z.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(gt.fromString(e,...t));return f_(r),new on(n.firestore,n instanceof Ys?n.converter:null,new ye(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g_{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new OE(this,"async_queue_retry"),this.Vu=()=>{const r=Dp();r&&de("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=Dp();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Dp();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new Js;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Ql(e))throw e;de("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let l=o.message||"";return o.stack&&(l=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),l}(r);throw ds("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=Rm.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&Se()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}class Nm extends cf{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new g_,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new g_(e),this._firestoreClient=void 0,await e}}}function _3(n,e){const t=typeof n=="object"?n:v5(),r=typeof n=="string"?n:"(default)",s=g5(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=lF("firestore");i&&w3(s,...i)}return s}function YE(n){if(n._terminated)throw new fe(Z.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||b3(n),n._firestoreClient}function b3(n){var e,t,r;const s=n._freezeSettings(),i=function(l,u,h,d){return new K5(l,u,h,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,QE(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new f3(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(l){const u=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(u),_online:u}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ea{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ea(nr.fromBase64String(e))}catch(t){throw new fe(Z.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new ea(nr.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Om{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new fe(Z.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new er(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XE{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class km{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new fe(Z.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new fe(Z.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Qe(this._lat,e._lat)||Qe(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jm{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E3=/^__.*__$/;class T3{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Ki(e,this.data,this.fieldMask,t,this.fieldTransforms):new Jl(e,this.data,t,this.fieldTransforms)}}function ZE(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Se()}}class Dm{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Dm(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return vh(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(ZE(this.Cu)&&E3.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class S3{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||sf(e)}Qu(e,t,r,s=!1){return new Dm({Cu:e,methodName:t,qu:r,path:er.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function eT(n){const e=n._freezeSettings(),t=sf(n._databaseId);return new S3(n._databaseId,!!e.ignoreUndefinedProperties,t)}function x3(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);nT("Data must be an object, but it was:",o,r);const l=tT(r,o);let u,h;if(i.merge)u=new vn(o.fieldMask),h=o.fieldTransforms;else if(i.mergeFields){const d=[];for(const g of i.mergeFields){const v=R3(e,g,t);if(!o.contains(v))throw new fe(Z.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);P3(d,v)||d.push(v)}u=new vn(d),h=o.fieldTransforms.filter(g=>u.covers(g.field))}else u=null,h=o.fieldTransforms;return new T3(new sn(l),u,h)}function A3(n,e,t,r=!1){return Mm(t,n.Qu(r?4:3,e))}function Mm(n,e){if(rT(n=Ho(n)))return nT("Unsupported field value:",e,n),tT(n,e);if(n instanceof XE)return function(r,s){if(!ZE(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const l of r){let u=Mm(l,s.Lu(o));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=Ho(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return mU(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=pt.fromDate(r);return{timestampValue:gh(s.serializer,i)}}if(r instanceof pt){const i=new pt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:gh(s.serializer,i)}}if(r instanceof km)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof ea)return{bytesValue:TE(s.serializer,r._byteString)};if(r instanceof on){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:vm(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof jm)return function(o,l){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw l.Bu("VectorValues must only contain numeric values.");return mm(l.serializer,u)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${lf(r)}`)}(n,e)}function tT(n,e){const t={};return Jb(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):da(n,(r,s)=>{const i=Mm(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function rT(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof pt||n instanceof km||n instanceof ea||n instanceof on||n instanceof XE||n instanceof jm)}function nT(n,e,t){if(!rT(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=lf(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function R3(n,e,t){if((e=Ho(e))instanceof Om)return e._internalPath;if(typeof e=="string")return sT(n,e);throw vh("Field path arguments must be of type string or ",n,!1,void 0,t)}const I3=new RegExp("[~\\*/\\[\\]]");function sT(n,e,t){if(e.search(I3)>=0)throw vh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Om(...e.split("."))._internalPath}catch{throw vh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function vh(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let u="";return(i||o)&&(u+=" (found",i&&(u+=` in field ${r}`),o&&(u+=` in document ${s}`),u+=")"),new fe(Z.INVALID_ARGUMENT,l+n+u)}function P3(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iT{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new on(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new C3(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(uf("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class C3 extends iT{data(){return super.data()}}function uf(n,e){return typeof e=="string"?sT(n,e):e instanceof Om?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N3(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new fe(Z.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Lm{}class oT extends Lm{}function ju(n,e,...t){let r=[];e instanceof Lm&&r.push(e),r=r.concat(t),function(i){const o=i.filter(u=>u instanceof Vm).length,l=i.filter(u=>u instanceof hf).length;if(o>1||o>0&&l>0)throw new fe(Z.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class hf extends oT{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new hf(e,t,r)}_apply(e){const t=this._parse(e);return aT(e._query,t),new Ji(e.firestore,e.converter,bg(e._query,t))}_parse(e){const t=eT(e.firestore);return function(i,o,l,u,h,d,g){let v;if(h.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new fe(Z.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){w_(g,d);const _=[];for(const E of g)_.push(y_(u,i,E));v={arrayValue:{values:_}}}else v=y_(u,i,g)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||w_(g,d),v=A3(l,o,g,d==="in"||d==="not-in");return jt.create(h,d,v)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Du(n,e,t){const r=e,s=uf("where",n);return hf._create(s,r,t)}class Vm extends Lm{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Vm(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:bn.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const l=i.getFlattenedFilters();for(const u of l)aT(o,u),o=bg(o,u)}(e._query,t),new Ji(e.firestore,e.converter,bg(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Fm extends oT{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Fm(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new fe(Z.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new fe(Z.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new kl(i,o)}(e._query,this._field,this._direction);return new Ji(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new pa(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function m_(n,e="asc"){const t=e,r=uf("orderBy",n);return Fm._create(r,t)}function y_(n,e,t){if(typeof(t=Ho(t))=="string"){if(t==="")throw new fe(Z.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!oE(e)&&t.indexOf("/")!==-1)throw new fe(Z.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(gt.fromString(t));if(!ye.isDocumentKey(r))throw new fe(Z.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Vv(n,new ye(r))}if(t instanceof on)return Vv(n,t._key);throw new fe(Z.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${lf(t)}.`)}function w_(n,e){if(!Array.isArray(n)||n.length===0)throw new fe(Z.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function aT(n,e){const t=function(s,i){for(const o of s)for(const l of o.getFlattenedFilters())if(i.indexOf(l.op)>=0)return l.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new fe(Z.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new fe(Z.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class O3{convertValue(e,t="none"){switch(Wi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Pt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(qi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Se()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return da(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>Pt(o.doubleValue));return new jm(i)}convertGeoPoint(e){return new km(Pt(e.latitude),Pt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=fm(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Cl(e));default:return null}}convertTimestamp(e){const t=ei(e);return new pt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=gt.fromString(e);it(PE(r));const s=new Nl(r.get(1),r.get(3)),i=new ye(r.popFirst(5));return s.isEqual(t)||ds(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k3(n,e,t){let r;return r=n?n.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mu{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class j3 extends iT{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Yu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(uf("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Yu extends j3{data(e={}){return super.data(e)}}class D3{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Mu(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Yu(this._firestore,this._userDataWriter,r.key,r,new Mu(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new fe(Z.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(l=>{const u=new Yu(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Mu(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(l=>i||l.type!==3).map(l=>{const u=new Yu(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Mu(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let h=-1,d=-1;return l.type!==0&&(h=o.indexOf(l.doc.key),o=o.delete(l.doc.key)),l.type!==1&&(o=o.add(l.doc),d=o.indexOf(l.doc.key)),{type:M3(l.type),doc:u,oldIndex:h,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function M3(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Se()}}class L3 extends O3{constructor(e){super(),this.firestore=e}convertBytes(e){return new ea(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new on(this.firestore,null,t)}}function Lp(n){n=wh(n,Ji);const e=wh(n.firestore,Nm),t=YE(e),r=new L3(e);return N3(n._query),m3(t,n._query).then(s=>new D3(e,r,n,s))}function v_(n,e){const t=wh(n.firestore,Nm),r=v3(n),s=k3(n.converter,e);return V3(t,[x3(eT(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,hs.exists(!1))]).then(()=>r)}function V3(n,e){return function(r,s){const i=new Js;return r.asyncQueue.enqueueAndForget(async()=>n3(await p3(r),s,i)),i.promise}(YE(n),e)}(function(e,t=!0){(function(s){fa=s})(w5),uh(new Rl("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),l=new Nm(new k5(r.getProvider("auth-internal")),new L5(r.getProvider("app-check-internal")),function(h,d){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new fe(Z.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Nl(h.options.projectId,d)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),l._setSettings(i),l},"PUBLIC").setMultipleInstances(!0)),Bo(kv,"4.7.3",e),Bo(kv,"4.7.3","esm2017")})();class F3{constructor(){we(this,"db");we(this,"TRADE_COLLECTION","trade_logs");we(this,"BACKTEST_COLLECTION","backtest_logs");const t=Fb({apiKey:void 0,projectId:void 0,appId:void 0});this.db=_3(t)}async logTrade(e){try{const t=await v_(ol(this.db,this.TRADE_COLLECTION),{...e,timestamp:pt.fromDate(e.timestamp)});ls.info("Trade logged to Firebase",{tradeId:t.id,symbol:e.symbol,type:e.type})}catch(t){throw ls.error("Failed to log trade to Firebase:",t),t}}async logBacktest(e){try{const t=await v_(ol(this.db,this.BACKTEST_COLLECTION),{...e,timestamp:pt.fromDate(e.timestamp),results:{...e.results,startTime:pt.fromDate(e.results.startTime),endTime:pt.fromDate(e.results.endTime)}});ls.info("Backtest logged to Firebase",{backtestId:t.id,strategy:e.strategy,pnl:e.results.pnl})}catch(t){throw ls.error("Failed to log backtest to Firebase:",t),t}}async getRecentTrades(e=100,t){try{let r=ju(ol(this.db,this.TRADE_COLLECTION),m_("timestamp","desc"),e(e));return t&&(r=ju(r,Du("strategy","==",t))),(await Lp(r)).docs.map(i=>({...i.data(),timestamp:i.data().timestamp.toDate()}))}catch(r){throw ls.error("Failed to fetch recent trades:",r),r}}async getStrategyPerformance(e,t,r){try{const s=ju(ol(this.db,this.BACKTEST_COLLECTION),Du("strategy","==",e),Du("timestamp",">=",pt.fromDate(t)),Du("timestamp","<=",pt.fromDate(r))),o=(await Lp(s)).docs.map(u=>u.data());if(o.length===0)return{trades:0,winRate:0,pnl:0,sharpeRatio:0};const l=o.reduce((u,h)=>({trades:u.trades+h.results.trades,winRate:u.winRate+h.results.winRate,pnl:u.pnl+h.results.pnl,sharpeRatio:u.sharpeRatio+h.results.sharpeRatio}),{trades:0,winRate:0,pnl:0,sharpeRatio:0});return{trades:l.trades,winRate:l.winRate/o.length,pnl:l.pnl,sharpeRatio:l.sharpeRatio/o.length}}catch(s){throw ls.error("Failed to fetch strategy performance:",s),s}}async getTopStrategies(e="sharpeRatio",t=5){try{const r=ju(ol(this.db,this.BACKTEST_COLLECTION),m_(`results.${e}`,"desc"),t(t));return(await Lp(r)).docs.map(i=>({strategy:i.data().strategy,value:i.data().results[e]}))}catch(r){throw ls.error("Failed to fetch top strategies:",r),r}}}const Vp=new F3;function U3(){const[n,e]=se.useState([]),[t,r]=se.useState(""),[s,i]=se.useState({start:new Date(Date.now()-30*24*60*60*1e3),end:new Date}),[o,l]=se.useState(null),[u,h]=se.useState([]);se.useEffect(()=>{d()},[t,s]);const d=async()=>{try{const g=await Vp.getRecentTrades(100,t);if(e(g),t){const _=await Vp.getStrategyPerformance(t,s.start,s.end);l(_)}const v=await Vp.getTopStrategies("sharpeRatio",5);h(v)}catch(g){console.error("Error loading log data:",g)}};return m.jsxs("div",{className:"bg-gray-900 rounded-lg p-6",children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsxs("h2",{className:"text-2xl font-bold flex items-center",children:[m.jsx(_h,{className:"w-6 h-6 text-blue-500 mr-2"}),"Trading Logs"]}),m.jsxs("div",{className:"flex items-center space-x-4",children:[m.jsxs("select",{value:t,onChange:g=>r(g.target.value),className:"bg-gray-800 border border-gray-700 rounded-lg px-3 py-1",children:[m.jsx("option",{value:"",children:"All Strategies"}),u.map((g,v)=>m.jsx("option",{value:g.strategy,children:g.strategy},v))]}),m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx(q2,{className:"w-5 h-5 text-gray-400"}),m.jsx("input",{type:"date",value:s.start.toISOString().split("T")[0],onChange:g=>i({...s,start:new Date(g.target.value)}),className:"bg-gray-800 border border-gray-700 rounded-lg px-2 py-1"}),m.jsx("span",{className:"text-gray-400",children:"to"}),m.jsx("input",{type:"date",value:s.end.toISOString().split("T")[0],onChange:g=>i({...s,end:new Date(g.target.value)}),className:"bg-gray-800 border border-gray-700 rounded-lg px-2 py-1"})]})]})]}),m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[m.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[m.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[m.jsx(__,{className:"w-5 h-5 text-blue-500 mr-2"}),"Recent Trades"]}),m.jsx("div",{className:"overflow-x-auto",children:m.jsxs("table",{className:"w-full",children:[m.jsx("thead",{children:m.jsxs("tr",{className:"text-left text-gray-400",children:[m.jsx("th",{className:"pb-2",children:"Time"}),m.jsx("th",{className:"pb-2",children:"Symbol"}),m.jsx("th",{className:"pb-2",children:"Type"}),m.jsx("th",{className:"pb-2",children:"Price"}),m.jsx("th",{className:"pb-2",children:"Status"})]})}),m.jsx("tbody",{children:n.map((g,v)=>m.jsxs("tr",{className:"border-t border-gray-700",children:[m.jsx("td",{className:"py-2",children:new Date(g.timestamp).toLocaleTimeString()}),m.jsx("td",{className:"py-2",children:g.symbol}),m.jsx("td",{className:"py-2",children:m.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${g.type==="BUY"?"bg-green-500/20 text-green-500":"bg-red-500/20 text-red-500"}`,children:g.type})}),m.jsxs("td",{className:"py-2",children:["$",Number(g.price).toFixed(2)]}),m.jsx("td",{className:"py-2",children:m.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${g.execution.status==="FILLED"?"bg-green-500/20 text-green-500":"bg-yellow-500/20 text-yellow-500"}`,children:g.execution.status})})]},v))})]})})]}),m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[m.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[m.jsx(Ui,{className:"w-5 h-5 text-blue-500 mr-2"}),"Top Performing Strategies"]}),m.jsx("div",{className:"space-y-4",children:u.map((g,v)=>m.jsxs("div",{className:"flex items-center justify-between border-t border-gray-700 pt-2",children:[m.jsx("span",{className:"text-gray-300",children:g.strategy}),m.jsx("span",{className:"text-green-500",children:g.value.toFixed(2)})]},v))})]}),o&&m.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[m.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Strategy Performance"}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-400",children:"Total Trades"}),m.jsx("p",{className:"text-2xl font-bold",children:o.trades})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-400",children:"Win Rate"}),m.jsxs("p",{className:"text-2xl font-bold text-green-500",children:[(o.winRate*100).toFixed(1),"%"]})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-400",children:"Total PnL"}),m.jsxs("p",{className:`text-2xl font-bold ${o.pnl>=0?"text-green-500":"text-red-500"}`,children:["$",o.pnl.toFixed(2)]})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-400",children:"Sharpe Ratio"}),m.jsx("p",{className:"text-2xl font-bold text-blue-500",children:o.sharpeRatio.toFixed(2)})]})]})]})]})]})]})}const lT=kg(n=>({user:null,profile:null,isLoading:!0,signIn:async(e,t)=>{const{error:r}=await Xt.auth.signInWithPassword({email:e,password:t});if(r)throw r},signUp:async(e,t)=>{const{error:r}=await Xt.auth.signUp({email:e,password:t});if(r)throw r},signOut:async()=>{const{error:e}=await Xt.auth.signOut();if(e)throw e;n({user:null,profile:null})},loadUser:async()=>{try{n({isLoading:!0});const{data:{user:e}}=await Xt.auth.getUser();if(e){const{data:t}=await Xt.from("profiles").select("*").eq("id",e.id).single();n({user:e,profile:t})}}catch(e){console.error("Error loading user:",e)}finally{n({isLoading:!1})}}}));function $3(){const[n,e]=se.useState(!1),[t,r]=se.useState(""),[s,i]=se.useState(""),[o,l]=se.useState(null),{signIn:u,signUp:h}=lT(),d=async g=>{g.preventDefault(),l(null);try{n?await h(t,s):await u(t,s)}catch(v){l(v.message)}};return m.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-900 py-12 px-4 sm:px-6 lg:px-8",children:m.jsxs("div",{className:"max-w-md w-full space-y-8",children:[m.jsx("div",{children:m.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-white",children:n?"Create your account":"Sign in to your account"})}),m.jsxs("form",{className:"mt-8 space-y-6",onSubmit:d,children:[m.jsxs("div",{className:"rounded-md shadow-sm -space-y-px",children:[m.jsxs("div",{children:[m.jsx("label",{htmlFor:"email-address",className:"sr-only",children:"Email address"}),m.jsx("input",{id:"email-address",name:"email",type:"email",autoComplete:"email",required:!0,className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-700 placeholder-gray-500 text-white bg-gray-800 rounded-t-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Email address",value:t,onChange:g=>r(g.target.value)})]}),m.jsxs("div",{children:[m.jsx("label",{htmlFor:"password",className:"sr-only",children:"Password"}),m.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-700 placeholder-gray-500 text-white bg-gray-800 rounded-b-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Password",value:s,onChange:g=>i(g.target.value)})]})]}),o&&m.jsx("div",{className:"text-red-500 text-sm text-center",children:o}),m.jsx("div",{children:m.jsx("button",{type:"submit",className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:n?"Sign up":"Sign in"})})]}),m.jsx("div",{className:"text-center",children:m.jsx("button",{onClick:()=>e(!n),className:"text-sm text-blue-500 hover:text-blue-400",children:n?"Already have an account? Sign in":"Don't have an account? Sign up"})})]})})}function B3(){const{user:n,isLoading:e}=lT(),[t,r]=se.useState("BTC/USDT"),[s,i]=se.useState(!1),o=M1(),l=()=>{var _,E,x;const h=Number(((_=o.BTCUSDT)==null?void 0:_.price)||0)*.5,d=Number(((E=o.ETHUSDT)==null?void 0:E.price)||0)*2,g=Number(((x=o.SOLUSDT)==null?void 0:x.price)||0)*10;return(h+d+g).toFixed(2)},u=[{title:"AI Models",value:"12",icon:m.jsx(fl,{className:"w-6 h-6 text-purple-500"}),change:"+2.4%",positive:!0},{title:"Active Algorithms",value:"8",icon:m.jsx(Lu,{className:"w-6 h-6 text-blue-500"}),change:"+1.2%",positive:!0},{title:"Risk Score",value:"Low",icon:m.jsx(Sd,{className:"w-6 h-6 text-green-500"}),change:"-0.5%",positive:!0},{title:"Portfolio Value",value:`$${l()}`,icon:m.jsx(jy,{className:"w-6 h-6 text-yellow-500"}),change:"+5.3%",positive:!0}];return e?m.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:m.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-blue-500"})}):n?m.jsxs("div",{className:"min-h-screen bg-[#0a0b0d] text-white",children:[m.jsx(My,{}),m.jsxs("main",{className:"p-6",children:[m.jsxs("div",{className:"mb-12 text-center",children:[m.jsx("h1",{className:"text-4xl font-bold mb-4",children:"Advanced Digital Asset Trading"}),m.jsx("p",{className:"text-gray-400 max-w-2xl mx-auto",children:"Leverage cutting-edge AI and machine learning algorithms to maximize your trading potential"})]}),m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-12",children:u.map((h,d)=>m.jsx(G2,{...h},d))}),m.jsx("div",{className:"mb-12",children:m.jsx(W4,{})}),m.jsx("div",{className:"mb-12",children:m.jsx(XV,{})}),m.jsx("div",{className:"mb-12",children:m.jsx(U3,{})}),m.jsx("div",{className:"mb-12",children:m.jsx(Bj,{})}),m.jsx("div",{className:"mb-12",children:m.jsx(Lj,{})}),m.jsx("div",{className:"mb-12",children:m.jsx(Fj,{})}),m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[m.jsx(Rj,{selectedAsset:t,onAssetChange:r}),m.jsx(Mj,{})]})]})]}):m.jsxs("div",{className:"min-h-screen bg-gray-900 text-white",children:[s?m.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:m.jsxs("div",{className:"bg-gray-800 p-8 rounded-lg w-full max-w-md",children:[m.jsx($3,{}),m.jsx("button",{onClick:()=>i(!1),className:"mt-4 w-full px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg",children:"Back to Home"})]})}):null,m.jsx(My,{}),m.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-24",children:m.jsxs("div",{className:"text-center",children:[m.jsx("h1",{className:"text-5xl font-bold mb-6",children:"Teaka Trade — Automated Intelligence for Everyone"}),m.jsx("p",{className:"text-xl text-gray-400 mb-12",children:"Turn signals into smart execution with zero code"}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mb-16",children:[m.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[m.jsx("div",{className:"text-blue-500 mb-4",children:m.jsx(fl,{className:"w-12 h-12 mx-auto"})}),m.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Select a Strategy"}),m.jsx("p",{className:"text-gray-400",children:"Choose from proven algorithms or create your own"})]}),m.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[m.jsx("div",{className:"text-green-500 mb-4",children:m.jsx(Sd,{className:"w-12 h-12 mx-auto"})}),m.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Set Your Risk Level"}),m.jsx("p",{className:"text-gray-400",children:"Customize position sizing and risk parameters"})]}),m.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[m.jsx("div",{className:"text-purple-500 mb-4",children:m.jsx(Lu,{className:"w-12 h-12 mx-auto"})}),m.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Auto-Trade in Real-Time"}),m.jsx("p",{className:"text-gray-400",children:"Let AI handle execution while you monitor"})]})]}),m.jsxs("div",{className:"flex justify-center space-x-6",children:[m.jsx("button",{onClick:()=>i(!0),className:"px-8 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold",children:"Get Started"}),m.jsx("button",{className:"px-8 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg font-semibold",children:"Learn More"})]})]})}),m.jsx("div",{className:"bg-gray-800 py-24",children:m.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[m.jsx("h2",{className:"text-3xl font-bold mb-12 text-center",children:"How Teaka Works"}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-12",children:[m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-start space-x-4",children:[m.jsx("div",{className:"bg-blue-500/20 p-2 rounded-lg",children:m.jsx(fl,{className:"w-6 h-6 text-blue-500"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"font-semibold mb-2",children:"AI-Powered Signal Generation"}),m.jsx("p",{className:"text-gray-400",children:"Combines ML models with quantitative logic"})]})]}),m.jsxs("div",{className:"flex items-start space-x-4",children:[m.jsx("div",{className:"bg-green-500/20 p-2 rounded-lg",children:m.jsx(Sd,{className:"w-6 h-6 text-green-500"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"font-semibold mb-2",children:"Smart Position Sizing"}),m.jsx("p",{className:"text-gray-400",children:"Adaptive risk models protect your capital"})]})]})]}),m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-start space-x-4",children:[m.jsx("div",{className:"bg-purple-500/20 p-2 rounded-lg",children:m.jsx(Lu,{className:"w-6 h-6 text-purple-500"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"font-semibold mb-2",children:"Multi-Exchange Execution"}),m.jsx("p",{className:"text-gray-400",children:"Trade via KuCoin, OANDA, or MT5"})]})]}),m.jsxs("div",{className:"flex items-start space-x-4",children:[m.jsx("div",{className:"bg-yellow-500/20 p-2 rounded-lg",children:m.jsx(jy,{className:"w-6 h-6 text-yellow-500"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"font-semibold mb-2",children:"Strategy Builder & Grader"}),m.jsx("p",{className:"text-gray-400",children:"Create and validate your trading ideas"})]})]})]})]}),m.jsxs("div",{className:"flex justify-center space-x-6 mt-12",children:[m.jsx("button",{onClick:()=>i(!0),className:"px-8 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold",children:"Try Teaka Lite"}),m.jsx("button",{className:"px-8 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg font-semibold",children:"See Pro Features 🔐"})]})]})}),m.jsx("div",{className:"py-24",children:m.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[m.jsxs("div",{className:"text-center mb-12",children:[m.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Built for Beginners, Powered for Pros"}),m.jsx("p",{className:"text-gray-400",children:"Advanced features wrapped in a simple interface"})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:[m.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[m.jsx("h3",{className:"font-semibold mb-3",children:"User-First Interface"}),m.jsx("p",{className:"text-gray-400",children:"Simple sliders, toggles, and intuitive charts"})]}),m.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[m.jsx("h3",{className:"font-semibold mb-3",children:"Grade-A Intelligence"}),m.jsx("p",{className:"text-gray-400",children:"VaR control and smart risk management"})]}),m.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[m.jsx("h3",{className:"font-semibold mb-3",children:"DeFi Ready"}),m.jsx("p",{className:"text-gray-400",children:"Smart contract integration capabilities"})]}),m.jsxs("div",{className:"bg-gray-800 rounded-lg p-6",children:[m.jsx("h3",{className:"font-semibold mb-3",children:"Flexible Deployment"}),m.jsx("p",{className:"text-gray-400",children:"Run on cloud, server, or local machine"})]})]})]})}),m.jsx("div",{className:"bg-gray-800 py-24",children:m.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[m.jsx("h2",{className:"text-3xl font-bold mb-8",children:"Ready to Start Trading?"}),m.jsxs("div",{className:"flex justify-center space-x-6",children:[m.jsx("button",{onClick:()=>i(!0),className:"px-8 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold",children:"Join Alpha Waitlist"}),m.jsx("button",{className:"px-8 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg font-semibold",children:"Get a Demo"})]})]})}),m.jsx("footer",{className:"border-t border-gray-800 py-12",children:m.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:m.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center",children:[m.jsx("div",{className:"text-gray-400 mb-4 md:mb-0",children:"© Teaka Network | Founder: Gee Martini"}),m.jsxs("div",{className:"flex items-center space-x-6",children:[m.jsx("a",{href:"#",className:"text-gray-400 hover:text-white",children:"Telegram: @teaka_trader_bot"}),m.jsx("a",{href:"#",className:"text-gray-400 hover:text-white",children:"Terms"}),m.jsx("a",{href:"#",className:"text-gray-400 hover:text-white",children:"Privacy"})]})]})})})]})}S_(document.getElementById("root")).render(m.jsx(se.StrictMode,{children:m.jsx(B3,{})}));
//# sourceMappingURL=index-uWPfJvZp.js.map
